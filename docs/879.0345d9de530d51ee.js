"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[879],{3879:(D,Y,M)=>{M.r(Y),M.d(Y,{TGraphPainter:()=>A,clTGraphAsymmErrors:()=>C});var $=M(5368),_=M(1773),P=M(2912),w=M(5611),G=M(2454),j=M(9608),O=M(1671),L=M(9994),N=M(7222);const T=(0,_.BIT)(18),X="TGraphErrors",C="TGraphAsymmErrors",z="TGraphBentErrors",S="TGraphMultiErrors";class A extends G.tK{constructor(t,i){super(t,i),this.axes_draw=!1,this.bins=null,this.xmin=this.ymin=this.xmax=this.ymax=0,this.wheel_zoomy=!0,this.is_bent=i._typename==z,this.has_errors=i._typename==X||i._typename==S||i._typename==C||this.is_bent||i._typename.match(/^RooHist/)}redraw(){var t=this;return(0,$.Z)(function*(){let i=Promise.resolve(!0);if(t.$redraw_hist){delete t.$redraw_hist;let r=t.getMainPainter();r?.$secondary&&t.axes_draw&&(i=r.redraw())}return i.then(()=>t.drawGraph())})()}cleanup(){delete this.interactive_bin,delete this.bins,super.cleanup()}get_gme(){let t=this.getObject();return t?._typename==S?t:null}decodeOptions(t,i){(0,_.isStr)(t)&&0==t.indexOf("same ")&&(t=t.slice(5));let r=this.getObject(),s=!!this.get_gme(),n=[],l=i?!!this.getMainPainter():!this.axes_draw;this.options||(this.options={});const g=(x,e)=>{Object.assign(e,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),s&&x.check("S=",!0)&&(e.ScaleErrX=x.partAsFloat()),x.check("L")&&(e.Line=1),x.check("F")&&(e.Fill=1),x.check("CC")&&(e.Curve=2),x.check("C")&&(e.Curve=1),x.check("*")&&(e.Mark=103),x.check("P0")&&(e.Mark=104),x.check("P")&&(e.Mark=1),x.check("B")&&(e.Bar=1,e.Errors=0),x.check("Z")&&(e.Errors=1,e.Ends=0),x.check("||")&&(e.Errors=1,e.MainError=0,e.Ends=1),x.check("[]")&&(e.Errors=1,e.MainError=0,e.Ends=2),x.check("|>")&&(e.Errors=1,e.Ends=3),x.check(">")&&(e.Errors=1,e.Ends=4),x.check("0")&&(e.Mark=1,e.Errors=1,e.OutRange=1),x.check("1")&&1==e.Bar&&(e.Bar=2),x.check("2")&&(e.Rect=1,e.Errors=0),x.check("3")&&(e.EF=1,e.Errors=0),x.check("4")&&(e.EF=2,e.Errors=0),x.check("5")&&(e.Rect=2,e.Errors=0),x.check("X")&&(e.Errors=0)};Object.assign(this.options,{Axis:"",NoOpt:0,PadStats:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),s&&t&&(t.indexOf(";")>0?(n=t.split(";"),t=n.shift()):t.indexOf("_")>0&&(n=t.split("_"),t=n.shift()));let a=this.options,f=new w.pc(t);a.PadStats=f.check("USE_PAD_STATS");let y="";if(["USE_PAD_TITLE","LOGXY","LOGX","LOGY","LOGZ","GRIDXY","GRIDX","GRIDY","TICKXY","TICKX","TICKY"].forEach(x=>{f.check(x)&&(y+=";"+x)}),f.check("XAXIS_",!0)&&(y+=";XAXIS_"+f.part),f.check("YAXIS_",!0)&&(y+=";YAXIS_"+f.part),f.empty()&&(a.original=l?"lp":"alp",f=new w.pc(a.original)),f.check("NOOPT")&&(a.NoOpt=1),f.check("POS3D_",!0)&&(a.pos3d=f.partAsInt()-.5),a._pfc=f.check("PFC"),a._plc=f.check("PLC"),a._pmc=f.check("PMC"),f.check("A")&&(a.Axis=f.check("I")?"A":"AXIS"),f.check("X+")&&(a.Axis+="X+",a.second_x=l),f.check("Y+")&&(a.Axis+="Y+",a.second_y=l),f.check("RX")&&(a.Axis+="RX"),f.check("RY")&&(a.Axis+="RY"),s&&(a.blocks=[],a.skip_errors_x0=a.skip_errors_y0=!1,f.check("X0")&&(a.skip_errors_x0=!0),f.check("Y0")&&(a.skip_errors_y0=!0)),g(f,a),s&&f.check("S")&&(a.individual_styles=!0),void 0===a.Errors&&(a.Errors=!this.has_errors||s&&n.length?0:1),1==a.Mark&&1==r.fMarkerStyle&&(a.Mark=101),a.Line+a.Fill+a.Curve+a.Mark+a.Bar+a.EF+a.Rect+a.Errors==0&&f.empty()&&(a.Line=1),r._typename==X){let x=r.fEX.length,e=0;for(let h=0;h<x;++h)e=Math.max(e,r.fEX[h],r.fEY[h]);e<1e-100&&(a.Errors=0)}if(a.Axis)a.Axis.indexOf("A")<0&&(a.Axis="AXIS,"+a.Axis);else{let e=this.getPadPainter()?.getRootPad(!0);(!e||e?.fPrimitives?.arr[0]===r)&&(a.Axis="AXIS")}a.Axis+=y;for(let x=0;x<n.length;++x){let h={};g(new w.pc(n[x]),h),h.skip_errors_x0=a.skip_errors_x0,h.skip_errors_y0=a.skip_errors_y0,a.blocks.push(h)}}extractGmeErrors(t){if(!this.bins)return;let i=this.getObject();this.bins.forEach(r=>{r.eylow=i.fEyL[t][r.indx],r.eyhigh=i.fEyH[t][r.indx]})}createBins(){let t=this.getObject();if(!t)return;let i=0,r=t.fNpoints;t._typename===_.clTCutG&&r>3&&r--,t._typename==X?i=1:t._typename==S?i=2:(t._typename==C||t._typename==z||t._typename.match(/^RooHist/))&&(i=3),this.bins=new Array(r);for(let s=0;s<r;++s){let n=this.bins[s]={x:t.fX[s],y:t.fY[s],indx:s};switch(i){case 1:n.exlow=n.exhigh=t.fEX[s],n.eylow=n.eyhigh=t.fEY[s];break;case 2:n.exlow=t.fExL[s],n.exhigh=t.fExH[s],n.eylow=t.fEyL[0][s],n.eyhigh=t.fEyH[0][s];break;case 3:n.exlow=t.fEXlow[s],n.exhigh=t.fEXhigh[s],n.eylow=t.fEYlow[s],n.eyhigh=t.fEYhigh[s]}0===s&&(this.xmin=this.xmax=n.x,this.ymin=this.ymax=n.y),i>0?(this.xmin=Math.min(this.xmin,n.x-n.exlow,n.x+n.exhigh),this.xmax=Math.max(this.xmax,n.x-n.exlow,n.x+n.exhigh),this.ymin=Math.min(this.ymin,n.y-n.eylow,n.y+n.eyhigh),this.ymax=Math.max(this.ymax,n.y-n.eylow,n.y+n.eyhigh)):(this.xmin=Math.min(this.xmin,n.x),this.xmax=Math.max(this.xmax,n.x),this.ymin=Math.min(this.ymin,n.y),this.ymax=Math.max(this.ymax,n.y))}}createHistogram(t,i){!t&&!i&&(t=i=!0);let r=this.xmin,s=this.xmax,n=this.ymin,l=this.ymax;r>=s&&(s=r+1),n>=l&&(l=n+1);let g=.1*(s-r),a=.1*(l-n),f=r-g,y=s+g,o=n-a,x=l+a;f<0&&r>=0&&(f=.9*r),y>0&&s<=0&&(y=0);let e=this.getObject(),h=e.fHistogram,m=o,c=x;if(h)h.fMaximum!=_.kNoZoom&&h.fMinimum!=_.kNoZoom&&(o=h.fMinimum,x=h.fMaximum);else{h=e.fHistogram=(0,_.createHistogram)("TH1F",100),h.fName=e.fName+"_h";const d=(0,_.BIT)(9);h.fBits=h.fBits|d,this._own_histogram=!0}return e.fMinimum!=_.kNoZoom&&(o=n=e.fMinimum),e.fMaximum!=_.kNoZoom&&(x=e.fMaximum),o<0&&n>=0&&(o=.9*n),h.fTitle=e.fTitle,t&&(h.fXaxis.fXmin=f,h.fXaxis.fXmax=y),i&&(h.fYaxis.fXmin=Math.min(m,o),h.fYaxis.fXmax=Math.max(c,x),h.fMinimum=o,h.fMaximum=x),h}unzoomUserRange(t,i){let r=this.getObject();if(this._own_histogram||!r)return!1;let s=r.fHistogram;return i=i&&s&&(s.fYaxis.fXmin>this.ymin||s.fYaxis.fXmax<this.ymax),!(!(t=t&&s&&(s.fXaxis.fXmin>this.xmin||s.fXaxis.fXmax<this.xmax))&&!i||(this.createHistogram(t,i),this.getMainPainter()?.extractAxesProperties(1),0))}canOptimize(){return _.settings.OptimizeDraw>0&&!this.options.NoOpt}optimizeBins(t,i){if(this.bins.length<30&&!i)return this.bins;let r=null;if((0,_.isFunc)(i))for(let l=0;l<this.bins.length;++l)i(this.bins[l],l)?r||(r=0==l?[]:this.bins.slice(0,l)):r&&r.push(this.bins[l]);if(r||(r=this.bins),t||(t=5e5),r.length<t||!this.canOptimize())return r;let s=Math.floor(r.length/t);s<2&&(s=2);let n=[];for(let l=0;l<r.length;l+=s)n.push(r[l]);return n}getTooltips(t){let r=[],s=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),n=this.get_gme();if(r.push(this.getObjectHint()),t&&s)if(void 0!==t.indx&&r.push("p = "+t.indx),r.push("x = "+s.axisAsText("x",t.x),"y = "+s.axisAsText("y",t.y)),n?r.push("error x = -"+s.axisAsText("x",n.fExL[t.indx])+"/+"+s.axisAsText("x",n.fExH[t.indx])):this.options.Errors&&"normal"==s.x_handle.kind&&(t.exlow||t.exhigh)&&r.push("error x = -"+s.axisAsText("x",t.exlow)+"/+"+s.axisAsText("x",t.exhigh)),n)for(let l=0;l<n.fNYErrors;++l)r.push(`error y${l} = -${s.axisAsText("y",n.fEyL[l][t.indx])}/+${s.axisAsText("y",n.fEyH[l][t.indx])}`);else(this.options.Errors||this.options.EF>0)&&"normal"==s.y_handle.kind&&(t.eylow||t.eyhigh)&&r.push("error y = -"+s.axisAsText("y",t.eylow)+"/+"+s.axisAsText("y",t.eyhigh));return r}get_main(){let t=this.getFramePainter();if(t&&t.grx&&t.gry)return t;let i=this.getPadPainter(),r=i?.getPadRect()||{width:800,height:600};return t={pad_layer:!0,pad:i?.getRootPad(!0),pw:r.width,ph:r.height,getFrameWidth(){return this.pw},getFrameHeight(){return this.ph},grx(s){return(s=this.pad.fLogx?s>0?Math.log10(s):this.pad.fUxmin:(s-this.pad.fX1)/(this.pad.fX2-this.pad.fX1))*this.pw},gry(s){return(1-(s=this.pad.fLogy?s>0?Math.log10(s):this.pad.fUymin:(s-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)))*this.ph},revertAxis(s,n){return"x"==s?n/this.pw*(this.pad.fX2-this.pad.fX1)+this.pad.fX1:"y"==s?(1-n/this.ph)*(this.pad.fY2-this.pad.fY1)+this.pad.fY1:n},getGrFuncs(){return this}},t.pad?t:null}appendExclusion(t,i,r,s){let n=[];for(let g=r.length-1;g>=0;--g){let a=r[g],f=Math.sqrt(a.dgrx**2+a.dgry**2);a.grx+=s*a.dgry/f,a.gry-=s*a.dgrx/f,n.push(a)}let l=(0,w.Cq)(t?"Lbezier":"Lline",n);this.draw_g.append("svg:path").attr("d",i.path+l.path+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,i,r,s,n,l,g,a){let f=this.getObject(),y=0,o=null;if(a&&l.excl_side&&(y=l.excl_width,l.width>0&&!i.Line&&!i.Curve&&(i.Line=1)),i.EF){o=this.optimizeBins(i.EF>1?2e4:0);for(let c=0;c<o.length;++c){let d=o[c];d.grx=t.grx(d.x),d.gry=t.gry(d.y-d.eylow)}let e=(0,w.Cq)(i.EF>1?"bezier":"line",o),h=[];for(let c=o.length-1;c>=0;--c){let d=o[c];d.gry=t.gry(d.y+d.eyhigh),h.push(d)}let m=(0,w.Cq)(i.EF>1?"Lbezier":"Lline",h);r.append("svg:path").attr("d",e.path+m.path+"Z").call(g.func),a&&(this.draw_kind="lines")}if(i.Line||i.Fill){let e="";f._typename==_.clTCutG&&(i.Fill=1),i.Fill&&(e="Z",y=0),o||(o=this.optimizeBins(0));for(let d=0;d<o.length;++d){let p=o[d];p.grx=t.grx(p.x),p.gry=t.gry(p.y)}let h="line";y&&(h+="calc");let m=(0,w.Cq)(h,o);y&&this.appendExclusion(!1,m,o,y);let c=r.append("svg:path").attr("d",m.path+e);i.Line&&c.call(l.func),i.Fill?c.call(g.func):c.style("fill","none"),a&&(this.draw_kind="lines")}if(i.Curve){let e=o;if("lines"!=this.draw_kind||!e||1==i.Curve&&e.length>2e4){e=this.optimizeBins(1==i.Curve?2e4:0);for(let c=0;c<e.length;++c){let d=e[c];d.grx=t.grx(d.x),d.gry=t.gry(d.y)}}let h="bezier";y&&(h+="calc");let m=(0,w.Cq)(h,e);y&&this.appendExclusion(!0,m,e,y),r.append("svg:path").attr("d",m.path).call(l.func).style("fill","none"),a&&(this.draw_kind="lines")}let x=null;if((i.Errors||i.Rect||i.Bar)&&(o=this.optimizeBins(5e3,(e,h)=>{let m=t.grx(e.x);if(!i.Bar&&(m<0||m>s))return!0;let c=t.gry(e.y);return!i.Bar&&!i.OutRange&&(c<0||c>n)||(e.grx1=Math.round(m),e.gry1=Math.round(c),this.has_errors&&(e.grx0=Math.round(t.grx(e.x-i.ScaleErrX*e.exlow)-m),e.grx2=Math.round(t.grx(e.x+i.ScaleErrX*e.exhigh)-m),e.gry0=Math.round(t.gry(e.y-e.eylow)-c),e.gry2=Math.round(t.gry(e.y+e.eyhigh)-c),this.is_bent?(e.grdx0=Math.round(t.gry(e.y+f.fEXlowd[h])-c),e.grdx2=Math.round(t.gry(e.y+f.fEXhighd[h])-c),e.grdy0=Math.round(t.grx(e.x+f.fEYlowd[h])-m),e.grdy2=Math.round(t.grx(e.x+f.fEYhighd[h])-m)):e.grdx0=e.grdx2=e.grdy0=e.grdy2=0),!1)}),a&&(this.draw_kind="nodes"),x=r.selectAll(".grpoint").data(o).enter().append("svg:g").attr("class","grpoint").attr("transform",e=>`translate(${e.grx1},${e.gry1})`)),i.Bar){for(let m=1;m<o.length-1;++m)o[m].width=Math.max(2,(o[m+1].grx1-o[m-1].grx1)/2-2);switch(o.length){case 0:break;case 1:o[0].width=s/4;break;case 2:o[0].width=o[1].width=(o[1].grx1-o[0].grx1)/2;break;default:o[0].width=o[1].width,o[o.length-1].width=o[o.length-2].width}let e=Math.round(t.gry(0)),h=g;if(a){let m=this.getFramePainter(),c=m?.fillatt&&!m?.fillatt.empty()?m.fillatt.getFillColor():-1;c===g.getFillColor()&&(h=new L.Y({color:"white"==c?1:0,pattern:1001}))}x.append("svg:path").attr("d",m=>{m.bar=!0;let c=Math.round(-m.width/2),d=Math.round(m.width);return`M${c},${1!==i.Bar?0:m.gry1>e?e-m.gry1:0}h${d}v${1!==i.Bar?n>m.gry1?n-m.gry1:0:Math.abs(e-m.gry1)}h${-d}z`}).call(h.func)}if(i.Rect&&x.filter(e=>e.exlow>0&&e.exhigh>0&&e.eylow>0&&e.eyhigh>0).append("svg:path").attr("d",e=>(e.rect=!0,`M${e.grx0},${e.gry0}H${e.grx2}V${e.gry2}H${e.grx0}Z`)).call(g.func).call(2===i.Rect?l.func:()=>{}),this.error_size=0,i.Errors){let e=l.width+_.gStyle.fEndErrorSize,h=0,m=i.Ends?`m0,${e}v${-2*e}`:"",c=i.Ends?`m${e},0h${-2*e}`:"",d=m,p=m,b=c,k=c;const E=(u,F)=>{if(!i.MainError)return`M${u},${F}`;let B="M0,0";return u?B+(F?`L${u},${F}`:`H${u}`):F?B+`V${F}`:B};switch(i.Ends){case 2:h=Math.max(l.width+1,Math.round(.66*e)),d=`m${h},${e}h${-h}v${-2*e}h${h}`,p=`m${-h},${e}h${h}v${-2*e}h${-h}`,b=`m${-e},${h}v${-h}h${2*e}v${h}`,k=`m${-e},${-h}v${h}h${2*e}v${-h}`;break;case 3:e=Math.max(e,Math.round(8*f.fMarkerSize*.66)),h=Math.max(l.width+1,Math.round(.66*e)),d=`l${h},${e}v${-2*e}l${-h},${e}`,p=`l${-h},${e}v${-2*e}l${h},${e}`,b=`l${-e},${h}h${2*e}l${-e},${-h}`,k=`l${-e},${-h}h${2*e}l${-e},${h}`;break;case 4:e=Math.max(e,Math.round(8*f.fMarkerSize*.66)),h=Math.max(l.width+1,Math.round(.66*e)),d=`l${h},${e}m0,${-2*e}l${-h},${e}`,p=`l${-h},${e}m0,${-2*e}l${h},${e}`,b=`l${-e},${h}m${2*e},0l${-e},${-h}`,k=`l${-e},${-h}m${2*e},0l${-e},${h}`}this.error_size=e,e=Math.floor((l.width-1)/2);let v=x.filter(u=>u.exlow>0||u.exhigh>0||u.eylow>0||u.eyhigh>0);(i.skip_errors_x0||i.skip_errors_y0)&&(v=v.filter(u=>!(0==u.x&&i.skip_errors_x0||0==u.y&&i.skip_errors_y0))),!(0,_.isBatchMode)()&&_.settings.Tooltip&&a&&v.append("svg:path").style("fill","none").style("pointer-events","visibleFill").attr("d",u=>`M${u.grx0},${u.gry0}h${u.grx2-u.grx0}v${u.gry2-u.gry0}h${u.grx0-u.grx2}z`),v.append("svg:path").call(l.func).style("fill","none").attr("d",u=>(u.error=!0,(u.exlow>0?E(u.grx0+e,u.grdx0)+d:"")+(u.exhigh>0?E(u.grx2-e,u.grdx2)+p:"")+(u.eylow>0?E(u.grdy0,u.gry0-e)+k:"")+(u.eyhigh>0?E(u.grdy2,u.gry2+e)+b:"")))}if(i.Mark){this.createAttMarker({attr:f,style:i.Mark-100}),this.marker_size=this.markeratt.getFullSize(),this.markeratt.resetPos();let h,m,c,e="",d=!(0,_.isBatchMode)()&&_.settings.Tooltip&&(!this.markeratt.fill||this.marker_size<7)&&!x&&a,p="",b=Math.max(5,Math.round(.7*this.marker_size)),k=1e6/(this.markeratt.getMarkerLength()+7),E=1;o?this.canOptimize()&&o.length>1.5*k&&(E=Math.min(2,Math.round(o.length/k))):o=this.optimizeBins(k);for(let v=0;v<o.length;v+=E)h=o[v],m=t.grx(h.x),m>-this.marker_size&&m<s+this.marker_size&&(c=t.gry(h.y),c>-this.marker_size&&c<n+this.marker_size&&(e+=this.markeratt.create(m,c),d&&(p+=`M${m-b},${c-b}h${2*b}v${2*b}h${-2*b}z`)));e&&(r.append("svg:path").attr("d",e).call(this.markeratt.func),null===x&&"none"==this.draw_kind&&a&&(this.draw_kind=101==i.Mark?"path":"mark")),d&&p&&r.append("svg:path").attr("d",p).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,i){let r=Math.max(t.scale_xmin,i.fXq1),s=Math.min(t.scale_xmax,i.fXq2),n=Math.max(t.scale_ymin,i.fYq1),l=Math.min(t.scale_ymax,i.fYq2),g="",a=(e,h,m,c)=>`M${t.grx(e)},${t.gry(h)}L${t.grx(m)},${t.gry(c)}`,f=(i.fYq2-i.fYq1)*(t.scale_xmin-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1,y=(i.fYq2-i.fYq1)*(t.scale_xmax-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1;g=f<t.scale_ymin?a((i.fXq2-i.fXq1)*(t.scale_ymin-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymin,r,n):a(t.scale_xmin,f,r,n),g+=y>t.scale_ymax?a(s,l,(i.fXq2-i.fXq1)*(t.scale_ymax-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymax):a(s,l,t.scale_xmax,y);let o=new O.rE({style:1,width:1,color:"black"}),x=new O.rE({style:2,width:1,color:"black"});this.draw_g.append("path").attr("d",a(r,n,s,l)).call(o.func).style("fill","none"),this.draw_g.append("path").attr("d",g).call(x.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}drawGraph(){let t=this.get_main(),i=this.getObject();if(!t)return;if(this.options.pos3d)return this.drawBins3D(t,i);let r=!!this.get_gme(),s=t.getGrFuncs(this.options.second_x,this.options.second_y),n=t.getFrameWidth(),l=t.getFrameHeight();if(this.createG(!t.pad_layer),this.options._pfc||this.options._plc||this.options._pmc){let a=this.getMainPainter();if((0,_.isFunc)(a?.createAutoColor)){let f=a.createAutoColor();this.options._pfc&&(i.fFillColor=f,delete this.fillatt),this.options._plc&&(i.fLineColor=f,delete this.lineatt),this.options._pmc&&(i.fMarkerColor=f,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1}}this.createAttLine({attr:i,can_excl:!0}),this.createAttFill({attr:i}),this.fillatt.used=!1,this.draw_kind="none",this.marker_size=0;let g=r?this.draw_g.append("svg:g"):this.draw_g;if(this.drawBins(s,this.options,g,n,l,this.lineatt,this.fillatt,!0),"TGraphQQ"==i._typename&&this.appendQQ(s,i),r){for(let a=0;a<i.fNYErrors;++a){let f=this.lineatt,y=this.fillatt;this.options.individual_styles&&(f=new O.rE({attr:i.fAttLine[a],std:!1}),y=new L.Y({attr:i.fAttFill[a],std:!1,svg:this.getCanvSvg()}));let o=this.draw_g.append("svg:g"),x=a<this.options.blocks.length?this.options.blocks[a]:this.options;this.extractGmeErrors(a),this.drawBins(s,x,o,n,l,f,y)}this.extractGmeErrors(0)}(0,_.isBatchMode)()||(0,N.Z)(this,this.testEditable())}extractTooltip(t){if(!t)return null;if("lines"==this.draw_kind||"path"==this.draw_kind||"mark"==this.draw_kind)return this.extractTooltipForPath(t);if("nodes"!=this.draw_kind)return null;let i=this.get_main(),r=i.getFrameHeight(),s=this.error_size,n=1===this.options.Bar,l=n?i.getGrFuncs(this.options.second_x,this.options.second_y):null,g=null,a=1e10,f=null,y=this.marker_size?Math.round(this.marker_size/2+1.5):0;if(this.draw_g.selectAll(".grpoint").each(function(){let h=(0,P.Ys)(this).datum();if(void 0===h)return;let c,m=(t.x-h.grx1)**2;if(1===t.nproc&&(m+=(t.y-h.gry1)**2),m>=a)return;if(h.error||h.rect||h.marker)c={x1:Math.min(-s,h.grx0,-y),x2:Math.max(s,h.grx2,y),y1:Math.min(-s,h.gry2,-y),y2:Math.max(s,h.gry0,y)};else if(h.bar){if(c={x1:-h.width/2,x2:h.width/2,y1:0,y2:r-h.gry1},n){let b=l.gry(0);c.y1=h.gry1>b?b-h.gry1:0,c.y2=h.gry1>b?0:b-h.gry1}}else c={x1:-5,x2:5,y1:-5,y2:5};let p=t.y>=h.gry1+c.y1&&t.y<=h.gry1+c.y2;t.x>=h.grx1+c.x1&&t.x<=h.grx1+c.x2&&(p||t.nproc>1)&&(a=m,g=this,f=c,f.exact=p)}),null===g)return null;let o=(0,P.Ys)(g).datum(),x=this.getObject(),e={name:x.fName,title:x.fTitle,x:o.grx1,y:o.gry1,color1:this.lineatt.color,lines:this.getTooltips(o),rect:f,d3bin:g};return e.user_info={obj:x,name:x.fName,bin:o.indx,cont:o.y,grx:o.grx1,gry:o.gry1},this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(e.color2=this.fillatt.getFillColor()),f.exact&&(e.exact=!0),e.menu=e.exact,e.menu_dist=3,e.bin=o,e.binindx=o.indx,e}showTooltip(t){if(!t)return void(this.draw_g&&this.draw_g.select(".tooltip_bin").remove());if(t.usepath)return this.showTooltipForPath(t);let i=(0,P.Ys)(t.d3bin).datum(),r=this.draw_g.select(".tooltip_bin");r.empty()&&(r=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),t.changed=r.property("current_bin")!==t.d3bin,t.changed&&r.attr("x",i.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",i.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){let i=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(i),i}findBestBin(t){if(!this.bins)return null;let g,a,f,y,o,i="lines"==this.draw_kind,r=-1,s=null,n=1e10,l=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);for(y=0;y<this.bins.length;++y)o=this.bins[y],a=l.grx(o.x),f=l.gry(o.y),g=(t.x-a)**2+(t.y-f)**2,g<n&&(n=g,s=o,r=y);n>100&&i&&(s=null);let x=Math.max(this.lineatt.width+3,4);this.marker_size>0&&(x=Math.max(this.marker_size,x)),s&&(n=Math.sqrt((t.x-l.grx(s.x))**2+(t.y-l.gry(s.y))**2)),!i&&n>x&&(s=null),s||(r=-1);let e={bin:s,indx:r,dist:n,radius:Math.round(x)};if(!s&&i){n=1e10;const h=(b,k,E)=>k>=b&&b>=E||k<=b&&b<=E;let d,m=this.bins[0],c=l.grx(m.x),p=0;for(y=1;y<this.bins.length;++y)o=this.bins[y],a=l.grx(o.x),h(t.x,c,a)&&(d=l.gry(m.y),f=l.gry(o.y),Math.abs(a-c)<1?(p=t.y,g=h(t.y,d,f)?0:Math.min(Math.abs(t.y-d),Math.abs(t.y-f))):(p=d+(t.x-c)/(a-c)*(f-d),g=Math.abs(p-t.y)),g<n&&(n=g,e.linex=t.x,e.liney=p)),m=o,c=a;n<.5*x&&(e.linedist=n,e.closeline=!0)}return e}testEditable(t){let i=this.getObject();return!!i&&(("toggle"==t||void 0!==t&&!t!=i.TestBit(T))&&i.InvertBit(T),!i.TestBit(T))}extractTooltipForPath(t){if(null===this.bins)return null;let i=this.findBestBin(t);if(!i||!i.bin&&!i.closeline)return null;let r="lines"==this.draw_kind,s="mark"==this.draw_kind,l=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),g=this.getObject(),a={name:g.fName,title:g.fTitle,x:i.bin?l.grx(i.bin.x):i.linex,y:i.bin?l.gry(i.bin.y):i.liney,color1:this.lineatt.color,lines:this.getTooltips(i.bin),usepath:!0};return a.user_info={obj:g,name:g.fName,bin:0,cont:0,grx:a.x,gry:a.y},a.ismark=s,a.islines=r,i.closeline?(a.menu=a.exact=!0,a.menu_dist=i.linedist):i.bin&&(this.options.EF&&r?(a.gry1=l.gry(i.bin.y-i.bin.eylow),a.gry2=l.gry(i.bin.y+i.bin.eyhigh)):a.gry1=a.gry2=l.gry(i.bin.y),a.binindx=i.indx,a.bin=i.bin,a.radius=i.radius,a.user_info.bin=i.indx,a.user_info.cont=i.bin.y,a.exact=Math.abs(t.x-a.x)<=i.radius&&(Math.abs(t.y-a.gry1)<=i.radius||Math.abs(t.y-a.gry2)<=i.radius),a.menu=a.exact,a.menu_dist=Math.sqrt((t.x-a.x)**2+Math.min(Math.abs(t.y-a.gry1),Math.abs(t.y-a.gry2))**2)),this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(a.color2=this.fillatt.getFillColor()),r||(a.color1=this.getColor(g.fMarkerColor),a.color2||(a.color2=a.color1)),a}showTooltipForPath(t){let i=this.draw_g.select(".tooltip_bin");if(t&&t.bin){if(i.empty()&&(i=this.draw_g.append("svg:g").attr("class","tooltip_bin")),t.changed=i.property("current_bin")!==t.bin,t.changed)if(i.selectAll("*").remove(),i.property("current_bin",t.bin),t.ismark)i.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{i.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&i.append("svg:circle").attr("cy",Math.round(t.gry2));let r=i.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(this.options.Line||this.options.Curve?r.call(this.lineatt.func):r.style("stroke","black"),this.options.Fill?r.call(this.fillatt.func):r.style("fill","none")):r.style("stroke","black"==t.color1?"green":"black").style("fill","none")}}else i.remove()}moveEnabled(){return this.testEditable()}moveStart(t,i){this.pos_dx=this.pos_dy=0,this.move_funcs=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);let r=this.extractTooltip({x:t,y:i});r&&r.exact&&void 0!==r.binindx?(this.move_binindx=r.binindx,this.move_bin=r.bin,this.move_x0=this.move_funcs.grx(this.move_bin.x),this.move_y0=this.move_funcs.gry(this.move_bin.y)):delete this.move_binindx}moveDrag(t,i){this.pos_dx+=t,this.pos_dy+=i,void 0===this.move_binindx?this.draw_g.attr("transform",`translate(${this.pos_dx},${this.pos_dy})`):this.move_funcs&&this.move_bin&&(this.move_bin.x=this.move_funcs.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=this.move_funcs.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())}moveEnd(t){let i="";if(void 0===this.move_binindx){if(this.draw_g.attr("transform",null),this.move_funcs&&this.bins&&!t){for(let r=0;r<this.bins.length;++r){let s=this.bins[r];s.x=this.move_funcs.revertAxis("x",this.move_funcs.grx(s.x)+this.pos_dx),s.y=this.move_funcs.revertAxis("y",this.move_funcs.gry(s.y)+this.pos_dy),i+=`SetPoint(${s.indx},${s.x},${s.y});;`,0==s.indx&&this.matchObjectType(_.clTCutG)&&(i+=`SetPoint(${this.getObject().fNpoints-1},${s.x},${s.y});;`)}this.drawGraph()}}else i=`SetPoint(${this.move_bin.indx},${this.move_bin.x},${this.move_bin.y});;`,0==this.move_bin.indx&&this.matchObjectType(_.clTCutG)&&(i+=`SetPoint(${this.getObject().fNpoints-1},${this.move_bin.x},${this.move_bin.y});;`),delete this.move_binindx;delete this.move_funcs,i&&!t&&this.submitCanvExec(i)}fillContextMenu(t){return super.fillContextMenu(t),this.snapid||t.addchk(this.testEditable(),"Editable",()=>{this.testEditable("toggle"),this.drawGraph()}),t.size()>0}executeMenuCommand(t,i){if(super.executeMenuCommand(t,i))return!0;let r=this.getCanvPainter(),s=this.get_main();if("RemovePoint"==t.fName||"InsertPoint"==t.fName){if(!r||r._readonly)return!0;let n=this.extractTooltip(pnt);if("InsertPoint"==t.fName){let l=(0,_.isFunc)(s.getLastEventPos)?s.getLastEventPos():null;if(l){let g=s.getGrFuncs(this.options.second_x,this.options.second_y),a=g.revertAxis("x",l.x)??0,f=g.revertAxis("y",l.y)??0;this.submitCanvExec(`AddPoint(${a.toFixed(3)}, ${f.toFixed(3)})`,this.args_menu_id)}}else this.args_menu_id&&void 0!==n?.binindx&&this.submitCanvExec(`RemovePoint(${n.binindx})`,this.args_menu_id);return!0}return!1}updateObject(t,i){if(!this.matchObjectType(t))return!1;i&&i!=this.options.original&&this.decodeOptions(i);let r=this.getObject();if(r.fBits=t.fBits,r.fTitle=t.fTitle,r.fX=t.fX,r.fY=t.fY,r.fNpoints=t.fNpoints,r.fMinimum=t.fMinimum,r.fMaximum=t.fMaximum,this.createBins(),delete this.$redraw_hist,this.axes_draw){let s=this.createHistogram();s.fTitle=r.fTitle;let n=this.getMainPainter();n?.$secondary&&(n.updateObject(s,this.options.Axis),this.$redraw_hist=!0)}return!0}canZoomInside(t,i,r){let s=this.getObject();if(!s||t!==(this.options.pos3d?"y":"x"))return!1;for(let n=0;n<s.fNpoints;++n)if(i<s.fX[n]&&s.fX[n]<r)return!0;return!1}clickButton(t){if("ToggleZoom"!==t)return!1;let i=this.getFramePainter();return!(!i||this.xmin===this.xmax&&this.ymin===this.ymax||(i.zoom(this.xmin,this.xmax,this.ymin,this.ymax),0))}findFunc(){let t=this.getObject();return t?.fFunctions?.arr?t?.fFunctions?.arr.find(i=>i._typename==_.clTF1||i._typename==_.clTF2):null}findStat(){let t=this.getObject();if(t?.fFunctions?.arr)for(let i=0;i<t.fFunctions.arr.length;++i){let r=t.fFunctions.arr[i];if(r._typename==_.clTPaveStats&&"stats"==r.fName)return r}return null}createStat(){let t=this.findFunc();if(!t)return null;let i=this.findStat();if(i)return i;if(this.getCanvPainter()?.normal_canvas||this.options.PadStats)return null;this.create_stats=!0;const r=_.gStyle;return i=(0,_.create)(_.clTPaveStats),Object.assign(i,{fName:"stats",fOptStat:0,fOptFit:r.fOptFit||111,fBorderSize:1}),i.fX1NDC=r.fStatX-r.fStatW,i.fY1NDC=r.fStatY-r.fStatH,i.fX2NDC=r.fStatX,i.fY2NDC=r.fStatY,i.fFillColor=r.fStatColor,i.fFillStyle=r.fStatStyle,i.fTextAngle=0,i.fTextSize=r.fStatFontSize,i.fTextAlign=12,i.fTextColor=r.fStatTextColor,i.fTextFont=r.fStatFont,i.AddText(t.fName),this.getObject().fFunctions.Add(i),i}fillStatistic(t,i,r){let s=this.findFunc();return!!(s&&r&&this.create_stats)&&(t.clearPave(),t.fillFunctionStat(s,r),!0)}drawNextFunction(t){var i=this;return(0,$.Z)(function*(){let r=i.getObject();if(t>=(r?.fFunctions?.arr?.length||0))return i;let s=i.getPadPainter(),n=r.fFunctions.arr[t],l=r.fFunctions.opt[t];return n.$main_painter=i,s.drawObject(i.getDom(),n,l).then(()=>i.drawNextFunction(t+1))})()}drawAxisHisto(){var t=this;return(0,$.Z)(function*(){let i=t.createHistogram();return j.f.draw(t.getDom(),i,t.options.Axis)})()}static _drawGraph(t,i){return(0,$.Z)(function*(){t.decodeOptions(i,!0),t.createBins(),t.createStat(),!_.settings.DragGraphs&&!graph.TestBit(T)&&graph.InvertBit(T);let r=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(r=t.drawAxisHisto().then(s=>{s&&(t.axes_draw=!0,t._own_histogram||(t.$primary=!0),s.$secondary="hist")})),r.then(()=>(t.addToPadPrimitives(),t.drawGraph())).then(()=>t.drawNextFunction(0))})()}static draw(t,i,r){return(0,$.Z)(function*(){return A._drawGraph(new A(t,i),r)})()}}}}]);
//# sourceMappingURL=879.0345d9de530d51ee.js.map