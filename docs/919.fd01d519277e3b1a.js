"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[919],{7635:(rt,it,$)=>{$.d(it,{D:()=>K});var O=$(4186),c=$(5460),G=$(2481);class K extends G.JW{constructor(p,C,w,M){super(p,C,w),this.csstype=M}v7EvalAttr(p,C){const w=this.getObject();if(!w)return C;this.cssprefix&&(p=this.cssprefix+p);const M=l=>{if(void 0===C)return l;const u=typeof C,h=typeof l;return u===h?l:"boolean"===u?"string"===h?""!==l&&"0"!==l&&"no"!==l&&"off"!==l:!!l:"number"===u&&"string"===h?parseFloat(l):l};if(w.fAttr?.m){const l=w.fAttr.m[p];if(l)return M(l.v)}if(this.rstyle?.fBlocks){const l=this.rstyle.fBlocks;for(let u=0;u<l.length;++u){const h=l[u];if((this.csstype&&h.selector===this.csstype||w.fId&&h.selector==="#"+w.fId||w.fCssClass&&h.selector==="."+w.fCssClass)&&h.map?.m){const _=h.map.m[p.toLowerCase()];if(_)return M(_.v)}}}return C}v7SetAttr(p,C){const w=this.getObject();this.cssprefix&&(p=this.cssprefix+p),w?.fAttr?.m&&(w.fAttr.m[p]={v:C})}v7EvalLength(p,C,w){C<=0&&(C=1);const M=this.v7EvalAttr(p);if(void 0===M)return Math.round(w*C);if("number"==typeof M)return Math.round(M*C);if(null===M)return 0;let l=0,u=0,h=M,o=0,_=0;for(;h;){for(;_<h.length&&(" "===h[_]||"\t"===h[_]);)++_;if(_>=h.length)break;if("-"===h[_]||"+"===h[_]){if(o)return console.log("Fail to parse RPadLength "+M),w;o="-"===h[_]?-1:1,_++;continue}for(_>0&&(h=h.slice(_),_=0);_<h.length&&(h[_]>="0"&&h[_]<="9"||"."===h[_]);)_++;const v=parseFloat(h.slice(0,_));if(!Number.isFinite(v))return console.log(`Fail to parse RPadLength ${M}`),Math.round(w*C);h=h.slice(_),_=0,o||(o=1),h&&"%"===h[0]?(h=h.slice(1),l+=o*v*.01):h.length>1&&"p"===h[0]&&"x"===h[1]?(h=h.slice(2),u+=o*v):l+=o*v,o=0}return Math.round(l*C+u)}v7EvalColor(p,C){let w=this.v7EvalAttr(p,"");if(!w||!(0,O.isStr)(w))return C;if("auto"===w){const M=this.getPadPainter();if(void 0!==M?._auto_color_cnt){const l=M.getHistPalette(),u=M._auto_color_cnt++;let h=M._num_primitives-1;h<2&&(h=2),w=l?l.getColorOrdinal(u%h/h):"blue",this._auto_colors||(this._auto_colors={}),this._auto_colors[p]=w}else this._auto_colors&&this._auto_colors[p]?w=this._auto_colors[p]:(console.error(`Autocolor ${p} not defined yet - please check code`),w="")}else if("["===w[0]){const M=parseFloat(w.slice(1,w.length-1));if(w="black",Number.isFinite(M)){const l=this.getPadPainter()?.getHistPalette();l&&(w=l.getColorOrdinal(M))}}return w}v7EvalFont(p,C,w){C?"number"==typeof C&&(C={size:C}):C={};const M=this.getPadPainter(),l=M?._dfltRFont||{fFamily:"Arial",fStyle:"",fWeight:""},u=this.v7EvalAttr(p+"_angle",0),h=this.v7EvalAttr(p+"_align",C.align||"none"),o=this.v7EvalColor(p+"_color",C.color||"none"),_=this.v7EvalAttr(p+"_font_family",l.fFamily||"Arial"),v=this.v7EvalAttr(p+"_font_style",l.fStyle||""),z=this.v7EvalAttr(p+"_font_weight",l.fWeight||"");let k=this.v7EvalAttr(p+"_size",C.size||12);(0,O.isStr)(k)&&(k=parseFloat(k)),(!Number.isFinite(k)||k<=0)&&(k=12),w||(w=M?.getPadHeight()||100);const P=new c.qg(null,k,w);return P.setNameStyleWeight(_,v,z),u&&P.setAngle(360-u),"none"!==h&&P.setAlign(h),"none"!==o&&P.setColor(o),P}createv7AttFill(p){(!p||!(0,O.isStr)(p))&&(p="fill_");const C=this.v7EvalColor(p+"color",""),w=this.v7EvalAttr(p+"style",0);this.createAttFill({pattern:w,color:C,color_as_svg:!0})}createv7AttLine(p){(!p||!(0,O.isStr)(p))&&(p="line_");const C=this.v7EvalColor(p+"color","black"),w=this.v7EvalAttr(p+"width",1),M=this.v7EvalAttr(p+"style",1),l=this.v7EvalAttr(p+"pattern");this.createAttLine({color:C,width:w,style:M,pattern:l}),"border_"===p&&this.lineatt.setBorder(this.v7EvalAttr(p+"rx",0),this.v7EvalAttr(p+"ry",0))}createv7AttMarker(p){(!p||!(0,O.isStr)(p))&&(p="marker_");const C=this.v7EvalColor(p+"color","black"),w=this.v7EvalAttr(p+"size",.01),M=this.v7EvalAttr(p+"style",1),l=w>=1?1:this.getPadPainter()?.getPadHeight()||100;this.createAttMarker({color:C,size:w,style:M,refsize:l})}v7AttrChange(p,C,w,M){if(!this.snapid)return!1;p._typename||(p._typename=`${O.nsREX}RChangeAttrRequest`,p.ids=[],p.names=[],p.values=[],p.update=!0),this.cssprefix&&(C=this.cssprefix+C),p.ids.push(this.snapid),p.names.push(C);let l=null;if(null==w&&(M||(M="none"),"none"!==M&&console.error(`Trying to set ${M} for none value`)),!M)switch(typeof w){case"number":M="double";break;case"boolean":M="boolean"}switch(l={_typename:`${O.nsREX}RAttrMap::`},M){case"none":l._typename+="NoValue_t";break;case"boolean":l._typename+="BoolValue_t",l.v=!!w;break;case"int":l._typename+="IntValue_t",l.v=parseInt(w);break;case"double":l._typename+="DoubleValue_t",l.v=parseFloat(w);break;default:l._typename+="StringValue_t",l.v=(0,O.isStr)(w)?w:JSON.stringify(w)}return p.values.push(l),!0}v7SendAttrChanges(p,C){const w=this.getCanvPainter();w&&p?._typename&&(void 0!==C&&(p.update=!!C),w.v7SubmitRequest("",p))}v7SubmitRequest(p,C,w){const M=this.getCanvPainter();return(0,O.isFunc)(M?.submitDrawableRequest)?this.snapid?M.submitDrawableRequest(p,C,this,w):(this._pending_request={kind:p,req:C,method:w},C):null}assignSnapId(p){if(this.snapid=p,this.snapid&&this._pending_request){const C=this._pending_request;this.v7SubmitRequest(C.kind,C.req,C.method),delete this._pending_request}}v7CommMode(){const p=this.getCanvPainter();return p&&p.submitDrawableRequest&&p._websocket?1:3}v7NormalMode(){return 1===this.v7CommMode()}v7OfflineMode(){return 3===this.v7CommMode()}}},9798:(rt,it,$)=>{$.d(it,{R:()=>w});var O=$(5774),c=$(4186),G=$(3324),B=$(165),J=$(6856),K=$(9646),V=$(1564),p=$(2481),C=$(7635);class w extends C.D{constructor(l,u,h,o){super(l,o?u.getObject():u,"",o?u.csstype:"axis"),Object.assign(this,J.fm),this.initAxisPainter(),this.axis=h,o?(this.embedded=!0,this.cssprefix=o,this.rstyle=u.rstyle):this.cssprefix="axis_"}cleanup(){delete this.axis,delete this.axis_g,this.cleanupAxisPainter(),super.cleanup()}getAxisType(){return"RAttrAxis"}configureZAxis(l,u){this.name=l,this.kind=p.UV,this.log=!1;const h=this.v7EvalAttr("log",0);h&&(this.log=!0,this.logbase=10,Math.abs(h-Math.exp(1))<.1?this.logbase=Math.exp(1):h>1.9&&(this.logbase=Math.round(h))),u.logz=this.log}configureAxis(l,u,h,o,_,v,z,k,P){P||(P={}),this.name=l,this.full_min=u,this.full_max=h,this.kind=p.UV,this.vertical=v,this.log=!1;const I=this.v7EvalAttr("log",0),T=this.v7EvalAttr("symlog",0);if(this.reverse=P.reverse||!1,this.v7EvalAttr("time")){this.kind=p.Yu,this.timeoffset=0;let S=this.v7EvalAttr("timeOffset");void 0!==S&&(S=parseFloat(S),Number.isFinite(S)&&(this.timeoffset=1e3*S))}else this.axis?.fLabelsIndex?(this.kind=p.ei,delete this.own_labels):this.kind=P.labels?p.ei:p.UV;this.kind===p.Yu?this.func=(0,G.w7)().domain([this.convertDate(o),this.convertDate(_)]):T&&T>0?(this.symlog=T,this.func=(0,G.aX)().constant(T).domain([o,_])):I?(_<=0&&(_=1),(o<=0||o>=_)&&(o=1e-4*_),this.log=!0,this.logbase=10,Math.abs(I-Math.exp(1))<.1?this.logbase=Math.exp(1):I>1.9&&(this.logbase=Math.round(I)),this.func=(0,G.ZE)().base(this.logbase).domain([o,_])):this.func=(0,G.m4)().domain([o,_]),this.scale_min=o,this.scale_max=_,this.gr_range=k||1e3;const F=z??[0,this.gr_range];this.axis_shift=F[1]-this.gr_range,this.func.range(this.reverse?[F[1],F[0]]:F),this.gr=this.kind===p.Yu?S=>this.func(this.convertDate(S)):this.log?S=>S<this.scale_min?this.vertical?this.func.range()[0]+5:-5:this.func(S):this.func,delete this.format;const R=this.v7EvalAttr("ndiv",508);this.nticks=R%100,this.nticks2=(R%1e4-this.nticks)/100,this.nticks3=Math.floor(R/1e4),this.nticks>20&&(this.nticks=20);const D=Math.abs(this.gr_range)||100;if(this.kind===p.Yu){this.nticks>8&&(this.nticks=8);const S=this.scale_max-this.scale_min,U=(0,J.iF)(S/D,!1);let Z=this.v7EvalAttr("timeFormat","");(!Z||S<.1*(this.full_max-this.full_min))&&(Z=(0,J.iF)(S/this.nticks,!0)),this.tfunc1=this.tfunc2=(0,G.DC)(Z),U!==Z&&(this.tfunc2=(0,G.DC)(U)),this.format=this.formatTime}else if(this.log)this.nticks2>1&&(this.nticks*=this.nticks2,this.nticks2=1),this.noexp=this.v7EvalAttr("noexp",!1),this.scale_max<300&&this.scale_min>.3&&10===this.logbase&&(this.noexp=!0),this.moreloglabels=this.v7EvalAttr("moreloglbls",!1),this.format=this.formatLog;else if(this.kind===p.ei){this.nticks=50;const S=this.scale_max-this.scale_min;this.nticks>S&&(this.nticks=Math.round(S)),this.nticks2=1,this.format=this.formatLabels}else this.order=0,this.ndig=0,this.format=this.formatNormal}getScaleMin(){return this.func?this.func.domain()[0]:0}getScaleMax(){return this.func?this.func.domain()[1]:0}formatLabels(l){const u=Math.round(l);if(this.axis?.fLabelsIndex){if(u<0||u>=this.axis.fNBinsNoOver)return null;for(let h=0;h<this.axis.fLabelsIndex.length;++h){const o=this.axis.fLabelsIndex[h];if(o.second===u)return o.first}}else{const h=this.getObject().fLabels;if(h&&u>=0&&u<h.length)return h[u]}return null}createTicks(l,u,h,o){h&&this.nticks&&this.kind===p.UV&&(this.noticksopt=!0);const _=this.produceTicks(this.nticks),v={nminor:0,nmiddle:0,nmajor:0,func:this.func,minor:_,middle:_,major:_};if(l){const z=v.major,k=1e-5*(this.scale_max-this.scale_min);return z[0]>this.scale_min+k&&z.unshift(this.scale_min),z[z.length-1]<this.scale_max-k&&z.push(this.scale_max),z}if(this.nticks2>1&&(!this.log||10===this.logbase)){v.minor=v.middle=this.produceTicks(v.major.length,this.nticks2);const z=Math.abs(this.func.range()[1]-this.func.range()[0]);v.middle.length<=v.major.length||v.middle.length>z/3.5?v.minor=v.middle=v.major:this.nticks3>1&&!this.log&&(v.minor=this.produceTicks(v.middle.length,this.nticks3),(v.minor.length<=v.middle.length||v.minor.length>z/1.7)&&(v.minor=v.middle))}if(v.reset=function(){this.nminor=this.nmiddle=this.nmajor=0},v.next=function(z){return!(this.nminor>=this.minor.length||(this.tick=this.minor[this.nminor++],this.grpos=this.func(this.tick),z&&(this.grpos=Math.round(this.grpos)),this.kind=3,this.nmiddle<this.middle.length&&Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1&&(this.nmiddle++,this.kind=2),this.nmajor<this.major.length&&Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1&&(this.nmajor++,this.kind=1),0))},v.last_major=function(){return 1===this.kind&&this.nmajor===this.major.length},v.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])},v.get_modifier=function(){return null},this.order=0,this.ndig=0,this.kind===p.UV&&!this.log&&v.major.length>0){let z=0,k=0,P=!1;if(!u){const R=Math.max(Math.abs(v.major[0]),Math.abs(v.major[v.major.length-1])),D=Math.min(Math.abs(v.major[0]),Math.abs(v.major[v.major.length-1])),S=R>0?3*Math.round(Math.log10(R)/3):0,U=D>0?3*Math.round(Math.log10(D)/3):0;P=R<2e4,(R||D)&&(z=Math.max(S,U)+3,k=Math.min(S,U)-3)}let I=0,T=this.ndig,F=1e10;for(let R=k;R<=z;R+=3){if(P&&3===R)continue;this.order=R,this.ndig=0;let D=[],S=0,U=0;for(;S<v.major.length;){const Z=this.format(v.major[S],!0);if(D.indexOf(Z)<0)D.push(Z),U+=Z.length,S++;else{if(++this.ndig>11)break;D=[],S=0,U=0}}!R&&this.ndig<4&&(U-=2*v.major.length+3),U<F&&(F=U,I=this.order,T=this.ndig)}this.order=I,this.ndig=T,o&&(this.order&&console.warn(`Axis painter - integer labels are configured, but axis order ${this.order} is preferable`),this.ndig&&console.warn(`Axis painter - integer labels are configured, but ${this.ndig} decimal digits are required`),this.ndig=0,this.order=0)}return v}isCenteredLabels(){return this.kind===p.ei||"log"!==this.kind&&this.v7EvalAttr("labels_center",!1)}processLabelsMove(l,u){if(this.optionUnlab||!this.axis_g)return!1;const h=this.axis_g.select(".axis_labels");if(!h||1!==h.size())return!1;if("start"===l){const _=h.node().getBBox();return h.append("rect").classed("drag",!0).attr("x",_.x).attr("y",_.y).attr("width",_.width).attr("height",_.height).style("cursor","move").call(B.Ru,!0),this.drag_pos0=this.vertical?u[0]:u[1],!0}let o=h.property("fix_offset");if(this.vertical?(o+=Math.round(u[0]-this.drag_pos0),h.attr("transform",`translate(${o})`)):(o+=Math.round(u[1]-this.drag_pos0),h.attr("transform",`translate(0,${o})`)),o||h.attr("transform",null),"stop"===l&&(h.select("rect.drag").remove(),delete this.drag_pos0,o!==h.property("fix_offset"))){h.property("fix_offset",o);const _=h.property("side")||1;this.labelsOffset=o/(this.vertical?-_:_),this.changeAxisAttr(1,"labels_offset",this.labelsOffset/this.scalingSize)}return!0}addTitleDrag(l,u){if(!c.settings.MoveResize||this.isBatchMode())return;let o,_,v,z,k,P,h=null;const I=(0,G.$E)().subject(Object);I.on("start",T=>{T.sourceEvent.preventDefault(),T.sourceEvent.stopPropagation();const F=l.node().getBBox(),R=this.vertical?F.height:F.width;v=o=l.property("shift_x"),z=_=l.property("shift_y"),P="center"===this.titlePos?1:"left"===this.titlePos?0:2,k=[0,this.gr_range/2,this.gr_range];const D=this.vertical?-R:R,S=this.isReverseAxis()?2:0;"middle"===this.title_align?(k[S]+=D/2,k[2-S]-=D/2):"begin"===this.title_align^this.isTitleRotated()?(k[1]-=D/2,k[2-S]-=D):(k[S]+=D,k[1]+=D/2),k[P]=this.vertical?_:o,h=l.append("rect").attr("x",F.x).attr("y",F.y).attr("width",F.width).attr("height",F.height).style("cursor","move").call(B.Ru,!0)}).on("drag",T=>{if(!h)return;T.sourceEvent.preventDefault(),T.sourceEvent.stopPropagation(),o+=T.dx,_+=T.dy;const F=this.vertical?_:o;let R,D,S=0;for(let U=1;U<3;++U)Math.abs(F-k[U])<Math.abs(F-k[S])&&(S=U);this.vertical?(R=o,D=k[S]):(R=k[S],D=_),v=R,z=D,P=S,(0,B.bk)(l,v,z)}).on("end",T=>{if(!h)return;T.sourceEvent.preventDefault(),T.sourceEvent.stopPropagation();const F=l.property("basepos")||0;l.property("shift_x",v).property("shift_y",z),this.titleOffset=(this.vertical?F-v:z-F)*u,this.titlePos=1===P?"center":0===P?"left":"right",this.changeAxisAttr(0,"title_position",this.titlePos,"title_offset",this.titleOffset/this.scalingSize),h.remove(),h=null}),l.style("cursor","move").call(I)}isInsideGrRange(l,u,h){return u||(u=0),void 0===h&&(h=u),this.gr_range<0?l>=this.gr_range-h&&l<=u:l>=-u&&l<=this.gr_range+h}getGrRange(l){return l||(l=0),this.gr_range<0?this.gr_range-l:this.gr_range+l}isReverseAxis(){return!this.vertical!=this.getGrRange()>0}drawMainLine(l){let u="";if(this.endingSize&&this.endingStyle){let h=this.gr_range>0?-this.endingSize:this.endingSize;const o=Math.round(.7*h);h=Math.round(h),u=this.vertical?`l${o},${h}M0,${this.gr_range}l${-o},${h}`:`l${h},${o}M${this.gr_range},0l${h},${-o}`}l.append("svg:path").attr("d","M0,0"+(this.vertical?"v":"h")+this.gr_range+u).call(this.lineatt.func).style("fill",u?"none":null)}drawTicks(l,u,h){h&&(this.ticks=[]),this.handle.reset();let o="",_=0;for("both"===this.ticksSide&&(u=1,_=1);this.handle.next(!0);){let k=Math.round(this.ticksSize/4),P=0;this.handle.kind<3&&(k=Math.round(this.ticksSize/2));const I=this.handle.grpos-this.axis_shift;(this.startingSize||this.endingSize)&&!this.isInsideGrRange(I,-Math.abs(this.startingSize),-Math.abs(this.endingSize))||(1===this.handle.kind&&((this.kind===p.ei||null!==this.format(this.handle.tick,!0))&&(k=this.ticksSize),h&&this.ticks.push(I)),_>0?P=-k:u<0?(P=-k,k=0):P=0,o+=this.vertical?`M${k},${I}H${P}`:`M${I},${-k}V${-P}`)}o&&l.append("svg:path").attr("d",o).style("stroke",this.ticksColor||this.lineatt.color).style("stroke-width",this.ticksWidth&&1!==this.ticksWidth?this.ticksWidth:null);const v=Math.round(.25*this.ticksSize),z=Math.round(1.25*this.ticksSize);return{"-1":u>0||_?z:v,1:u<0||_?z:v}}drawLabels(l,u,h){var o=this;return(0,O.A)(function*(){const _=o.isCenteredLabels(),v=0!==o.labelsFont.angle,z=l.append("svg:g").attr("class","axis_labels").property("side",u),k=o.handle.lbl_pos||o.handle.major;let P=1,I=0,T=!1,F=0,R=0;function D(L){F=Math.max(F,this.result_width),R=Math.max(R,this.result_height);const tt=this.result_width;if(tt&&(!L.vertical&&!v||L.vertical&&v)&&!L.log){let q=.45*this.gap_before+.45*this.gap_after;this.gap_before?this.gap_after||(q=.9*this.gap_before):q=.9*this.gap_after,P=Math.min(P,q/tt)}P>1e-4&&P<.8&&!L.vertical&&!v&&I>5&&u>0&&(T=!0);const W=P*(T?3:1);W>1e-4&&W<1&&L.scaleTextDrawing(1/W,z)}const S=Math.round((o.vertical?-u:u)*o.labelsOffset),U=Math.round((o.vertical?-u:u)*h[u]);let Z=0;S&&z.attr("transform",o.vertical?`translate(${S})`:`translate(0,${S})`),z.property("fix_offset",S),o.startTextDrawing(o.labelsFont,"font",z);for(let L=0;L<k.length;++L){const tt=o.format(k[L],!0);if(null===tt)continue;const W={text:tt,latex:1,draw_g:z};let q=Math.round(o.func(k[L]));if(W.gap_before=L>0?Math.abs(Math.round(q-o.func(k[L-1]))):0,W.gap_after=L<k.length-1?Math.abs(Math.round(o.func(k[L+1])-q)):0,_){const st=W.gap_after||W.gap_before;if(q=Math.round(q-(o.vertical?.5*st:-.5*st)),!o.isInsideGrRange(q,5))continue}if(I=Math.max(I,tt.length),q-=o.axis_shift,!o.startingSize&&!o.endingSize||o.isInsideGrRange(q,-Math.abs(o.startingSize),-Math.abs(o.endingSize))){if(o.vertical?(W.x=U,W.y=q,W.align=v?u<0?23:20:u<0?12:32):(W.x=q,W.y=U,W.align=v?u<0?12:32:u<0?20:23,o.log&&!o.noexp&&!o.vertical&&23===W.align&&(W.align=21,W.y+=o.labelsFont.size)),W.post_process=D,o.drawText(W),Z&&q!==Z&&(o.vertical&&!v||!o.vertical&&v)){const st=Math.abs(q-Z);P=Math.min(P,.9*st/o.labelsFont.size)}Z=q}}return o.order&&o.drawText({x:o.vertical?5*u:o.getGrRange(5),y:o.has_obstacle?U:o.vertical?o.getGrRange(3):-3*u,align:o.vertical?u<0?30:10:o.has_obstacle^u<0?13:10,latex:1,text:"#times"+o.formatExp(10,o.order),draw_g:z}),o.finishTextDrawing(z).then(()=>{if(T&&z.selectAll("text").each(function(){const L=(0,G.Lt)(this),tt=L.attr("transform");L.attr("transform",tt+" rotate(25)").style("text-anchor","start")}),o.vertical)h[u]+=Math.round(v?1.2*R:F+.4*o.labelsFont.size)-u*S;else{const L=T?F*Math.sin(.1388888888888889*Math.PI)+R*(Math.cos(.1388888888888889*Math.PI)+.2):0;h[u]+=Math.round(Math.max(v?F+.4*o.labelsFont.size:1.2*R,1.2*o.labelsFont.size,L))+S}return h})})()}addZoomingRect(l,u,h){if(c.settings.Zooming&&!this.disable_zooming&&!this.isBatchMode()){const o=Math.max(h[u],10),_=this.vertical?`v${this.gr_range}h${-u*o}v${-this.gr_range}`:`h${this.gr_range}v${u*o}h${-this.gr_range}`;l.append("svg:path").attr("d",`M0,0${_}z`).attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair")}}isTitleRotated(){return this.titleFont&&this.titleFont.angle!==(this.vertical?270:0)}drawTitle(l,u,h){var o=this;return(0,O.A)(function*(){if(!o.fTitle)return o;const _=l.append("svg:g").attr("class","axis_title"),v=o.isTitleRotated();let z=0,k=0,P=0;return o.startTextDrawing(o.titleFont,"font",_),o.title_align=o.titleCenter?"middle":o.titleOpposite^(o.isReverseAxis()||v)?"begin":"end",o.vertical?(P=Math.round(-u*h[u]),z=P+Math.round(-u*o.titleOffset),k=Math.round(o.titleCenter?o.gr_range/2:o.titleOpposite?0:o.gr_range),o.drawText({align:[o.title_align,u<0^v?"top":"bottom"],text:o.fTitle,draw_g:_})):(z=Math.round(o.titleCenter?o.gr_range/2:o.titleOpposite?0:o.gr_range),P=Math.round(u*h[u]),k=P+Math.round(u*o.titleOffset),o.drawText({align:[o.title_align,u>0^v?"top":"bottom"],text:o.fTitle,draw_g:_})),(0,B.bk)(_,z,k).property("basepos",P).property("shift_x",z).property("shift_y",k),o.addTitleDrag(_,u),o.finishTextDrawing(_)})()}extractDrawAttributes(l){const u=this.getPadPainter(),h=u?.getPadRect()||{width:10,height:10};this.scalingSize=l||(this.vertical?h.width:h.height),this.createv7AttLine("line_"),this.optionUnlab=this.v7EvalAttr("labels_hide",!1),this.endingStyle=this.v7EvalAttr("ending_style",""),this.endingSize=Math.round(this.v7EvalLength("ending_size",this.scalingSize,this.endingStyle?.02:0)),this.startingSize=Math.round(this.v7EvalLength("starting_size",this.scalingSize,0)),this.ticksSize=this.v7EvalLength("ticks_size",this.scalingSize,.02),this.ticksSide=this.v7EvalAttr("ticks_side","normal"),this.ticksColor=this.v7EvalColor("ticks_color",""),this.ticksWidth=this.v7EvalAttr("ticks_width",1),l&&this.ticksSize<0&&(this.ticksSize=-this.ticksSize),this.fTitle=this.v7EvalAttr("title_value",""),this.fTitle?(this.titleFont=this.v7EvalFont("title",{size:.03},l||u?.getPadHeight()||10),this.titleFont.roundAngle(180,this.vertical?270:0),this.titleOffset=this.v7EvalLength("title_offset",this.scalingSize,0),this.titlePos=this.v7EvalAttr("title_position","right"),this.titleCenter="center"===this.titlePos,this.titleOpposite="left"===this.titlePos):(delete this.titleFont,delete this.titleOffset,delete this.titlePos),this.labelsFont=this.v7EvalFont("labels",{size:l?.05:.03}),this.labelsFont.roundAngle(180),this.labelsFont.angle&&(this.labelsFont.angle=270),this.labelsOffset=this.v7EvalLength("labels_offset",this.scalingSize,0),l&&(this.ticksSize=.5*this.labelsFont.size),this.maxTickSize&&this.ticksSize>this.maxTickSize&&(this.ticksSize=this.maxTickSize)}drawAxis(l,u,h){var o=this;return(0,O.A)(function*(){let _=l;void 0===h&&(h=1),o.standalone||(_=l.selectChild(`.${o.name}_container`),_.empty()?_=l.append("svg:g").attr("class",`${o.name}_container`):_.selectAll("*").remove()),_.attr("transform",u),o.extractDrawAttributes(),o.axis_g=_,o.side=h,"invert"===o.ticksSide&&(h=-h),o.standalone&&o.drawMainLine(_),o.handle=o.createTicks(!1,!1,!1,!1);const P=o.drawTicks(_,h,!0);return(o.optionUnlab?Promise.resolve(P):o.drawLabels(_,h,P)).then(T=>(o.addZoomingRect(_,o.standalone?h:o.side,T),o.drawTitle(_,h,T)))})()}setAfterDrawHandler(l){this._afterDrawAgain=l}drawAxisAgain(){if(!this.axis_g||!this.side)return;this.axis_g.selectAll("*").remove(),this.extractDrawAttributes();let l=this.side;"invert"===this.ticksSide&&(l=-l),this.standalone&&this.drawMainLine(this.axis_g);const u=this.drawTicks(this.axis_g,l,!1);return(this.optionUnlab?Promise.resolve(u):this.drawLabels(this.axis_g,l,u)).then(o=>(this.addZoomingRect(this.axis_g,this.standalone?l:this.side,o),this.drawTitle(this.axis_g,l,o))).then(()=>{(0,c.isFunc)(this._afterDrawAgain)&&this._afterDrawAgain()})}drawAxisOtherPlace(l,u,h,o){let _=l.selectChild(`.${this.name}_container2`);_.empty()?_=l.append("svg:g").attr("class",`${this.name}_container2`):_.selectAll("*").remove(),_.attr("transform",u),"invert"===this.ticksSide&&(h=-h);const v=this.drawTicks(_,h,!1);return(this.optionUnlab||o?Promise.resolve(v):this.drawLabels(_,h,v)).then(k=>(this.addZoomingRect(_,h,k),!0))}zoomStandalone(l,u){this.changeAxisAttr(1,"zoomMin",l,"zoomMax",u)}redraw(){const l=this.getObject(),u=this.getPadPainter(),h=u.getCoordinate(l.fPos),o=this.v7EvalAttr("reverse",!1),_=l.fLabels.length,v=_>0?0:this.v7EvalAttr("min",0),z=_>0?_:this.v7EvalAttr("max",100);let k=u.getPadLength(l.fVertical,l.fLength);l.fVertical&&(k-=u.getPadHeight());let P=this.v7EvalAttr("zoomMin"),I=this.v7EvalAttr("zoomMax");P===I&&(P=v,I=z),this.configureAxis("axis",v,z,P,I,l.fVertical,void 0,k,{reverse:o,labels:_>0}),this.createG(),this.standalone=!0;const T=this.drawAxis(this.draw_g,(0,B.bk)(h.x,h.y));return this.isBatchMode()?T:T.then(()=>{c.settings.ContextMenu&&this.draw_g.on("contextmenu",F=>{F.stopPropagation(),F.preventDefault(),(0,K.ES)(F,this).then(R=>{R.add("header:RAxisDrawable"),R.add("Unzoom",()=>this.zoomStandalone()),this.fillAxisContextMenu(R,""),R.show()})}),(0,V.WJ)(this,{x:h.x,y:h.y,width:this.vertical?10:k,height:this.vertical?k:10,only_move:!0,redraw:F=>this.positionChanged(F)}),this.draw_g.on("dblclick",()=>this.zoomStandalone()),c.settings.ZoomWheel&&this.draw_g.on("wheel",F=>{F.stopPropagation(),F.preventDefault();const R=(0,G.Wn)(F,this.draw_g.node()),S=this.analyzeWheelEvent(F,this.vertical?1-R[1]/k:R[0]/k);S.changed&&this.zoomStandalone(S.min,S.max)})})}positionChanged(l){const u=this.getObject(),h=this.getPadPainter().getPadRect(),o=l.x/h.width,_=1-l.y/h.height;u.fPos.fHoriz.fArr=[o],u.fPos.fVert.fArr=[_],this.submitCanvExec(`SetPos({${o.toFixed(4)},${_.toFixed(4)}})`)}changeAxisAttr(l){const u={};let h=1;for(;h<arguments.length-1;)this.v7AttrChange(u,arguments[h],arguments[h+1]),this.v7SetAttr(arguments[h],arguments[h+1]),h+=2;this.v7SendAttrChanges(u,!1),1===l?this.standalone?this.redraw():this.drawAxisAgain():l&&this.redrawPad()}changeAxisLog(l){this.kind===p.ei||this.kind===p.Yu||("toggle"===l&&(l=this.log?0:10),l=parseFloat(l),Number.isFinite(l)&&this.changeAxisAttr(2,"log",l,"symlog",0))}fillAxisContextMenu(l,u){return u&&l.add("Unzoom",()=>this.getFramePainter().unzoom(u)),l.add("sub:Log scale",()=>this.changeAxisLog("toggle")),l.addchk(!this.log&&!this.symlog,"linear",0,h=>this.changeAxisLog(h)),l.addchk(this.log&&!this.symlog&&10===this.logbase,"log10",()=>this.changeAxisLog(10)),l.addchk(this.log&&!this.symlog&&2===this.logbase,"log2",()=>this.changeAxisLog(2)),l.addchk(this.log&&!this.symlog&&Math.abs(this.logbase-Math.exp(1))<.1,"ln",()=>this.changeAxisLog(Math.exp(1))),l.addchk(!this.log&&this.symlog,"symlog",0,()=>l.input("set symlog constant",this.symlog||10,"float").then(h=>this.changeAxisAttr(2,"symlog",h))),l.add("endsub:"),l.add("Divisions",()=>l.input("Set axis devisions",this.v7EvalAttr("ndiv",508),"int").then(h=>this.changeAxisAttr(2,"ndiv",h))),l.add("sub:Ticks"),l.addRColorMenu("color",this.ticksColor,h=>this.changeAxisAttr(1,"ticks_color",h)),l.addSizeMenu("size",0,.05,.01,this.ticksSize/this.scalingSize,h=>this.changeAxisAttr(1,"ticks_size",h)),l.addSelectMenu("side",["normal","invert","both"],this.ticksSide,h=>this.changeAxisAttr(1,"ticks_side",h)),l.add("endsub:"),!this.optionUnlab&&this.labelsFont&&(l.add("sub:Labels"),l.addSizeMenu("offset",-.05,.05,.01,this.labelsOffset/this.scalingSize,h=>this.changeAxisAttr(1,"labels_offset",h)),l.addRAttrTextItems(this.labelsFont,{noangle:1,noalign:1},h=>this.changeAxisAttr(1,"labels_"+h.name,h.value)),l.addchk(this.labelsFont.angle,"rotate",h=>this.changeAxisAttr(1,"labels_angle",h?180:0)),l.add("endsub:")),l.add("sub:Title",()=>l.input("Enter axis title",this.fTitle).then(h=>this.changeAxisAttr(1,"title_value",h))),this.fTitle&&(l.addSizeMenu("offset",-.05,.05,.01,this.titleOffset/this.scalingSize,h=>this.changeAxisAttr(1,"title_offset",h)),l.addSelectMenu("position",["left","center","right"],this.titlePos,h=>this.changeAxisAttr(1,"title_position",h)),l.addchk(this.isTitleRotated(),"rotate",h=>this.changeAxisAttr(1,"title_angle",h?180:0)),l.addRAttrTextItems(this.titleFont,{noangle:1,noalign:1},h=>this.changeAxisAttr(1,"title_"+h.name,h.value))),l.add("endsub:"),!0}}},7919:(rt,it,$)=>{$.r(it),$.d(it,{RCanvasPainter:()=>q,RObjectPainter:()=>p.D,RPadPainter:()=>v,drawRAxis:()=>lt,drawRFont:()=>ot,drawRFrame:()=>dt,drawRFrameTitle:()=>ht,drawRPadSnapshot:()=>st,ensureRCanvas:()=>at});var O=$(5774),c=$(4186),G=$(3324),B=$(9606),J=$(5619),K=$(165),V=$(2481),p=$(7635),C=$(9798),w=$(9248),M=$(6856),l=$(1564);class u extends p.D{constructor(t,e){super(t,e,"","frame"),this.mode3d=!1,this.xmin=this.xmax=0,this.ymin=this.ymax=0,this.axes_drawn=!1,this.keys_handler=null,this.projection=0,this.v7_frame=!0}getFramePainter(){return this}is_root6(){return!1}setFrameActive(t){this.enabledKeys=t&&c.settings.HandleKeys,this.control&&(this.control.enableKeys=this.enabledKeys)}setLastEventPos(t){this.fLastEventPnt=t}getLastEventPos(){return this.fLastEventPnt}updateAttributes(t){if(void 0===this.fX1NDC||t&&!this.modified_NDC){const e=this.getPadPainter().getPadRect();this.fX1NDC=this.v7EvalLength("margins_left",e.width,c.gStyle.fPadLeftMargin)/e.width,this.fY1NDC=this.v7EvalLength("margins_bottom",e.height,c.gStyle.fPadBottomMargin)/e.height,this.fX2NDC=1-this.v7EvalLength("margins_right",e.width,c.gStyle.fPadRightMargin)/e.width,this.fY2NDC=1-this.v7EvalLength("margins_top",e.height,c.gStyle.fPadTopMargin)/e.height}this.fillatt||this.createv7AttFill(),this.createv7AttLine("border_")}getProjectionFunc(){return(0,l.qP)(this.projection)}recalculateRange(t){this.projection=t||0,2===this.projection&&(this.scale_ymin<=-90||this.scale_ymax>=90)&&(console.warn(`Mercator Projection: latitude out of range ${this.scale_ymin} ${this.scale_ymax}`),this.projection=0);const e=this.getProjectionFunc();if(!e)return;const i=[e(this.scale_xmin,this.scale_ymin),e(this.scale_xmin,this.scale_ymax),e(this.scale_xmax,this.scale_ymax),e(this.scale_xmax,this.scale_ymin)];this.scale_xmin<0&&this.scale_xmax>0&&(i.push(e(0,this.scale_ymin)),i.push(e(0,this.scale_ymax))),this.scale_ymin<0&&this.scale_ymax>0&&(i.push(e(this.scale_xmin,0)),i.push(e(this.scale_xmax,0))),this.original_xmin=this.scale_xmin,this.original_xmax=this.scale_xmax,this.original_ymin=this.scale_ymin,this.original_ymax=this.scale_ymax,this.scale_xmin=this.scale_xmax=i[0].x,this.scale_ymin=this.scale_ymax=i[0].y;for(let s=1;s<i.length;++s)this.scale_xmin=Math.min(this.scale_xmin,i[s].x),this.scale_xmax=Math.max(this.scale_xmax,i[s].x),this.scale_ymin=Math.min(this.scale_ymin,i[s].y),this.scale_ymax=Math.max(this.scale_ymax,i[s].y)}drawGrids(){const t=this.getFrameSvg().selectChild(".axis_layer");t.selectAll(".xgrid").remove(),t.selectAll(".ygrid").remove();const e=this.getFrameHeight(),i=this.getFrameWidth(),s=this.v7EvalAttr("gridX",!1),a=this.v7EvalAttr("gridY",!1),n=(0,w.Ov)(c.gStyle.fGridStyle),r=c.gStyle.fGridColor>0?this.getColor(c.gStyle.fGridColor):"black";if(this.x_handle&&(this.x_handle.draw_grid=s),this.x_handle?.draw_grid){let d="";for(let f=0;f<this.x_handle.ticks.length;++f)d+=this.swap_xy?`M0,${e+this.x_handle.ticks[f]}h${i}`:`M${this.x_handle.ticks[f]},0v${e}`;d&&t.append("svg:path").attr("class","xgrid").attr("d",d).style("stroke",r).style("stroke-width",c.gStyle.fGridWidth).style("stroke-dasharray",n)}if(this.y_handle&&(this.y_handle.draw_grid=a),this.y_handle?.draw_grid){let d="";for(let f=0;f<this.y_handle.ticks.length;++f)d+=this.swap_xy?`M${this.y_handle.ticks[f]},0v${e}`:`M0,${e+this.y_handle.ticks[f]}h${i}`;d&&t.append("svg:path").attr("class","ygrid").attr("d",d).style("stroke",r).style("stroke-width",c.gStyle.fGridWidth).style("stroke-dasharray",n)}}axisAsText(t,e){const i=this[`${t}_handle`];return i?i.axisAsText(e,c.settings[t.toUpperCase()+"ValuesFormat"]):e.toPrecision(4)}_setAxisRange(t,e,i){const s=`${t}min`,a=`${t}max`;if(this[s]!==this[a])return;let n=this.v7EvalAttr(`${t}_min`),r=this.v7EvalAttr(`${t}_max`);void 0!==n&&(e=n),void 0!==r&&(i=r),e<i&&(this[s]=e,this[a]=i);const d=`zoom_${t}min`,f=`zoom_${t}max`;this[d]===this[f]&&!this.zoomChangedInteractive(t)&&(n=this.v7EvalAttr(`${t}_zoomMin`),r=this.v7EvalAttr(`${t}_zoomMax`),(void 0!==n||void 0!==r)&&(this[d]=void 0===n?this[s]:n,this[f]=void 0===r?this[a]:r))}setAxesRanges(t,e,i,s,a,n,r,d,f){this.axes_drawn||(this.xaxis=t,this._setAxisRange("x",e,i),this.yaxis=s,this._setAxisRange("y",a,n),this.zaxis=r,this._setAxisRange("z",d,f))}setAxes2Ranges(t,e,i,s,a,n,r,d){t&&(this.x2axis=e,this._setAxisRange("x2",i,s)),a&&(this.y2axis=n,this._setAxisRange("y2",r,d))}createXY(t){if(this.self_drawaxes)return;this.cleanXY(),t||(t={ndim:1}),this.v6axes=!0,this.swap_xy=t.swap_xy||!1,this.reverse_x=t.reverse_x||!1,this.reverse_y=t.reverse_y||!1,this.logx=this.v7EvalAttr("x_log",0),this.logy=this.v7EvalAttr("y_log",0);const e=this.getFrameWidth(),i=this.getFrameHeight();this.scales_ndim=t.ndim,this.scale_xmin=this.xmin,this.scale_xmax=this.xmax,this.scale_ymin=this.ymin,this.scale_ymax=this.ymax,t.extra_y_space&&((this.swap_xy?this.logx:this.logy)&&this.scale_ymax>0?this.scale_ymax=Math.exp(1.1*Math.log(this.scale_ymax)):this.scale_ymax+=.1*(this.scale_ymax-this.scale_ymin)),t.zoom_xmin!==t.zoom_xmax&&(this.zoom_xmin===this.zoom_xmax||!this.zoomChangedInteractive("x"))&&(this.zoom_xmin=t.zoom_xmin,this.zoom_xmax=t.zoom_xmax),t.zoom_ymin!==t.zoom_ymax&&(this.zoom_ymin===this.zoom_ymax||!this.zoomChangedInteractive("y"))&&(this.zoom_ymin=t.zoom_ymin,this.zoom_ymax=t.zoom_ymax),this.zoom_xmin!==this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax),this.zoom_ymin!==this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);let s=this.xaxis,a=this.yaxis;s?._typename!==c.clTAxis&&(s=(0,c.create)(c.clTAxis)),a?._typename!==c.clTAxis&&(a=(0,c.create)(c.clTAxis)),this.x_handle=new M.TB(this.getDom(),s,!0),this.x_handle.setPadName(this.getPadName()),this.x_handle.optionUnlab=this.v7EvalAttr("x_labels_hide",!1),this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,this.swap_xy,this.swap_xy?[0,i]:[0,e],{reverse:this.reverse_x,log:this.swap_xy?this.logy:this.logx,symlog:this.swap_xy?t.symlog_y:t.symlog_x,logcheckmin:this.swap_xy,logminfactor:1e-4}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle=new M.TB(this.getDom(),a,!0),this.y_handle.setPadName(this.getPadName()),this.y_handle.optionUnlab=this.v7EvalAttr("y_labels_hide",!1),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!this.swap_xy,this.swap_xy?[0,e]:[0,i],{reverse:this.reverse_y,log:this.swap_xy?this.logx:this.logy,symlog:this.swap_xy?t.symlog_x:t.symlog_y,logcheckmin:t.ndim<2||this.swap_xy,log_min_nz:t.ymin_nz&&t.ymin_nz<this.ymax?.5*t.ymin_nz:0,logminfactor:3e-4}),this.y_handle.assignFrameMembers(this,"y")}hasDrawnAxes(t,e){return!t&&!e&&this.axes_drawn}drawAxes(){var t=this;return(0,O.A)(function*(){if(t.axes_drawn||t.xmin===t.xmax||t.ymin===t.ymax)return t.axes_drawn;const e=t.v7EvalAttr("ticksX",1),i=t.v7EvalAttr("ticksY",1);let s=1,a=1;t.v7EvalAttr("swapX",!1)&&(s=-1),t.v7EvalAttr("swapY",!1)&&(a=-1);const n=t.getFrameWidth(),r=t.getFrameHeight();t.v6axes||(t.cleanupAxes(),t.swap_xy=!1,t.zoom_xmin!==t.zoom_xmax?(t.scale_xmin=t.zoom_xmin,t.scale_xmax=t.zoom_xmax):(t.scale_xmin=t.xmin,t.scale_xmax=t.xmax),t.zoom_ymin!==t.zoom_ymax?(t.scale_ymin=t.zoom_ymin,t.scale_ymax=t.zoom_ymax):(t.scale_ymin=t.ymin,t.scale_ymax=t.ymax),t.recalculateRange(0),t.x_handle=new C.R(t.getDom(),t,t.xaxis,"x_"),t.x_handle.setPadName(t.getPadName()),t.x_handle.snapid=t.snapid,t.x_handle.draw_swapside=s<0,t.x_handle.draw_ticks=e,t.y_handle=new C.R(t.getDom(),t,t.yaxis,"y_"),t.y_handle.setPadName(t.getPadName()),t.y_handle.snapid=t.snapid,t.y_handle.draw_swapside=a<0,t.y_handle.draw_ticks=i,t.z_handle=new C.R(t.getDom(),t,t.zaxis,"z_"),t.z_handle.setPadName(t.getPadName()),t.z_handle.snapid=t.snapid,t.x_handle.configureAxis("xaxis",t.xmin,t.xmax,t.scale_xmin,t.scale_xmax,!1,[0,n],n,{reverse:!1}),t.x_handle.assignFrameMembers(t,"x"),t.y_handle.configureAxis("yaxis",t.ymin,t.ymax,t.scale_ymin,t.scale_ymax,!0,[r,0],-r,{reverse:!1}),t.y_handle.assignFrameMembers(t,"y"),t.z_handle.configureZAxis("zaxis",t));const d=t.getFrameSvg().selectChild(".axis_layer");t.x_handle.has_obstacle=!1;const f=t.swap_xy?t.y_handle:t.x_handle,x=t.swap_xy?t.x_handle:t.y_handle;let m;if(t.getPadPainter()?._fast_drawing)m=Promise.resolve(!0);else if(t.v6axes){f.disable_ticks=e<=0,x.disable_ticks=i<=0;const j=f.drawAxis(d,n,r,f.invert_side?null:`translate(0,${r})`,e>1?-r:0,!1,void 0,!1,t.getPadPainter().getPadHeight()-r-t.getFrameY()),N=x.drawAxis(d,n,r,x.invert_side?`translate(${n})`:null,i>1?n:0,!1,x.invert_side?0:t._frame_x,!1);m=Promise.all([j,N]).then(()=>t.drawGrids())}else{let y=[];e>0&&y.push(f.drawAxis(d,(0,K.bk)(0,s>0?r:0),s)),i>0&&y.push(x.drawAxis(d,(0,K.bk)(a>0?0:n,r),a)),m=Promise.all(y).then(()=>(y=[],e>1&&y.push(f.drawAxisOtherPlace(d,(0,K.bk)(0,s<0?r:0),-s,2===e)),i>1&&y.push(x.drawAxisOtherPlace(d,(0,K.bk)(a<0?0:n,r),-a,2===i)),Promise.all(y))).then(()=>t.drawGrids())}return m.then(()=>(t.axes_drawn=!0,!0))})()}drawAxes2(t,e){const i=this.getFrameWidth(),s=this.getFrameHeight(),a=this.getFrameSvg().selectChild(".axis_layer");let n,r;return t&&(this.zoom_x2min!==this.zoom_x2max?(this.scale_x2min=this.zoom_x2min,this.scale_x2max=this.zoom_x2max):(this.scale_x2min=this.x2min,this.scale_x2max=this.x2max),this.x2_handle=new C.R(this.getDom(),this,this.x2axis,"x2_"),this.x2_handle.setPadName(this.getPadName()),this.x2_handle.snapid=this.snapid,this.x2_handle.configureAxis("x2axis",this.x2min,this.x2max,this.scale_x2min,this.scale_x2max,!1,[0,i],i,{reverse:!1}),this.x2_handle.assignFrameMembers(this,"x2"),n=this.x2_handle.drawAxis(a,null,-1)),e&&(this.zoom_y2min!==this.zoom_y2max?(this.scale_y2min=this.zoom_y2min,this.scale_y2max=this.zoom_y2max):(this.scale_y2min=this.y2min,this.scale_y2max=this.y2max),this.y2_handle=new C.R(this.getDom(),this,this.y2axis,"y2_"),this.y2_handle.setPadName(this.getPadName()),this.y2_handle.snapid=this.snapid,this.y2_handle.configureAxis("y2axis",this.y2min,this.y2max,this.scale_y2min,this.scale_y2max,!0,[s,0],-s,{reverse:!1}),this.y2_handle.assignFrameMembers(this,"y2"),r=this.y2_handle.drawAxis(a,(0,K.bk)(i,s),-1)),Promise.all([n,r])}getGrFuncs(t,e){const i=t&&this.grx2,s=e&&this.gry2;return i||s?{use_x2:i,grx:i?this.grx2:this.grx,x_handle:i?this.x2_handle:this.x_handle,logx:i?this.x2_handle.log:this.x_handle.log,scale_xmin:i?this.scale_x2min:this.scale_xmin,scale_xmax:i?this.scale_x2max:this.scale_xmax,use_y2:s,gry:s?this.gry2:this.gry,y_handle:s?this.y2_handle:this.y_handle,logy:s?this.y2_handle.log:this.y_handle.log,scale_ymin:s?this.scale_y2min:this.scale_ymin,scale_ymax:s?this.scale_y2max:this.scale_ymax,swap_xy:this.swap_xy,fp:this,revertAxis(a,n){return"x"===a&&this.use_x2&&(a="x2"),"y"===a&&this.use_y2&&(a="y2"),this.fp.revertAxis(a,n)},axisAsText(a,n){return"x"===a&&this.use_x2&&(a="x2"),"y"===a&&this.use_y2&&(a="y2"),this.fp.axisAsText(a,n)}}:this}sizeChanged(){const t={};this.v7AttrChange(t,"margins_left",this.fX1NDC),this.v7AttrChange(t,"margins_bottom",this.fY1NDC),this.v7AttrChange(t,"margins_right",1-this.fX2NDC),this.v7AttrChange(t,"margins_top",1-this.fY2NDC),this.v7SendAttrChanges(t,!1),this.redrawPad()}cleanXY(){const t=(e,i)=>{this[e]?.cleanup(),delete this[e],delete this[i]};t("x_handle","grx"),t("y_handle","gry"),t("z_handle","grz"),t("x2_handle","grx2"),t("y2_handle","gry2"),delete this.v6axes}cleanupAxes(){this.cleanXY(),this.draw_g?.selectChild(".axis_layer").selectAll("*").remove(),this.axes_drawn=!1}cleanFrameDrawings(){(0,c.isFunc)(this.create3DScene)&&this.create3DScene(-1),this.cleanupAxes();const t=e=>{this[e+"min"]=this[e+"max"]=0,this[`zoom_${e}min`]=this[`zoom_${e}max`]=0,this[`scale_${e}min`]=this[`scale_${e}max`]=0};t("x"),t("y"),t("z"),t("x2"),t("y2"),this.draw_g?.selectChild(".main_layer").selectAll("*").remove(),this.draw_g?.selectChild(".upper_layer").selectAll("*").remove()}cleanup(){this.cleanFrameDrawings(),this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null)),this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null),delete this.enabledKeys,delete this.self_drawaxes,delete this.xaxis,delete this.yaxis,delete this.zaxis,delete this.x2axis,delete this.y2axis,delete this.draw_g,delete this._click_handler,delete this._dblclick_handler;const t=this.getPadPainter();t?.frame_painter_ref===this&&delete t.frame_painter_ref,super.cleanup()}redraw(){const t=this.getPadPainter();t&&(t.frame_painter_ref=this),this.updateAttributes();const e=t?.getPadRect()??{width:10,height:10},i=Math.round(e.width*this.fX1NDC),s=Math.round(e.height*(1-this.fY2NDC));let f,x,m,a=Math.round(e.width*(this.fX2NDC-this.fX1NDC)),n=Math.round(e.height*(this.fY2NDC-this.fY1NDC)),r=!1,d=!1;if(t?.options&&(t.options.RotateFrame&&(r=!0),t.options.FixFrame&&(d=!0)),r?(f=`rotate(-90,${i},${s}) translate(${i-n},${s})`,[a,n]=[n,a]):f=(0,K.bk)(i,s),this._frame_x=i,this._frame_y=s,this._frame_width=a,this._frame_height=n,this._frame_rotate=r,this._frame_fixpos=d,this.mode3d)return this;this.draw_g=this.getFrameSvg(),this.draw_g.empty()?(this.draw_g=this.getLayerSvg("primitives_layer").append("svg:g").attr("class","root_frame"),this.isBatchMode()||this.draw_g.append("svg:title").text(""),x=this.draw_g.append("svg:rect"),m=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden"),this.draw_g.append("svg:g").attr("class","axis_layer"),this.draw_g.append("svg:g").attr("class","upper_layer")):(x=this.draw_g.selectChild("rect"),m=this.draw_g.selectChild(".main_layer")),this.axes_drawn=!1,this.draw_g.attr("transform",f),x.attr("x",0).attr("y",0).attr("width",a).attr("height",n).attr("rx",this.lineatt.rx||null).attr("ry",this.lineatt.ry||null).call(this.fillatt.func).call(this.lineatt.func),m.attr("width",a).attr("height",n).attr("viewBox",`0 0 ${a} ${n}`);let y=Promise.resolve(!0);return this.v7EvalAttr("drawAxes")&&(this.self_drawaxes=!0,this.setAxesRanges(),y=this.drawAxes().then(()=>this.addInteractivity())),y.then(()=>this)}getFrameX(){return this._frame_x||0}getFrameY(){return this._frame_y||0}getFrameWidth(){return this._frame_width||0}getFrameHeight(){return this._frame_height||0}getFrameRect(){return{x:this._frame_x||0,y:this._frame_y||0,width:this.getFrameWidth(),height:this.getFrameHeight(),transform:this.draw_g?.attr("transform")||"",hint_delta_x:0,hint_delta_y:0}}getHistPalette(){return this.getPadPainter().getHistPalette()}configureUserClickHandler(t){this._click_handler=(0,c.isFunc)(t)?t:null}configureUserDblclickHandler(t){this._dblclick_handler=(0,c.isFunc)(t)?t:null}zoom(t,e,i,s,a,n){var r=this;return(0,O.A)(function*(){if(r.projection)return!1;"x"===t?(t=e,e=i,i=void 0):"y"===t?(s=i,i=e,t=e=void 0):"z"===t&&(a=e,n=i,t=e=i=void 0);let d=t!==e,f=i!==s,x=a!==n,m=!1,y=!1,A=!1;if(d){let X=0;t<=r.xmin&&(t=r.xmin,X++),e>=r.xmax&&(e=r.xmax,X++),2===X&&(d=!1,m=!0)}else m=t===e&&0===t;if(f){let X=0;i<=r.ymin&&(i=r.ymin,X++),s>=r.ymax&&(s=r.ymax,X++),2===X&&(f=!1,y=!0)}else y=i===s&&0===i;if(x){let X=0;a<=r.zmin&&(a=r.zmin,X++),n>=r.zmax&&(n=r.zmax,X++),2===X&&(x=!1,A=!0)}else A=a===n&&0===a;let b=!1,j="",N="",H="",Y=!1;const E={_typename:`${c.nsREX}RFrame::RUserRanges`,values:[0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1]},Q=(X,et)=>{!et&&!(0,c.isFunc)(X.canZoomInside)||(Y=!0,d&&(et||X.canZoomInside("x",t,e))&&(r.zoom_xmin=t,r.zoom_xmax=e,b=!0,j="0",d=!1,E.values[0]=t,E.values[1]=e,E.flags[0]=E.flags[1]=!0),f&&(et||X.canZoomInside("y",i,s))&&(r.zoom_ymin=i,r.zoom_ymax=s,b=!0,N="1",f=!1,E.values[2]=i,E.values[3]=s,E.flags[2]=E.flags[3]=!0),x&&(et||X.canZoomInside("z",a,n))&&(r.zoom_zmin=a,r.zoom_zmax=n,b=!0,H="2",x=!1,E.values[4]=a,E.values[5]=n,E.flags[4]=E.flags[5]=!0))};return(d||f||x)&&r.forEachPainter(X=>Q(X)),!Y&&r.self_drawaxes&&Q(null,!0),(m||y||A)&&(m&&(r.zoom_xmin!==r.zoom_xmax&&(b=!0,j="0"),r.zoom_xmin=r.zoom_xmax=0,E.values[0]=E.values[1]=-1),y&&(r.zoom_ymin!==r.zoom_ymax&&(b=!0,N="1"),r.zoom_ymin=r.zoom_ymax=0,E.values[2]=E.values[3]=-1),A&&(r.zoom_zmin!==r.zoom_zmax&&(b=!0,H="2"),r.zoom_zmin=r.zoom_zmax=0,E.values[4]=E.values[5]=-1)),!!b&&(r.v7NormalMode()&&r.v7SubmitRequest("zoom",{_typename:`${c.nsREX}RFrame::RZoomRequest`,ranges:E}),r.interactiveRedraw("pad","zoom"+j+N+H).then(()=>!0))})()}zoomSingle(t,e,i){var s=this;return(0,O.A)(function*(){const n=["x","y","z","x2","y2"].indexOf(t);if(s.projection||!s[t+"_handle"]||n<0)return!1;let r=e!==i,d=!1;if(r){let A=0;e<=s[t+"min"]&&(e=s[t+"min"],A++),i>=s[t+"max"]&&(i=s[t+"max"],A++),2===A&&(r=!1,d=!0)}else d=e===i&&0===e;let f=!1,x=!1;const m={_typename:`${c.nsREX}RFrame::RUserRanges`,values:[0,0,0,0,0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]},y=(A,b)=>{!b&&!(0,c.isFunc)(A?.canZoomInside)||(x=!0,r&&(b||A.canZoomInside(t[0],e,i))&&(s["zoom_"+t+"min"]=e,s["zoom_"+t+"max"]=i,f=!0,r=!1,m.values[2*n]=e,m.values[2*n+1]=i,m.flags[2*n]=m.flags[2*n+1]=!0))};return r&&s.forEachPainter(A=>y(A)),!x&&s.self_drawaxes&&y(null,!0),d&&(s[`zoom_${t}min`]!==s[`zoom_${t}max`]&&(f=!0),s[`zoom_${t}min`]=s[`zoom_${t}max`]=0,m.values[2*n]=m.values[2*n+1]=-1),!!f&&(s.v7NormalMode()&&s.v7SubmitRequest("zoom",{_typename:`${c.nsREX}RFrame::RZoomRequest`,ranges:m}),s.interactiveRedraw("pad",`zoom${n}`).then(()=>!0))})()}isAxisZoomed(t){return this[`zoom_${t}min`]!==this[`zoom_${t}max`]}unzoom(t,e,i){var s=this;return(0,O.A)(function*(){return"all"===t?s.unzoom("x2").then(()=>s.unzoom("y2")).then(()=>s.unzoom("xyz")):"x2"===t||"y2"===t?s.zoomSingle(t,0,0).then(a=>(a&&s.zoomChangedInteractive(t,"unzoom"),a)):(typeof t>"u"?t=e=i=!0:(0,c.isStr)(t)&&(i=t.indexOf("z")>=0,e=t.indexOf("y")>=0,t=t.indexOf("x")>=0),s.zoom(t?0:void 0,t?0:void 0,e?0:void 0,e?0:void 0,i?0:void 0,i?0:void 0).then(a=>(a&&t&&s.zoomChangedInteractive("x","unzoom"),a&&e&&s.zoomChangedInteractive("y","unzoom"),a&&i&&s.zoomChangedInteractive("z","unzoom"),a)))})()}zoomChangedInteractive(t,e){if("reset"===t)return void(this.zoom_changed_x=this.zoom_changed_y=this.zoom_changed_z=void 0);if(!t||"any"===t)return this.zoom_changed_x||this.zoom_changed_y||this.zoom_changed_z;if("x"!==t&&"y"!==t&&"z"!==t)return;const i="zoom_changed_"+t;if(void 0===e)return this[i];"unzoom"!==e?e&&(this[i]=!0):this[i]=void 0===this[i]}fillObjectOfflineMenu(t,e){"x"!==e&&"y"!==e||t.add("Unzoom",()=>this.unzoom(e))}changeFrameAttr(t,e){const i={};this.v7AttrChange(i,t,e),this.v7SetAttr(t,e),this.v7SendAttrChanges(i,!1),this.redrawPad()}fillContextMenu(t,e){if("pal"===e&&(e="z"),"x"===e||"y"===e||"x2"===e||"y2"===e){const s=this[e+"_handle"];return!!s&&(t.add("header: "+e.toUpperCase()+" axis"),s.fillAxisContextMenu(t,e))}const i=0===t.size();return t.add(i?"header:Frame":"separator"),this.zoom_xmin!==this.zoom_xmax&&t.add("Unzoom X",()=>this.unzoom("x")),this.zoom_ymin!==this.zoom_ymax&&t.add("Unzoom Y",()=>this.unzoom("y")),this.zoom_zmin!==this.zoom_zmax&&t.add("Unzoom Z",()=>this.unzoom("z")),this.zoom_x2min!==this.zoom_x2max&&t.add("Unzoom X2",()=>this.unzoom("x2")),this.zoom_y2min!==this.zoom_y2max&&t.add("Unzoom Y2",()=>this.unzoom("y2")),t.add("Unzoom all",()=>this.unzoom("all")),t.add("separator"),t.addchk(this.isTooltipAllowed(),"Show tooltips",()=>this.setTooltipAllowed("toggle")),this.x_handle&&t.addchk(this.x_handle.draw_grid,"Grid x",s=>this.changeFrameAttr("gridX",s)),this.y_handle&&t.addchk(this.y_handle.draw_grid,"Grid y",s=>this.changeFrameAttr("gridY",s)),this.x_handle&&!this.x2_handle&&t.addchk(this.x_handle.draw_swapside,"Swap x",s=>this.changeFrameAttr("swapX",s)),this.y_handle&&!this.y2_handle&&t.addchk(this.y_handle.draw_swapside,"Swap y",s=>this.changeFrameAttr("swapY",s)),this.x_handle&&!this.x2_handle&&(t.add("sub:Ticks x"),t.addchk(0===this.x_handle.draw_ticks,"off",()=>this.changeFrameAttr("ticksX",0)),t.addchk(1===this.x_handle.draw_ticks,"normal",()=>this.changeFrameAttr("ticksX",1)),t.addchk(2===this.x_handle.draw_ticks,"ticks on both sides",()=>this.changeFrameAttr("ticksX",2)),t.addchk(3===this.x_handle.draw_ticks,"labels on both sides",()=>this.changeFrameAttr("ticksX",3)),t.add("endsub:")),this.y_handle&&!this.y2_handle&&(t.add("sub:Ticks y"),t.addchk(0===this.y_handle.draw_ticks,"off",()=>this.changeFrameAttr("ticksY",0)),t.addchk(1===this.y_handle.draw_ticks,"normal",()=>this.changeFrameAttr("ticksY",1)),t.addchk(2===this.y_handle.draw_ticks,"ticks on both sides",()=>this.changeFrameAttr("ticksY",2)),t.addchk(3===this.y_handle.draw_ticks,"labels on both sides",()=>this.changeFrameAttr("ticksY",3)),t.add("endsub:")),t.addAttributesMenu(this,i?"":"Frame "),t.add("separator"),t.add("sub:Save as"),["svg","png","jpeg","pdf","webp"].forEach(s=>t.add(`frame.${s}`,()=>this.getPadPainter().saveAs(s,"frame",`frame.${s}`))),t.add("endsub:"),!0}revertAxis(t,e){return this[`${t}_handle`]?.revertPoint(e)??0}showAxisStatus(t,e){const i=t,a=(0,G.Wn)(e,this.getFrameSvg().node());let n="x"===t?0:1;this.swap_xy&&(n=1-n);const r=this.revertAxis(t,a[n]);this.showObjectStatus(i,"axis",`${t} : ${this.axisAsText(t,r)}`,`${Math.round(a[0])},${Math.round(a[1])}`)}addKeysHandler(){this.isBatchMode()||(l.wM.assign(this),this.addFrameKeysHandler())}addInteractivity(t){return!(!this.isBatchMode()&&(c.settings.Zooming||c.settings.ContextMenu))||(l.wM.assign(this),t||this.addBasicInteractivity(),this.addFrameInteractivity(t))}setRootPadRange(){}toggleAxisLog(t){return this[t+"_handle"]?.changeAxisLog("toggle")}}var h=$(139),o=$(9646),_=$(9788);class v extends p.D{constructor(t,e,i){super(t,e,"","pad"),this.pad=e,this.iscan=i,this.this_pad_name="",!this.iscan&&null!==e&&(this.this_pad_name=e.fObjectID?"pad"+e.fObjectID:"ppp"+c.internals.id_counter++),this.painters=[],this.has_canvas=!0,this.forEachPainter=this.forEachPainterInPad;const s=this.selectDom();!s.empty()&&s.property("_batch_mode")&&(this.batch_mode=!0)}isBatchMode(){return void 0!==this.batch_mode?this.batch_mode:!!(0,c.isBatchMode)()||!(this.iscan||!this.has_canvas)&&this.getCanvPainter()?.isBatchMode()}isRoot6(){return!1}isEditable(){return!0}svg_this_pad(){return this.getPadSvg(this.this_pad_name)}getMainPainter(){return this.main_painter_ref||null}setMainPainter(t,e){(!this.main_painter_ref||e)&&(this.main_painter_ref=t)}cleanup(){this._doing_draw&&console.error("pad drawing is not completed when cleanup is called"),this.painters.forEach(e=>e.cleanup());const t=this.svg_this_pad();t.empty()||(t.property("pad_painter",null),this.iscan||t.remove()),delete this.main_painter_ref,delete this.frame_painter_ref,delete this.pads_cache,delete this._pad_x,delete this._pad_y,delete this._pad_width,delete this._pad_height,delete this._doing_draw,delete this._dfltRFont,this.painters=[],this.pad=null,this.draw_object=null,this.pad_frame=null,this.this_pad_name=void 0,this.has_canvas=!1,(0,V.QD)({pp:this,active:!1}),super.cleanup()}getFramePainter(){return this.frame_painter_ref}getPadWidth(){return this._pad_width||0}getPadHeight(){return this._pad_height||0}getPadLog(t){return!1}getPadRect(){return{x:this._pad_x||0,y:this._pad_y||0,width:this.getPadWidth(),height:this.getPadHeight()}}getFrameRect(){const t=this.getFramePainter();if(t)return t.getFrameRect();const e=this.getPadWidth(),i=this.getPadHeight(),s={};return s.szx=Math.round(.5*e),s.szy=Math.round(.5*i),s.width=2*s.szx,s.height=2*s.szy,s.x=Math.round(e/2-s.szx),s.y=Math.round(i/2-s.szy),s.hint_delta_x=s.szx,s.hint_delta_y=s.szy,s.transform=(0,K.bk)(s.x,s.y)||"",s}getRootPad(t){return void 0!==t&&t?null:this.pad}cleanPrimitives(t){if((0,c.isFunc)(t))for(let e=this.painters.length-1;e>=0;--e)t(this.painters[e])&&(this.painters[e].cleanup(),this.painters.splice(e,1))}removePrimitive(t){const e=this.painters[t],i=[];let s=t;for(let a=this.painters.length-1;a>=0;--a)(a===t||this.painters[a].isSecondary(e))&&(i.push(this.painters[a]),this.painters.splice(a,1),a<=t&&s--);return i.forEach(a=>{a.cleanup(),this.main_painter_ref===a&&(delete this.main_painter_ref,s=-111)}),s}findInPrimitives(t,e){return console.warn("findInPrimitives not implemented for RPad"),null}findPainterFor(t,e,i){return this.painters.find(s=>{const a=s.getObject();return!(!a||(!t||a!==t)&&(!e&&!i||e&&a.fName!==e||i&&a._typename!==i))})}getHistPalette(){const t=this.findPainterFor(void 0,void 0,`${c.nsREX}RPaletteDrawable`);return t?t.getHistPalette():(this.fDfltPalette||(this.fDfltPalette={_typename:`${c.nsREX}RPalette`,fColors:[{fOrdinal:0,fColor:{fColor:"rgb(53, 42, 135)"}},{fOrdinal:.125,fColor:{fColor:"rgb(15, 92, 221)"}},{fOrdinal:.25,fColor:{fColor:"rgb(20, 129, 214)"}},{fOrdinal:.375,fColor:{fColor:"rgb(6, 164, 202)"}},{fOrdinal:.5,fColor:{fColor:"rgb(46, 183, 164)"}},{fOrdinal:.625,fColor:{fColor:"rgb(135, 191, 119)"}},{fOrdinal:.75,fColor:{fColor:"rgb(209, 187, 89)"}},{fOrdinal:.875,fColor:{fColor:"rgb(254, 200, 50)"}},{fOrdinal:1,fColor:{fColor:"rgb(249, 251, 14)"}}],fInterpolate:!0,fNormalized:!0},(0,c.addMethods)(this.fDfltPalette,`${c.nsREX}RPalette`)),this.fDfltPalette)}getNumPainters(){return this.painters.length}forEachPainterInPad(t,e){e||(e="all"),"objects"!==e&&t(this);for(let i=0;i<this.painters.length;++i){const s=this.painters[i];(0,c.isFunc)(s.forEachPainterInPad)?"objects"!==e&&s.forEachPainterInPad(t,e):"pads"!==e&&t(s)}}registerForPadEvents(t){this.pad_events_receiver=t}producePadEvent(t,e,i,s,a){"select"===t&&(0,c.isFunc)(this.selectActivePad)&&this.selectActivePad(e,i,s),this.pad_events_receiver&&this.pad_events_receiver({what:t,padpainter:e,painter:i,position:s,place:a})}selectObjectPainter(t,e,i){const s=this.iscan||!this.has_canvas,a=s?this:this.getCanvPainter();void 0===t&&(t=this),e&&!s&&(e=(0,K.md)(this.svg_this_pad(),e)),(0,V.QD)({pp:this,active:!0}),a.producePadEvent("select",this,t,e,i)}setFastDrawing(t,e){const i=this._fast_drawing;this._fast_drawing=c.settings.SmallPad&&(t<c.settings.SmallPad.width||e<c.settings.SmallPad.height),i!==this._fast_drawing&&this.showPadButtons()}isGrayscale(){return!1}setGrayscale(){console.error("grayscale mode not implemented for RCanvas")}createCanvasSvg(t,e){let r,d,s=null,a=null,n=null;if(t>0){if(this._fixed_size)return t>1;if(a=this.getCanvSvg(),a.empty()||(s=a.property("height_factor"),n=this.testMainResize(t,null,s),!n.changed&&1===t))return!1;this.isBatchMode()||(r=this.getLayerSvg("btns_layer",this.this_pad_name)),d=a.selectChild(".canvas_fillrect")}else{const f=this.selectDom();"static"===f.style("position")&&f.style("position","relative"),a=f.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("current_pad","").property("redraw_by_resize",!1),this.setTopPainter(),!this.isBatchMode()&&!this.online_canvas&&a.append("svg:title").text("ROOT canvas"),d=a.append("svg:path").attr("class","canvas_fillrect"),this.isBatchMode()||d.style("pointer-events","visibleFill").on("dblclick",x=>this.enlargePad(x,!0)).on("click",()=>this.selectObjectPainter(this,null)).on("mouseenter",()=>this.showObjectStatus()).on("contextmenu",c.settings.ContextMenu?x=>this.padContextMenu(x):null),a.append("svg:g").attr("class","primitives_layer"),a.append("svg:g").attr("class","info_layer"),this.isBatchMode()||(r=a.append("svg:g").attr("class","btns_layer").property("leftside","left"===c.settings.ToolBarSide).property("vertical",c.settings.ToolBarVert)),s=.66,this.pad&&this.pad.fWinSize[0]&&this.pad.fWinSize[1]&&(s=this.pad.fWinSize[1]/this.pad.fWinSize[0],(s<.1||s>10)&&(s=.66)),this._fixed_size?(f.style("overflow","auto"),n={width:this.pad.fWinSize[0],height:this.pad.fWinSize[1]},(!n.width||!n.height)&&(n=(0,K.xh)(f))):n=this.testMainResize(2,e,s)}return this.createAttFill({pattern:1001,color:0}),n.width<=5||n.height<=5?(a.style("display","none"),console.warn(`Hide canvas while geometry too small w=${n.width} h=${n.height}`),n.width=200,n.height=100):a.style("display",null),this._fixed_size?a.attr("x",0).attr("y",0).attr("width",n.width).attr("height",n.height).style("position","absolute"):a.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0),a.style("filter",c.settings.DarkMode?"invert(100%)":null),a.attr("viewBox",`0 0 ${n.width} ${n.height}`).attr("preserveAspectRatio","none").property("height_factor",s).property("draw_x",0).property("draw_y",0).property("draw_width",n.width).property("draw_height",n.height),this._pad_x=0,this._pad_y=0,this._pad_width=n.width,this._pad_height=n.height,d.attr("d",`M0,0H${n.width}V${n.height}H0Z`).call(this.fillatt.func),this.setFastDrawing(n.width,n.height),this.alignButtons&&r&&this.alignButtons(r,n.width,n.height),!0}drawItemNameOnCanvas(){}enlargePad(t,e,i){if(t?.preventDefault(),t?.stopPropagation(),e&&this._websocket&&"off"===this.enlargeMain("state"))return;const s=this.getCanvSvg(),a=s.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(a||this.hasObjectsToDraw()||this.painters))a||i?a===this.pad?(this.enlargeMain(!1),s.property("pad_enlarged",null)):!i&&e&&console.error("missmatch with pad double click events"):(this.enlargeMain(!0,!0),s.property("pad_enlarged",this.pad),(0,V.QD)({pp:this,active:!0}));else{if(this._fixed_size||!this.enlargeMain(!i&&"toggle"))return;"off"===this.enlargeMain("state")?s.property("pad_enlarged",null):(0,V.QD)({pp:this,active:!0})}return this.checkResize(!0)}createPadSvg(t){if(!this.has_canvas)return this.createCanvasSvg(t?2:0),!0;const e=this.getPadSvg(this.pad_name),i=this.getCanvSvg(),s=e.property("draw_width"),a=e.property("draw_height"),n=i.property("pad_enlarged");let r=!0,d=s,f=a,x=0,m=0,y=null,A=null,b=null;return this.pad?.fPos&&this.pad?.fSize&&(x=Math.round(s*this.pad.fPos.fHoriz.fArr[0]),m=Math.round(a*this.pad.fPos.fVert.fArr[0]),d=Math.round(s*this.pad.fSize.fHoriz.fArr[0]),f=Math.round(a*this.pad.fSize.fVert.fArr[0])),n&&(r=!1,n===this.pad?r=!0:this.forEachPainterInPad(j=>{j.getObject()===n&&(r=!0)},"pads"),r&&(d=s,f=a,x=m=0)),t?(y=this.svg_this_pad(),A=y.selectChild(".root_pad_border"),this.isBatchMode()||(b=this.getLayerSvg("btns_layer",this.this_pad_name)),this.addPadInteractive(!0)):(y=e.selectChild(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this),this.isBatchMode()||y.append("svg:title").text("ROOT subpad"),A=y.append("svg:path").attr("class","root_pad_border"),y.append("svg:g").attr("class","primitives_layer"),this.isBatchMode()||(b=y.append("svg:g").attr("class","btns_layer").property("leftside","left"!==c.settings.ToolBarSide).property("vertical",c.settings.ToolBarVert)),c.settings.ContextMenu&&A.on("contextmenu",j=>this.padContextMenu(j)),this.isBatchMode()||A.style("pointer-events","visibleFill").on("dblclick",j=>this.enlargePad(j,!0)).on("click",()=>this.selectObjectPainter(this,null)).on("mouseenter",()=>this.showObjectStatus())),this.createAttFill({attr:this.pad}),this.createAttLine({attr:this.pad,color0:0===this.pad.fBorderMode?"none":""}),y.style("display",r?null:"none").attr("viewBox",`0 0 ${d} ${f}`).attr("preserveAspectRatio","none").attr("x",x).attr("y",m).attr("width",d).attr("height",f).property("draw_x",x).property("draw_y",m).property("draw_width",d).property("draw_height",f),this._pad_x=x,this._pad_y=m,this._pad_width=d,this._pad_height=f,A.attr("d",`M0,0H${d}V${f}H0Z`).call(this.fillatt.func).call(this.lineatt.func),this.setFastDrawing(d,f),y.property("can3d")===c.constants.Embed3D.Overlay&&this.selectDom().select(".draw3d_"+this.this_pad_name).style("display",r?"":"none"),this.alignButtons&&b&&this.alignButtons(b,d,f),r}addPadInteractive(t=!1){(0,c.isFunc)(this.$userInteractive)&&(this.$userInteractive(),delete this.$userInteractive)}hasObjectsToDraw(){return this.pad?.fPrimitives?.find(t=>t._typename!==`${c.nsREX}RPadDisplayItem`)}syncDraw(t){const e={kind:t||"redraw"};return void 0===this._doing_draw?(this._doing_draw=[e],Promise.resolve(!0)):!(!0!==e.kind&&this._doing_draw.findIndex((i,s)=>s>0&&i.kind===e.kind)>0)&&(this._doing_draw.push(e),new Promise(i=>{e.func=i}))}confirmDraw(){if(void 0===this._doing_draw)return console.warn("failure, should not happen");if(this._doing_draw.shift(),0===this._doing_draw.length)delete this._doing_draw;else{const t=this._doing_draw[0];t.func&&(t.func(),delete t.func)}}drawObject(){return(0,O.A)(function*(){return console.log("Not possible to draw object without loading of draw.mjs"),null})()}drawPrimitives(t){var e=this;return(0,O.A)(function*(){if(void 0===t)return e.iscan&&(e._start_tm=(new Date).getTime()),e._num_primitives=e.pad?.fPrimitives?.length??0,e.syncDraw(!0).then(()=>e.drawPrimitives(0));if(e.pad&&!(t>=e._num_primitives))return e.drawObject(e.getDom(),e.pad.fPrimitives[t],"").then(i=>((0,c.isObject)(i)&&(i._primitive=!0),e.drawPrimitives(t+1)));if(e.confirmDraw(),e._start_tm){const i=(new Date).getTime()-e._start_tm;i>3e3&&console.log(`Canvas drawing took ${(.001*i).toFixed(2)}s`),delete e._start_tm}})()}processPadTooltipEvent(t){const e=[],i=[];return this.painters?.forEach(s=>{(0,c.isFunc)(s.processTooltipEvent)&&e.push(s)}),t&&(t.nproc=e.length),e.forEach(s=>{const a=s.processTooltipEvent(t)||{user_info:null};i.push(a),t?.painters&&(a.painter=s)}),i}changeDarkMode(t){this.getCanvSvg().style("filter",t??c.settings.DarkMode?"invert(100%)":null)}fillContextMenu(t){t.add(this.iscan?"header: RCanvas":"header: RPad"),t.addchk(this.isTooltipAllowed(),"Show tooltips",()=>this.setTooltipAllowed("toggle")),this._websocket||(t.addAttributesMenu(this),this.iscan&&t.addSettingsMenu(!1,!1,i=>{"dark"===i&&this.changeDarkMode()})),t.add("separator"),(0,c.isFunc)(this.hasMenuBar)&&(0,c.isFunc)(this.actiavteMenuBar)&&t.addchk(this.hasMenuBar(),"Menu bar",i=>this.actiavteMenuBar(i)),(0,c.isFunc)(this.hasEventStatus)&&(0,c.isFunc)(this.activateStatusBar)&&(0,c.isFunc)(this.canStatusBar)&&this.canStatusBar()&&t.addchk(this.hasEventStatus(),"Event status",()=>this.activateStatusBar("toggle")),(this.enlargeMain()||this.has_canvas&&this.hasObjectsToDraw())&&t.addchk("on"===this.enlargeMain("state"),"Enlarge "+(this.iscan?"canvas":"pad"),()=>this.enlargePad());const e=this.this_pad_name||(this.iscan?"canvas":"pad");return t.add("sub:Save as"),["svg","png","jpeg","pdf","webp"].forEach(i=>t.add(`${e}.${i}`,()=>this.saveAs(i,this.iscan,`${e}.${i}`))),t.add("endsub:"),!0}padContextMenu(t){t.stopPropagation&&(t.stopPropagation(),t.preventDefault(),this.getFramePainter()?.setLastEventPos()),(0,o.ES)(t,this).then(e=>(this.fillContextMenu(e),this.fillObjectExecMenu(e))).then(e=>e.show())}redrawPad(t){var e=this;return(0,O.A)(function*(){const i=e.syncDraw(t);if(!1===i)return console.log("Prevent RPad redrawing"),!1;let s=!0;const a=n=>{for(;n<e.painters.length;){const r=e.painters[n++];let d=0;if((s||r.this_pad_name)&&(d=r.redraw(t)),(0,c.isPromise)(d))return d.then(()=>a(n))}return!0};return i.then(()=>(e.iscan?e.createCanvasSvg(2):s=e.createPadSvg(!0),a(0))).then(()=>(e.addPadInteractive(),(0,V.OZ)()===e&&e.getCanvPainter()?.producePadEvent("padredraw",e),e.confirmDraw(),!0))})()}redraw(t){return this.redrawPad(t)}needRedrawByResize(){const t=this.svg_this_pad();if(!t.empty()&&t.property("can3d")===c.constants.Embed3D.Overlay)return!0;for(let e=0;e<this.painters.length;++e)if((0,c.isFunc)(this.painters[e].needRedrawByResize)&&this.painters[e].needRedrawByResize())return!0;return!1}checkCanvasResize(t,e){if(this._ignore_resize||!this.iscan&&this.has_canvas)return!1;const i=this.syncDraw("canvas_resize");if(!1===i)return!1;(!0===t||!1===t)&&(e=t,t=null),(0,c.isObject)(t)&&t.force&&(e=!0),e||(e=this.needRedrawByResize());let s=!1;const a=n=>!s||n>=this.painters.length?(this.confirmDraw(),s):(0,c.getPromise)(this.painters[n].redraw(e?"redraw":"resize")).then(()=>a(n+1));return i.then(()=>(s=this.createCanvasSvg(e?2:1,t),s&&this.iscan&&this.pad&&this.online_canvas&&!this.embed_canvas&&!this.isBatchMode()&&(this._resize_tmout&&clearTimeout(this._resize_tmout),this._resize_tmout=setTimeout(()=>{if(delete this._resize_tmout,!this.pad?.fWinSize)return;const n=this.getPadWidth(),r=this.getPadHeight();n>0&&r>0&&(this.pad.fWinSize[0]!==n||this.pad.fWinSize[1]!==r)&&(this.pad.fWinSize[0]=n,this.pad.fWinSize[1]=r,this.sendWebsocket(`RESIZED:[${n},${r}]`))},1e3)),a(0)))}updateObject(t){return!!t&&(this.pad.fStyle=t.fStyle,this.pad.fAttr=t.fAttr,this.iscan?(this.pad.fTitle=t.fTitle,this.pad.fWinSize=t.fWinSize):(this.pad.fPos=t.fPos,this.pad.fSize=t.fSize),!0)}addObjectPainter(t,e,i){t&&e&&e[i]&&void 0===t.snapid&&(this.painters.indexOf(t)<0&&this.painters.push(t),t.assignSnapId(e[i].fObjectID),t.rstyle||(t.rstyle=e[i].fStyle||this.rstyle))}extractTObjectProp(t){if(t.fColIndex&&t.fColValue){const a=this.root_colors||(0,h.HG)();for(let n=0;n<t.fColIndex.length;++n)a[t.fColIndex[n]]=t.fColValue[n]}const e=new p.D,i=t.fObject;e.assignObject(t),e.csstype=t.fCssType,e.rstyle=t.fStyle,t.fOption=e.v7EvalAttr("options","");const s=(a,n)=>{const r=e.v7EvalColor(n,"");r&&(i[a]=(0,h.nM)(r,this.root_colors))};void 0!==i.fLineColor&&void 0!==i.fLineWidth&&void 0!==i.fLineStyle&&(s("fLineColor","line_color"),i.fLineWidth=e.v7EvalAttr("line_width",i.fLineWidth),i.fLineStyle=e.v7EvalAttr("line_style",i.fLineStyle)),void 0!==i.fFillColor&&void 0!==i.fFillStyle&&(s("fFillColor","fill_color"),i.fFillStyle=e.v7EvalAttr("fill_style",i.fFillStyle)),void 0!==i.fMarkerColor&&void 0!==i.fMarkerStyle&&void 0!==i.fMarkerSize&&(s("fMarkerColor","marker_color"),i.fMarkerStyle=e.v7EvalAttr("marker_style",i.fMarkerStyle),i.fMarkerSize=e.v7EvalAttr("marker_size",i.fMarkerSize)),void 0!==i.fTextColor&&void 0!==i.fTextAlign&&void 0!==i.fTextAngle&&void 0!==i.fTextSize&&(s("fTextColor","text_color"),i.fTextAlign=e.v7EvalAttr("text_align",i.fTextAlign),i.fTextAngle=e.v7EvalAttr("text_angle",i.fTextAngle),i.fTextSize=e.v7EvalAttr("text_size",i.fTextSize))}drawNextSnap(t,e){var i=this;return(0,O.A)(function*(){if(void 0===e&&(e=-1,i._snaps_map={},i._num_primitives=t?t.length:0,i._auto_color_cnt=0),delete i.next_rstyle,++e,!t||e>=t.length)return delete i._snaps_map,delete i._auto_color_cnt,i;const s=t[e],a=s.fObjectID;let n=i._snaps_map[a],r=null;if(n?n++:n=1,i._snaps_map[a]=n,s.fDummy)return i.drawNextSnap(t,e);for(let d=0;d<i.painters.length;++d)if(i.painters[d].snapid===a&&0==--n){r=i.painters[d];break}if(r){if(s._typename===`${c.nsREX}RPadDisplayItem`)return r.redrawPadSnap(s).then(f=>(i.addObjectPainter(f,t,e),i.drawNextSnap(t,e)));let d;return s._typename===`${c.nsREX}TObjectDisplayItem`&&i.extractTObjectProp(s),r.updateObject(s.fDrawable||s.fObject||s,s.fOption||"",!0)&&(d=r.redraw()),(0,c.getPromise)(d).then(()=>i.drawNextSnap(t,e))}if(s._typename===`${c.nsREX}RPadDisplayItem`){const d=s,f=new v(i.getDom(),d,!1);f.decodeOptions(""),f.addToPadPrimitives(i.this_pad_name),f.assignSnapId(s.fObjectID),f.rstyle=s.fStyle,f.createPadSvg(),s.fPrimitives&&s.fPrimitives.length>0&&f.addPadButtons();const x=f.selectCurrentPad(f.this_pad_name);return f.drawNextSnap(s.fPrimitives).then(()=>(f.addPadInteractive(),f.selectCurrentPad(x),i.drawNextSnap(t,e)))}if(i.next_rstyle=t[e].fStyle||i.rstyle,s._typename===`${c.nsREX}TObjectDisplayItem`){const d={kNone:0,kObject:1,kColors:4,kStyle:5,kPalette:6};if(s.fKind===d.kStyle)return Object.assign(c.gStyle,s.fObject),i.drawNextSnap(t,e);if(s.fKind===d.kColors){const f=[],x=s.fObject.arr;for(let m=0;m<x.length;++m){const y=x[m].fString,A=y.indexOf("=");A>0&&(f[parseInt(y.slice(0,A))]=y.slice(A+1))}return i.root_colors=f,i.drawNextSnap(t,e)}if(s.fKind===d.kPalette){const f=s.fObject.arr,x=[];for(let m=0;m<f.length;++m)x[m]=f[m].fString;return i.custom_palette=new h.rE(x),i.drawNextSnap(t,e)}if(!i.getFramePainter())return i.drawObject(i.getDom(),{_typename:c.clTFrame,$dummy:!0},"").then(()=>i.drawNextSnap(t,e-1));i.extractTObjectProp(s)}return i.drawObject(i.getDom(),s.fDrawable||s.fObject||s,s.fOption||"").then(d=>(i.addObjectPainter(d,t,e),i.drawNextSnap(t,e)))})()}findSnap(t,e){function i(s){return!(!s||!(0,c.isStr)(s))&&(s===t||e&&s.length>t.length&&s.indexOf(t)===s.length-t.length)}if(i(this.snapid))return this;if(!this.painters)return null;for(let s=0;s<this.painters.length;++s){let a=this.painters[s];if(!e&&(0,c.isFunc)(a.findSnap)?a=a.findSnap(t):i(a.snapid)||(a=null),a)return a}return null}redrawPadSnap(t){var e=this;return(0,O.A)(function*(){if(!t||!t.fPrimitives)return e;if(e.iscan&&e._websocket&&t.fTitle&&!e.embed_canvas&&typeof document<"u"&&(document.title=t.fTitle),void 0===e.snapid){e.assignSnapId(t.fObjectID),e.draw_object=t,e.pad=t,e.isBatchMode()&&e.iscan&&(e._fixed_size=!0);const n=e.selectDom().attr("id");return!e.isBatchMode()&&!e.use_openui&&!e.brlayout&&n&&(0,c.isStr)(n)&&(e.brlayout=new J.jX(n,null,e),e.brlayout.create(n,!0),e.setDom(e.brlayout.drawing_divid()),(0,B.d7)(e.brlayout)),e.createCanvasSvg(0),e.addPadButtons(!0),e.drawNextSnap(t.fPrimitives)}e.updateObject(t),e.iscan?e.createCanvasSvg(2):e.createPadSvg(!0);let i=!1,s=!1;for(let n=0;n<e.painters.length;++n){let r=e.painters[n];void 0!==r.snapid&&(t.fPrimitives.forEach(d=>{r&&d.fObjectID===r.snapid&&(r=null,i=!0)}),r&&(e.painters.splice(n--,1),r.cleanup(),s=!0,e.main_painter_ref===r&&delete e.main_painter_ref))}if(s&&delete e.pads_cache,!i){let n=e.getFramePainter();n?.is_root6()&&(n=null);for(let r=0;r<e.painters.length;++r)n!==e.painters[r]&&e.painters[r].cleanup();e.painters=[],delete e.main_painter_ref,n&&(e.painters.push(n),n.cleanFrameDrawings(),n.redraw()),(0,c.isFunc)(e.removePadButtons)&&e.removePadButtons(),e.addPadButtons(!0)}const a=e.selectCurrentPad(e.this_pad_name);return e.drawNextSnap(t.fPrimitives).then(()=>(e.addPadInteractive(),e.selectCurrentPad(a),(0,V.OZ)()===e&&e.getCanvPainter()?.producePadEvent("padredraw",e),e))})()}createImage(t){var e=this;return(0,O.A)(function*(){return"png"===t||"jpeg"===t||"svg"===t||"pdf"===t?e.produceImage(!0,t).then(i=>{if(!i||"svg"===t)return i;const s=i.indexOf("base64,");return s>0?i.slice(s+7):""}):""})()}itemContextMenu(t){const e=this.svg_this_pad().node().getBoundingClientRect(),i={clientX:e.left+10,clientY:e.top+10};if("pad"===t)return(0,c.postponePromise)(()=>this.padContextMenu(i),50);let a,s=null;switch(t){case"xaxis":case"yaxis":case"zaxis":s=this.getMainPainter(),a=t[0];break;case"frame":s=this.getFramePainter();break;default:{const n=parseInt(t);Number.isInteger(n)&&(s=this.painters[n])}}return(0,c.isFunc)(s?.fillContextMenu)?(0,o.ES)(i,s).then(n=>{(s.fillContextMenu(n,a)||s.snapid)&&s.fillObjectExecMenu(n,a).then(()=>(0,c.postponePromise)(()=>n.show(),50))}):void 0}saveAs(t,e,i){i||(i=(this.this_pad_name||(this.iscan?"canvas":"pad"))+"."+t),this.produceImage(e,t).then(s=>{if(!s)return console.error(`Fail to produce image ${i}`);(0,B.OJ)(i,"svg"!==t?s:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(s))})}findActivePad(){return null}produceImage(t,e){var i=this;return(0,O.A)(function*(){const s="frame"===t,a=s?i.getFrameSvg(i.this_pad_name):t?i.getCanvSvg():i.svg_this_pad(),n=t&&!s?i.getCanvPainter():i,r=[];if(a.empty())return"";if(s||!t){const m=i.getCanvSvg().selectChild(".canvas_defs");m.empty()||(r.push({prnt:i.getCanvSvg(),defs:m}),a.node().insertBefore(m.node(),a.node().firstChild))}s||n.forEachPainterInPad(m=>{const y={prnt:m.svg_this_pad()};r.push(y);const A=m.getLayerSvg("btns_layer",i.this_pad_name);y.btns_node=A.node(),y.btns_node&&(y.btns_prnt=y.btns_node.parentNode,y.btns_next=y.btns_node.nextSibling,A.remove());const b=m.getFramePainter();if(!(0,c.isFunc)(b?.render3D)||!(0,c.isFunc)(b?.access3dKind))return;const j=b.access3dKind();if(j!==c.constants.Embed3D.Overlay&&j!==c.constants.Embed3D.Embed)return;const N=b.getSizeFor3d(c.constants.Embed3D.Embed),H=b.renderer.domElement;b.render3D(0);const Y=H.toDataURL("image/png");j===c.constants.Embed3D.Embed&&(y.foreign=y.prnt.select("."+N.clname),y.foreign.remove());const E=b.getFrameSvg();y.frame_node=E.node(),y.frame_node&&(y.frame_next=y.frame_node.nextSibling,E.remove()),y.img=y.prnt.insert("image",".primitives_layer").attr("x",N.x).attr("y",N.y).attr("width",H.width).attr("height",H.height).attr("href",Y)},"pads");let d=a.property("draw_width"),f=a.property("draw_height");if(s){const m=i.getFramePainter();d=m.getFrameWidth(),f=m.getFrameHeight()}const x="pdf"===e?{node:a.node(),width:d,height:f,reset_tranform:s}:(0,K.NM)(`<svg width="${d}" height="${f}" xmlns="http://www.w3.org/2000/svg">${a.node().innerHTML}</svg>`);return(0,K.Vm)(x,e).then(m=>{for(let y=0;y<r.length;++y){const A=r[y];A.img?.remove();const b=A.prnt.selectChild(".primitives_layer");A.foreign&&A.prnt.node().insertBefore(A.foreign.node(),b.node()),A.frame_node&&b.node().insertBefore(A.frame_node,A.frame_next),A.btns_node&&A.btns_prnt.insertBefore(A.btns_node,A.btns_next),A.defs&&A.prnt.node().insertBefore(A.defs.node(),A.prnt.node().firstChild)}return m})})()}clickPadButton(t,e){if("CanvasSnapShot"===t)return this.saveAs("png",!0);if("enlargePad"===t)return this.enlargePad();if("PadSnapShot"===t)return this.saveAs("png",!1);if("PadContextMenus"===t)return e?.preventDefault(),e?.stopPropagation(),(0,o.IV)()?void 0:(0,o.ES)(e,this).then(a=>{a.add("header:Menus"),a.add(this.iscan?"Canvas":"Pad","pad",this.itemContextMenu),this.getFramePainter()&&a.add("Frame","frame",this.itemContextMenu);const n=this.getMainPainter();if(n&&(a.add("X axis","xaxis",this.itemContextMenu),a.add("Y axis","yaxis",this.itemContextMenu),(0,c.isFunc)(n.getDimension)&&n.getDimension()>1&&a.add("Z axis","zaxis",this.itemContextMenu)),this.painters?.length){a.add("separator");const r=[];this.painters.forEach((d,f)=>{const x=d?.getObject();if(!x||r.indexOf(x)>=0||d.isSecondary())return;let m=(0,c.isFunc)(d.getClassName)?d.getClassName():x._typename||"";m&&(m+="::"),m+=(0,c.isFunc)(d.getObjectName)?d.getObjectName():x.fName||`item${f}`,a.add(m,f,this.itemContextMenu),r.push(x)})}a.show()});let i=!1;const s=[];for(let a=0;a<this.painters.length;++a){const n=this.painters[a];(0,c.isFunc)(n.clickPadButton)&&s.push(n.clickPadButton(t,e)),!i&&(0,c.isFunc)(n.clickButton)&&(i=n.clickButton(t),(0,c.isPromise)(i)&&s.push(i))}return Promise.all(s)}addPadButton(t,e,i,s){if(c.settings.ToolBar&&!this.isBatchMode()){this._buttons||(this._buttons=[]);for(let n=0;n<this._buttons.length;++n)if(this._buttons[n].funcname===i)return;if(this._buttons.push({btn:t,tooltip:e,funcname:i,keyname:s}),!this.iscan&&this.has_canvas&&0!==i.indexOf("Pad")&&"enlargePad"!==i){const n=this.getCanvPainter();n&&n!==this&&n.addPadButton(t,e,i)}}}addPadButtons(t){this.addPadButton("camera","Create PNG",this.iscan?"CanvasSnapShot":"PadSnapShot","Ctrl PrintScreen"),c.settings.ContextMenu&&this.addPadButton("question","Access context menus","PadContextMenus"),(!this.iscan&&this.has_canvas&&this.hasObjectsToDraw()||this.enlargeMain("verify"))&&this.addPadButton("circle","Enlarge canvas","enlargePad"),t&&this.brlayout&&(this.addPadButton("diamand","Toggle Ged","ToggleGed"),this.addPadButton("three_circles","Toggle Status","ToggleStatus"))}showPadButtons(){this._buttons&&(_.DR.assign(this),this.showPadButtons())}getPadLength(t,e,i){let s,a;const n=t?-1:1,r=(m,y)=>m<e.fArr.length?e.fArr[m]:y,d=()=>(s||(s=i?i.getFrameRect():this.getPadRect()),s);if(i){const m=r(2),y=t?"gry":"grx";void 0!==m&&i[y]&&(a=i[y](m))}void 0===a&&(a=t?d().height:0);const f=r(0,0);return a+=n*r(1,0),f&&(a+=n*(t?d().height:d().width)*f),Math.round(a)}getCoordinate(t,e){return{x:this.getPadLength(!1,t.fHoriz,e),y:this.getPadLength(!0,t.fVert,e)}}decodeOptions(t){const e=this.getObject();if(!e)return;const i=new K.nC(t);this.options||(this.options={}),Object.assign(this.options,{GlobalColors:!0,LocalColors:!1,IgnorePalette:!1,RotateFrame:!1,FixFrame:!1}),(i.check("NOCOLORS")||i.check("NOCOL"))&&(this.options.GlobalColors=this.options.LocalColors=!1),(i.check("LCOLORS")||i.check("LCOL"))&&(this.options.GlobalColors=!1,this.options.LocalColors=!0),(i.check("NOPALETTE")||i.check("NOPAL"))&&(this.options.IgnorePalette=!0),i.check("ROTATE")&&(this.options.RotateFrame=!0),i.check("FIXFRAME")&&(this.options.FixFrame=!0),i.check("WHITE")&&(e.fFillColor=0),i.check("LOGX")&&(e.fLogx=1),i.check("LOGY")&&(e.fLogy=1),i.check("LOGZ")&&(e.fLogz=1),i.check("LOG")&&(e.fLogx=e.fLogy=e.fLogz=1),i.check("GRIDX")&&(e.fGridx=1),i.check("GRIDY")&&(e.fGridy=1),i.check("GRID")&&(e.fGridx=e.fGridy=1),i.check("TICKX")&&(e.fTickx=1),i.check("TICKY")&&(e.fTicky=1),i.check("TICK")&&(e.fTickx=e.fTicky=1)}static draw(t,e,i){return(0,O.A)(function*(){const s=new v(t,e,!1);s.decodeOptions(i),s.getCanvSvg().empty()?(s.has_canvas=!1,s.this_pad_name="",s.setTopPainter()):s.addToPadPrimitives(s.pad_name),s.createPadSvg(),s.matchObjectType(c.clTPad)&&(!s.has_canvas||s.hasObjectsToDraw())&&s.addPadButtons();const a=s.has_canvas?s.selectCurrentPad(s.this_pad_name):void 0;return(0,V.QD)({pp:s,active:!1}),s.drawPrimitives().then(()=>(s.addPadInteractive(),s.showPadButtons(),s.selectCurrentPad(a),s))})()}}const z="0123456789abcdef".split(""),k=[-2147483648,8388608,32768,128],P=[24,16,8,0],I=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];class T{constructor(t){this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}update(t){if(this.finalized)return;const e="string"!=typeof t,i=t.length,s=this.blocks;let a,r,n=0;for(;n<i;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(r=this.start;n<i&&r<64;++n)s[r>>2]|=t[n]<<P[3&r++];else for(r=this.start;n<i&&r<64;++n)a=t.charCodeAt(n),a<128?s[r>>2]|=a<<P[3&r++]:a<2048?(s[r>>2]|=(192|a>>6)<<P[3&r++],s[r>>2]|=(128|63&a)<<P[3&r++]):a<55296||a>=57344?(s[r>>2]|=(224|a>>12)<<P[3&r++],s[r>>2]|=(128|a>>6&63)<<P[3&r++],s[r>>2]|=(128|63&a)<<P[3&r++]):(a=65536+((1023&a)<<10|1023&t.charCodeAt(++n)),s[r>>2]|=(240|a>>18)<<P[3&r++],s[r>>2]|=(128|a>>12&63)<<P[3&r++],s[r>>2]|=(128|a>>6&63)<<P[3&r++],s[r>>2]|=(128|63&a)<<P[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=s[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}finalize(){if(this.finalized)return;this.finalized=!0;const t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=k[3&e],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}hash(){const t=this.blocks;let x,m,y,A,b,j,N,H,Y,E,Q,e=this.h0,i=this.h1,s=this.h2,a=this.h3,n=this.h4,r=this.h5,d=this.h6,f=this.h7;for(x=16;x<64;++x)b=t[x-15],m=(b>>>7|b<<25)^(b>>>18|b<<14)^b>>>3,b=t[x-2],y=(b>>>17|b<<15)^(b>>>19|b<<13)^b>>>10,t[x]=t[x-16]+m+t[x-7]+y|0;for(Q=i&s,x=0;x<64;x+=4)this.first?(this.is224?(H=300032,b=t[0]-1413257819,f=b-150054599|0,a=b+24177077|0):(H=704751109,b=t[0]-210244248,f=b-1521486534|0,a=b+143694565|0),this.first=!1):(m=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),y=(n>>>6|n<<26)^(n>>>11|n<<21)^(n>>>25|n<<7),H=e&i,A=H^e&s^Q,N=n&r^~n&d,b=f+y+N+I[x]+t[x],j=m+A,f=a+b|0,a=b+j|0),m=(a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10),y=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),Y=a&e,A=Y^a&i^H,N=f&n^~f&r,b=d+y+N+I[x+1]+t[x+1],j=m+A,d=s+b|0,s=b+j|0,m=(s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10),y=(d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7),E=s&a,A=E^s&e^Y,N=d&f^~d&n,b=r+y+N+I[x+2]+t[x+2],j=m+A,r=i+b|0,i=b+j|0,m=(i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10),y=(r>>>6|r<<26)^(r>>>11|r<<21)^(r>>>25|r<<7),Q=i&s,A=Q^i&a^E,N=r&d^~r&f,b=n+y+N+I[x+3]+t[x+3],j=m+A,n=e+b|0,e=b+j|0,this.chromeBugWorkAround=!0;this.h0=this.h0+e|0,this.h1=this.h1+i|0,this.h2=this.h2+s|0,this.h3=this.h3+a|0,this.h4=this.h4+n|0,this.h5=this.h5+r|0,this.h6=this.h6+d|0,this.h7=this.h7+f|0}digest(){this.finalize();const t=this.h0,e=this.h1,i=this.h2,s=this.h3,a=this.h4,n=this.h5,r=this.h6,d=this.h7,f=[t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24&255,i>>16&255,i>>8&255,255&i,s>>24&255,s>>16&255,s>>8&255,255&s,a>>24&255,a>>16&255,a>>8&255,255&a,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r];return this.is224||f.push(d>>24&255,d>>16&255,d>>8&255,255&d),f}hex(){const t=this.digest();let e="";for(let i=0;i<t.length;++i)e+=z[t[i]>>4&15]+z[15&t[i]];return e}toString(){return this.hex()}}function R(g,t,e){const i=new T(!1);return i.update(g),i.update(t),e?i.hex():i.digest()}function S(g,t,e){const i=function F(g,t){const e=new T(!1);return e.update(g),t?e.hex():e.digest()}(""+g),r=[],d=[];for(;i.length<64;)i.push(0);for(let x=0;x<i.length;++x){const m=i[x];r.push(92^m),d.push(54^m)}const f=R(d,void 0===e?t:new Uint8Array(t,e));return R(r,f,!0)}class U{constructor(t,e,i,s){this.path=t,this.connid=null,this.req=null,this.raw=e,this.handle=i,this.counter=s,this.nextRequest("","connect")}nextRequest(t,e){let i=this.path,s="buf",a=null;if("connect"===e)i+=this.raw?"?raw_connect":"?txt_connect",this.handle&&(i+="&"+this.handle.getConnArgs(this.counter++)),console.log(`longpoll connect ${i} raw = ${this.raw}`),this.connid="connect";else if("close"===e){if(null===this.connid||"close"===this.connid)return;i+=`?connection=${this.connid}&close`,this.handle&&(i+="&"+this.handle.getConnArgs(this.counter++)),this.connid="close",s="text;sync"}else null===this.connid||"number"!=typeof this.connid?c.browser.qt5||console.error("No connection"):(i+="?connection="+this.connid,this.handle&&(i+="&"+this.handle.getConnArgs(this.counter++)),"dummy"===e&&(i+="&dummy"));t&&(this.raw?i+="&post="+(0,c.btoa_func)(t):(s="postbuf",a=t)),(0,c.createHttpRequest)(i,s,function(n){if(this.handle.req===this&&(this.handle.req=null),null===n)return this.handle.processRequest(null);if(this.handle.raw){const r=new Uint8Array(n);let d="",f=0,x=r.length;if(x<4)return c.browser.qt5||console.error(`longpoll got short message in raw mode ${x}`),this.handle.processRequest(null);for(;f<4;)d+=String.fromCharCode(r[f++]);if("txt:"!==d){for(d="";f<x&&":"!==String.fromCharCode(r[f]);)d+=String.fromCharCode(r[f++]);++f,x=f+parseInt(d.trim())}for(d="";f<x;)d+=String.fromCharCode(r[f++]);d&&this.handle.processRequest("<<nope>>"===d?-1111:d),x<r.length&&this.handle.processRequest(n,x)}else if("application/x-binary"===this.getResponseHeader("Content-Type")){const r=this.getResponseHeader("LongpollHeader");r&&this.handle.processRequest(r),this.handle.processRequest(n,0)}else{if(n&&!(0,c.isStr)(n)){let r="";const d=new Uint8Array(n);for(let f=0;f<d.length;++f)r+=String.fromCharCode(d[f]);n=r}this.handle.processRequest("<<nope>>"===n?-1111:n)}},function(){this.handle.processRequest(null,"error")},!0).then(n=>{n.handle=this,this.req||(this.req=n),n.send(a)})}processRequest(t,e){if(null===t)return(0,c.isFunc)(this.onerror)&&this.onerror("receive data with connid "+(this.connid||"---")),"error"===e&&(0,c.isFunc)(this.onclose)&&this.onclose("force_close"),void(this.connid=null);-1111===t&&(t="");let i=5;if("connect"===this.connid){if(!t)return this.connid=null,void((0,c.isFunc)(this.onerror)&&this.onerror("connection rejected"));this.connid=parseInt(t),i=100,console.log(`Get new longpoll connection with id ${this.connid}`),(0,c.isFunc)(this.onopen)&&this.onopen()}else{if("close"===this.connid)return void((0,c.isFunc)(this.onclose)&&this.onclose());(0,c.isFunc)(this.onmessage)&&t&&this.onmessage({data:t,offset:e})}this.req||setTimeout(()=>{this.req||this.nextRequest("","dummy")},i)}send(t){this.nextRequest(t)}close(){this.nextRequest("","close")}}class Z{constructor(t){this.receiver=t,this.protocol=[],this.cnt=0,(0,c.httpRequest)("protocol.json","text").then(e=>this.getProtocol(e))}getProtocol(t){t&&(this.protocol=JSON.parse(t),(0,c.isFunc)(this.onopen)&&this.onopen(),this.nextOperation())}send(){"send"===this.protocol[this.cnt]&&(this.cnt++,setTimeout(()=>this.nextOperation(),10))}close(){}nextOperation(){if(this.wait_for_file)return;const t=this.protocol[this.cnt];t&&"send"!==t&&(this.wait_for_file=!0,this.cnt++,(0,c.httpRequest)(t,t.indexOf(".bin")>0?"buf":"text").then(e=>{if(this.wait_for_file=!1,!e)return;const i=t.indexOf("_ch"),s=i>0?Number.parseInt(t.slice(i+3,t.indexOf(".",i))):1;(0,c.isFunc)(this.receiver.provideData)&&this.receiver.provideData(s,e,0),setTimeout(()=>this.nextOperation(),10)}))}}class L{constructor(t,e){this.kind=t,this.state=0,this.credits=e||10,this.cansend=this.credits,this.ackn=this.credits,this.send_seq=1,this.recv_seq=0}getUserArgs(t){return t&&(0,c.isStr)(t)?(0,c.isObject)(this.user_args)?this.user_args[t]:void 0:this.user_args}setUserArgs(t){this.user_args=t}setReceiver(t){this.receiver=t}cleanup(){delete this.receiver,this.close(!0)}invokeReceiver(t,e,i,s){if(this.receiver&&(0,c.isFunc)(this.receiver[e])&&this.receiver[e](this,i,s),t&&this.channels){const a=Object.keys(this.channels);for(let n=0;n<a.length;++n)this.channels[a[n]].invokeReceiver(!1,e,i,s)}}provideData(t,e,i){if(this.wait_first_recv)return delete this.wait_first_recv,this.state=1,this.invokeReceiver(!1,"onWebsocketOpened");if(t>1&&this.channels){const a=this.channels[t];if(a)return a.provideData(1,e,i)}const s=i&&i<0;if(!(s||this.msgqueue&&this.msgqueue.length))return this.invokeReceiver(!1,"onWebsocketMsg",e,i);this.msgqueue||(this.msgqueue=[]),s&&(i=void 0),this.msgqueue.push({ready:!0,msg:e,len:i})}reserveQueueItem(){this.msgqueue||(this.msgqueue=[]);const t={ready:!1,msg:null,len:0};return this.msgqueue.push(t),t}markQueueItemDone(t,e,i){t.ready=!0,t.msg=e,t.len=i,this.processQueue()}processQueue(){if(!this._loop_msgqueue&&this.msgqueue){for(this._loop_msgqueue=!0;this.msgqueue.length>0&&this.msgqueue[0].ready;){const t=this.msgqueue.shift();this.invokeReceiver(!1,"onWebsocketMsg",t.msg,t.len)}0===this.msgqueue.length&&delete this.msgqueue,delete this._loop_msgqueue}}close(t){if(this.master)return this.master.send(`CLOSECH=${this.channelid}`,0),delete this.master.channels[this.channelid],void delete this.master;this.timerid&&(clearTimeout(this.timerid),delete this.timerid),this._websocket&&this.state>0&&(this.state=t?-1:0,this._websocket.onclose=null,this._websocket.close(),delete this._websocket)}canSend(t){return this.cansend>=(t||1)}getRelCanSend(){return this.credits?this.cansend/this.credits:1}send(t,e){if(this.master)return this.master.send(t,this.channelid);if(!this._websocket||this.state<=0)return!1;Number.isInteger(e)||(e=1),this.cansend<=0&&console.error(`should be queued before sending cansend: ${this.cansend}`);const i=`${this.send_seq++}:${this.ackn}:${this.cansend}:${e}:`;this.ackn=0,this.cansend--;let s="none";return this._websocket.send(`${s}:${i}${t}`),("websocket"===this.kind||"longpoll"===this.kind)&&(this.timerid&&clearTimeout(this.timerid),this.timerid=setTimeout(()=>this.keepAlive(),1e4)),!0}sendLast(t,e,i){let s=this._delayed;s||(s=this._delayed={}),s[t]=i,s[`${t}_handler`]||(s[`${t}_handler`]=setTimeout(()=>{delete s[`${t}_handler`],this.send(s[t])},e))}inject(t,e,i){if(!i)return setTimeout(this.inject.bind(this,t,e,!0),0);if(void 0===e&&(e=1),Array.isArray(t)){for(let s=0;s<t.length;++s)this.provideData(e,(0,c.isStr)(t[s])?t[s]:JSON.stringify(t[s]),-1);this.processQueue()}else t&&this.provideData(e,(0,c.isStr)(t)?t:JSON.stringify(t))}keepAlive(){delete this.timerid,this.send("KEEPALIVE",0)}resizeWindow(t,e){c.browser.qt5||c.browser.cef3?this.send(`RESIZE=${t},${e}`,0):typeof window<"u"&&(0,c.isFunc)(window?.resizeTo)&&window.resizeTo(t,e)}createChannel(){if(this.master)return this.master.createChannel();const t=new L("channel",this.credits);return t.wait_first_recv=!0,this.channels||(this.channels={},this.freechannelid=2),t.master=this,t.channelid=this.freechannelid++,this.channels[t.channelid]=t,t}isConnected(){return this.state>0}getChannelId(){return this.channelid&&this.master?this.channelid:1}setHRef(t){if((0,c.isStr)(t)&&t.indexOf("?")>0){this.href=t.slice(0,t.indexOf("?"));const e=(0,c.decodeUrl)(t);this.key=e.get("key"),this.token=e.get("token")}else this.href=t,delete this.key,delete this.token}getHRef(t){if(!t||!this.kind||!this.href)return this.href;let e=this.href;if(0===t.indexOf("../")){const i=e.lastIndexOf("/",e.length-2);e=e.slice(0,i)+t.slice(2)}else e+=t;return e}getConnArgs(t){let e="";return this.key&&(e+=`key=${S(this.key,`attempt_${t}`)}&ntry=${t}`),this.token&&(e&&(e+="&"),e+=`token=${this.token}`),e}connect(t){this.close(),!t&&this.href&&(t=this.href);let e=0;const i=s=>{if(0!==this.state)return;s||console.log(`try connect window again ${(new Date).toString()}`),this._websocket&&(this._websocket.close(),delete this._websocket),t||((t=window.location.href)&&t.indexOf("#")>0&&(t=t.slice(0,t.indexOf("#"))),t&&t.lastIndexOf("/")>0&&(t=t.slice(0,t.lastIndexOf("/")+1))),this.href=t,e++,s&&console.log(`Opening web socket at ${t}`),e>2&&(0,B.Rh)(`Trying to connect ${t}`);let a=t;"file"===this.kind?(a+="root.filedump",this._websocket=new Z(this),console.log(`configure protocol log ${a}`)):"websocket"===this.kind&&s?(a=a.replace("http://","ws://").replace("https://","wss://")+"root.websocket",a+="?"+this.getConnArgs(e),console.log(`configure websocket ${a}`),this._websocket=new WebSocket(a)):(a+="root.longpoll",console.log(`configure longpoll ${a}`),this._websocket=new U(a,"rawlongpoll"===this.kind,this,e)),this._websocket&&(this._websocket.onopen=()=>{e>2&&(0,B.Rh)(),this.state=1,this.send(`READY=${this.key||""}`,0),this.invokeReceiver(!1,"onWebsocketOpened")},this._websocket.onmessage=n=>{let r=n.data;if(this.next_binary){const H=this.next_binary;if(delete this.next_binary,delete this.next_binary_hash,r instanceof Blob){const E=new FileReader,Q=this.reserveQueueItem();E.onload=X=>{let et=X.target.result;this.markQueueItemDone(Q,et,0)},E.readAsArrayBuffer(r,n.offset||0)}else{let E=r;this.provideData(H,E,n.offset||0)}return}if(!(0,c.isStr)(r))return console.log("unsupported message kind: "+typeof r);const d=r.indexOf(":"),x=(r.slice(0,d),r.indexOf(":",d+1)),m=Number.parseInt(r.slice(d+1,x)),y=r.indexOf(":",x+1),A=Number.parseInt(r.slice(x+1,y)),b=r.indexOf(":",y+1),j=r.indexOf(":",b+1),N=Number.parseInt(r.slice(b+1,j));if(m<=this.recv_seq)return console.log(`Failure with packet sequence ${m} <= ${this.recv_seq}`);if(this.recv_seq=m,this.ackn++,this.cansend+=A,r=r.slice(j+1),0===N){if(console.log(`GET chid=0 message ${r}`),"CLOSE"===r)this.close(!0),this.invokeReceiver(!0,"onWebsocketClosed");else if(0===r.indexOf("NEW_KEY=")){const H=r.slice(8);this.close(!0);let Y=typeof document<"u"?document.URL:null;if((0,c.isStr)(Y)&&typeof window<"u"&&window?.history){const E=Y.indexOf("?key=");E>0&&(Y=Y.slice(0,E)),window.history.replaceState(window.history.state,void 0,`${Y}?key=${H}`)}else typeof sessionStorage<"u"&&sessionStorage.setItem("RWebWindow_Key",H);location.reload(!0)}}else"$$binary$$"===r.slice(0,10)?(this.next_binary=N,this.next_binary_hash=r.slice(10)):"$$nullbinary$$"===r?this.provideData(N,new ArrayBuffer(0),0):this.provideData(N,r);this.ackn>7&&this.send("READY",0)},this._websocket.onclose=n=>{delete this._websocket,(this.state>0||"force_close"===n)&&(console.log("websocket closed"),this.state=0,this.invokeReceiver(!0,"onWebsocketClosed"))},this._websocket.onerror=n=>{console.log(`websocket error ${n} state ${this.state}`),this.state>0&&(this.invokeReceiver(!0,"onWebsocketError",n),this.state=0)},(0,c.isBatchMode)()||setTimeout(i,3e3))};i(!0)}askReload(){this.send("GENERATE_KEY",0)}addReloadKeyHandler(){"file"!==this.kind&&window.addEventListener("keydown",t=>{("R"===t.key||"r"===t.key)&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),console.log("Prevent Ctrl-R propogation - ask reload RWebWindow!"),this.askReload())})}}class q extends v{constructor(t,e){super(t,e,!0),this._websocket=null,this.tooltip_allowed=c.settings.Tooltip,this.v7canvas=!0,null===t&&null===e&&(c.settings.SmallPad.width=20,c.settings.SmallPad.height=10)}cleanup(){delete this._websocket,delete this._submreq,this._changed_layout&&this.setLayoutKind("simple"),delete this._changed_layout,super.cleanup()}getLayoutKind(){const t=this.selectDom("origin");return(t.empty()?"":t.property("layout"))||"simple"}setLayoutKind(t,e){const i=this.selectDom("origin");i.empty()||(t||(t="simple"),i.property("layout",t),i.property("layout_selector","simple"!==t&&e?e:null),this._changed_layout="simple"!==t)}changeLayout(t,e){var i=this;return(0,O.A)(function*(){if(i.getLayoutKind()===t)return!0;const a=i.selectDom("origin"),n=a.select(".side_panel2"),r=[];let x,d=a.select(".side_panel"),f=i.selectDom();for(;f.node().firstChild;)r.push(f.node().removeChild(f.node().firstChild));if(d.empty()||(0,V.tP)(d.node()),n.empty()||(0,V.tP)(n.node()),i.setLayoutKind("simple"),a.html(""),"simple"===t){f=a;for(let m=0;m<r.length;++m)f.node().appendChild(r[m]);i.setLayoutKind(t),x=!0}else{const m=new J.ho(a.node(),t);void 0===e&&(e=0===t.indexOf("vert")?0:1),f=(0,G.Lt)(m.getGridFrame(e)),f.classed("central_panel",!0).style("position","relative"),2===e?(d=(0,G.Lt)(m.getGridFrame(0)),d.classed("side_panel2",!0).style("position","relative"),d=(0,G.Lt)(m.getGridFrame(3)),d.classed("side_panel",!0).style("position","relative")):(d=(0,G.Lt)(m.getGridFrame(1-e)),d.classed("side_panel",!0).style("position","relative"));for(let y=0;y<r.length;++y)f.node().appendChild(r[y]);i.setLayoutKind(t,".central_panel"),a.property("mdi",null)}return(0,V.XR)(f.node(),x),!0})()}toggleProjection(t){var e=this;return(0,O.A)(function*(){if(delete e.proj_painter,t&&(e.proj_painter={X:!1,Y:!1}),(0,c.isFunc)(e.showUI5ProjectionArea))return e.showUI5ProjectionArea(t);let s,i="simple";switch(t){case"XY":i="projxy",s=2;break;case"X":case"bottom":i="vert2_31",s=0;break;case"Y":case"left":i="horiz2_13",s=1;break;case"top":i="vert2_13",s=1;break;case"right":i="horiz2_31",s=0}return e.changeLayout(i,s)})()}drawProjection(){return(0,O.A)(function*(){return!1})()}drawInSidePanel(t,e,i){var s=this;return(0,O.A)(function*(){const a="projxy"===s.getLayoutKind()&&"Y"===i?".side_panel2":".side_panel",n=s.selectDom("origin").select(a);return n.empty()?null:s.drawObject(n.node(),t,e)})()}testUI5(){return!!this.use_openui&&(console.warn("full ui5 should be used - not loaded yet? Please check!!"),!0)}showMessage(t){this.testUI5()||(0,B.Rh)(t,7e3)}saveCanvasAsFile(t){const e=t.indexOf(".");this.createImage(t.slice(e+1)).then(i=>this.sendWebsocket(`SAVE:${t}:${i}`))}sendSaveCommand(t){this.sendWebsocket("PRODUCE:"+t)}sendWebsocket(t){return!!this._websocket?.canSend()&&(this._websocket.send(t),!0)}closeWebsocket(t){this._websocket&&(this._websocket.close(t),this._websocket.cleanup(),delete this._websocket)}useWebsocket(t){this.closeWebsocket(),this._websocket=t,this._websocket.setReceiver(this),this._websocket.connect()}websocketTimeout(t,e){if(!this._websocket)return;this._websocket._tmouts||(this._websocket._tmouts={});const i=this._websocket._tmouts[t];if(void 0===e)return void 0!==i;"reset"===e?i&&(clearTimeout(i),delete this._websocket._tmouts[t]):!i&&Number.isInteger(e)&&(this._websocket._tmouts[t]=setTimeout(()=>{delete this._websocket._tmouts[t]},e))}onWebsocketOpened(){}onWebsocketClosed(){this.embed_canvas||(0,B.W4)()}onWebsocketMsg(t,e){if("CLOSE"===e)this.onWebsocketClosed(),this.closeWebsocket(!0);else if("SNAP:"===e.slice(0,5)){const i=(e=e.slice(5)).indexOf(":"),s=e.slice(0,i),a=(0,c.parse)(e.slice(i+1));this.syncDraw(!0).then(()=>{!this.snapid&&a?.fWinSize&&this.resizeBrowser(a.fWinSize[0],a.fWinSize[1])}).then(()=>this.redrawPadSnap(a)).then(()=>{this.addPadInteractive(),t.send(`SNAPDONE:${s}`),this.confirmDraw()})}else if("JSON"===e.slice(0,4)){const i=(0,c.parse)(e.slice(4));this.redrawObject(i)}else if("REPL_REQ:"===e.slice(0,9))this.processDrawableReply(e.slice(9));else if("CMD:"===e.slice(0,4)){const i=(e=e.slice(4)).indexOf(":"),s=e.slice(0,i),a=e.slice(i+1),n=`REPLY:${s}:`;if("SVG"===a||"PNG"===a||"JPEG"===a)this.createImage(a.toLowerCase()).then(r=>t.send(n+r));else if(0===a.indexOf("ADDPANEL:")){const r=a.slice(9);if((0,c.isFunc)(this.showUI5Panel)){const d=new L(t.kind);d.setReceiver({cpainter:this,onWebsocketOpened(){},onWebsocketMsg(x,m){const y=0===m.indexOf("SHOWPANEL:")?m.slice(10):"";this.cpainter.showUI5Panel(y,x).then(A=>t.send(n+(A?"true":"false")))},onWebsocketClosed(){t.send(n+"false")},onWebsocketError(){t.send(n+"false")}});let f=t.href;if(0===r.indexOf("../")){const x=f.lastIndexOf("/",f.length-2);f=f.slice(0,x)+r.slice(2)}else f+=r;d.connect(f)}else t.send(n+"false")}else console.log("Unrecognized command "+a),t.send(n)}else if("DXPROJ:"===e.slice(0,7)||"DYPROJ:"===e.slice(0,7)){const i=e[1],s=(0,c.parse)(e.slice(7));this.drawProjection(i,s)}else if("SHOW:"===e.slice(0,5)){const i=e.slice(5),s="1"===i[i.length-1];this.showSection(i.slice(0,i.length-2),s)}else console.log(`unrecognized msg len: ${e.length} msg: ${e.slice(0,30)}`)}submitDrawableRequest(t,e,i,s){if(!(this._websocket&&e&&e._typename&&i.snapid&&(0,c.isStr)(i.snapid)))return null;if(t&&s){i._requests||(i._requests={});const n=i._requests[t];if(n){const r=(new Date).getTime();if(!n._tm||r-n._tm<5e3)return n._nextreq=e,!1;delete i._requests[t]}i._requests[t]=e}e.id=i.snapid,s?(this._nextreqid||(this._nextreqid=1),e.reqid=this._nextreqid++):e.reqid=0;const a=JSON.stringify(e);return e.reqid&&(e._kind=t,e._painter=i,e._method=s,e._tm=(new Date).getTime(),this._submreq||(this._submreq={}),this._submreq[e.reqid]=e),this.sendWebsocket("REQ:"+a),e}submitMenuRequest(t,e,i){var s=this;return(0,O.A)(function*(){return new Promise(a=>{s.submitDrawableRequest("",{_typename:`${c.nsREX}RDrawableMenuRequest`,menukind:e||"",menureqid:i},t,a)})})()}submitExec(t,e,i){if(this._websocket){if(i&&(0,c.isStr)(i)){const s=i.length;if(s>2&&i.indexOf("#x")===s-2?i="x":s>2&&i.indexOf("#y")===s-2?i="y":s>2&&i.indexOf("#z")===s-2&&(i="z"),"x"!==i&&"y"!==i&&"z"!==i)return console.log(`not recoginzed subelem ${i} in SubmitExec`);e=i+"axis#"+e}this.submitDrawableRequest("",{_typename:`${c.nsREX}RDrawableExecRequest`,exec:e},t)}}processDrawableReply(t){const e=(0,c.parse)(t);if(!e||!e.reqid||!this._submreq)return!1;const i=this._submreq[e.reqid];if(!i)return!1;delete this._submreq[e.reqid],i._kind&&i._painter?._requests&&i._painter._requests[i._kind]===i&&delete i._painter._requests[i._kind],i._method&&i._method(e,i),i._nextreq&&!i._painter._requests[i._kind]&&this.submitDrawableRequest(i._kind,i._nextreq,i._painter,i._method)}showSection(t,e){var i=this;return(0,O.A)(function*(){switch(t){case"Menu":case"StatusBar":case"Editor":case"ToolBar":break;case"ToolTips":i.setTooltipAllowed(e)}return!0})()}processChanges(t,e,i){if(this._websocket&&this._websocket.canSend(2)&&(0,c.isStr)(t))switch(e||(e=this),t){case"sbits":console.log("Status bits in RCanvas are changed - that to do?");break;case"frame":case"zoom":console.log("Frame moved or zoom is changed - that to do?");break;case"pave_moved":console.log("TPave is moved inside RCanvas - that to do?");break;default:"exec:"===t.slice(0,5)&&e?.snapid?this.submitExec(e,t.slice(5),i):console.log("UNPROCESSED CHANGES",t)}}clickPadButton(t,e){return"ToggleGed"===t?this.activateGed(this,null,"toggle"):"ToggleStatus"===t?this.activateStatusBar("toggle"):super.clickPadButton(t,e)}hasEventStatus(){if(this.testUI5())return!1;if(this.brlayout)return this.brlayout.hasStatus();const t=(0,J.gZ)();return!!t&&t.hasStatusLine()}canStatusBar(){return this.testUI5()||this.brlayout||(0,J.gZ)()}activateStatusBar(t){this.testUI5()||(this.brlayout?this.brlayout.createStatusLine(23,t):(0,J.gZ)()?.createStatusLine(23,t),this.processChanges("sbits",this))}showCanvasStatus(...t){this.testUI5()||(this.brlayout||(0,J.gZ)()?.brlayout)?.showStatus(...t)}hasGed(){return!this.testUI5()&&(this.brlayout?.hasContent()??!1)}removeGed(){this.testUI5()||(this.registerForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout?.deleteContent(!0),this.processChanges("sbits",this))}getUi5PanelData(){return{jsroot:{settings:c.settings,create:c.create,parse:c.parse,toJSON:c.toJSON,loadScript:c.loadScript,EAxisBits:V.rb,getColorExec:B.pp}}}activateGed(t,e,i){var s=this;return(0,O.A)(function*(){if(s.testUI5()||!s.brlayout)return!1;if(s.brlayout.hasContent())return"toggle"===i||!1===i?s.removeGed():t?.getPadPainter()?.selectObjectPainter(t),!0;if(!1===i)return!1;const a=s.brlayout.createBrowserBtns();return B.IK.createSVG(a,B.IK.diamand,15,"toggle fix-pos mode","browser").style("margin","3px").on("click",()=>s.brlayout.toggleKind("fix")),B.IK.createSVG(a,B.IK.circle,15,"toggle float mode","browser").style("margin","3px").on("click",()=>s.brlayout.toggleKind("float")),B.IK.createSVG(a,B.IK.cross,15,"delete GED","browser").style("margin","3px").on("click",()=>s.removeGed()),s.brlayout.setBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>"),s.brlayout.setBrowserTitle("GED"),s.brlayout.toggleBrowserKind(e||"float"),new Promise(n=>{B.cA.then(r=>{(0,G.Lt)("#ged_placeholder").text(""),r.ui.require(["sap/ui/model/json/JSONModel","sap/ui/core/mvc/XMLView"],(d,f)=>{const x=new d({handle:null});f.create({viewName:"rootui5.canv.view.Ged",viewData:s.getUi5PanelData("Ged")}).then(m=>{m.setModel(x),m.placeAt("ged_placeholder"),s.ged_view=m,s.registerForPadEvents(m.getController().padEventsReceiver.bind(m.getController())),t?.getPadPainter()?.selectObjectPainter(t),s.processChanges("sbits",s),n(!0)})})})})})()}produceJSON(){return console.error("RCanvasPainter.produceJSON not yet implemented"),""}resizeBrowser(t,e){!t||!e||this.isBatchMode()||this.embed_canvas||this.batch_mode||this._websocket?.resizeWindow(t,e)}static draw(t,e){return(0,O.A)(function*(){const i=!e;i&&(e=(0,c.create)(`${c.nsREX}RCanvas`));const s=new q(t,e);return s.normal_canvas=!i,s.createCanvasSvg(0),(0,V.QD)({pp:s,active:!1}),s.drawPrimitives().then(()=>(s.addPadInteractive(),s.addPadButtons(),s.showPadButtons(),s))})()}}function st(g,t){const e=new q(g,null);return e.normal_canvas=!1,e.batch_mode=(0,c.isBatchMode)(),e.syncDraw(!0).then(()=>e.redrawPadSnap(t)).then(()=>(e.confirmDraw(),e.showPadButtons(),e))}function at(g,t){return nt.apply(this,arguments)}function nt(){return(nt=(0,O.A)(function*(g,t){return g?(g.getCanvSvg().empty()?q.draw(g.getDom(),null):Promise.resolve(!0)).then(()=>{if(!1!==t&&g.getFrameSvg().selectChild(".main_layer").empty())return u.draw(g.getDom(),null,(0,c.isStr)(t)?t:"")}).then(()=>(g.addToPadPrimitives(),g)):Promise.reject(Error("Painter not provided in ensureRCanvas"))})).apply(this,arguments)}function ht(g,t){const e=this.getFramePainter();if(!e)return console.log("no frame painter - no title");const i=e.getFrameRect(),s=i.x,a=i.y,n=i.width,r=this.getPadPainter().getPadHeight(),d=this.getObject(),f=n,x=this.v7EvalFont("text",{size:.07,color:"black",align:22});let m=this.v7EvalLength("margin",r,.02),y=this.v7EvalLength("height",r,.05);if("drag"===g){y=t.height,m=a-t.y-t.height;const b={};this.v7AttrChange(b,"margin",m/r),this.v7AttrChange(b,"height",y/r),this.v7SendAttrChanges(b,!1)}this.createG(),(0,K.bk)(this.draw_g,s,Math.round(a-m-y));const A={x:f/2,y:y/2,text:d.fText,latex:1};return this.startTextDrawing(x,"font"),this.drawText(A),this.finishTextDrawing().then(()=>(0,l.WJ)(this,{x:s,y:Math.round(a-m-y),width:f,height:y,minwidth:20,minheight:20,no_change_x:!0,redraw:b=>this.redraw("drag",b)}))}function ot(){const g=this.getObject(),t=this.getCanvSvg(),e="custom_font_"+g.fFamily+g.fWeight+g.fStyle;let i=t.selectChild(".canvas_defs");i.empty()&&(i=t.insert("svg:defs",":first-child").attr("class","canvas_defs"));let s=i.selectChild("."+e);if(s.empty()){s=i.append("style").attr("type","text/css").attr("class",e).text(`@font-face { font-family: "${g.fFamily}"; font-weight: ${g.fWeight?g.fWeight:"normal"}; font-style: ${g.fStyle?g.fStyle:"normal"}; src: ${g.fSrc}; }`);const a=g.fSrc.indexOf("base64,"),n=g.fSrc.lastIndexOf(" format(");if(a>0&&n>a){const r=g.fSrc.slice(a+7,n-2);g.fSrc.indexOf("data:application/font-ttf")>0&&s.property("$fonthandler",{name:g.fFamily,format:"ttf",base64:r})}}return g.fDefault&&(this.getPadPainter()._dfltRFont=g),!0}function lt(g,t,e){const i=new C.R(g,t,e);return i.disable_zooming=!0,at(i,!1).then(()=>i.redraw()).then(()=>i)}function dt(g,t,e){const i=new u(g,t);return"3d"===e&&(i.mode3d=!0),at(i,!1).then(()=>i.redraw())}(0,c.registerMethods)(`${c.nsREX}RPalette`,{extractRColor:g=>g.fColor||"black",getColor(g){return this.palette[g]},getContourIndex(g){const t=this.fContour;let s,e=0,i=t.length-1;if(g<t[0])return-1;if(g>=t[i])return i-1;if(this.fCustomContour){for(;e<i-1;)s=Math.round((e+i)/2),t[s]>g?i=s:e=s;return e}return Math.floor((g-t[0])/(t[i-1]-t[0])*(i-1))},getContourColor(g){const t=this.getContourIndex(g);return t<0?"":this.getColor(t)},getContour(){return this.fContour&&this.fContour.length>1?this.fContour:null},deleteContour(){delete this.fContour},calcColor(g,t,e){const i=e.fOrdinal-t.fOrdinal,s=e.fOrdinal-g,a=g-t.fOrdinal;if(!this.fInterpolate||i<=0)return s<a?e.fColor:t.fColor;const n=(0,G.Qh)(this.extractRColor(t.fColor)),r=(0,G.Qh)(this.extractRColor(e.fColor));return(0,G.Qh)(Math.round((n.r*s+r.r*a)/i),Math.round((n.g*s+r.g*a)/i),Math.round((n.b*s+r.b*a)/i)).toString()},createPaletteColors(g){const t=[];let e=0;for(;t.length<g;){const i=t.length/(g-1),s=this.fColors[e];if(Math.abs(s.fOrdinal-i)<1e-4||e===this.fColors.length-1){t.push(this.extractRColor(s.fColor));continue}const a=this.fColors[e+1];a.fOrdinal<=i?e++:t.push(this.calcColor(i,s,a))}return t},getColorOrdinal(g){if(!this.fColors)return"black";"number"!=typeof g||g<0?g=0:g>1&&(g=1);let t,e=this.fColors[0];for(let i=0;i<this.fColors.length-1;++i){if(t=e,Math.abs(t.fOrdinal-g)<1e-4)return this.extractRColor(t.fColor);if(e=this.fColors[i+1],e.fOrdinal>g)return this.calcColor(g,t,e)}return this.extractRColor(e.fColor)},setFullRange(g,t){this.full_min=g,this.full_max=t},createContour(g,t,e,i,s){if(this.fContour=[],delete this.fCustomContour,this.colzmin=e,this.colzmax=i,g){this.colzmax<=0&&(this.colzmax=1),this.colzmin<=0&&(this.colzmin=void 0===s||s<=0?1e-4*this.colzmax:s<3||s>100?.3*s:1),this.colzmin>=this.colzmax&&(this.colzmin=1e-4*this.colzmax);const a=Math.log(this.colzmin)/Math.log(10),r=(Math.log(this.colzmax)/Math.log(10)-a)/t;this.fContour.push(this.colzmin);for(let d=1;d<t;d++)this.fContour.push(Math.exp((a+r*d)*Math.log(10)));this.fContour.push(this.colzmax),this.fCustomContour=!0}else{this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin));const a=(this.colzmax-this.colzmin)/t;for(let n=0;n<=t;n++)this.fContour.push(this.colzmin+a*n)}(!this.palette||this.palette.length!==t)&&(this.palette=this.createPaletteColors(t))}})}}]);
//# sourceMappingURL=919.fd01d519277e3b1a.js.map