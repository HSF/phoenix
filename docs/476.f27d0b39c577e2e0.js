"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[476],{6476:(bt,ot,A)=>{A.r(ot),A.d(ot,{RH2Painter:()=>J});var H=A(4788),F=A(9542),st=A(2253),at=A(6367),it=A(3675),xt=A(8172),ct=A(9056);class W extends xt.n{constructor(t,i){super(t,i),this.wheel_zoomy=!0}cleanup(){delete this.tt_handle,super.cleanup()}getDimension(){return 2}toggleProjection(t,i){if("Projections"==t&&(t=""),(0,F.isStr)(t)&&t.length>1&&(i=parseInt(t.slice(1)),t=t[0]),i||(i=1),t&&this.is_projection==t){if(this.projection_width!==i)return void(this.projection_width=i);t=""}delete this.proj_hist;let e=this.is_projection===t?"":t;this.is_projection="",this.projection_width=i,this.provideSpecialDrawArea(e).then(()=>(this.is_projection=e,this.redrawProjection()))}redrawProjection(){}executeMenuCommand(t,i){return!!super.executeMenuCommand(t,i)||("SetShowProjectionX"==t.fName||"SetShowProjectionY"==t.fName)&&(this.toggleProjection(t.fName[17],i&&parseInt(i)?parseInt(i):1),!0)}fillHistContextMenu(t){t.add("sub:Projections",()=>this.toggleProjection());let i=this.is_projection||"";i&&(i+=this.projection_width);let e=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10"];for(let o=0;o<e.length;++o)t.addchk(i==e[o],e[o],e[o],l=>this.toggleProjection(l));t.add("endsub:"),t.add("Auto zoom-in",()=>this.autoZoom());let r=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",r,o=>{if("inspect"===o)return this.showInspector();this.decodeOptions(o),this.interactiveRedraw("pad","drawopt")}),this.options.Color&&this.fillPaletteMenu(t)}clickButton(t){if(super.clickButton(t))return!0;switch(t){case"ToggleColor":this.toggleColor();break;case"Toggle3D":this.toggleMode3D();break;default:return!1}return!0}fillToolbar(){super.fillToolbar(!0);let t=this.getPadPainter();t&&(t.addPadButton("th2color","Toggle color","ToggleColor"),t.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),t.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),t.showPadButtons())}toggleColor(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color,this.redraw()}autoZoom(){let o,l,t=this.getSelectIndex("x","left",-1),i=this.getSelectIndex("x","right",1),e=this.getSelectIndex("y","left",-1),r=this.getSelectIndex("y","right",1),u=this.getHisto(),f=this.getAxis("x"),w=this.getAxis("y");if(t==i||e==r)return;let x=u.getBinContent(t+1,e+1);for(o=t;o<i;++o)for(l=e;l<r;++l)x=Math.min(x,u.getBinContent(o+1,l+1));if(x>0)return;let h=i,n=t,a=r,c=e;for(o=t;o<i;++o)for(l=e;l<r;++l)u.getBinContent(o+1,l+1)>x&&(o<h&&(h=o),o>=n&&(n=o+1),l<a&&(a=l),l>=c&&(c=l+1));let g,m,d,y,s=!1;return h===n-1&&h>t+1&&n<i-1&&(h--,n++),a===c-1&&a>e+1&&c<r-1&&(a--,c++),(h>t||n<i)&&h<n-1&&(g=f.GetBinCoord(h),m=f.GetBinCoord(n),s=!0),(a>e||c<r)&&a<c-1&&(d=w.GetBinCoord(a),y=w.GetBinCoord(c),s=!0),s?this.getFramePainter().zoom(g,m,d,y):void 0}scanContent(t){if(t&&this.nbinsx&&this.nbinsy)return;let i,e,r=this.getHisto();if(this.extractAxesProperties(2),this.isDisplayItem())this.gminbin=r.fContMin,this.gminposbin=r.fContMinPos>0?r.fContMinPos:null,this.gmaxbin=r.fContMax;else for(this.gminbin=this.gmaxbin=r.getBinContent(1,1),this.gminposbin=null,i=0;i<this.nbinsx;++i)for(e=0;e<this.nbinsy;++e){let o=r.getBinContent(i+1,e+1);o<this.gminbin?this.gminbin=o:o>this.gmaxbin&&(this.gmaxbin=o),o>0&&(null===this.gminposbin||this.gminposbin>o)&&(this.gminposbin=o)}this.zmin=this.gminbin,this.zmax=this.gmaxbin,null===this.gminposbin&&(this.gminposbin=1e-4*this.gmaxbin),this.draw_content=!(this.options.Axis>0)&&this.gmaxbin>0}countStat(t){let f,w,x,h,n,y,s,i=this.getHisto(),e=0,r=0,o=0,l=0,u=0,a={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},c=this.getSelectIndex("x","left"),g=this.getSelectIndex("x","right"),m=this.getSelectIndex("y","left"),d=this.getSelectIndex("y","right"),M=this.getAxis("x"),b=this.getAxis("y");for(y=1;y<=this.nbinsx;++y)for(f=y<=c+1?0:y>g+1?2:1,x=M.GetBinCoord(y-.5),s=1;s<=this.nbinsy;++s)w=s<=m+1?0:s>d+1?2:1,h=b.GetBinCoord(s-.5),n=i.getBinContent(y,s),a.entries+=n,a.matrix[3*w+f]+=n,1==f&&1==w&&(t&&!t(x,h)||((null===a.wmax||n>a.wmax)&&(a.wmax=n,a.xmax=x,a.ymax=h),e+=n,r+=x*n,o+=h*n,l+=x**2*n,u+=h**2*n));return Math.abs(e)>1e-300&&(a.meanx=r/e,a.meany=o/e,a.rmsx=Math.sqrt(Math.abs(l/e-a.meanx**2)),a.rmsy=Math.sqrt(Math.abs(u/e-a.meany**2))),null===a.wmax&&(a.wmax=0),a.integral=e,a}fillStatistic(t,i){let e=this.countStat(),r=Math.floor(i%10),o=Math.floor(i/10)%10,l=Math.floor(i/100)%10,u=Math.floor(i/1e3)%10,f=Math.floor(i/1e4)%10,w=Math.floor(i/1e5)%10,x=Math.floor(i/1e6)%10,h=Math.floor(i/1e7)%10,n=Math.floor(i/1e8)%10;if(t.clearStat(),r>0&&t.addText(e.name),o>0&&t.addText("Entries = "+t.format(e.entries,"entries")),l>0&&(t.addText("Mean x = "+t.format(e.meanx)),t.addText("Mean y = "+t.format(e.meany))),u>0&&(t.addText("Std Dev x = "+t.format(e.rmsx)),t.addText("Std Dev y = "+t.format(e.rmsy))),x>0&&t.addText("Integral = "+t.format(e.matrix[4],"entries")),h>0&&(t.addText("Skewness x = <undef>"),t.addText("Skewness y = <undef>")),n>0&&t.addText("Kurt = <undef>"),f>0||w>0){let a=e.matrix;t.addText(a[6].toFixed(0)+" | "+a[7].toFixed(0)+" | "+a[7].toFixed(0)),t.addText(a[3].toFixed(0)+" | "+a[4].toFixed(0)+" | "+a[5].toFixed(0)),t.addText(a[0].toFixed(0)+" | "+a[1].toFixed(0)+" | "+a[2].toFixed(0))}return!0}drawBinsColor(){const t=this.getHisto(),i=this.prepareDraw(),e=i.stepi,r=i.stepj,o=[];let u,f,w,x,h,n,a,c,g,m;const d=()=>{m.path+=`h${a}v${m.y2-m.y}h${-a}z`,m.dy=0,m=null};for(x=i.i1;x<i.i2;x+=e){for(a=i.grx[x+e]-i.grx[x]||1,h=i.j1;h<i.j2;h+=r)if(n=t.getBinContent(x+1,h+1),u=i.palette.getContourIndex(n),0===n&&(this.options.Zero?null===u&&this._show_empty_bins&&(u=0):u=null),null!==u){if(f=`M${i.grx[x]},${i.gry[h]}`,c=i.gry[h+r]-i.gry[h]||-1,g=o[u],void 0===g)g=o[u]={path:f};else{if(g===m){g.y2=i.gry[h]+c;continue}w=`m${i.grx[x]-g.x},${i.gry[h]-g.y}`,g.path+=w.length<f.length?w:f}m&&d(),g.x=i.grx[x],g.y=i.gry[h],g.y2=i.gry[h]+c,m=g}else m&&d();m&&d()}return o.forEach((y,s)=>{y&&this.draw_g.append("svg:path").style("fill",i.palette.getColor(s)).attr("d",y.path)}),this.updatePaletteDraw(),i}buildContour(t,i,e,r){let n,a,g,b,_,B,C,j,p,P,k,Z,T,lt,I,o=this.getHisto(),l=2004,f=new Float32Array(2*l),w=new Float32Array(2*l),x=new Int32Array(2*l),h=0,c=[],m=0,d=[0,0,0,0],y=[0,0,0,0],s=[0,0,0,0],M=[0,0,0,0],Q=t.stepi,E=t.stepj;function pt(G){for(let v=0;v<i.length;++v)if(G<i[v])return v-1;return i.length-1}function ht(G,v,$,N,S,D,z,R){let nt,gt,dt,ut,O=$===z,U=O?R-N:z-$,tt=v+1,yt=S-G,Y=h-1,wt=999+h,ft=0;for(;tt<=D&&Y<=wt;)ut=i[tt],dt=ut-G,gt=dt/yt,nt=U*gt,O?(f[Y]=$,w[Y]=N+nt):(f[Y]=$+nt,w[Y]=N),x[Y]=tt,ft++,Y+=2,tt++;return ft}let V=t.original?t.origx:t.grx,q=t.original?t.origy:t.gry;for(_=t.j1;_<t.j2-E;_+=E)for(y[1]=y[0]=(q[_]+q[_+E])/2,y[3]=y[2]=(q[_+E]+q[_+2*E])/2,b=t.i1;b<t.i2-Q;b+=Q){for(s[0]=o.getBinContent(b+1,_+1),s[1]=o.getBinContent(b+1+Q,_+1),s[2]=o.getBinContent(b+1+Q,_+1+E),s[3]=o.getBinContent(b+1,_+1+E),B=0;B<4;B++)M[B]=pt(s[B]);if(M[0]!==M[1]||M[1]!==M[2]||M[2]!==M[3]||M[3]!==M[0]){for(d[3]=d[0]=(V[b]+V[b+1])/2,d[2]=d[1]=(V[b+1]+V[b+2])/2,C=s[0]<=s[1]?0:1,j=s[2]<=s[3]?2:3,s[C]>s[j]&&(C=j),C++,h=1,p=1;p<=4;p++)j=C%4+1,P=ht(s[C-1],M[C-1],d[C-1],y[C-1],s[j-1],M[j-1],d[j-1],y[j-1]),h+=2*P,C=j;for(C=s[0]<=s[1]?0:1,j=s[2]<=s[3]?2:3,s[C]>s[j]&&(C=j),C++,h=2,p=1;p<=4;p++)j=1==C?4:C-1,P=ht(s[C-1],M[C-1],d[C-1],y[C-1],s[j-1],M[j-1],d[j-1],y[j-1]),h+=2*P,C=j;for(k=0,p=1;p<=h-5;p+=2)for(;x[p-1]!=x[p];){for(Z=f[p],T=w[p],lt=x[p],I=p;I<=h-5;I+=2)f[I]=f[I+2],w[I]=w[I+2],x[I]=x[I+2];if(f[h-3]=Z,w[h-3]=T,x[h-3]=lt,k>2e3)break;k++}if(k>2e3)continue;for(p=1;p<=h-2;p+=2)n=x[p-1],n>=0&&n<i.length&&(a=c[n],a||(a=c[n]=(0,F.createTPolyLine)(4*l,!0)),g=a.fLastPoint,g<a.fN-2&&(a.fX[g+1]=Math.round(f[p-1]),a.fY[g+1]=Math.round(w[p-1]),a.fX[g+2]=Math.round(f[p]),a.fY[g+2]=Math.round(w[p]),a.fLastPoint=g+2,m=Math.max(m,a.fLastPoint+1)))}}let et=new Int32Array(i.length),rt=0;for(n=0;n<i.length;n++)if(i[n]>=0){rt=n;break}for(B=0,n=rt-1;n>=0;n--)et[B]=n,B++;for(n=rt;n<i.length;n++)et[B]=n,B++;let X=new Float32Array(2*m),L=new Float32Array(2*m);for(B=0;B<i.length;++B){if(n=et[B],a=c[n],!a)continue;let D,z,U,G=n,v=a.fX,$=a.fY,N=a.fLastPoint+1,S=0,R=0,O=0;for(;;){for(D=m,z=D+1,X[D]=v[S],L[D]=$[S],X[z]=v[S+1],L[z]=$[S+1],v[S]=v[S+1]=R,$[S]=$[S+1]=O;;){for(U=0,b=2;b<N;b+=2)z<2*m-1&&v[b]===X[z]&&$[b]===L[z]&&(z++,X[z]=v[b+1],L[z]=$[b+1],v[b]=v[b+1]=R,$[b]=$[b+1]=O,U++),D>0&&v[b+1]===X[D]&&$[b+1]===L[D]&&(D--,X[D]=v[b],L[D]=$[b],v[b]=v[b+1]=R,$[b]=$[b+1]=O,U++);if(0==U)break}for(D+1<z&&D>=0&&r(G,X,L,D,z,n),S=0,b=2;b<N;b+=2)if(v[b]!==R&&$[b]!==O){S=b;break}if(0===S)break}}}drawBinsContour(t,i,e){let r=this.prepareDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),o=this.getFramePainter(),l=o.getHistPalette(),u=l.getContour(),f=o.getProjectionFunc(),w=(x,h,n,a,c)=>{let m,d,y,s,g="";for(let M=n;M<=a;++M){if(f?(d=f(x[M],h[M]),d.x=Math.round(t.grx(d.x)),d.y=Math.round(t.gry(d.y))):d={x:Math.round(x[M]),y:Math.round(h[M])},g)if(M==a&&y&&d.x==y.x&&d.y==y.y){if(!s)return"";g+="z",c=!1}else d.x!=m.x&&d.y!=m.y?(g+="l"+(d.x-m.x)+","+(d.y-m.y),s=!0):d.x!=m.x?(g+="h"+(d.x-m.x),s=!0):d.y!=m.y&&(g+="v"+(d.y-m.y),s=!0);else g="M"+d.x+","+d.y,y=d;m=d}return c&&(g+="z"),g};if(14===this.options.Contour){let x=`M0,0h${i}v${e}h${-i}z`;if(this.options.Proj){let h=r.stepj,n=parseInt((r.j2-r.j1)/h),a=new Float32Array(2*n),c=new Float32Array(2*n);for(let g=0;g<n;++g)a[g]=r.origx[r.i1],c[g]=(r.origy[r.j1]*(g*h+.5)+r.origy[r.j2]*(n-.5-g*h))/n,a[g+n]=r.origx[r.i2],c[g+n]=(r.origy[r.j2]*(g*h+.5)+r.origy[r.j1]*(n-.5-g*h))/n;x=w(a,c,0,2*n-1,!0)}this.draw_g.append("svg:path").attr("d",x).style("fill",l.getColor(0))}return this.buildContour(r,u,l,(x,h,n,a,c)=>{let d,g=l.getColor(x),m=g;switch(this.options.Contour){case 1:case 14:break;case 11:m="none",d=new at.rE({color:g});break;case 12:m="none",d=new at.rE({color:1,style:x%5+1,width:1});break;case 13:m="none",d=this.lineatt}let y=w(h,n,a,c,"none"!=m);if(!y)return;let s=this.draw_g.append("svg:path").attr("class","th2_contour").attr("d",y).style("fill",m);d&&s.call(d.func)}),r.hide_only_zeros=!0,r}createPolyBin(){return""}drawBinsText(t){let e,r,o,l,u,f,w,x,h,n,i=this.getHisto();null===t&&(t=this.prepareDraw({rounding:!1}));let a=this.v7EvalFont("text",{size:20,color:"black",align:22}),c=0,g=this.draw_g.append("svg:g").attr("class","th2_text"),m=t.stepi,d=t.stepj;for(this.options.BarOffset&&(c=this.options.BarOffset),this.startTextDrawing(a,"font",g),e=t.i1;e<t.i2;e+=m)for(r=t.j1;r<t.j2;r+=d)o=i.getBinContent(e+1,r+1),(0!==o||this._show_empty_bins)&&(l=t.grx[e+m]-t.grx[e],u=t.gry[r]-t.gry[r+d],f=o===Math.round(o)?o.toString():(0,it.Ee)(o,F.gStyle.fPaintTextFormat),a.angle?(w=Math.round(t.grx[e]+.5*l),x=Math.round(t.gry[r+d]+u*(.5+c)),h=n=0):(w=Math.round(t.grx[e]+.1*l),x=Math.round(t.gry[r+d]+u*(.1+c)),h=Math.round(.8*l),n=Math.round(.8*u)),this.drawText({align:22,x:w,y:x,width:h,height:n,text:f,latex:0,draw_g:g}));return this.finishTextDrawing(g,!0).then(()=>(t.hide_only_zeros=!0,t))}drawBinsArrow(){let e,r,l,u,f,w,x,h,n,a,c,g,m,d,y,t=this.getHisto(),i="",o=1e-30,s=this.prepareDraw({rounding:!1}),M=(s.grx[s.i2]-s.grx[s.i1])/(s.i2-s.i1+1-.03)/2,b=(s.gry[s.j2]-s.gry[s.j1])/(s.j2-s.j1+1-.03)/2,_=s.stepi,B=s.stepj;const C=(j,p)=>j?p?`l${j},${p}`:`h${j}`:p?`v${p}`:"";for(let j=0;j<2;++j)for(e=s.i1;e<s.i2;e+=_)for(r=s.j1;r<s.j2;r+=B)l=e===s.i1?t.getBinContent(e+1+_,r+1)-t.getBinContent(e+1,r+1):e>=s.i2-_?t.getBinContent(e+1,r+1)-t.getBinContent(e+1-_,r+1):.5*(t.getBinContent(e+1+_,r+1)-t.getBinContent(e+1-_,r+1)),u=r===s.j1?t.getBinContent(e+1,r+1+B)-t.getBinContent(e+1,r+1):r>=s.j2-B?t.getBinContent(e+1,r+1)-t.getBinContent(e+1,r+1-B):.5*(t.getBinContent(e+1,r+1+B)-t.getBinContent(e+1,r+1-B)),0===j?o=Math.max(o,Math.abs(l),Math.abs(u)):(f=(s.grx[e]+s.grx[e+_])/2,w=(s.gry[r]+s.gry[r+B])/2,x=M*l/o,h=b*u/o,n=f-x,a=f+x,c=w-h,g=w+h,l=Math.round(a-n),u=Math.round(g-c),(0!==l||0!==u)&&(i+="M"+Math.round(n)+","+Math.round(c)+C(l,u),(Math.abs(l)>5||Math.abs(u)>5)&&(m=Math.sqrt(2/(l**2+u**2)),d=Math.round(m*(l+u)),y=Math.round(m*(l-u)),(d||y)&&(i+=`m${-d},${y}`+C(d,-y)+C(-y,-d)))));return this.draw_g.append("svg:path").attr("d",i).style("fill","none").call(this.lineatt.func),s}drawBinsBox(){let t=this.getHisto(),i=this.prepareDraw({rounding:!1}),e=this.getFramePainter();e.maxbin===e.minbin&&(e.maxbin=this.gmaxbin,e.minbin=this.gminbin,e.minposbin=this.gminposbin),e.maxbin===e.minbin&&(e.minbin=Math.min(0,e.maxbin-1));let l,u,f,w,c,g,m,d,y,s,M,b,r=Math.max(Math.abs(e.maxbin),Math.abs(e.minbin)),o=Math.max(0,e.minbin),x="",h="",n="",a="",_=!1,B=0,C=i.stepi,j=i.stepj;if(e.logz&&r>0){_=!0;let p=Math.log(r);B=o>0?Math.log(o):e.minposbin>=1&&e.minposbin<100?Math.log(.7):e.minposbin>0?Math.log(.7*e.minposbin):p-10,B>=p&&(B=p-10),b=1/(p-B)}else b=1/(r-o);for(l=i.i1;l<i.i2;l+=C)for(u=i.j1;u<i.j2;u+=j)if(f=t.getBinContent(l+1,u+1),w=Math.abs(f),!(0===w||w<o)&&(c=_?w>0?Math.log(w)-B:0:w-o,c=.5*(c<0?1:1-Math.sqrt(c*b)),c<0&&(c=0),s=i.grx[l+C]-i.grx[l],M=i.gry[u]-i.gry[u+j],g=c*s,m=c*M,d=Math.round(i.grx[l]+g),y=Math.round(i.gry[u+j]+m),s=Math.max(Math.round(s-2*g),1),M=Math.max(Math.round(M-2*m),1),x+=`M${d},${y}v${M}h${s}v${-M}z`,f<0&&10===this.options.BoxStyle&&(h+=`M${d},${y}l${s},${M}M${d+s},${y}l${-s},${M}`),11===this.options.BoxStyle&&s>5&&M>5)){let p=Math.round(.1*s),P=Math.round(.1*M),k=`M${d},${y}h${s}l${-p},${P}h${2*p-s}v${M-2*P}l${-p},${P}z`,Z=`M${d+s},${y+M}v${-M}l${-p},${P}v${M-2*P}h${2*p-s}l${-p},${P}z`;f<0?(a+=k,n+=Z):(n+=k,a+=Z)}if(x){let p=this.draw_g.append("svg:path").attr("d",x).call(this.fillatt.func);11!==this.options.BoxStyle&&this.fillatt.empty()&&p.call(this.lineatt.func)}if(n&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",n).call(this.fillatt.func).style("fill",(0,st.B8)(this.fillatt.color).brighter(.5).formatHex()),a&&this.draw_g.append("svg:path").attr("d",a).call(this.fillatt.func).style("fill",this.fillatt.hasColor()?(0,st.B8)(this.fillatt.color).darker(.5).formatHex():"red"),h){let p=this.draw_g.append("svg:path").attr("d",h).style("fill","none");this.lineatt.empty()||p.call(this.lineatt.func)}return i}drawBinsScatter(){let f,w,x,h,n,a,c,g,t=this.getHisto(),i=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),e=[],r=[],o=[],l=[],u=[],m=1,d=this.options.ScatCoef*(this.gmaxbin>2e3?2e3/this.gmaxbin:1),y=i.stepi,s=i.stepj,M=new it.q9(i.sumz);if(d*i.sumz<1e5){this.createv7AttMarker(),this.markeratt.resetPos();let j,p,C="";for(h=i.i1;h<i.i2;h+=y)for(c=i.grx[h+y]-i.grx[h],n=i.j1;n<i.j2;n+=s)if(g=i.gry[n]-i.gry[n+s],a=t.getBinContent(h+1,n+1),p=Math.round(d*a),!(p<=0))for(j=0;j<p;++j)C+=this.markeratt.create(Math.round(i.grx[h]+c*M.random()),Math.round(i.gry[n+1]+g*M.random()));return this.draw_g.append("svg:path").attr("d",C).call(this.markeratt.func),i}for(this.maxbin>.7&&(m=.7/this.maxbin),h=i.i1;h<i.i2;h+=y)for(n=i.j1;n<i.j2;n+=s)a=t.getBinContent(h+1,n+1),!(a<=0||a<this.minbin)&&(c=i.grx[h+y]-i.grx[h],g=i.gry[n]-i.gry[n+s],!(c*g<=0)&&(f=i.palette.getContourIndex(a/c/g),!(f<0)&&(w=`M${i.grx[h]},${i.gry[n+s]}`,void 0===e[f]?(e[f]=w,l[f]=c,u[f]=g):(x=`m${i.grx[h]-r[f]},${i.gry[n+s]-o[f]}`,e[f]+=x.length<w.length?x:w,l[f]=Math.max(l[f],c),u[f]=Math.max(u[f],g)),r[f]=i.grx[h],o[f]=i.gry[n+s],e[f]+=`v${g}h${c}v${-g}z`)));let b=this.getFrameSvg().select(".main_layer"),_=b.select("def");_.empty()&&e.length>0&&(_=b.insert("svg:defs",":first-child")),this.createv7AttMarker();let B=i.palette.getContour();for(f=0;f<e.length;++f)if(void 0!==e[f]&&f<B.length){let C="scatter_"+f,j=_.select("."+C);j.empty()?j=_.append("svg:pattern").attr("class",C).attr("id","jsroot_scatter_pattern_"+F.internals.id_counter++).attr("patternUnits","userSpaceOnUse"):j.selectAll("*").remove();let p=Math.round(m*B[f]*l[f]*u[f]);p<1&&(p=1);let P=new Float32Array(p),k=new Float32Array(p);if(1===p)P[0]=k[0]=.5;else for(let T=0;T<p;++T)P[T]=M.random(),k[T]=M.random();this.markeratt.resetPos();let Z="";for(let T=0;T<p;++T)Z+=this.markeratt.create(P[T]*l[f],k[T]*u[f]);j.attr("width",l[f]).attr("height",u[f]).append("svg:path").attr("d",Z).call(this.markeratt.func),this.draw_g.append("svg:path").attr("scatter-index",f).style("fill",`url(#${j.attr("id")})`).attr("d",e[f])}return i}draw2DBins(){var t=this;return(0,H.Z)(function*(){if(!t.draw_content)return t.removeG(),!1;t.createHistDrawAttributes(),t.createG(!0);let i=t.getFramePainter(),e=i.getFrameRect(),r=i.getGrFuncs(t.options.second_x,t.options.second_y),o=null,l=null;return t.options.Scat?o=t.drawBinsScatter():t.options.Color?o=t.drawBinsColor():t.options.Box?o=t.drawBinsBox():t.options.Arrow?o=t.drawBinsArrow():t.options.Contour>0&&(o=t.drawBinsContour(r,e.width,e.height)),t.options.Text&&(l=t.drawBinsText(o)),!o&&!l&&(o=t.drawBinsColor()),l||(l=Promise.resolve(o)),l.then(u=>(t.tt_handle=u,t))})()}getBinTooltips(t,i){let e=[],r=this.getHisto(),o=r.getBinContent(t+1,i+1),l=1,u=1;this.isDisplayItem()&&(l=r.stepx||1,u=r.stepy||1),e.push(this.getObjectHint()||"histo<2>"),e.push("x = "+this.getAxisBinTip("x",t,l),"y = "+this.getAxisBinTip("y",i,u)),e.push(`bin = ${t+1}, ${i+1}`),r.$baseh&&(o-=r.$baseh.getBinContent(t+1,i+1));let f="entries = "+(l>1||u>1?"~":"");return o===Math.round(o)?e.push(f+o):e.push(f+(0,it.Ee)(o,F.gStyle.fStatFormat)),e}getPolyBinTooltips(){return[]}processTooltipEvent(t){if(!t||!this.draw_content||!this.draw_g||!this.tt_handle||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let i=this.getHisto(),e=this.tt_handle,r=this.draw_g.select(".tooltip_bin");if(e.poly)return null;let o,l,u=0,f=null;for(o=e.i1;o<e.i2&&!(t.x>=e.grx[o]&&t.x<=e.grx[o+1]);++o);for(l=e.j1;l<e.j2&&!(t.y>=e.gry[l+1]&&t.y<=e.gry[l]);++l);if(o<e.i2&&l<e.j2&&(u=i.getBinContent(o+1,l+1),this.is_projection?f=0:e.hide_only_zeros?f=0!==u||this._show_empty_bins?0:null:(f=e.palette.getContourIndex(u),null===f&&0===u&&this._show_empty_bins&&(f=0))),null===f)return r.remove(),null;let w={name:"histo",title:i.fTitle||"title",x:t.x,y:t.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(o,l),exact:!0,menu:!0};if(this.options.Color&&(w.color2=e.palette.getColor(f)),t.disabled&&!this.is_projection)r.remove(),w.changed=!0;else{r.empty()&&(r=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));let x=o,h=o+1,n=l,a=l+1,c=e.grx[x],g=e.grx[h],m=e.gry[a],d=e.gry[n],y=1e4*o+l;if("X"==this.is_projection){if(c=0,g=this.getFramePainter().getFrameWidth(),this.projection_width>1){let s=(this.projection_width-1)/2;a+s>=e.j2?(a=Math.min(Math.round(a+s),e.j2),n=Math.max(a-this.projection_width,e.j1)):(n=Math.max(Math.round(n-s),e.j1),a=Math.min(n+this.projection_width,e.j2))}m=e.gry[a],d=e.gry[n],y=777*n+333*a}else if("Y"==this.is_projection){if(m=0,d=this.getFramePainter().getFrameHeight(),this.projection_width>1){let s=(this.projection_width-1)/2;h+s>=e.i2?(h=Math.min(Math.round(h+s),e.i2),x=Math.max(h-this.projection_width,e.i1)):(x=Math.max(Math.round(x-s),e.i1),h=Math.min(x+this.projection_width,e.i2))}c=e.grx[x],g=e.grx[h],y=777*x+333*h}w.changed=r.property("current_bin")!==y,w.changed&&r.attr("x",c).attr("width",g-c).attr("y",m).attr("height",d-m).style("opacity","0.7").property("current_bin",y),this.is_projection&&w.changed&&this.redrawProjection(x,h,n,a)}return w.changed&&(w.user_info={obj:i,name:"histo",bin:i.getBin(o+1,l+1),cont:u,binx:o+1,biny:l+1,grx:t.x,gry:t.y}),w}canZoomInside(t,i,e){if("z"==t)return!0;let r=this.getAxis(t);return r.FindBin(e,.5)-r.FindBin(i,0)>1}draw2D(t){var i=this;return(0,H.Z)(function*(){return i.clear3DScene(),i.drawFrameAxes().then(e=>!!e&&i.drawingBins(t)).then(e=>{if(e)return i.draw2DBins().then(()=>i.addInteractivity())}).then(()=>i)})()}draw3D(t){var i=this;return(0,H.Z)(function*(){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),i.draw2D(t)})()}callDrawFunc(t){var i=this;return(0,H.Z)(function*(){let e=i.getFramePainter();return e&&e.mode3d!==i.options.Mode3D&&!i.isMainPainter()&&(i.options.Mode3D=e.mode3d),i.options.Mode3D?i.draw3D(t):i.draw2D(t)})()}redraw(t){var i=this;return(0,H.Z)(function*(){return i.callDrawFunc(t)})()}static _draw(t){return(0,H.Z)(function*(){return(0,ct.ensureRCanvas)(t).then(()=>{t.setAsMainPainter(),t.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:F.kNoZoom,maximum:F.kNoZoom};let i=t.v7EvalAttr("kind",""),e=t.v7EvalAttr("sub",0),r=t.options;switch(r.Text=t.v7EvalAttr("drawtext",!1),i){case"lego":r.Lego=e>0?10+e:12,r.Mode3D=!0;break;case"surf":r.Surf=e>0?10+e:1,r.Mode3D=!0;break;case"box":r.Box=!0,r.BoxStyle=10+e;break;case"err":r.Error=!0,r.Mode3D=!0;break;case"cont":r.Contour=e>0?10+e:1;break;case"arr":r.Arrow=!0;break;case"scat":r.Scat=!0;break;case"col":r.Color=!0;break;default:r.Text||(r.Color=!0)}return t._show_empty_bins=!1,t.scanContent(),t.callDrawFunc()})})()}static draw(t,i,e){return(0,H.Z)(function*(){return W._draw(new W(t,i),e)})()}}var mt=A(9850),K=A(7238);class J extends W{draw3DBins(){if(this.draw_content){if(this.options.Surf)return(0,K.c5)(this,!0);if(this.options.Error)return(0,K.me)(this,!0);if(this.options.Contour)return(0,K.ME)(this,!0,!0);(0,K.UR)(this,!0),this.updatePaletteDraw()}}draw3D(t){this.mode3d=!0;let i=this.getFramePainter(),e=this.isMainPainter(),r=Promise.resolve(this);if("resize"==t)return e&&i.resize3D()&&i.render3D(),r;let o=1+2*F.gStyle.fHistTopMargin;return this.zmin=i.logz?.3*this.gminposbin:this.gminbin,this.zmax=this.gmaxbin,this.options.minimum!==F.kNoZoom&&(this.zmin=this.options.minimum),this.options.maximum!==F.kNoZoom&&(this.zmax=this.options.maximum,o=1),i.logz&&this.zmin<=0&&(this.zmin=1e-5*this.zmax),this.deleteAttr(),e&&((0,K.g_)(i),r=i.create3DScene(this.options.Render3D).then(()=>{i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,null,this.zmin,this.zmax),i.set3DOptions(this.options),i.drawXYZ(i.toplevel,mt.C,{zmult:o,zoom:F.settings.Zooming,ndim:2,draw:!0,v7:!0})})),i.mode3d?r.then(()=>this.drawingBins(t)).then(()=>{let l=this.getFramePainter();return this.draw3DBins(),l.render3D(),l.addKeysHandler(),this}):r}static draw(t,i,e){return(0,H.Z)(function*(){return J._draw(new J(t,i),e)})()}}}}]);
//# sourceMappingURL=476.f27d0b39c577e2e0.js.map