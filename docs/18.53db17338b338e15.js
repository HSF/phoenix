"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[18],{2018:(ct,lt,T)=>{T.r(lt),T.d(lt,{RH1Painter:()=>it});var z=T(5368),F=T(1773),ot=T(2912),Y=T(5611),xt=T(8597),gt=T(6717);class et extends xt.n{constructor(t,e){super(t,e),this.wheel_zoomy=!1}scanContent(t){let e=this.getHisto();if(!e)return;!this.nbinsx&&t&&(t=!1),t||this.extractAxesProperties(1);let r=0,u=0,i=0,a=0;if(this.isDisplayItem())r=e.fContMin,u=e.fContMinPos,i=e.fContMax,a=i;else{let h=this.getSelectIndex("x","left"),l=this.getSelectIndex("x","right");if(t&&h===this.scan_xleft&&l===this.scan_xright)return;this.scan_xleft=h,this.scan_xright=l;let n,p,c=!0;for(let o=0;o<this.nbinsx;++o)n=e.getBinContent(o+1),a+=n,!(o<h||o>=l)&&(n>0&&(0==u||n<u)&&(u=n),c&&(r=i=n,c=!1),p=0,r=Math.min(r,n-p),i=Math.max(i,n+p))}if(this.stat_entries=a,this.hmin=r,this.hmax=i,this.ymin_nz=u,this.draw_content=!(0==this.nbinsx||Math.abs(r)<1e-300&&Math.abs(i)<1e-300),this.draw_content)if(r>=i)0==r?(this.ymin=0,this.ymax=1):r<0?(this.ymin=2*r,this.ymax=0):(this.ymin=0,this.ymax=2*r);else{let h=.05*(i-r);this.ymin=r-h,this.ymin<0&&r>=0&&(this.ymin=0),this.ymax=i+h}}countStat(t){let p,e=this.getHisto(),r=this.getAxis("x"),u=this.getSelectIndex("x","left"),i=this.getSelectIndex("x","right"),a=0,h=0,l=0,o=0,s=0,y=null,d=null,x=(this.getFramePainter(),{name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0});for(p=u;p<i;++p)o=r.GetBinCoord(p+.5),(!t||t(o))&&(s=e.getBinContent(p+1),(null===y||s>d)&&(y=o,d=s),a+=s,h+=s*o,l+=s*o**2);return x.integral=a,Math.abs(a)>1e-300&&(x.meanx=h/a,x.meany=0/a,x.rmsx=Math.sqrt(Math.abs(l/a-x.meanx**2)),x.rmsy=Math.sqrt(Math.abs(0/a-x.meany**2))),null!==y&&(x.xmax=y,x.wmax=d),x}fillStatistic(t,e){let r=this.countStat(),u=e%10,i=Math.floor(e/10)%10,a=Math.floor(e/100)%10,h=Math.floor(e/1e3)%10,l=Math.floor(e/1e4)%10,c=Math.floor(e/1e5)%10,n=Math.floor(e/1e6)%10,p=Math.floor(e/1e7)%10,o=Math.floor(e/1e8)%10;return t.clearStat(),u>0&&t.addText(r.name),i>0&&t.addText("Entries = "+t.format(r.entries,"entries")),a>0&&t.addText("Mean = "+t.format(r.meanx)),h>0&&t.addText("Std Dev = "+t.format(r.rmsx)),l>0&&t.addText("Underflow = "+t.format(histo.getBinContent(0),"entries")),c>0&&t.addText("Overflow = "+t.format(histo.getBinContent(this.nbinsx+1),"entries")),n>0&&t.addText("Integral = "+t.format(r.integral,"entries")),p>0&&t.addText("Skew = <not avail>"),o>0&&t.addText("Kurt = <not avail>"),!0}drawBars(t,e,r,u){var i=this;return(0,z.Z)(function*(){i.createG(!0);let o,s,y,d,w,x,_,f,g,a=t.i1,h=t.i2,l=t.stepi,c=i.getFramePainter(),n=i.getHisto(),p=i.getAxis("x"),M="",b="",v="";for(f=c.swap_xy?0:u,Number.isFinite(i.options.BaseLine)&&i.options.BaseLine>=e.scale_ymin&&(f=Math.round(e.gry(i.options.BaseLine))),o=a;o<h;o+=l)s=p.GetBinCoord(o),y=p.GetBinCoord(o+l),!(e.logx&&y<=0)&&(d=Math.round(e.grx(s)),w=Math.round(e.grx(y)),x=n.getBinContent(o+1),!(e.logy&&x<e.scale_ymin)&&(_=Math.round(e.gry(x)),g=w-d,d+=Math.round(i.options.BarOffset*g),g=Math.round(i.options.BarWidth*g),M+=c.swap_xy?`M${f},${d}h${_-f}v${g}h${f-_}z`:`M${d},${_}h${g}v${f-_}h${-g}z`,i.options.BarStyle>0&&(w=d+g,g=Math.round(g/10),c.swap_xy?(b+=`M${f},${d}h${_-f}v${g}h${f-_}z`,v+=`M${f},${w}h${_-f}v${-g}h${f-_}z`):(b+=`M${d},${_}h${g}v${f-_}h${-g}z`,v+=`M${w},${_}h${-g}v${f-_}h${g}z`))));return i.fillatt.empty()&&i.fillatt.setSolidColor("blue"),M&&i.draw_g.append("svg:path").attr("d",M).call(i.fillatt.func),b&&i.draw_g.append("svg:path").attr("d",b).call(i.fillatt.func).style("fill",(0,ot.B8)(i.fillatt.color).brighter(.5).formatHex()),v&&i.draw_g.append("svg:path").attr("d",v).call(i.fillatt.func).style("fill",(0,ot.B8)(i.fillatt.color).darker(.5).formatHex()),!0})()}drawFilledErrors(t,e){var r=this;return(0,z.Z)(function*(){r.createG(!0);let c,n,p,o,s,y,d,u=t.i1,i=t.i2,a=t.stepi,h=r.getHisto(),l=r.getAxis("x"),w=[],x=[];for(c=u;c<i;c+=a)n=l.GetBinCoord(c+.5),!(e.logx&&n<=0)&&(p=Math.round(e.grx(n)),o=h.getBinContent(c+1),s=h.getBinError(c+1),!(e.logy&&o-s<e.scale_ymin)&&(y=Math.round(e.gry(o+s)),d=Math.round(e.gry(o-s)),w.push({grx:p,gry:y}),x.unshift({grx:p,gry:d})));let _=4===r.options.ErrorKind?"bezier":"line",f=(0,Y.Cq)(_,w),g=(0,Y.Cq)("L"+_,x);return r.fillatt.empty()&&r.fillatt.setSolidColor("blue"),r.draw_g.append("svg:path").attr("d",f.path+g.path+"Z").call(r.fillatt.func),!0})()}draw1DBins(){var t=this;return(0,z.Z)(function*(){let e=t.getFramePainter(),r=e.getFrameRect();if(!t.draw_content||r.width<=0||r.height<=0)return t.removeG(),!1;t.createHistDrawAttributes();let u=t.prepareDraw({extra:1,only_indexes:!0}),i=e.getGrFuncs(t.options.second_x,t.options.second_y);return t.options.Bar?t.drawBars(u,i,r.width,r.height):3===t.options.ErrorKind||4===t.options.ErrorKind?t.drawFilledErrors(u,i,r.width,r.height):t.drawHistBins(u,i,r.width,r.height)})()}drawHistBins(t,e,r,u){var i=this;return(0,z.Z)(function*(){i.createG(!0);let d,w,x,_,f,g,M,b,v,C,E,B,m,$,S,G,j,k,at,H,K,Z,P,a=i.options,h=t.i1,l=t.i2,c=t.stepi,n=i.getHisto(),p=!(0,F.isBatchMode)()&&F.settings.Tooltip,o=i.getAxis("x"),s="",y=!1,L=!a.Zero,R=a.Error,O=a.Mark,X=a.Line,N=a.Text,J=null,W=null,Q=null,I=null,V=null,rt="",nt="",q=0;if(R&&!O&&i.v7EvalAttr("marker_style",1)>1&&(O=!0),2===a.ErrorKind?i.fillatt.empty()?O=!0:J="":a.Error&&(W="",V=p?"":null),X&&(I=""),O&&(i.createv7AttMarker(),i.markeratt.size>0?(Q="",i.markeratt.resetPos()):O=!1),N){if(P=i.v7EvalFont("text",{size:20,color:"black",align:22}),!P.angle&&!a.TextKind){let D=r/(l-h+1);D<3*P.size&&(P.setAngle(270),P.setSize(Math.round(.7*D)))}i.startTextDrawing(P,"font")}let ft=l-h>3*r;if(1===a.ErrorKind){let D=i.lineatt.width+F.gStyle.fEndErrorSize;rt=`m0,${D}v${-2*D}m0,${D}`,nt=`m${D},0h${-2*D}m${D},0`,q=Math.floor((i.lineatt.width-1)/2)}let U=R||O;(U||N||X)&&(ft=!0);let tt=D=>{if(k=n.getBinContent(D+1),!L||0!==k){if(H=Math.round(e.grx(o.GetBinCoord(D))),K=Math.round(e.grx(o.GetBinCoord(D+c))),Z=Math.round((H+K)/2),S=Math.round(e.gry(k)),G=j=20,R&&(at=n.getBinError(D+1),G=Math.round(S-e.gry(k+at)),j=Math.round(e.gry(k-at)-S)),N&&0!==k){let A=k===Math.round(k)?k.toString():(0,Y.Ee)(k,F.gStyle.fPaintTextFormat);i.drawText(P.angle?{align:12,x:Z,y:Math.round(S-2-P.size/5),text:A,latex:0}:{x:Math.round(H+.1*(K-H)),y:Math.round(S-2-P.size),width:Math.round(.8*(K-H)),height:P.size,text:A,latex:0})}if(X&&null!==I&&(I+=(0===I.length?"M":"L")+Z+","+S),U&&S>=-G&&S<=u+j&&(null!==J&&(J+=`M${H},${S-G}h${K-H}v${G+j+1}h${H-K}z`),null!==Q&&(Q+=i.markeratt.create(Z,S)),null!==W)){let A=5;if(i.options.errorX>0){A=Math.round((K-H)*i.options.errorX);let ut=Z-A;W+=`M${ut+q},${S}${rt}h${Z+A-ut-2*q}${rt}`}W+=`M${Z},${S-G+q}${nt}v${G+j-2*q}${nt}`,null!==V&&(V+=`M${Z-A},${S-G}h${2*A}v${G+j}h${-2*A}z`)}}};for(B=h;B<=l;B+=c)_=o.GetBinCoord(B),!(e.logx&&_<=0)&&(f=Math.round(e.grx(_)),y=B>l-c,y&&h<l?M=x:(g=n.getBinContent(B+1),M=Math.round(e.gry(g))),0===s.length?(m=$=B,E=d=w=f,C=b=v=x=M,s="M"+w+","+x):ft?f!==w||y?((U||N||X)&&(m===$?tt(m):m<$?(tt(m),tt($)):(tt($),tt(m))),!U&&(b!==v||C!==b)&&(E!==w&&(s+="h"+(w-E)),x===b?(v!==C&&(s+="v"+(v-C)),b!==v&&(s+="v"+(b-v))):(b!==C&&(s+="v"+(b-C)),v!==b&&(s+="v"+(v-b)),x!==v&&(s+="v"+(x-v))),E=w,C=x),y&&E!==f&&(s+="h"+(f-E)),m=$=B,b=v=x=M,w=f):(M<b?$=B:M>v&&(m=B),b=Math.min(b,M),v=Math.max(v,M),x=M):(M!==x||y)&&(f!==w&&(s+="h"+(f-w)),M!==x&&(s+="v"+(M-x)),x=M,w=f));let st="",dt=!(0,F.isBatchMode)()&&i.fillatt.empty()&&a.Hist&&F.settings.Tooltip&&!U&&!X;if(!i.fillatt.empty()||dt){let D=u+3;if(dt){let A=Math.round(e.gry(0));A<=0?D=-3:A<u&&(D=A)}st=`L${w},${D}H${d}Z`,s&&(s+=st)}return U||X?(J&&i.draw_g.append("svg:path").attr("d",J).call(i.fillatt.func),W&&i.draw_g.append("svg:path").attr("d",W).call(i.lineatt.func),V&&i.draw_g.append("svg:path").attr("d",V).style("fill","none").style("pointer-events",(0,F.isBatchMode)()?null:"visibleFill"),I&&(i.fillatt.empty()||i.draw_g.append("svg:path").attr("d",a.Fill?I+st:s).call(i.fillatt.func),i.draw_g.append("svg:path").attr("d",I).style("fill","none").call(i.lineatt.func)),Q&&i.draw_g.append("svg:path").attr("d",Q).call(i.markeratt.func)):s&&a.Hist&&i.draw_g.append("svg:path").attr("d",s).style("stroke-linejoin","miter").call(i.lineatt.func).call(i.fillatt.func),!N||i.finishTextDrawing()})()}getBinTooltips(t){let e=[],r=this.getObjectHint(),u=this.getFramePainter(),i=this.getHisto(),a=this.getAxis("x"),h=this.isDisplayItem()?i.stepx:1,l=a.GetBinCoord(t),c=a.GetBinCoord(t+h),n=i.getBinContent(t+1),p=this.getAxisBinTip("x",t,h);if(r&&e.push(r),this.options.Error||this.options.Mark)e.push("x = "+p,"y = "+u.axisAsText("y",n)),this.options.Error&&("["==p[0]&&e.push("error x = "+((c-l)/2).toPrecision(4)),e.push("error y = "+i.getBinError(t+1).toPrecision(4)));else{e.push(`bin = ${t+1}`),e.push("x = "+p),i.$baseh&&(n-=i.$baseh.getBinContent(t+1));let o="entries = "+(h>1?"~":"");n===Math.round(n)?e.push(o+n):e.push(o+(0,Y.Ee)(n,F.gStyle.fStatFormat))}return e}processTooltipEvent(t){if(!t||!this.draw_content||this.options.Mode3D||!this.draw_g)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let c,n,p,o,s,y,d,e=this.getFramePainter(),r=e.getGrFuncs(this.options.second_x,this.options.second_y),u=e.getFrameWidth(),i=e.getFrameHeight(),a=this.getHisto(),h=this.getAxis("x"),l=null,w=2,x=this.getSelectIndex("x","left",-1),_=this.getSelectIndex("x","right",2),f=x,g=_;function M(m){let $=h.GetBinCoord(m);return r.logx&&$<=0?null:r.grx($)}function b(m){let $=a.getBinContent(m+1);return r.logy&&$<r.scale_ymin?r.swap_xy?-1e3:10*i:Math.round(r.gry($))}let v=r.swap_xy?t.y:t.x,C=r.swap_xy?t.x:t.y;for(;f<g-1;){let m=Math.round(.5*(f+g)),$=M(m);null===$||$<v-.5?r.swap_xy?g=m:f=m:$>v+.5?r.swap_xy?f=m:g=m:(f++,g--)}if(l=g=f,n=M(l),r.swap_xy){for(;f>x&&M(f-1)<n+2;)--f;for(;g<_&&M(g+1)>n-2;)++g}else{for(;f>x&&M(f-1)>n-2;)--f;for(;g<_&&M(g+1)<n+2;)++g}if(f<g){let m=i;for(let $=f;$<=g;$++){let L=Math.abs(b($)-C);L<m&&(m=L,l=$)}m>i/10&&(l=Math.round(f+(g-f)/i*C)),n=M(l)}if(n=Math.round(n),o=Math.round(M(l+1)),this.options.Bar){let m=o-n;n+=Math.round(this.options.BarOffset*m),o=n+Math.round(this.options.BarWidth*m)}if(n>o&&([n,o]=[o,n]),p=Math.round((n+o)/2),y=s=d=b(l),this.options.Bar)c=!0,w=0,s=Math.round(r.gry(!1!==this.options.BaseLine&&this.options.BaseLine>r.scale_ymin?this.options.BaseLine:r.scale_ymin)),s>d&&([s,d]=[d,s]),!t.touch&&1===t.nproc&&(C<s||C>d)&&(l=null);else if(this.options.Error||this.options.Mark){c=!0;let m=3;if(this.markeratt&&(m=Math.max(m,this.markeratt.getFullSize())),this.options.Error){let $=a.getBinContent(l+1),L=a.getBinError(l+1);s=Math.round(r.gry($+L)),d=Math.round(r.gry($-L));let R=(o-n)*this.options.errorX;n=Math.round(p-R),o=Math.round(p+R)}o-n<2*m&&(n=p-m,o=p+m),s=Math.min(s,y-m),d=Math.max(d,y+m),!t.touch&&1===t.nproc&&(C<s||C>d)&&(l=null)}else this.options.Line?c=!1:(c=1===t.nproc&&_-x<u,c&&(d=i,this.fillatt.empty()||(d=Math.min(i,Math.max(0,Math.round(r.gry(0)))),d<s&&([s,d]=[d,s])),(t.y<s||t.y>d)&&!t.touch&&(l=null)));null!==l&&(l===x&&n>v+w||l===_-1&&o<v-w||v<n-w||v>o+w||!this.options.Zero&&0===a.getBinContent(l+1))&&(l=null);let E=this.draw_g.select(".tooltip_bin");if(null===l||d<=0||s>=i)return E.remove(),null;let B={name:"histo",title:a.fTitle,x:p,y,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(l)};if(t.disabled)E.remove(),B.changed=!0;else if(c)E.empty()&&(E=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),B.changed=E.property("current_bin")!==l,B.changed&&E.attr("x",e.swap_xy?s:n).attr("width",e.swap_xy?d-s:o-n).attr("y",e.swap_xy?n:s).attr("height",e.swap_xy?o-n:d-s).style("opacity","0.3").property("current_bin",l),B.exact=Math.abs(y-C)<=5||C>=s&&C<=d,B.menu=B.exact,B.menu_dist=Math.sqrt((p-v)**2+(y-C)**2);else{let m=this.lineatt.width+3;E.empty()&&(E=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",m).call(this.lineatt.func).call(this.fillatt.func)),B.exact=Math.abs(p-t.x)<=m&&Math.abs(y-t.y)<=m,B.menu=B.exact,B.menu_dist=Math.sqrt((p-t.x)**2+(y-t.y)**2),B.changed=E.property("current_bin")!==l,B.changed&&E.attr("cx",p).attr("cy",y).property("current_bin",l)}return B.changed&&(B.user_info={obj:a,name:"histo",bin:l,cont:a.getBinContent(l+1),grx:p,gry:y}),B}fillHistContextMenu(t){t.add("Auto zoom-in",()=>this.autoZoom());let e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,r=>{if("inspect"===r)return this.showInspector();this.decodeOptions(r),this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")})}autoZoom(){let t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1),r=e-t,u=this.getHisto(),i=this.getAxis("x");if(0==r)return;let a=u.getBinContent(t+1);for(let h=t;h<e;++h)a=Math.min(a,u.getBinContent(h+1));if(!(a>0)){for(;t<e&&u.getBinContent(t+1)<=a;)++t;for(;t<e&&u.getBinContent(e)<=a;)--e;if(t===e-1&&t>2&&e<this.nbinsx-2&&(--t,++e),e-t<r&&t<e)return this.getFramePainter().zoom(i.GetBinCoord(t),i.GetBinCoord(e))}}canZoomInside(t,e,r){let u=this.getAxis("x");return"x"==t&&u.FindBin(r,.5)-u.FindBin(e,0)>1||"y"==t&&Math.abs(r-e)>1e-6*Math.abs(this.ymax-this.ymin)}callDrawFunc(t){var e=this;return(0,z.Z)(function*(){let r=e.getFramePainter();return r&&r.mode3d!==e.options.Mode3D&&!e.isMainPainter()&&(e.options.Mode3D=r.mode3d),e.options.Mode3D?e.draw3D(t):e.draw2D(t)})()}draw2D(t){var e=this;return(0,z.Z)(function*(){return e.clear3DScene(),e.drawFrameAxes().then(r=>!!r&&e.drawingBins(t)).then(r=>{if(r)return e.draw1DBins().then(()=>e.addInteractivity())}).then(()=>e)})()}draw3D(t){var e=this;return(0,z.Z)(function*(){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),e.draw2D(t)})()}redraw(t){var e=this;return(0,z.Z)(function*(){return e.callDrawFunc(t)})()}static _draw(t,e){return(0,z.Z)(function*(){return(0,gt.ensureRCanvas)(t).then(()=>{t.setAsMainPainter(),t.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:F.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1};let r=new Y.pc(e);r.check("R3D_",!0)&&(t.options.Render3D=F.constants.Render3D.fromString(r.part.toLowerCase()));let u=t.v7EvalAttr("kind","hist"),i=t.v7EvalAttr("sub",0),a=!!t.getMainPainter(),h=t.options;switch(h.Text=t.v7EvalAttr("drawtext",!1),h.BarOffset=t.v7EvalAttr("baroffset",0),h.BarWidth=t.v7EvalAttr("barwidth",1),h.second_x=a&&t.v7EvalAttr("secondx",!1),h.second_y=a&&t.v7EvalAttr("secondy",!1),u){case"bar":h.Bar=!0,h.BarStyle=i;break;case"err":h.Error=!0,h.ErrorKind=i;break;case"p":h.Mark=!0;break;case"l":h.Line=!0;break;case"lego":h.Lego=i>0?10+i:12,h.Mode3D=!0;break;default:h.Hist=!0}return t.scanContent(),t.callDrawFunc()})})()}static draw(t,e,r){return(0,z.Z)(function*(){return et._draw(new et(t,e),r)})()}}var mt=T(757),ht=T(3641);class it extends et{draw3D(t){this.mode3d=!0;let e=this.getFramePainter(),r=this.isMainPainter(),u=1+2*F.gStyle.fHistTopMargin,i=Promise.resolve(this);return"resize"==t?(r&&e.resize3D()&&e.render3D(),i):(this.deleteAttr(),this.scanContent(!0),r&&((0,ht.g_)(e),i=e.create3DScene(this.options.Render3D).then(()=>{e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,mt.C,{use_y_for_z:!0,zmult:u,zoom:F.settings.Zooming,ndim:1,draw:!0,v7:!0})})),e.mode3d?i.then(()=>this.drawingBins(t)).then(()=>{let a=this.getFramePainter();return(0,ht.UR)(this,!0),this.updatePaletteDraw(),a.render3D(),a.addKeysHandler(),this}):i)}static draw(t,e,r){return(0,z.Z)(function*(){return it._draw(new it(t,e),r)})()}}}}]);
//# sourceMappingURL=18.53db17338b338e15.js.map