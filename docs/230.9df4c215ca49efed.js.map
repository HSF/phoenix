{"version":3,"file":"230.9df4c215ca49efed.js","mappings":"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","names":["TRatioPlotPainter","ObjectPainter","setGridsRange","xmin","xmax","ratio","this","getObject","x_handle","getPadPainter","findPainterFor","fLowerPad","clTPad","getFramePainter","full_min","full_max","fGridlines","forEach","line","fX1","fX2","redraw","_this","pp","top_p","fTopPad","disablePadDrawing","up_p","fUpperPad","up_main","getMainPainter","up_fp","low_p","low_main","low_fp","lbl_size","promise_up","Promise","resolve","_ratio_configured","options","Axis","getHisto","fYaxis","fLabelSize","Math","round","min","getPadWidth","getPadHeight","h","fXaxis","fTitle","fTitleSize","getRootPad","fTicky","redrawPad","then","o_zoom","zoom","_ratio_low_fp","_ratio_painter","ymin","ymax","zmin","zmax","o_sizeChanged","sizeChanged","fX1NDC","fX2NDC","forEachPainterInPad","objp","isFunc","testEditable","currpad","arr","fGridlinePositions","length","gridy","found","fY1","fY2","abs","create","clTLine","scale_xmin","scale_xmax","fLineStyle","push","undefined","selectCurrentPad","fName","drawTLine","getDom","all","_ratio_up_fp","static","dom","opt","painter","ensureTCanvas"],"sourceRoot":"webpack:///","sources":["../node_modules/jsroot/modules/draw/TRatioPlotPainter.mjs"],"sourcesContent":["import { create, clTPad, clTLine, isFunc } from '../core.mjs';\nimport { ObjectPainter } from '../base/ObjectPainter.mjs';\nimport { ensureTCanvas } from '../gpad/TCanvasPainter.mjs';\nimport { drawTLine } from './more.mjs';\n\n\n/**\n * @summary Painter class for TRatioPlot\n *\n * @private\n */\n\nclass TRatioPlotPainter extends ObjectPainter {\n\n   /** @summary Set grids range */\n   setGridsRange(xmin, xmax) {\n      let ratio = this.getObject();\n      if (xmin === xmax) {\n         let x_handle = this.getPadPainter()?.findPainterFor(ratio.fLowerPad, 'lower_pad', clTPad)?.getFramePainter()?.x_handle;\n         if (!x_handle) return;\n         xmin = x_handle.full_min;\n         xmax = x_handle.full_max;\n      }\n\n      ratio.fGridlines.forEach(line => {\n         line.fX1 = xmin;\n         line.fX2 = xmax;\n      });\n   }\n\n   /** @summary Redraw TRatioPlot */\n   async redraw() {\n      let ratio = this.getObject(),\n          pp = this.getPadPainter();\n\n      let top_p = pp.findPainterFor(ratio.fTopPad, 'top_pad', clTPad);\n      if (top_p) top_p.disablePadDrawing();\n\n      let up_p = pp.findPainterFor(ratio.fUpperPad, 'upper_pad', clTPad),\n          up_main = up_p?.getMainPainter(),\n          up_fp = up_p?.getFramePainter(),\n          low_p = pp.findPainterFor(ratio.fLowerPad, 'lower_pad', clTPad),\n          low_main = low_p?.getMainPainter(),\n          low_fp = low_p?.getFramePainter(),\n          lbl_size = 20, promise_up = Promise.resolve(true);\n\n      if (up_p && up_main && up_fp && low_fp && !up_p._ratio_configured) {\n         up_p._ratio_configured = true;\n         up_main.options.Axis = 0; // draw both axes\n\n         lbl_size = up_main.getHisto().fYaxis.fLabelSize;\n         if (lbl_size < 1) lbl_size = Math.round(lbl_size*Math.min(up_p.getPadWidth(), up_p.getPadHeight()));\n\n         let h = up_main.getHisto();\n         h.fXaxis.fLabelSize = 0; // do not draw X axis labels\n         h.fXaxis.fTitle = ''; // do not draw X axis title\n         h.fYaxis.fLabelSize = lbl_size;\n         h.fYaxis.fTitleSize = lbl_size;\n\n         up_p.getRootPad().fTicky = 1;\n\n         promise_up = up_p.redrawPad().then(() => {\n            up_fp.o_zoom = up_fp.zoom;\n            up_fp._ratio_low_fp = low_fp;\n            up_fp._ratio_painter = this;\n\n            up_fp.zoom = function(xmin,xmax,ymin,ymax,zmin,zmax) {\n               this._ratio_painter.setGridsRange(xmin, xmax);\n               this._ratio_low_fp.o_zoom(xmin,xmax);\n               return this.o_zoom(xmin,xmax,ymin,ymax,zmin,zmax);\n            }\n\n            up_fp.o_sizeChanged = up_fp.sizeChanged;\n            up_fp.sizeChanged = function() {\n               this.o_sizeChanged();\n               this._ratio_low_fp.fX1NDC = this.fX1NDC;\n               this._ratio_low_fp.fX2NDC = this.fX2NDC;\n               this._ratio_low_fp.o_sizeChanged();\n            }\n            return true;\n         });\n      }\n\n      return promise_up.then(() => {\n\n         if (!low_p || !low_main || !low_fp || !up_fp || low_p._ratio_configured)\n            return this;\n\n         low_p._ratio_configured = true;\n         low_main.options.Axis = 0; // draw both axes\n         let h = low_main.getHisto();\n         h.fXaxis.fTitle = 'x';\n         h.fXaxis.fLabelSize = lbl_size;\n         h.fXaxis.fTitleSize = lbl_size;\n         h.fYaxis.fLabelSize = lbl_size;\n         h.fYaxis.fTitleSize = lbl_size;\n         low_p.getRootPad().fTicky = 1;\n\n         low_p.forEachPainterInPad(objp => {\n            if (isFunc(objp?.testEditable))\n               objp.testEditable(false);\n         });\n\n         let arr = [], currpad;\n\n         if ((ratio.fGridlinePositions.length > 0) && (ratio.fGridlines.length < ratio.fGridlinePositions.length)) {\n            ratio.fGridlinePositions.forEach(gridy => {\n               let found = false;\n               ratio.fGridlines.forEach(line => {\n                  if ((line.fY1 == line.fY2) && (Math.abs(line.fY1 - gridy) < 1e-6)) found = true;\n               });\n               if (!found) {\n                  let line = create(clTLine);\n                  line.fX1 = up_fp.scale_xmin;\n                  line.fX2 = up_fp.scale_xmax;\n                  line.fY1 = line.fY2 = gridy;\n                  line.fLineStyle = 2;\n                  ratio.fGridlines.push(line);\n                  if (currpad === undefined)\n                     currpad = this.selectCurrentPad(ratio.fLowerPad.fName);\n                  arr.push(drawTLine(this.getDom(), line));\n               }\n            });\n         }\n\n         return Promise.all(arr).then(() => low_fp.zoom(up_fp.scale_xmin,  up_fp.scale_xmax)).then(() => {\n\n            low_fp.o_zoom = low_fp.zoom;\n            low_fp._ratio_up_fp = up_fp;\n            low_fp._ratio_painter = this;\n\n            low_fp.zoom = function(xmin,xmax,ymin,ymax,zmin,zmax) {\n               this._ratio_painter.setGridsRange(xmin, xmax);\n               this._ratio_up_fp.o_zoom(xmin,xmax);\n               return this.o_zoom(xmin,xmax,ymin,ymax,zmin,zmax);\n            }\n\n            low_fp.o_sizeChanged = low_fp.sizeChanged;\n            low_fp.sizeChanged = function() {\n               this.o_sizeChanged();\n               this._ratio_up_fp.fX1NDC = this.fX1NDC;\n               this._ratio_up_fp.fX2NDC = this.fX2NDC;\n               this._ratio_up_fp.o_sizeChanged();\n            }\n            return this;\n         });\n      });\n   }\n\n   /** @summary Draw TRatioPlot */\n   static async draw(dom, ratio, opt) {\n      let painter = new TRatioPlotPainter(dom, ratio, opt);\n\n      return ensureTCanvas(painter, false).then(() => painter.redraw());\n   }\n\n} // class TRatioPlotPainter\n\nexport { TRatioPlotPainter };\n"],"x_google_ignoreList":[0]}