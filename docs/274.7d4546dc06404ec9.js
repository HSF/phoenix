"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[274],{6274:(b,y,p)=>{p.r(y),p.d(y,{TGraphPolarPainter:()=>M,TGraphPolargramPainter:()=>x});var P=p(4788),g=p(9542),u=p(2253),w=p(3675),_=p(6458),E=p(6367),T=p(49),v=p(6116);class x extends _.tK{constructor(t,e){super(t,e),this.$polargram=!0,this.zoom_rmin=this.zoom_rmax=0}translate(t,e,a){let i=this.r(e),r=i/this.szx*this.szy,s={x:i*Math.cos(-t-this.angle),y:r*Math.sin(-t-this.angle),rx:i,ry:r};return a||(s.x=Math.round(s.x),s.y=Math.round(s.y),s.rx=Math.round(s.rx),s.ry=Math.round(s.ry)),s}format(t){return t===Math.round(t)?t.toString():this.ndig>10?t.toExponential(4):t.toFixed(this.ndig>0?this.ndig:0)}axisAsText(t,e){return"r"==t?e===Math.round(e)?e.toString():this.ndig>10?e.toExponential(4):e.toFixed(this.ndig+2):(e*=180/Math.PI)===Math.round(e)?e.toString():e.toFixed(1)}getFrameRect(){let t=this.getPadPainter(),e=t.getRootPad(!0),a=t.getPadWidth(),i=t.getPadHeight(),r={};return e?(r.szx=Math.round(Math.max(.1,.5-Math.max(e.fLeftMargin,e.fRightMargin))*a),r.szy=Math.round(Math.max(.1,.5-Math.max(e.fBottomMargin,e.fTopMargin))*i)):(r.szx=Math.round(.5*a),r.szy=Math.round(.5*i)),r.width=2*r.szx,r.height=2*r.szy,r.x=Math.round(a/2-r.szx),r.y=Math.round(i/2-r.szy),r.hint_delta_x=r.szx,r.hint_delta_y=r.szy,r.transform=`translate(${r.x},${r.y})`,r}mouseEvent(t,e){let i=this.getLayerSvg("primitives_layer").select(".interactive_ellipse");if(i.empty())return;let r=null;if("leave"!==t){let s=(0,u.cx)(e,i.node());r={x:s[0],y:s[1],touch:!1}}this.processFrameTooltipEvent(r)}mouseWheel(t){t.stopPropagation(),t.preventDefault(),this.processFrameTooltipEvent(null);let e=this.getObject();if(!e)return;let a=t.wheelDelta?-t.wheelDelta:t.deltaY||t.detail;if(!a)return;a=a<0?-.2:.2;let i=this.scale_rmin,r=this.scale_rmax;r+=a*(r-i),(i<e.fRwrmin||r>e.fRwrmax)&&(i=r=0),(this.zoom_rmin!=i||this.zoom_rmax!=r)&&(this.zoom_rmin=i,this.zoom_rmax=r,this.redrawPad())}redraw(){if(!this.isMainPainter())return;let t=this.getObject(),e=this.getPadPainter().getFrameRect();this.createG(),this.draw_g.attr("transform",`translate(${Math.round(e.x+e.width/2)},${Math.round(e.y+e.height/2)})`),this.szx=e.szx,this.szy=e.szy,this.scale_rmin=t.fRwrmin,this.scale_rmax=t.fRwrmax,this.zoom_rmin!=this.zoom_rmax&&(this.scale_rmin=this.zoom_rmin,this.scale_rmax=this.zoom_rmax),this.r=(0,u.BY)().domain([this.scale_rmin,this.scale_rmax]).range([0,this.szx]),this.angle=t.fAxisAngle||0;let a=this.r.ticks(5),i=Math.floor(t.fNdivRad%1e4/100);this.createAttLine({attr:t}),this.gridatt||(this.gridatt=new E.rE({color:t.fLineColor,style:2,width:1}));let r=Math.abs(t.fRwrmax-t.fRwrmin);this.ndig=r<=0?-3:Math.round(Math.log10(a.length/r));let s=[],l=0;for(;l<a.length;){let n=this.format(a[l]);if(s.indexOf(n)>=0){if(++this.ndig>10)break;s=[],l=0}else s.push(n),l++}let f=!1;a[a.length-1]<t.fRwrmax&&this.zoom_rmin==this.zoom_rmax&&(a.push(t.fRwrmax),f=!0),this.startTextDrawing(t.fRadialLabelFont,Math.round(t.fRadialTextSize*this.szy*2));for(let n=0;n<a.length;++n){let d=this.r(a[n]),h=d/this.szx*this.szy;if(this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(d)).attr("ry",Math.round(h)).style("fill","none").call(this.lineatt.func),(n<a.length-1||!f)&&this.drawText({align:23,x:Math.round(d),y:Math.round(t.fRadialTextSize*this.szy*.5),text:this.format(a[n]),color:this.getColor(t.fRadialLabelColor),latex:0}),i>1&&(n<a.length-1||!f)){let c=(a[1]-a[0])/i;for(let m=1;m<i;++m){let z=a[n]+c*m;if(z>this.scale_rmax)break;d=this.r(z),h=d/this.szx*this.szy,this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(d)).attr("ry",Math.round(h)).style("fill","none").call(this.gridatt.func)}}}let o=t.fNdivPol%100;return 8!==o&&3!==o&&(o=8),this.finishTextDrawing().then(()=>{let n=Math.round(t.fPolarTextSize*this.szy*2);this.startTextDrawing(t.fPolarLabelFont,n),s=8==o?["0","#frac{#pi}{4}","#frac{#pi}{2}","#frac{3#pi}{4}","#pi","#frac{5#pi}{4}","#frac{3#pi}{2}","#frac{7#pi}{4}"]:["0","#frac{2#pi}{3}","#frac{4#pi}{3}"];let d=[12,11,21,31,32,33,23,13];for(let h=0;h<o;++h){let c=2*-h*Math.PI/o-this.angle;this.draw_g.append("svg:path").attr("d",`M0,0L${Math.round(this.szx*Math.cos(c))},${Math.round(this.szy*Math.sin(c))}`).call(this.lineatt.func);let m=Math.round(16-c/Math.PI*4)%8;this.drawText({align:d[m],x:Math.round((this.szx+n)*Math.cos(c)),y:Math.round((this.szy+n/this.szx*this.szy)*Math.sin(c)),text:s[h],color:this.getColor(t.fPolarLabelColor),latex:1})}return this.finishTextDrawing()}).then(()=>{if(i=Math.floor(t.fNdivPol%1e4/100),i>1)for(let h=0;h<o*i;++h){if(h%i==0)continue;let c=2*-h*Math.PI/o/i-this.angle;this.draw_g.append("svg:path").attr("d",`M0,0L${Math.round(this.szx*Math.cos(c))},${Math.round(this.szy*Math.sin(c))}`).call(this.gridatt.func)}if((0,g.isBatchMode)())return;v.a4.assign(this);let n=this.getLayerSvg("primitives_layer"),d=n.select(".interactive_ellipse");d.empty()&&(d=n.append("g").classed("most_upper_primitives",!0).append("ellipse").classed("interactive_ellipse",!0).attr("cx",0).attr("cy",0).style("fill","none").style("pointer-events","visibleFill").on("mouseenter",h=>this.mouseEvent("enter",h)).on("mousemove",h=>this.mouseEvent("move",h)).on("mouseleave",h=>this.mouseEvent("leave",h))),d.attr("rx",this.szx).attr("ry",this.szy),(0,u.Ys)(d.node().parentNode).attr("transform",this.draw_g.attr("transform")),g.settings.Zooming&&g.settings.ZoomWheel&&d.on("wheel",h=>this.mouseWheel(h))})}static draw(t,e){return(0,P.Z)(function*(){let a=(0,_.SO)(t);if(a){if(a.getObject()===e)return a;throw Error("Cannot superimpose TGraphPolargram with any other drawings")}let i=new x(t,e);return(0,T.ensureTCanvas)(i,!1).then(()=>(i.setAsMainPainter(),i.redraw())).then(()=>i)})()}}class M extends _.tK{redraw(){this.drawGraphPolar()}decodeOptions(t){let e=new w.pc(t||"L");this.options||(this.options={}),Object.assign(this.options,{mark:e.check("P"),err:e.check("E"),fill:e.check("F"),line:e.check("L"),curve:e.check("C")}),this.storeDrawOpt(t)}drawGraphPolar(){let t=this.getObject(),e=this.getMainPainter();if(!t||!e?.$polargram)return;this.options.mark&&this.createAttMarker({attr:t}),(this.options.err||this.options.line||this.options.curve)&&this.createAttLine({attr:t}),this.options.fill&&this.createAttFill({attr:t}),this.createG(),this.draw_g.attr("transform",e.draw_g.attr("transform"));let a="",i="",r="",s=[];for(let l=0;l<t.fNpoints;++l){if(t.fY[l]>e.scale_rmax)continue;if(this.options.err){let o=e.translate(t.fX[l],t.fY[l]-t.fEY[l]),n=e.translate(t.fX[l],t.fY[l]+t.fEY[l]);i+=`M${o.x},${o.y}L${n.x},${n.y}`,o=e.translate(t.fX[l]+t.fEX[l],t.fY[l]),n=e.translate(t.fX[l]-t.fEX[l],t.fY[l]),i+=`M${o.x},${o.y}A${n.rx},${n.ry},0,0,1,${n.x},${n.y}`}let f=e.translate(t.fX[l],t.fY[l]);this.options.mark&&(a+=this.markeratt.create(f.x,f.y)),(this.options.line||this.options.fill)&&(r+=(r?"L":"M")+f.x+","+f.y),this.options.curve&&(f.grx=f.x,f.gry=f.y,s.push(f))}this.options.fill&&r&&this.draw_g.append("svg:path").attr("d",r+"Z").call(this.fillatt.func),this.options.line&&r&&this.draw_g.append("svg:path").attr("d",r).style("fill","none").call(this.lineatt.func),this.options.curve&&s.length&&this.draw_g.append("svg:path").attr("d",(0,w.Cq)("bezier",s).path).style("fill","none").call(this.lineatt.func),i&&this.draw_g.append("svg:path").attr("d",i).style("fill","none").call(this.lineatt.func),a&&this.draw_g.append("svg:path").attr("d",a).call(this.markeratt.func)}createPolargram(){let t=(0,g.create)("TGraphPolargram"),e=this.getObject(),a=e.fY[0]||0,i=a;for(let r=0;r<e.fNpoints;++r)a=Math.min(a,e.fY[r]-e.fEY[r]),i=Math.max(i,e.fY[r]+e.fEY[r]);return t.fRwrmin=a-.1*(i-a),t.fRwrmax=i+.1*(i-a),t}extractTooltip(t){if(!t)return null;let e=this.getObject(),a=this.getMainPainter(),i=1e10,r=-1,s=null;for(let o=0;o<e.fNpoints;++o){let n=a.translate(e.fX[o],e.fY[o]),d=(n.x-t.x)**2+(n.y-t.y)**2;d<i&&(i=d,r=o,s=n)}let l=5;if(this.markeratt&&this.markeratt.used&&(l=this.markeratt.getFullSize()),Math.sqrt(i)>l)return null;let f={name:this.getObject().fName,title:this.getObject().fTitle,x:s.x,y:s.y,color1:this.markeratt&&this.markeratt.used?this.markeratt.color:this.lineatt.color,exact:Math.sqrt(i)<4,lines:[this.getObjectHint()],binindx:r,menu_dist:l,radius:l};return f.lines.push("r = "+a.axisAsText("r",e.fY[r])),f.lines.push("phi = "+a.axisAsText("phi",e.fX[r])),e.fEY&&e.fEY[r]&&f.lines.push("error r = "+a.axisAsText("r",e.fEY[r])),e.fEX&&e.fEX[r]&&f.lines.push("error phi = "+a.axisAsText("phi",e.fEX[r])),f}showTooltip(t){if(!this.draw_g)return;let e=this.draw_g.select(".tooltip_bin");t?(e.empty()&&(e=this.draw_g.append("svg:ellipse").attr("class","tooltip_bin").style("pointer-events","none")),t.changed=e.property("current_bin")!==t.binindx,t.changed&&e.attr("cx",t.x).attr("cy",t.y).attr("rx",Math.round(t.radius)).attr("ry",Math.round(t.radius)).style("fill","none").style("stroke",t.color1).property("current_bin",t.binindx)):e.remove()}processTooltipEvent(t){let e=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(e),e}static draw(t,e,a){return(0,P.Z)(function*(){let i=new M(t,e);i.decodeOptions(a);let r=i.getMainPainter();if(r&&!r.$polargram)return console.error("Cannot superimpose TGraphPolar with plain histograms"),null;let s=Promise.resolve(null);return r||(e.fPolargram||(e.fPolargram=i.createPolargram()),s=x.draw(t,e.fPolargram)),s.then(()=>(i.addToPadPrimitives(),i.drawGraphPolar(),i))})()}}}}]);
//# sourceMappingURL=274.7d4546dc06404ec9.js.map