"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[832],{832:(D,X,d)=>{d.r(X),d.d(X,{THStackPainter:()=>P});var E=d(5835),h=d(9542),v=d(3675),H=d(6458),A=d(629),N=d(8189),b=d(49);class P extends H.tK{constructor(r,i,s){super(r,i,s),this.firstpainter=null,this.painters=[]}cleanup(){this.getPadPainter()?.cleanPrimitives(r=>r===this.firstpainter||this.painters.indexOf(r)>=0),delete this.firstpainter,delete this.painters,super.cleanup()}buildStack(r){if(!r.fHists)return!1;let i=r.fHists.arr.length;if(i<=0)return!1;let s=(0,h.create)(h.clTList);s.Add((0,h.clone)(r.fHists.arr[0]),r.fHists.opt[0]);for(let e=1;e<i;++e){let t=(0,h.clone)(r.fHists.arr[e]),n=r.fHists.opt[e],a=s.arr[e-1];if(t.fNbins!=a.fNbins||t.fXaxis.fXmin!=a.fXaxis.fXmin||t.fXaxis.fXmax!=a.fXaxis.fXmax)return console.warn(`When drawing THStack, cannot sum-up histograms ${t.fName} and ${a.fName}`),s.Clear(),!1;for(let f=0;f<t.fArray.length;++f)t.fArray[f]+=a.fArray[f];s.Add(t,n)}return r.fStack=s,!0}getMinMax(r){let i=0,s=0,e=this.getObject(),t=this.getPadPainter().getRootPad(!0);const n=(o,p)=>{let u={min:0,max:0},M=!0,k=!0;if(o.fMinimum!==h.kNoZoom&&(u.min=o.fMinimum,M=!1),o.fMaximum!==h.kNoZoom&&(u.max=o.fMaximum,k=!1),!M&&!k)return u;let C=1,S=o.fXaxis.fNbins,w=1,O=1,T=!0;o.fXaxis.TestBit(H.VO.kAxisRange)&&(C=o.fXaxis.fFirst,S=o.fXaxis.fLast),0===o._typename.indexOf(h.clTH2)&&(O=o.fYaxis.fNbins,o.fYaxis.TestBit(H.VO.kAxisRange)&&(w=o.fYaxis.fFirst,O=o.fYaxis.fLast));for(let c=w;c<=O;++c)for(let x=C;x<=S;++x){let _=o.getBinContent(x,c),g=p?o.getBinError(o.getBin(x,c)):0;M&&(T||_-g<u.min)&&(u.min=_-g),k&&(T||_+g>u.max)&&(u.max=_+g),T=!1}return u};if(this.options.nostack)for(let o=0;o<e.fHists.arr.length;++o){let p=n(e.fHists.arr[o],r);0==o?(i=p.min,s=p.max):(i=Math.min(i,p.min),s=Math.max(s,p.max))}else i=n(e.fStack.arr[0],r).min,s=n(e.fStack.arr[e.fStack.arr.length-1],r).max;const a=()=>{if(t&&(1==this.options.ndim?t.fLogy:t.fLogz)){s<=0&&(s=1),i<=0&&(i=1e-4*s);let o=1/(1+.5*Math.log10(s/i)),p=1+.2*Math.log10(s/i);i*=o,s*=p}else i>0&&i<.05*s&&(i=0)};s*=1+h.gStyle.fHistTopMargin,a();let f=s,l=i,m=!1;return e.fMaximum!=h.kNoZoom&&(s=e.fMaximum,f=Math.max(s,f),m=!0),e.fMinimum!=h.kNoZoom&&(i=e.fMinimum,l=Math.min(i,l),m=!0),m?a():i=s=h.kNoZoom,{min:i,max:s,min0:l,max0:f,zoomed:m,hopt:`hmin:${l};hmax:${f};minimum:${i};maximum:${s}`}}drawNextHisto(r,i){var s=this;return(0,E.Z)(function*(){let e=s.getObject(),t=s.options.nostack?e.fHists:e.fStack,n=t?.arr?.length||0;if(r>=n)return s;let a=s.options.horder?r:n-r-1,f=t.arr[a],l=t.opt[a]||f.fOption||s.options.hopt;if(l.toUpperCase().indexOf(s.options.hopt)<0&&(l+=" "+s.options.hopt),s.options.draw_errors&&!l&&(l="E"),s.options._pfc||s.options._plc||s.options._pmc){let m=s.getMainPainter();if((0,h.isFunc)(m?.createAutoColor)){let o=m.createAutoColor(n);s.options._pfc&&(f.fFillColor=o),s.options._plc&&(f.fLineColor=o),s.options._pmc&&(f.fMarkerColor=o)}}if(i){let m=i.getSubPadPainter(r+1);if(!m)return s;let o=m.selectCurrentPad(m.this_pad_name);return s.hdraw_func(m.getDom(),f,l).then(p=>(s.painters.push(p),m.selectCurrentPad(o),s.drawNextHisto(r+1,i)))}return a>0&&!s.options.nostack&&(f.$baseh=t.arr[a-1]),s.hdraw_func(s.getDom(),f,l+" same nostat").then(m=>(s.painters.push(m),s.drawNextHisto(r+1,i)))})()}decodeOptions(r){this.options||(this.options={}),Object.assign(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,draw_errors:!1,hopt:""});let i=this.getObject(),s=i.fHistogram||(i.fHists?i.fHists.arr[0]:null)||(i.fStack?i.fStack.arr[0]:null);const e=a=>{if(a.fSumw2&&a.fSumw2.length>0)for(let f=0;f<a.fSumw2.length;++f)if(a.fSumw2[f]>0)return!0;return!1};if(s&&0==s._typename.indexOf(h.clTH2)&&(this.options.ndim=2),2==this.options.ndim&&!r&&(r="lego1"),i.fHists&&!this.options.nostack)for(let a=0;a<i.fHists.arr.length;++a)this.options.has_errors=this.options.has_errors||e(i.fHists.arr[a]);this.options.nhist=i.fHists?i.fHists.arr.length:1;let t=new v.pc(r);this.options.nostack=t.check("NOSTACK"),t.check("STACK")&&(this.options.nostack=!1),this.options.same=t.check("SAME"),t.check("NOCLEAR"),this.options._pfc=t.check("PFC"),this.options._plc=t.check("PLC"),this.options._pmc=t.check("PMC"),this.options.pads=t.check("PADS"),this.options.pads&&(this.options.nostack=!0),this.options.hopt=t.remain();let n=t.check("LEGO");this.options.errors=t.check("E"),!this.options.nostack&&this.options.has_errors&&!n&&!t.check("HIST")&&this.options.hopt.indexOf("E")<0&&(this.options.draw_errors=!0),this.options.horder=this.options.nostack||n}createHistogram(r){let i=r.fHists,s=i?i.arr.length:0;if(!s){let n=(0,h.createHistogram)("TH1I",100);return n.fTitle=r.fTitle,n}let e=i.arr[0],t=(0,h.createHistogram)(1==this.options.ndim?"TH1I":"TH2I",e.fXaxis.fNbins,e.fYaxis.fNbins);t.fName="axis_hist",Object.assign(t.fXaxis,e.fXaxis),2==this.options.ndim&&Object.assign(t.fYaxis,e.fYaxis);for(let n=1;n<s;++n){let a=i.arr[n];t.fXaxis.fLabels||(t.fXaxis.fXmin=Math.min(t.fXaxis.fXmin,a.fXaxis.fXmin),t.fXaxis.fXmax=Math.max(t.fXaxis.fXmax,a.fXaxis.fXmax)),2==this.options.ndim&&!t.fYaxis.fLabels&&(t.fYaxis.fXmin=Math.min(t.fYaxis.fXmin,a.fYaxis.fXmin),t.fYaxis.fXmax=Math.max(t.fYaxis.fXmax,a.fYaxis.fXmax))}return t.fTitle=r.fTitle,t}updateObject(r){if(!this.matchObjectType(r))return!1;let i=this.getObject();if(i.fHists=r.fHists,i.fStack=r.fStack,i.fTitle=r.fTitle,i.fMinimum=r.fMinimum,i.fMaximum=r.fMaximum,this.options.nostack||(this.options.nostack=!this.buildStack(i)),this.firstpainter){let t=r.fHistogram;t||(t=i.fHistogram=this.createHistogram(i));let n=this.getMinMax(this.options.errors||this.options.draw_errors);this.firstpainter.options.minimum=n.min,this.firstpainter.options.maximum=n.max,this.firstpainter._checked_zooming=!1,1==this.options.ndim?(this.firstpainter.ymin=n.min0,this.firstpainter.ymax=n.max0):(this.firstpainter.zmin=n.min0,this.firstpainter.zmax=n.max0),this.firstpainter.updateObject(t)}let s=this.options.nostack?i.fHists:i.fStack,e=s&&s.arr?s.arr.length:0;if(e!==this.painters.length)this.getPadPainter()?.cleanPrimitives(t=>this.painters.indexOf(t)>=0),this.painters=[],this.did_update=!0;else for(let t=0;t<e;++t)this.painters[t].updateObject(s.arr[this.options.horder?t:e-t-1]);return!0}redraw(){if(this.did_update)return delete this.did_update,this.drawNextHisto(0,this.options.pads?this.getPadPainter():null)}static draw(r,i,s){return(0,E.Z)(function*(){if(!i.fHists||!i.fHists.arr)return null;let e=new P(r,i,s),t=null,n=!1;return(0,b.ensureTCanvas)(e,!1).then(()=>{if(e.decodeOptions(s),e.hdraw_func=1==e.options.ndim?A.TH1Painter.draw:N.TH2Painter.draw,e.options.pads)return t=e.getPadPainter(),t.doingDraw()&&t.pad?.fPrimitives&&t.pad.fPrimitives.arr.length>1&&0==t.pad.fPrimitives.arr.indexOf(i)?(n=!0,void console.log("special case with THStack with is already rendered - do nothing")):(t.cleanPrimitives(m=>m!==e),t.divide(e.options.nhist));if(e.options.nostack||(e.options.nostack=!e.buildStack(i)),e.options.same)return;let a=!i.fHistogram;a&&(i.fHistogram=e.createHistogram(i));let f=e.getMinMax(e.options.errors||e.options.draw_errors);return e.hdraw_func(r,i.fHistogram,e.options.hopt+";axis;"+f.hopt).then(m=>{e.addToPadPrimitives(),e.firstpainter=m,m.$secondary="hist",a||(e.$primary=!0)})}).then(()=>n?e:e.drawNextHisto(0,t))})()}}}}]);
//# sourceMappingURL=832.83df34f38ba74f23.js.map