{"version":3,"file":"270.2efaf859b941cbca.js","mappings":"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","names":["drawText","text","this","getObject","pp","getPadPainter","onframe","v7EvalAttr","getFramePainter","clipping","p","getCoordinate","fPos","textFont","v7EvalFont","size","color","align","createG","startTextDrawing","x","y","fText","latex","finishTextDrawing","drawLine","line","p1","fP1","p2","fP2","createv7AttLine","draw_g","append","attr","call","lineatt","func","drawBox","box","createv7AttFill","fillatt","drawMarker","marker","fP","createv7AttMarker","path","markeratt","create","RPalettePainter","RObjectPainter","getHistPalette","pal","fPalette","isFunc","getColor","addMethods","nsREX","drawPalette","drag","palette","contour","getContour","framep","console","log","zmin","zmax","length","rect","getFrameRect","pad_width","getPadWidth","pad_height","getPadHeight","visible","vertical","palette_x","palette_y","palette_width","palette_height","gmin","full_min","gmax","full_max","width","height","changes","v7AttrChange","v7SendAttrChanges","margin","v7EvalLength","Math","round","makeTranslate","g_btns","selectChild","empty","selectAll","remove","style","undefined","z_handle","configureAxis","reverse","i","z0","gr","z1","col","getContourColor","r","property","d3_rgb","darker","toString","isTooltipAllowed","on","d3_select","transition","duration","toFixed","settings","Zooming","unzoom","maxTickSize","promise","drawAxis","isBatchMode","then","ContextMenu","evnt","stopPropagation","preventDefault","createMenu","menu","add","addchk","flag","v7SetAttr","redrawPad","fillAxisContextMenu","show","addDragHandler","minwidth","minheight","no_change_x","no_change_y","redraw","d","zoom_rect","zoom_rect_visible","moving_labels","last_pos","doing_zoom","sel1","sel2","moveRectSel","d3_pointer","node","processLabelsMove","min","max","sz","abs","endRectSel","window","z","invert","z2","zoom","startRectSel","setTimeout","assignHandlers","ZoomWheel","pos","item","analyzeWheelEvent","changed","setAfterDrawHandler","draw","dom","opt","_asyncToGenerator","painter","ensureRCanvas"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["../node_modules/jsroot/modules/draw/v7more.mjs"],"sourcesContent":["import { addMethods, settings, nsREX, isFunc } from '../core.mjs';\nimport { select as d3_select, rgb as d3_rgb, pointer as d3_pointer } from '../d3.mjs';\nimport { makeTranslate } from '../base/BasePainter.mjs';\nimport { RObjectPainter } from '../base/RObjectPainter.mjs';\nimport { addDragHandler } from '../gpad/TFramePainter.mjs';\nimport { ensureRCanvas } from '../gpad/RCanvasPainter.mjs';\nimport { createMenu } from '../gui/menu.mjs';\n\n\n/** @summary draw RText object\n  * @private */\nfunction drawText() {\n   const text = this.getObject(),\n       pp = this.getPadPainter(),\n       onframe = this.v7EvalAttr('onFrame', false) ? pp.getFramePainter() : null,\n       clipping = onframe ? this.v7EvalAttr('clipping', false) : false,\n       p = pp.getCoordinate(text.fPos, onframe),\n       textFont = this.v7EvalFont('text', { size: 12, color: 'black', align: 22 });\n\n   this.createG(clipping ? 'main_layer' : (onframe ? 'upper_layer' : false));\n\n   this.startTextDrawing(textFont, 'font');\n\n   this.drawText({ x: p.x, y: p.y, text: text.fText, latex: 1 });\n\n   return this.finishTextDrawing();\n}\n\n/** @summary draw RLine object\n  * @private */\nfunction drawLine() {\n    const line = this.getObject(),\n        pp = this.getPadPainter(),\n        onframe = this.v7EvalAttr('onFrame', false) ? pp.getFramePainter() : null,\n        clipping = onframe ? this.v7EvalAttr('clipping', false) : false,\n        p1 = pp.getCoordinate(line.fP1, onframe),\n        p2 = pp.getCoordinate(line.fP2, onframe);\n\n    this.createG(clipping ? 'main_layer' : (onframe ? 'upper_layer' : false));\n\n    this.createv7AttLine();\n\n    this.draw_g\n        .append('svg:path')\n        .attr('d', `M${p1.x},${p1.y}L${p2.x},${p2.y}`)\n        .call(this.lineatt.func);\n}\n\n/** @summary draw RBox object\n  * @private */\nfunction drawBox() {\n   const box = this.getObject(),\n       pp = this.getPadPainter(),\n       onframe = this.v7EvalAttr('onFrame', false) ? pp.getFramePainter() : null,\n       clipping = onframe ? this.v7EvalAttr('clipping', false) : false,\n       p1 = pp.getCoordinate(box.fP1, onframe),\n       p2 = pp.getCoordinate(box.fP2, onframe);\n\n   this.createG(clipping ? 'main_layer' : (onframe ? 'upper_layer' : false));\n\n   this.createv7AttLine('border_');\n\n   this.createv7AttFill();\n\n   this.draw_g\n       .append('svg:path')\n       .attr('d', `M${p1.x},${p1.y}H${p2.x}V${p2.y}H${p1.x}Z`)\n       .call(this.lineatt.func)\n       .call(this.fillatt.func);\n}\n\n/** @summary draw RMarker object\n  * @private */\nfunction drawMarker() {\n    const marker = this.getObject(),\n        pp = this.getPadPainter(),\n        onframe = this.v7EvalAttr('onFrame', false) ? pp.getFramePainter() : null,\n        clipping = onframe ? this.v7EvalAttr('clipping', false) : false,\n        p = pp.getCoordinate(marker.fP, onframe);\n\n    this.createG(clipping ? 'main_layer' : (onframe ? 'upper_layer' : false));\n\n    this.createv7AttMarker();\n\n    const path = this.markeratt.create(p.x, p.y);\n\n    if (path) {\n       this.draw_g.append('svg:path')\n                  .attr('d', path)\n                  .call(this.markeratt.func);\n    }\n}\n\n/** @summary painter for RPalette\n *\n * @private\n */\n\nclass RPalettePainter extends RObjectPainter {\n\n   /** @summary get palette */\n   getHistPalette() {\n      const pal = this.getObject()?.fPalette;\n\n      if (pal && !isFunc(pal.getColor))\n         addMethods(pal, `${nsREX}RPalette`);\n\n      return pal;\n   }\n\n   /** @summary Draw palette */\n   drawPalette(drag) {\n      const palette = this.getHistPalette(),\n            contour = palette.getContour(),\n            framep = this.getFramePainter();\n\n      if (!contour)\n         return console.log('no contour - no palette');\n\n      // frame painter must  be there\n      if (!framep)\n         return console.log('no frame painter - no palette');\n\n      const zmin = contour[0],\n            zmax = contour[contour.length-1],\n            rect = framep.getFrameRect(),\n            pad_width = this.getPadPainter().getPadWidth(),\n            pad_height = this.getPadPainter().getPadHeight(),\n            visible = this.v7EvalAttr('visible', true),\n            vertical = this.v7EvalAttr('vertical', true);\n      let gmin = palette.full_min,\n          gmax = palette.full_max,\n          palette_x, palette_y, palette_width, palette_height;\n\n      if (drag) {\n         palette_width = drag.width;\n         palette_height = drag.height;\n\n         const changes = {};\n         if (vertical) {\n            this.v7AttrChange(changes, 'margin', (drag.x - rect.x - rect.width) / pad_width);\n            this.v7AttrChange(changes, 'width', palette_width / pad_width);\n         } else {\n            this.v7AttrChange(changes, 'margin', (drag.y - rect.y - rect.height) / pad_width);\n            this.v7AttrChange(changes, 'width', palette_height / pad_height);\n         }\n         this.v7SendAttrChanges(changes, false); // do not invoke canvas update on the server\n      } else {\n          if (vertical) {\n            const margin = this.v7EvalLength('margin', pad_width, 0.02);\n            palette_x = Math.round(rect.x + rect.width + margin);\n            palette_width = this.v7EvalLength('width', pad_width, 0.05);\n            palette_y = rect.y;\n            palette_height = rect.height;\n          } else {\n            const margin = this.v7EvalLength('margin', pad_height, 0.02);\n            palette_x = rect.x;\n            palette_width = rect.width;\n            palette_y = Math.round(rect.y + rect.height + margin);\n            palette_height = this.v7EvalLength('width', pad_height, 0.05);\n          }\n\n          // x,y,width,height attributes used for drag functionality\n          makeTranslate(this.draw_g, palette_x, palette_y);\n      }\n\n      let g_btns = this.draw_g.selectChild('.colbtns');\n      if (g_btns.empty())\n         g_btns = this.draw_g.append('svg:g').attr('class', 'colbtns');\n      else\n         g_btns.selectAll('*').remove();\n\n      if (!visible) return;\n\n      g_btns.append('svg:path')\n          .attr('d', `M0,0H${palette_width}V${palette_height}H0Z`)\n          .style('stroke', 'black')\n          .style('fill', 'none');\n\n      if ((gmin === undefined) || (gmax === undefined)) { gmin = zmin; gmax = zmax; }\n\n      if (vertical)\n         framep.z_handle.configureAxis('zaxis', gmin, gmax, zmin, zmax, true, [palette_height, 0], -palette_height, { reverse: false });\n      else\n         framep.z_handle.configureAxis('zaxis', gmin, gmax, zmin, zmax, false, [0, palette_width], palette_width, { reverse: false });\n\n      for (let i = 0; i < contour.length-1; ++i) {\n         const z0 = Math.round(framep.z_handle.gr(contour[i])),\n             z1 = Math.round(framep.z_handle.gr(contour[i+1])),\n             col = palette.getContourColor((contour[i]+contour[i+1])/2),\n\n          r = g_btns.append('svg:path')\n                     .attr('d', vertical ? `M0,${z1}H${palette_width}V${z0}H0Z` : `M${z0},0V${palette_height}H${z1}V0Z`)\n                     .style('fill', col)\n                     .style('stroke', col)\n                     .property('fill0', col)\n                     .property('fill1', d3_rgb(col).darker(0.5).toString());\n\n         if (this.isTooltipAllowed()) {\n            r.on('mouseover', function() {\n               d3_select(this).transition().duration(100).style('fill', d3_select(this).property('fill1'));\n            }).on('mouseout', function() {\n               d3_select(this).transition().duration(100).style('fill', d3_select(this).property('fill0'));\n            }).append('svg:title').text(contour[i].toFixed(2) + ' - ' + contour[i+1].toFixed(2));\n         }\n\n         if (settings.Zooming)\n            r.on('dblclick', () => framep.unzoom('z'));\n      }\n\n      framep.z_handle.maxTickSize = Math.round(palette_width*0.3);\n\n      const promise = framep.z_handle.drawAxis(this.draw_g, makeTranslate(vertical ? palette_width : 0, palette_height), vertical ? -1 : 1);\n\n      if (this.isBatchMode() || drag)\n         return promise;\n\n      return promise.then(() => {\n         if (settings.ContextMenu) {\n            this.draw_g.on('contextmenu', evnt => {\n               evnt.stopPropagation(); // disable main context menu\n               evnt.preventDefault();  // disable browser context menu\n               createMenu(evnt, this).then(menu => {\n                  menu.add('header:Palette');\n                  menu.addchk(vertical, 'Vertical', flag => { this.v7SetAttr('vertical', flag); this.redrawPad(); });\n                  framep.z_handle.fillAxisContextMenu(menu, 'z');\n                  menu.show();\n               });\n            });\n         }\n\n         addDragHandler(this, { x: palette_x, y: palette_y, width: palette_width, height: palette_height,\n                                minwidth: 20, minheight: 20, no_change_x: !vertical, no_change_y: vertical, redraw: d => this.drawPalette(d) });\n\n         if (!settings.Zooming) return;\n\n         let doing_zoom = false, sel1 = 0, sel2 = 0, zoom_rect, zoom_rect_visible, moving_labels, last_pos;\n\n         const moveRectSel = evnt => {\n            if (!doing_zoom) return;\n            evnt.preventDefault();\n\n            last_pos = d3_pointer(evnt, this.draw_g.node());\n\n            if (moving_labels)\n               return framep.z_handle.processLabelsMove('move', last_pos);\n\n            if (vertical)\n               sel2 = Math.min(Math.max(last_pos[1], 0), palette_height);\n            else\n               sel2 = Math.min(Math.max(last_pos[0], 0), palette_width);\n\n            const sz = Math.abs(sel2-sel1);\n\n            if (!zoom_rect_visible && (sz > 1)) {\n               zoom_rect.style('display', null);\n               zoom_rect_visible = true;\n            }\n\n            if (vertical)\n               zoom_rect.attr('y', Math.min(sel1, sel2)).attr('height', sz);\n            else\n               zoom_rect.attr('x', Math.min(sel1, sel2)).attr('width', sz);\n         }, endRectSel = evnt => {\n            if (!doing_zoom) return;\n\n            evnt.preventDefault();\n            d3_select(window).on('mousemove.colzoomRect', null)\n                             .on('mouseup.colzoomRect', null);\n            zoom_rect.remove();\n            zoom_rect = null;\n            doing_zoom = false;\n\n            if (moving_labels)\n               framep.z_handle.processLabelsMove('stop', last_pos);\n             else {\n               const z = framep.z_handle.func, z1 = z.invert(sel1), z2 = z.invert(sel2);\n               this.getFramePainter().zoom('z', Math.min(z1, z2), Math.max(z1, z2));\n            }\n         }, startRectSel = evnt => {\n            // ignore when touch selection is activated\n            if (doing_zoom) return;\n            doing_zoom = true;\n\n            evnt.preventDefault();\n            evnt.stopPropagation();\n\n            last_pos = d3_pointer(evnt, this.draw_g.node());\n            sel1 = sel2 = last_pos[vertical ? 1 : 0];\n            zoom_rect_visible = false;\n            moving_labels = false;\n            zoom_rect = g_btns\n                 .append('svg:rect')\n                 .attr('class', 'zoom')\n                 .attr('id', 'colzoomRect')\n                 .style('display', 'none');\n            if (vertical)\n               zoom_rect.attr('x', 0).attr('width', palette_width).attr('y', sel1).attr('height', 1);\n            else\n               zoom_rect.attr('x', sel1).attr('width', 1).attr('y', 0).attr('height', palette_height);\n\n            d3_select(window).on('mousemove.colzoomRect', moveRectSel)\n                             .on('mouseup.colzoomRect', endRectSel, true);\n\n            setTimeout(() => {\n               if (!zoom_rect_visible && doing_zoom)\n                  moving_labels = framep.z_handle.processLabelsMove('start', last_pos);\n            }, 500);\n         }, assignHandlers = () => {\n            this.draw_g.selectAll('.axis_zoom, .axis_labels')\n                       .on('mousedown', startRectSel)\n                       .on('dblclick', () => framep.unzoom('z'));\n\n            if (settings.ZoomWheel) {\n               this.draw_g.on('wheel', evnt => {\n                  evnt.stopPropagation();\n                  evnt.preventDefault();\n\n                  const pos = d3_pointer(evnt, this.draw_g.node()),\n                      coord = vertical ? (1 - pos[1] / palette_height) : pos[0] / palette_width,\n\n                   item = framep.z_handle.analyzeWheelEvent(evnt, coord);\n                  if (item.changed)\n                     framep.zoom('z', item.min, item.max);\n               });\n            }\n         };\n\n         framep.z_handle.setAfterDrawHandler(assignHandlers);\n\n         assignHandlers();\n      });\n   }\n\n   /** @summary draw RPalette object */\n   static async draw(dom, palette, opt) {\n      const painter = new RPalettePainter(dom, palette, opt, 'palette');\n      return ensureRCanvas(painter, false).then(() => {\n         painter.createG(); // just create container, real drawing will be done by histogram\n         return painter;\n      });\n   }\n\n} // class RPalettePainter\n\nexport { RPalettePainter, drawText, drawLine, drawBox, drawMarker };\n"],"x_google_ignoreList":[0]}