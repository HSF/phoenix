"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[825],{825:(R,G,k)=>{k.r(G),k.d(G,{TGraphPainter:()=>F,clTGraphAsymmErrors:()=>B});var T=k(5774),_=k(4186),C=k(3324),w=k(165),X=k(2481),Y=k(2105),N=k(1194),A=k(139),D=k(9606),H=k(9646);const $=(0,_.BIT)(18),S="TGraphErrors",B="TGraphAsymmErrors",z="TGraphBentErrors",O="TGraphMultiErrors";class F extends X.JW{constructor(t,i){super(t,i),this.axes_draw=!1,this.bins=null,this.xmin=this.ymin=this.xmax=this.ymax=0,this.wheel_zoomy=!0,this.is_bent=i._typename===z,this.has_errors=i._typename===S||i._typename===O||i._typename===B||this.is_bent||i._typename.match(/^RooHist/)}getGraph(){return this.getObject()}getHistogram(){return this.getObject()?.fHistogram}setHistogram(t){const i=this.getObject();i&&(i.fHistogram=t)}redraw(){var t=this;return(0,T.A)(function*(){let i=Promise.resolve(!0);if(t.$redraw_hist){delete t.$redraw_hist;const e=t.getMainPainter();e?.isSecondary(t)&&t.axes_draw&&(i=e.redraw())}return i.then(()=>t.drawGraph()).then(()=>{const e=t._funcHandler?.drawNext(0)??t;return delete t._funcHandler,e})})()}cleanup(){delete this.interactive_bin,delete this.bins,super.cleanup()}get_gme(){const t=this.getGraph();return t?._typename===O?t:null}decodeOptions(t,i){(0,_.isStr)(t)&&0===t.indexOf("same ")&&(t=t.slice(5));const e=this.getGraph(),a=!!this.get_gme(),n=i?!!this.getMainPainter():!this.axes_draw;let h=[];this.options||(this.options={});const x=(l,c)=>{Object.assign(c,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),a&&l.check("S=",!0)&&(c.ScaleErrX=l.partAsFloat()),l.check("L")&&(c.Line=1),l.check("F")&&(c.Fill=1),l.check("CC")&&(c.Curve=2),l.check("C")&&(c.Curve=1),l.check("*")&&(c.Mark=103),l.check("P0")&&(c.Mark=104),l.check("P")&&(c.Mark=1),l.check("B")&&(c.Bar=1,c.Errors=0),l.check("Z")&&(c.Errors=1,c.Ends=0),l.check("||")&&(c.Errors=1,c.MainError=0,c.Ends=1),l.check("[]")&&(c.Errors=1,c.MainError=0,c.Ends=2),l.check("|>")&&(c.Errors=1,c.Ends=3),l.check(">")&&(c.Errors=1,c.Ends=4),l.check("0")&&(c.Mark=1,c.Errors=1,c.OutRange=1),l.check("1")&&1===c.Bar&&(c.Bar=2),l.check("2")&&(c.Rect=1,c.Errors=0),l.check("3")&&(c.EF=1,c.Errors=0),l.check("4")&&(c.EF=2,c.Errors=0),l.check("5")&&(c.Rect=2,c.Errors=0),l.check("X")&&(c.Errors=0)};Object.assign(this.options,{Axis:"",NoOpt:0,PadStats:!1,PadPalette:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),a&&t&&(t.indexOf(";")>0?(h=t.split(";"),t=h.shift()):t.indexOf("_")>0&&(h=t.split("_"),t=h.shift()));const r=this.options;let m=new w.nC(t),g="";if(N.c.forEach(l=>{m.check(l)&&(g+=";"+l)}),m.check("XAXIS_",!0)&&(g+=";XAXIS_"+m.part),m.check("YAXIS_",!0)&&(g+=";YAXIS_"+m.part),m.empty()&&(r.original=n?"lp":"alp",m=new w.nC(r.original)),m.check("NOOPT")&&(r.NoOpt=1),m.check("POS3D_",!0)&&(r.pos3d=m.partAsInt()-.5),m.check("PFC")&&!r._pfc&&(r._pfc=2),m.check("PLC")&&!r._plc&&(r._plc=2),m.check("PMC")&&!r._pmc&&(r._pmc=2),m.check("A")&&(r.Axis=m.check("I")?"A;":" "),m.check("X+")&&(r.Axis+="X+",r.second_x=n),m.check("Y+")&&(r.Axis+="Y+",r.second_y=n),m.check("RX")&&(r.Axis+="RX"),m.check("RY")&&(r.Axis+="RY"),a&&(r.blocks=[],r.skip_errors_x0=r.skip_errors_y0=!1,m.check("X0")&&(r.skip_errors_x0=!0),m.check("Y0")&&(r.skip_errors_y0=!0)),x(m,r),a&&m.check("S")&&(r.individual_styles=!0),void 0===r.Errors&&(r.Errors=!this.has_errors||a&&h.length?0:1),1===r.Mark&&1===e.fMarkerStyle&&(r.Mark=101),r.Line+r.Fill+r.Curve+r.Mark+r.Bar+r.EF+r.Rect+r.Errors===0&&m.empty()&&(r.Line=1),this.matchObjectType(S)){const l=e.fEX.length;let c=0;for(let s=0;s<l;++s)c=Math.max(c,e.fEX[s],e.fEY[s]);c<1e-100&&(r.Errors=0)}if(this._cutg=this.matchObjectType(_.clTCutG),this._cutg_lastsame=this._cutg&&e.fNpoints>3&&e.fX[0]===e.fX[e.fNpoints-1]&&e.fY[0]===e.fY[e.fNpoints-1],!r.Axis){const l=this.getPadPainter()?.getRootPad(!0);(!l||l?.fPrimitives?.arr[0]===this.getObject())&&(r.Axis=" ")}r.Axis+=g;for(let l=0;l<h.length;++l){const s={};x(new w.nC(h[l]),s),s.skip_errors_x0=r.skip_errors_x0,s.skip_errors_y0=r.skip_errors_y0,r.blocks.push(s)}}extractGmeErrors(t){if(!this.bins)return;const i=this.getGraph();this.bins.forEach(e=>{e.eylow=i.fEyL[t][e.indx],e.eyhigh=i.fEyH[t][e.indx]})}createBins(){const t=this.getGraph();if(!t)return;let i=0,e=t.fNpoints;this._cutg&&this._cutg_lastsame&&e--,t._typename===S?i=1:t._typename===O?i=2:(t._typename===B||t._typename===z||t._typename.match(/^RooHist/))&&(i=3),this.bins=new Array(e);for(let a=0;a<e;++a){const n=this.bins[a]={x:t.fX[a],y:t.fY[a],indx:a};switch(i){case 1:n.exlow=n.exhigh=t.fEX[a],n.eylow=n.eyhigh=t.fEY[a];break;case 2:n.exlow=t.fExL[a],n.exhigh=t.fExH[a],n.eylow=t.fEyL[0][a],n.eyhigh=t.fEyH[0][a];break;case 3:n.exlow=t.fEXlow[a],n.exhigh=t.fEXhigh[a],n.eylow=t.fEYlow[a],n.eyhigh=t.fEYhigh[a]}0===a&&(this.xmin=this.xmax=n.x,this.ymin=this.ymax=n.y),i>0?(this.xmin=Math.min(this.xmin,n.x-n.exlow,n.x+n.exhigh),this.xmax=Math.max(this.xmax,n.x-n.exlow,n.x+n.exhigh),this.ymin=Math.min(this.ymin,n.y-n.eylow,n.y+n.eyhigh),this.ymax=Math.max(this.ymax,n.y-n.eylow,n.y+n.eyhigh)):(this.xmin=Math.min(this.xmin,n.x),this.xmax=Math.max(this.xmax,n.x),this.ymin=Math.min(this.ymin,n.y),this.ymax=Math.max(this.ymax,n.y))}}getHistRangeMargin(){return.1}createHistogram(t,i){!t&&!i&&(t=i=!0);const e=this.getGraph(),a=this.xmin,n=this.getHistRangeMargin();let h=this.xmax,x=this.ymin,r=this.ymax;a>=h&&(h=a+1),x>=r&&(r=x+1);const m=(h-a)*n,g=(r-x)*n;let l=a-m,c=h+m,s=x-g,o=r+g;if(!this._not_adjust_hrange){const u=this.getPadPainter()?.getPadLog("x");l<0&&a>=0&&(l=u?a*(1-n):0),c>0&&h<=0&&(c=u?(1+n)*h:0)}const y=s,d=o;let f=this.getHistogram();return f?f.fMaximum!==_.kNoZoom&&f.fMinimum!==_.kNoZoom&&(s=f.fMinimum,o=f.fMaximum):(f=this._need_2dhist?(0,_.createHistogram)(_.clTH2I,30,30):(0,_.createHistogram)(_.clTH1I,100),f.fName=e.fName+"_h",f.fBits|=_.kNoStats,this._own_histogram=!0,this.setHistogram(f)),e.fMinimum!==_.kNoZoom&&(s=x=e.fMinimum),e.fMaximum!==_.kNoZoom&&(o=e.fMaximum),s<0&&x>=0&&(s=(1-n)*x),(0,_.setHistogramTitle)(f,this.getObject().fTitle),t&&!f.fXaxis.fLabels&&(f.fXaxis.fXmin=l,f.fXaxis.fXmax=c),i&&!f.fYaxis.fLabels&&(f.fYaxis.fXmin=Math.min(y,s),f.fYaxis.fXmax=Math.max(d,o),this._need_2dhist||(f.fMinimum=s,f.fMaximum=o)),f}unzoomUserRange(t,i){const e=this.getGraph();if(this._own_histogram||!e)return!1;const a=this.getHistogram();return i=i&&a&&(a.fYaxis.fXmin>this.ymin||a.fYaxis.fXmax<this.ymax),!(!(t=t&&a&&(a.fXaxis.fXmin>this.xmin||a.fXaxis.fXmax<this.xmax))&&!i||(this.createHistogram(t,i),this.getMainPainter()?.extractAxesProperties(1),0))}canOptimize(){return _.settings.OptimizeDraw>0&&!this.options.NoOpt}optimizeBins(t,i){if(this.bins.length<30&&!i)return this.bins;let e=null;if((0,_.isFunc)(i))for(let h=0;h<this.bins.length;++h)i(this.bins[h],h)?e||(e=0===h?[]:this.bins.slice(0,h)):e&&e.push(this.bins[h]);if(e||(e=this.bins),t||(t=5e5),e.length<t||!this.canOptimize())return e;let a=Math.floor(e.length/t);a<2&&(a=2);const n=[];for(let h=0;h<e.length;h+=a)n.push(e[h]);return n}needDrawFunc(t,i){return i._typename===_.clTPaveStats?"stats"!==i.fName||!t.TestBit(_.kNoStats):i._typename!==_.clTF1&&i._typename!==_.clTF2||!i.TestBit((0,_.BIT)(9))}getTooltips(t){const e=[],a=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),n=this.get_gme();if(e.push(this.getObjectHint()),t&&a)if(void 0!==t.indx&&e.push("p = "+t.indx),e.push("x = "+a.axisAsText("x",t.x),"y = "+a.axisAsText("y",t.y)),n?e.push("error x = -"+a.axisAsText("x",n.fExL[t.indx])+"/+"+a.axisAsText("x",n.fExH[t.indx])):this.options.Errors&&a.x_handle.kind===X.UV&&(t.exlow||t.exhigh)&&e.push("error x = -"+a.axisAsText("x",t.exlow)+"/+"+a.axisAsText("x",t.exhigh)),n)for(let h=0;h<n.fNYErrors;++h)e.push(`error y${h} = -${a.axisAsText("y",n.fEyL[h][t.indx])}/+${a.axisAsText("y",n.fEyH[h][t.indx])}`);else(this.options.Errors||this.options.EF>0)&&a.y_handle.kind===X.UV&&(t.eylow||t.eyhigh)&&e.push("error y = -"+a.axisAsText("y",t.eylow)+"/+"+a.axisAsText("y",t.eyhigh));return e}get_main(){let t=this.getFramePainter();if(t?.grx&&t?.gry)return t;const i=this.getPadPainter(),e=i?.getPadRect()||{width:800,height:600};return t={pad_layer:!0,pad:i?.getRootPad(!0)??(0,_.create)(_.clTPad),pw:e.width,ph:e.height,fX1NDC:.1,fX2NDC:.9,fY1NDC:.1,fY2NDC:.9,getFrameWidth(){return this.pw},getFrameHeight(){return this.ph},grx(a){return(a=this.pad.fLogx?a>0?Math.log10(a):this.pad.fUxmin:(a-this.pad.fX1)/(this.pad.fX2-this.pad.fX1))*this.pw},gry(a){return(1-(a=this.pad.fLogv??this.pad.fLogy?a>0?Math.log10(a):this.pad.fUymin:(a-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)))*this.ph},revertAxis(a,n){return"x"===a?n/this.pw*(this.pad.fX2-this.pad.fX1)+this.pad.fX1:"y"===a?(1-n/this.ph)*(this.pad.fY2-this.pad.fY1)+this.pad.fY1:n},getGrFuncs(){return this}},t.pad?t:null}appendExclusion(t,i,e,a){const n=[];for(let x=e.length-1;x>=0;--x){const r=e[x],m=Math.sqrt(r.dgrx**2+r.dgry**2);m>1e-10&&(r.grx+=a*r.dgry/m,r.gry-=a*r.dgrx/m),n.push(r)}const h=(0,w.Mw)(n,{cmd:"L",line:!t});this.draw_g.append("svg:path").attr("d",i+h+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,i,e,a,n,h,x,r){const m=this.getGraph();if(!m?.fNpoints)return;let g=0,l=null;if(r&&h.excl_side&&(g=h.excl_width,h.width>0&&!i.Line&&!i.Curve&&(i.Line=1)),i.EF){l=this.optimizeBins(i.EF>1?2e4:0);for(let f=0;f<l.length;++f){const u=l[f];u.grx=t.grx(u.x),u.gry=t.gry(u.y-u.eylow)}const s=(0,w.Mw)(l,{line:i.EF<2,qubic:!0}),o=[];for(let f=l.length-1;f>=0;--f){const u=l[f];u.gry=t.gry(u.y+u.eyhigh),o.push(u)}const y=(0,w.Mw)(o,{line:i.EF<2,cmd:"L",qubic:!0}),d=e.append("svg:path").attr("d",s+y+"Z").call(x.func);x.empty()&&x.colorindx&&d.style("stroke",this.getColor(x.colorindx)),r&&(this.draw_kind="lines")}if(i.Line||i.Fill){let s="";this._cutg&&(s="Z",i.original||(i.Fill=1)),i.Fill&&(s="Z",g=0),l||(l=this.optimizeBins(0));for(let d=0;d<l.length;++d){const f=l[d];f.grx=t.grx(f.x),f.gry=t.gry(f.y)}const o=(0,w.Mw)(l,{line:!0,calc:g});g&&this.appendExclusion(!1,o,l,g);const y=e.append("svg:path").attr("d",o+s);i.Line&&y.call(h.func),i.Fill?y.call(x.func):y.style("fill","none"),r&&(this.draw_kind="lines")}if(i.Curve){let s=l;if("lines"!==this.draw_kind||!s||1===i.Curve&&s.length>2e4){s=this.optimizeBins(1===i.Curve?2e4:0);for(let y=0;y<s.length;++y){const d=s[y];d.grx=t.grx(d.x),d.gry=t.gry(d.y)}}const o=(0,w.Mw)(s,{qubic:!g});g&&this.appendExclusion(!0,o,s,g),e.append("svg:path").attr("d",o).call(h.func).style("fill","none"),r&&(this.draw_kind="lines")}let c=null;if((i.Errors||i.Rect||i.Bar)&&(l=this.optimizeBins(5e3,(s,o)=>{const y=t.grx(s.x);if(!i.Bar&&(y<0||y>a))return!0;const d=t.gry(s.y);return!i.Bar&&!i.OutRange&&(d<0||d>n)||(s.grx1=Math.round(y),s.gry1=Math.round(d),this.has_errors&&(s.grx0=Math.round(t.grx(s.x-i.ScaleErrX*s.exlow)-y),s.grx2=Math.round(t.grx(s.x+i.ScaleErrX*s.exhigh)-y),s.gry0=Math.round(t.gry(s.y-s.eylow)-d),s.gry2=Math.round(t.gry(s.y+s.eyhigh)-d),this.is_bent?(s.grdx0=Math.round(t.gry(s.y+m.fEXlowd[o])-d),s.grdx2=Math.round(t.gry(s.y+m.fEXhighd[o])-d),s.grdy0=Math.round(t.grx(s.x+m.fEYlowd[o])-y),s.grdy2=Math.round(t.grx(s.x+m.fEYhighd[o])-y)):s.grdx0=s.grdx2=s.grdy0=s.grdy2=0),!1)}),r&&(this.draw_kind="nodes"),c=e.selectAll(".grpoint").data(l).enter().append("svg:g").attr("class","grpoint").attr("transform",s=>(0,w.bk)(s.grx1,s.gry1))),i.Bar){let s=0,o=0;for(let f=0;f<l.length;++f)0===f?s=o=l[f].grx1:(s=Math.min(s,l[f].grx1),o=Math.max(o,l[f].grx1));if(1===l.length)l[0].width=a/4;else for(let f=0;f<l.length;++f)l[f].width=(o-s)/l.length*_.gStyle.fBarWidth;const y=Math.round(t.gry(0));let d=x;if(r){const f=this.getFramePainter(),u=f?.fillatt?.empty()?-1:f.fillatt.getFillColor();u===x.getFillColor()&&(d=this.createAttFill({color:"white"===u?A.tA:A.$q,pattern:1001,std:!1}))}c.append("svg:path").attr("d",f=>{f.bar=!0;const u=f.width>1?Math.round(-f.width/2):0,M=f.width>1?Math.round(f.width):1;return`M${u},${1!==i.Bar?0:f.gry1>y?y-f.gry1:0}h${M}v${1!==i.Bar?n>f.gry1?n-f.gry1:0:Math.abs(y-f.gry1)}h${-M}z`}).call(d.func)}if(i.Rect&&c.filter(s=>s.exlow>0&&s.exhigh>0&&s.eylow>0&&s.eyhigh>0).append("svg:path").attr("d",s=>(s.rect=!0,`M${s.grx0},${s.gry0}H${s.grx2}V${s.gry2}H${s.grx0}Z`)).call(x.func).call(2===i.Rect?h.func:()=>{}),this.error_size=0,i.Errors){let s=h.width+_.gStyle.fEndErrorSize,o=0;const y=i.Ends?`m0,${s}v${-2*s}`:"",d=i.Ends?`m${s},0h${-2*s}`:"";let f=y,u=y,M=d,b=d;const E=(p,P)=>{if(!i.MainError)return`M${p},${P}`;const L="M0,0";return p?L+(P?`L${p},${P}`:`H${p}`):P?L+`V${P}`:L};switch(i.Ends){case 2:o=Math.max(h.width+1,Math.round(.66*s)),f=`m${o},${s}h${-o}v${-2*s}h${o}`,u=`m${-o},${s}h${o}v${-2*s}h${-o}`,M=`m${-s},${o}v${-o}h${2*s}v${o}`,b=`m${-s},${-o}v${o}h${2*s}v${-o}`;break;case 3:s=Math.max(s,Math.round(8*m.fMarkerSize*.66)),o=Math.max(h.width+1,Math.round(.66*s)),f=`l${o},${s}v${-2*s}l${-o},${s}`,u=`l${-o},${s}v${-2*s}l${o},${s}`,M=`l${-s},${o}h${2*s}l${-s},${-o}`,b=`l${-s},${-o}h${2*s}l${-s},${o}`;break;case 4:s=Math.max(s,Math.round(8*m.fMarkerSize*.66)),o=Math.max(h.width+1,Math.round(.66*s)),f=`l${o},${s}m0,${-2*s}l${-o},${s}`,u=`l${-o},${s}m0,${-2*s}l${o},${s}`,M=`l${-s},${o}m${2*s},0l${-s},${-o}`,b=`l${-s},${-o}m${2*s},0l${-s},${o}`}this.error_size=s,s=Math.floor((h.width-1)/2);let v=c.filter(p=>p.exlow>0||p.exhigh>0||p.eylow>0||p.eyhigh>0);(i.skip_errors_x0||i.skip_errors_y0)&&(v=v.filter(p=>!(0===p.x&&i.skip_errors_x0||0===p.y&&i.skip_errors_y0))),!this.isBatchMode()&&_.settings.Tooltip&&r&&v.append("svg:path").style("fill","none").style("pointer-events","visibleFill").attr("d",p=>`M${p.grx0},${p.gry0}h${p.grx2-p.grx0}v${p.gry2-p.gry0}h${p.grx0-p.grx2}z`),v.append("svg:path").call(h.func).style("fill","none").attr("d",p=>(p.error=!0,(p.exlow>0?E(p.grx0+s,p.grdx0)+f:"")+(p.exhigh>0?E(p.grx2-s,p.grdx2)+u:"")+(p.eylow>0?E(p.grdy0,p.gry0-s)+b:"")+(p.eyhigh>0?E(p.grdy2,p.gry2+s)+M:"")))}if(i.Mark){this.createAttMarker({attr:m,style:i.Mark-100}),this.marker_size=this.markeratt.getFullSize(),this.markeratt.resetPos();const s=!this.isBatchMode()&&_.settings.Tooltip&&(!this.markeratt.fill||this.marker_size<7)&&!c&&r,o=Math.max(5,Math.round(.7*this.marker_size)),y=1e6/(this.markeratt.getMarkerLength()+7);let f,u,M,d="",b="",E=1;l?this.canOptimize()&&l.length>1.5*y&&(E=Math.min(2,Math.round(l.length/y))):l=this.optimizeBins(y);for(let v=0;v<l.length;v+=E)f=l[v],u=t.grx(f.x),u>-this.marker_size&&u<a+this.marker_size&&(M=t.gry(f.y),M>-this.marker_size&&M<n+this.marker_size&&(d+=this.markeratt.create(u,M),s&&(b+=`M${u-o},${M-o}h${2*o}v${2*o}h${-2*o}z`)));d&&(e.append("svg:path").attr("d",d).call(this.markeratt.func),null===c&&"none"===this.draw_kind&&r&&(this.draw_kind=101===i.Mark?"path":"mark")),s&&b&&e.append("svg:path").attr("d",b).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,i){const e=Math.max(t.scale_xmin,i.fXq1),a=Math.min(t.scale_xmax,i.fXq2),n=Math.max(t.scale_ymin,i.fYq1),h=Math.min(t.scale_ymax,i.fYq2),x=(s,o,y,d)=>`M${t.grx(s)},${t.gry(o)}L${t.grx(y)},${t.gry(d)}`,r=(i.fYq2-i.fYq1)*(t.scale_xmin-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1,m=(i.fYq2-i.fYq1)*(t.scale_xmax-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1;let g="";g=r<t.scale_ymin?x((i.fXq2-i.fXq1)*(t.scale_ymin-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymin,e,n):x(t.scale_xmin,r,e,n),g+=m>t.scale_ymax?x(a,h,(i.fXq2-i.fXq1)*(t.scale_ymax-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymax):x(a,h,t.scale_xmax,m);const l=this.createAttLine({style:1,width:1,color:A.tA,std:!1}),c=this.createAttLine({style:2,width:1,color:A.tA,std:!1});this.draw_g.append("path").attr("d",x(e,n,a,h)).call(l.func).style("fill","none"),this.draw_g.append("path").attr("d",g).call(c.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}createGraphDrawAttributes(t){const i=this.getGraph(),e=this.options;if(e._pfc>1||e._plc>1||e._pmc>1){const a=this.getPadPainter();if((0,_.isFunc)(a?.getAutoColor)){const n=a.getAutoColor(i.$num_graphs);this._auto_exec="",e._pfc>1&&(e._pfc=1,i.fFillColor=n,this._auto_exec+=`SetFillColor(${n});;`,delete this.fillatt),e._plc>1&&(e._plc=1,i.fLineColor=n,this._auto_exec+=`SetLineColor(${n});;`,delete this.lineatt),e._pmc>1&&(e._pmc=1,i.fMarkerColor=n,this._auto_exec+=`SetMarkerColor(${n});;`,delete this.markeratt)}}t?this.deleteAttr():(this.createAttLine({attr:i,can_excl:!0}),this.createAttFill({attr:i}))}drawGraph(){const t=this.get_main(),i=this.getGraph();if(!t)return;if(this.options.pos3d)return this.drawBins3D(t,i);const e=!!this.get_gme(),a=t.getGrFuncs(this.options.second_x,this.options.second_y),n=t.getFrameWidth(),h=t.getFrameHeight();this.createG(!t.pad_layer),this.createGraphDrawAttributes(),this.fillatt.used=!1,this.draw_kind="none",this.marker_size=0;const x=e?this.draw_g.append("svg:g"):this.draw_g;if(this.drawBins(a,this.options,x,n,h,this.lineatt,this.fillatt,!0),"TGraphQQ"===i._typename&&this.appendQQ(a,i),e){for(let r=0;r<i.fNYErrors;++r){let m=this.lineatt,g=this.fillatt;this.options.individual_styles&&(m=this.createAttLine({attr:i.fAttLine[r],std:!1}),g=this.createAttFill({attr:i.fAttFill[r],std:!1}));const l=this.draw_g.append("svg:g"),c=r<this.options.blocks.length?this.options.blocks[r]:this.options;this.extractGmeErrors(r),this.drawBins(a,c,l,n,h,m,g)}this.extractGmeErrors(0)}this.isBatchMode()||((0,D.X2)(this,this.testEditable()),(0,H.wh)(this))}extractTooltip(t){if(!t)return null;if("lines"===this.draw_kind||"path"===this.draw_kind||"mark"===this.draw_kind)return this.extractTooltipForPath(t);if("nodes"!==this.draw_kind)return null;const i=this.get_main(),e=i.getFrameHeight(),a=this.error_size,n=1===this.options.Bar,h=n?i.getGrFuncs(this.options.second_x,this.options.second_y):null,x=this.marker_size?Math.round(this.marker_size/2+1.5):0;let r=null,m=1e10,g=null;if(this.draw_g.selectAll(".grpoint").each(function(){const o=(0,C.Lt)(this).datum();if(void 0===o)return;let d,y=(t.x-o.grx1)**2;if(1===t.nproc&&(y+=(t.y-o.gry1)**2),y>=m)return;if(o.error||o.rect||o.marker)d={x1:Math.min(-a,o.grx0,-x),x2:Math.max(a,o.grx2,x),y1:Math.min(-a,o.gry2,-x),y2:Math.max(a,o.gry0,x)};else if(o.bar){if(d={x1:-o.width/2,x2:o.width/2,y1:0,y2:e-o.gry1},n){const M=h.gry(0);d.y1=o.gry1>M?M-o.gry1:0,d.y2=o.gry1>M?0:M-o.gry1}}else d={x1:-5,x2:5,y1:-5,y2:5};const u=t.y>=o.gry1+d.y1&&t.y<=o.gry1+d.y2;t.x>=o.grx1+d.x1&&t.x<=o.grx1+d.x2&&(u||t.nproc>1)&&(m=y,r=this,g=d,g.exact=u)}),null===r)return null;const l=(0,C.Lt)(r).datum(),c=this.getGraph(),s={name:c.fName,title:c.fTitle,x:l.grx1,y:l.gry1,color1:this.lineatt.color,lines:this.getTooltips(l),rect:g,d3bin:r};return s.user_info={obj:c,name:c.fName,bin:l.indx,cont:l.y,grx:l.grx1,gry:l.gry1},this.fillatt?.used&&!this.fillatt?.empty()&&(s.color2=this.fillatt.getFillColor()),g.exact&&(s.exact=!0),s.menu=s.exact,s.menu_dist=3,s.bin=l,s.binindx=l.indx,s}showTooltip(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_g)return void i?.remove();if(t.usepath)return this.showTooltipForPath(t);const e=(0,C.Lt)(t.d3bin).datum();i.empty()&&(i=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(w.Ru)),t.changed=i.property("current_bin")!==t.d3bin,t.changed&&i.attr("x",e.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",e.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){const i=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(i),i}findBestBin(t){if(!this.bins)return null;const i="lines"===this.draw_kind,e=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);let x,r,m,g,l,a=-1,n=null,h=1e10;for(g=0;g<this.bins.length;++g)l=this.bins[g],r=e.grx(l.x),m=e.gry(l.y),x=(t.x-r)**2+(t.y-m)**2,x<h&&(h=x,n=l,a=g);h>100&&i&&(n=null);let c=Math.max(this.lineatt.width+3,4);this.marker_size>0&&(c=Math.max(this.marker_size,c)),n&&(h=Math.sqrt((t.x-e.grx(n.x))**2+(t.y-e.gry(n.y))**2)),!i&&h>c&&(n=null),n||(a=-1);const s={bin:n,indx:a,dist:h,radius:Math.round(c)};if(!n&&i){h=1e10;const o=(M,b,E)=>b>=M&&M>=E||b<=M&&M<=E;let f,y=this.bins[0],d=e.grx(y.x),u=0;for(g=1;g<this.bins.length;++g)l=this.bins[g],r=e.grx(l.x),o(t.x,d,r)&&(f=e.gry(y.y),m=e.gry(l.y),Math.abs(r-d)<1?(u=t.y,x=o(t.y,f,m)?0:Math.min(Math.abs(t.y-f),Math.abs(t.y-m))):(u=f+(t.x-d)/(r-d)*(m-f),x=Math.abs(u-t.y)),x<h&&(h=x,s.linex=t.x,s.liney=u)),y=l,d=r;h<.5*c&&(s.linedist=h,s.closeline=!0)}return s}testEditable(t){const i=this.getGraph();return!!i&&(("toggle"===t||void 0!==t&&!t!==i.TestBit($))&&i.InvertBit($),!i.TestBit($))}extractTooltipForPath(t){if(null===this.bins)return null;const i=this.findBestBin(t);if(!i||!i.bin&&!i.closeline)return null;const e="lines"===this.draw_kind,a="mark"===this.draw_kind,h=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),x=this.getGraph(),r={name:x.fName,title:x.fTitle,x:i.bin?h.grx(i.bin.x):i.linex,y:i.bin?h.gry(i.bin.y):i.liney,color1:this.lineatt.color,lines:this.getTooltips(i.bin),usepath:!0};return r.user_info={obj:x,name:x.fName,bin:0,cont:0,grx:r.x,gry:r.y},r.ismark=a,r.islines=e,i.closeline?(r.menu=r.exact=!0,r.menu_dist=i.linedist):i.bin&&(this.options.EF&&e?(r.gry1=h.gry(i.bin.y-i.bin.eylow),r.gry2=h.gry(i.bin.y+i.bin.eyhigh)):r.gry1=r.gry2=h.gry(i.bin.y),r.binindx=i.indx,r.bin=i.bin,r.radius=i.radius,r.user_info.bin=i.indx,r.user_info.cont=i.bin.y,r.exact=Math.abs(t.x-r.x)<=i.radius&&(Math.abs(t.y-r.gry1)<=i.radius||Math.abs(t.y-r.gry2)<=i.radius),r.menu=r.exact,r.menu_dist=Math.sqrt((t.x-r.x)**2+Math.min(Math.abs(t.y-r.gry1),Math.abs(t.y-r.gry2))**2)),this.fillatt?.used&&!this.fillatt?.empty()&&(r.color2=this.fillatt.getFillColor()),e||(r.color1=this.getColor(x.fMarkerColor),r.color2||(r.color2=r.color1)),r}showTooltipForPath(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(t?.bin&&this.draw_g){if(i.empty()&&(i=this.draw_g.append("svg:g").attr("class","tooltip_bin")),t.changed=i.property("current_bin")!==t.bin,t.changed)if(i.selectAll("*").remove(),i.property("current_bin",t.bin),t.ismark)i.append("svg:rect").style("pointer-events","none").call(w.Ru).style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{i.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&i.append("svg:circle").attr("cy",Math.round(t.gry2));const e=i.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(this.options.Line||this.options.Curve?e.call(this.lineatt.func):e.style("stroke","black"),this.options.Fill?e.call(this.fillatt.func):e.style("fill","none")):e.style("stroke","black"===t.color1?"green":"black").style("fill","none")}}else i?.remove()}moveEnabled(){return this.testEditable()}moveStart(t,i){this.pos_dx=this.pos_dy=0,this.move_funcs=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);const e=this.extractTooltip({x:t,y:i});e&&e.exact&&void 0!==e.binindx?(this.move_binindx=e.binindx,this.move_bin=e.bin,this.move_x0=this.move_funcs.grx(this.move_bin.x),this.move_y0=this.move_funcs.gry(this.move_bin.y)):delete this.move_binindx}moveDrag(t,i){this.pos_dx+=t,this.pos_dy+=i,void 0===this.move_binindx?(0,w.bk)(this.draw_g,this.pos_dx,this.pos_dy):this.move_funcs&&this.move_bin&&(this.move_bin.x=this.move_funcs.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=this.move_funcs.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())}moveEnd(t){const i=this.getGraph(),e=i?.fNpoints-1;let a="";const n=h=>{a+=`SetPoint(${h.indx},${h.x},${h.y});;`,i.fX[h.indx]=h.x,i.fY[h.indx]=h.y,0===h.indx&&this._cutg_lastsame&&(a+=`SetPoint(${e},${h.x},${h.y});;`,i.fX[e]=h.x,i.fY[e]=h.y)};if(void 0===this.move_binindx){if(this.draw_g.attr("transform",null),this.move_funcs&&this.bins&&!t){for(let h=0;h<this.bins.length;++h){const x=this.bins[h];x.x=this.move_funcs.revertAxis("x",this.move_funcs.grx(x.x)+this.pos_dx),x.y=this.move_funcs.revertAxis("y",this.move_funcs.gry(x.y)+this.pos_dy),n(x)}i.$redraw_pad?this.redrawPad():this.drawGraph()}}else n(this.move_bin),delete this.move_binindx,i.$redraw_pad&&this.redrawPad();delete this.move_funcs,a&&!t&&this.submitCanvExec(a)}fillWebObjectOptions(t){this._auto_exec&&t&&(t.fcust="auto_exec:"+this._auto_exec,delete this._auto_exec)}fillContextMenuItems(t){this.snapid||t.addchk(this.testEditable(),"Editable",()=>{this.testEditable("toggle"),this.drawGraph()})}executeMenuCommand(t,i){if(super.executeMenuCommand(t,i))return!0;const e=this.getCanvPainter(),a=this.get_main();if("RemovePoint"===t.fName||"InsertPoint"===t.fName){if(!e||e._readonly)return!0;const n=(0,_.isFunc)(a?.getLastEventPos)?a.getLastEventPos():null,h=this.extractTooltip(n);if("InsertPoint"===t.fName){if(n){const x=a.getGrFuncs(this.options.second_x,this.options.second_y),r=x.revertAxis("x",n.x)??0,m=x.revertAxis("y",n.y)??0;this.submitCanvExec(`AddPoint(${r.toFixed(3)}, ${m.toFixed(3)})`,t.$execid)}}else t.$execid&&void 0!==h?.binindx&&this.submitCanvExec(`RemovePoint(${h.binindx})`,t.$execid);return!0}return!1}_updateMembers(t,i){t.fBits=i.fBits,t.fTitle=i.fTitle,t.fX=i.fX,t.fY=i.fY,t.fNpoints=i.fNpoints,t.fMinimum=i.fMinimum,t.fMaximum=i.fMaximum;const e=this.options;return void 0!==this.snapid&&(e._pfc=e._plc=e._pmc=0),e._pfc||(t.fFillColor=i.fFillColor),t.fFillStyle=i.fFillStyle,e._plc||(t.fLineColor=i.fLineColor),t.fLineStyle=i.fLineStyle,t.fLineWidth=i.fLineWidth,e._pmc||(t.fMarkerColor=i.fMarkerColor),t.fMarkerSize=i.fMarkerSize,t.fMarkerStyle=i.fMarkerStyle,i.fFunctions}updateObject(t,i){if(!this.matchObjectType(t))return!1;i&&i!==this.options.original&&this.decodeOptions(i);const e=this._updateMembers(this.getObject(),t);if(this.createBins(),delete this.$redraw_hist,this.axes_draw){const a=this.createHistogram(),n=this.getMainPainter();n?.isSecondary(this)&&(n.updateObject(a,this.options.Axis),this.$redraw_hist=!0)}return this._funcHandler=new Y.eP(this,this.getPadPainter(),e),!0}canZoomInside(t,i,e){const a=this.getGraph();if(!a||t!==(this.options.pos3d?"y":"x"))return!1;for(let n=0;n<a.fNpoints;++n)if(i<a.fX[n]&&a.fX[n]<e)return!0;return!1}clickButton(t){return"ToggleZoom"===t&&(this.xmin!==this.xmax||this.ymin!==this.ymax)&&this.getFramePainter()?.zoom(this.xmin,this.xmax,this.ymin,this.ymax)}findFunc(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===_.clTF1||t._typename===_.clTF2)}findStat(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===_.clTPaveStats&&"stats"===t.fName)}createStat(){const t=this.findFunc();if(!t)return null;let i=this.findStat();if(i)return i;if(this.getCanvPainter()?.normal_canvas)return null;this.create_stats=!0;const e=_.gStyle;return i=(0,_.create)(_.clTPaveStats),Object.assign(i,{fName:"stats",fOptStat:0,fOptFit:e.fOptFit||111,fBorderSize:1,fX1NDC:e.fStatX-e.fStatW,fY1NDC:e.fStatY-e.fStatH,fX2NDC:e.fStatX,fY2NDC:e.fStatY,fFillColor:e.fStatColor,fFillStyle:e.fStatStyle}),i.fTextAngle=0,i.fTextSize=e.fStatFontSize,i.fTextAlign=12,i.fTextColor=e.fStatTextColor,i.fTextFont=e.fStatFont,i.AddText(t.fName),this.getGraph().fFunctions.Add(i),i}fillStatistic(t,i,e){const a=this.findFunc();return!(!a||!e||(t.clearPave(),t.fillFunctionStat(a,1===e?111:e,1),0))}drawAxisHisto(){var t=this;return(0,T.A)(function*(){const i=t.createHistogram();return N.N.draw(t.getDom(),i,t.options.Axis)})()}static _drawGraph(t,i){return(0,T.A)(function*(){t.decodeOptions(i,!0),t.createBins(),t.createStat();const e=t.getGraph();!_.settings.DragGraphs&&e&&!e.TestBit($)&&e.InvertBit($);let a=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(a=t.drawAxisHisto().then(n=>{n?.setSecondaryId(t,"hist"),t.axes_draw=!!n})),a.then(()=>(t.addToPadPrimitives(),t.drawGraph())).then(()=>new Y.eP(t,t.getPadPainter(),e.fFunctions,!0).drawNext(0))})()}static draw(t,i,e){return(0,T.A)(function*(){return F._drawGraph(new F(t,i),e)})()}}}}]);
//# sourceMappingURL=825.d0b7e7979b16e7d9.js.map