"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[156],{8156:(Dt,_t,F)=>{F.r(_t),F.d(_t,{RH3Painter:()=>it,drawHistDisplayItem:()=>Ct});var pt=F(5774),V=F(4186),$=F(5225),yt=F(165),bt=F(7919),wt=F(9798),Bt=F(5815),W=F(2009),zt=F(7294),At=F(9681),Mt=F(7387);class it extends Bt.G{getDimension(){return 3}scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;const e=this.getHisto();if(e){if(this.extractAxesProperties(3),this.isDisplayItem())this.gminbin=e.fContMin,this.gminposbin=e.fContMinPos>0?e.fContMinPos:null,this.gmaxbin=e.fContMax;else{this.gminbin=this.gmaxbin=e.getBinContent(1,1,1);for(let i=0;i<this.nbinsx;++i)for(let n=0;n<this.nbinsy;++n)for(let x=0;x<this.nbinsz;++x){const a=e.getBinContent(i+1,n+1,x+1);a<this.gminbin?this.gminbin=a:a>this.gmaxbin&&(this.gmaxbin=a)}}this.draw_content=0!==this.gmaxbin||0!==this.gminbin}}countStat(){const t=this.getHisto(),e=this.getAxis("x"),i=this.getAxis("y"),n=this.getAxis("z"),x=this.getSelectIndex("x","left"),a=this.getSelectIndex("x","right"),d=this.getSelectIndex("y","left"),f=this.getSelectIndex("y","right"),h=this.getSelectIndex("z","left"),g=this.getSelectIndex("z","right"),l={name:t.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};let p,C,I,H,j,w,y,S,P,_,m=0,M=0,D=0,E=0,u=0,c=0,b=0;for(p=1;p<=this.nbinsx;++p)for(H=e.GetBinCoord(p-.5),j=p<=x+1?0:p>a+1?2:1,C=1;C<=this.nbinsy;++C)for(w=i.GetBinCoord(C-.5),y=C<=d+1?0:C>f+1?2:1,I=1;I<=this.nbinsz;++I)S=n.GetBinCoord(I-.5),P=I<=h+1?0:I>g+1?2:1,_=t.getBinContent(p,C,I),l.entries+=_,1===j&&1===y&&1===P&&(m+=_,M+=H*_,D+=w*_,E+=S*_,u+=H**2*_,c+=w**2*_,b+=S**2*_);return Math.abs(m)>1e-300&&(l.meanx=M/m,l.meany=D/m,l.meanz=E/m,l.rmsx=Math.sqrt(Math.abs(u/m-l.meanx**2)),l.rmsy=Math.sqrt(Math.abs(c/m-l.meany**2)),l.rmsz=Math.sqrt(Math.abs(b/m-l.meanz**2))),l.integral=m,t.fEntries>1&&(l.entries=t.fEntries),l}fillStatistic(t,e){const i=this.countStat(),n=e%10,x=Math.floor(e/10)%10,a=Math.floor(e/100)%10,d=Math.floor(e/1e3)%10,f=Math.floor(e/1e6)%10;return t.clearStat(),n>0&&t.addText(i.name),x>0&&t.addText("Entries = "+t.format(i.entries,"entries")),a>0&&(t.addText("Mean x = "+t.format(i.meanx)),t.addText("Mean y = "+t.format(i.meany)),t.addText("Mean z = "+t.format(i.meanz))),d>0&&(t.addText("Std Dev x = "+t.format(i.rmsx)),t.addText("Std Dev y = "+t.format(i.rmsy)),t.addText("Std Dev z = "+t.format(i.rmsz))),f>0&&t.addText("Integral = "+t.format(i.integral,"entries")),!0}getBinTooltips(t,e,i){const n=[],x=this.getHisto();let a=1,d=1,f=1;this.isDisplayItem()&&(a=x.stepx||1,d=x.stepy||1,f=x.stepz||1),n.push(this.getObjectHint(),`x = ${this.getAxisBinTip("x",t,a)}  xbin=${t+1}`,`y = ${this.getAxisBinTip("y",e,d)}  ybin=${e+1}`,`z = ${this.getAxisBinTip("z",i,f)}  zbin=${i+1}`);const h=x.getBinContent(t+1,e+1,i+1),g="entries = "+(a>1||d>1||f>1?"~":"");return h===Math.round(h)?n.push(g+h):n.push(g+(0,yt.lg)(h,V.gStyle.fStatFormat)),n}draw3DScatter(t){var e=this;return(0,pt.A)(function*(){const i=e.getHisto(),n=e.getFramePainter(),x=t.i1,a=t.i2,d=t.stepi,f=t.j1,h=t.j2,g=t.stepj,l=t.k1,m=t.k2,M=t.stepk;if(a<=x||h<=f||m<=l)return!0;const D=e.gmaxbin>1e3?1e3/e.gmaxbin:1,E=Math.max(0,e.gminbin);let u,c,b,p,C=0,I=0;for(u=x;u<a;u+=d)for(c=f;c<h;c+=g)for(b=l;b<m;b+=M)p=i.getBinContent(u+1,c+1,b+1),I+=p,!(p<=E)&&(C+=Math.round(p*D));if(C>(n.webgl?1e5:3e4))return!1;const H=new W._l(C,n.webgl,n.size_x3d/200),j=new Int32Array(C),w=e.getAxis("x"),y=e.getAxis("y"),S=e.getAxis("z"),P=new yt.YF(I);let _=0;for(u=x;u<a;u+=d)for(c=f;c<h;c+=g)for(b=l;b<m;b+=M){if(p=i.getBinContent(u+1,c+1,b+1),p<=E)continue;const v=Math.round(p*D);for(let G=0;G<v;++G){const k=w.GetBinCoord(u+P.random()),T=y.GetBinCoord(c+P.random()),U=S.GetBinCoord(b+P.random());j[_++]=i.getBin(u+1,c+1,b+1),H.addPoint(n.grx(k),n.gry(T),n.grz(U))}}return H.createPoints({color:e.v7EvalColor("fill_color","red")}).then(v=>(n.add3DMesh(v),v.bins=j,v.painter=e,v.tip_color=65280,v.tooltip=function(G){const k=Math.floor(G.index/this.nvertex);if(k<0||k>=this.bins.length)return null;const T=this.painter,U=T.getFramePainter(),B=T.get3DToolTip(this.bins[k]);return B.x1=U.grx(T.getAxis("x").GetBinLowEdge(B.ix)),B.x2=U.grx(T.getAxis("x").GetBinLowEdge(B.ix+d)),B.y1=U.gry(T.getAxis("y").GetBinLowEdge(B.iy)),B.y2=U.gry(T.getAxis("y").GetBinLowEdge(B.iy+g)),B.z1=U.grz(T.getAxis("z").GetBinLowEdge(B.iz)),B.z2=U.grz(T.getAxis("z").GetBinLowEdge(B.iz+M)),B.color=this.tip_color,B.opacity=.3,B},!0))})()}draw3DBins(t){const e=this.getFramePainter();let g,l,i=this.v7EvalColor("fill_color","red"),n=0,x=!1,a=!1,d=!1,f=1,h=!0,m=.5;if(this.options.Sphere){m=.4,x=!0,11===this.options.Sphere&&(d=!0);const o=e.webgl?new $.Gu$(.5,16,12):new $.Gu$(.5,8,6);o.applyMatrix4((new $.kn4).makeRotationX(Math.PI/2)),o.computeVertexNormals();const r=o.getIndex().array,O=o.getAttribute("position").array,z=o.getAttribute("normal").array;n=3*r.length,g=new Float32Array(n),l=new Float32Array(n);for(let s=0;s<r.length;++s){const A=3*r[s];g[3*s]=O[A],g[3*s+1]=O[A+1],g[3*s+2]=O[A+2],l[3*s]=z[A],l[3*s+1]=z[A+1],l[3*s+2]=z[A+2]}}else{const o=W.DJ.Indexes,r=W.DJ.Normals,O=W.DJ.Vertices;n=3*o.length,g=new Float32Array(n),l=new Float32Array(n);for(let z=0,s=-3;z<o.length;++z){const A=O[o[z]];g[3*z]=A.x-.5,g[3*z+1]=A.y-.5,g[3*z+2]=A.z-.5,z%6==0&&(s+=3),l[3*z]=r[s],l[3*z+1]=r[s+1],l[3*z+2]=r[s+2]}a=!0,11===this.options.Box?d=!0:12===this.options.Box?(d=!0,a=!1):this.options.Color&&(d=!0,f=.5,h=!1,a=!1,x=!0)}h&&(h=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);const M=this.getHisto(),D=t.i1,E=t.i2,u=t.stepi,c=t.j1,b=t.j2,p=t.stepj,C=t.k1,I=t.k2,H=t.stepk;let j=null;if(d&&(j=e.getHistPalette(),this.createContour(e,j)),E<=D||b<=c||I<=C)return!0;const w=[];let S,P,_,v,G,y=0,k=0,T=[];for(S=D;S<E;S+=u)for(P=c;P<b;P+=p)for(_=C;_<I;_+=H){if(G=M.getBinContent(S+1,P+1,_+1),!this.options.Color&&(0===G||G<this.gminbin)||(v=h?Math.pow(Math.abs(G*h),.3333):1,v<.001)||(y++,!d))continue;const o=j.getContourIndex(G);o>=0?(void 0===w[o]&&(w[o]=0,T[o]=k++),w[o]+=1):console.error(`not found color for value = ${G}`)}d||(w.push(y),k=1,T=[0]);const U=new Array(k),B=new Array(k),dt=new Array(k),ct=new Array(k),J=new Array(k),mt=new Array(k),ut=new Array(k);for(let o=0;o<w.length;++o){if(!w[o])continue;y=w[o];const r=T[o];U[r]=0,J[r]=0,a&&(J[r]=y*n/3>65520?2:1),B[r]=new Float32Array(y*n),dt[r]=new Float32Array(y*n),ct[r]=new Int32Array(y),1===J[r]&&(mt[r]=new Uint16Array(y*W.DJ.MeshSegments.length)),2===J[r]&&(ut[r]=new Float32Array(y*W.DJ.Segments.length*3))}const nt=this.getAxis("x"),st=this.getAxis("y"),rt=this.getAxis("z");let Y,X,Q,q,tt,et;for(S=D;S<E;S+=u)for(Y=e.grx(nt.GetBinLowEdge(S+1)),X=e.grx(nt.GetBinLowEdge(S+2)),P=c;P<b;P+=p)for(Q=e.gry(st.GetBinLowEdge(P+1)),q=e.gry(st.GetBinLowEdge(P+2)),_=C;_<I;_+=H){if(G=M.getBinContent(S+1,P+1,_+1),!this.options.Color&&(0===G||G<this.gminbin)||(v=h?Math.pow(Math.abs(G*h),.3333):1,v<.001))continue;let o=0;if(d){const s=j.getContourIndex(G);if(s<0)continue;o=T[s]}y=U[o],tt=e.grz(rt.GetBinLowEdge(_+1)),et=e.grz(rt.GetBinLowEdge(_+2)),ct[o][y]=M.getBin(S+1,P+1,_+1);let r=y*n;const O=B[o],z=dt[o];for(let s=0;s<n;s+=3,r+=3)O[r]=(X+Y)/2+g[s]*(X-Y)*v,O[r+1]=(q+Q)/2+g[s+1]*(q-Q)*v,O[r+2]=(et+tt)/2+g[s+2]*(et-tt)*v,z[r]=l[s],z[r+1]=l[s+1],z[r+2]=l[s+2];if(1===J[o]){const s=W.DJ.MeshSegments;r=y*s.length;const A=Math.round(y*n/3),K=mt[o];for(let R=0;R<s.length;++R)K[r+R]=A+s[R]}if(2===J[o]){const s=W.DJ.Segments,A=ut[o];r=y*s.length*3;for(let K=0;K<s.length;++K,r+=3){const R=W.DJ.Vertices[s[K]];A[r]=(X+Y)/2+(R.x-.5)*(X-Y)*v,A[r+1]=(q+Q)/2+(R.y-.5)*(q-Q)*v,A[r+2]=(et+tt)/2+(R.z-.5)*(et-tt)*v}}U[o]=y+1}for(let o=0;o<w.length;++o){if(!w[o])continue;const r=T[o],O=new $.LoY;O.setAttribute("position",new $.THS(B[r],3)),O.setAttribute("normal",new $.THS(dt[r],3)),d&&(i=j.getColor(o));const z=x?new $.G_z({color:i,opacity:f,transparent:f<1,vertexColors:!1}):new $.V9B({color:i,opacity:f,transparent:f<1,vertexColors:!1}),s=new $.eaF(O,z);if(s.bins=ct[r],s.bins_faces=n/9,s.painter=this,s.tipscale=m,s.tip_color=65280,s.use_scale=h,s.tooltip=function(A){const K=Math.floor(A.faceIndex/this.bins_faces);if(K<0||K>=this.bins.length)return null;const R=this.painter,Z=R.getFramePainter(),L=R.get3DToolTip(this.bins[K]),ot=Z.grx(nt.GetBinCoord(L.ix-1)),at=Z.grx(nt.GetBinCoord(L.ix)),lt=Z.gry(st.GetBinCoord(L.iy-1)),gt=Z.gry(st.GetBinCoord(L.iy)),ht=Z.grz(rt.GetBinCoord(L.iz-1)),xt=Z.grz(rt.GetBinCoord(L.iz)),N=(this.use_scale?Math.pow(Math.abs(L.value*this.use_scale),.3333):1)*this.tipscale;return L.x1=(at+ot)/2-(at-ot)*N,L.x2=(at+ot)/2+(at-ot)*N,L.y1=(gt+lt)/2-(gt-lt)*N,L.y2=(gt+lt)/2+(gt-lt)*N,L.z1=(xt+ht)/2-(xt-ht)*N,L.z2=(xt+ht)/2+(xt-ht)*N,L.color=this.tip_color,L},e.add3DMesh(s),J[r]>0){const A=this.v7EvalColor("line_color","lightblue"),K=new $.mrM({color:A}),R=1===J[r]?(0,W.Fc)(B[r],K,mt[r]):(0,W.Fc)(ut[r],K);e.add3DMesh(R)}}d&&this.updatePaletteDraw()}draw3D(){if(!this.draw_content)return!1;const t=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});return(this.options.Scatter?this.draw3DScatter(t):Promise.resolve(!1)).then(i=>i||this.draw3DBins(t))}redraw(t){const e=this.getFramePainter();return"resize"===t?(e.resize3D()&&e.render3D(),this):((0,Mt.wx)(e),e.create3DScene(this.options.Render3D).then(()=>(e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,wt.R,{zoom:V.settings.Zooming,ndim:3,draw:!0,v7:!0}),this.drawingBins(t))).then(()=>this.draw3D()).then(()=>(e.render3D(),e.addKeysHandler(),this)))}fillToolbar(){const t=this.getPadPainter();t&&(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,e,i){let n=this.getHisto();return n&&(n=n["f"+t.toUpperCase()+"axis"]),!n||n.FindBin(i,.5)-n.FindBin(e,0)>1}autoZoom(){const t=this.getSelectIndex("x","left"),e=this.getSelectIndex("x","right"),i=this.getSelectIndex("y","left"),n=this.getSelectIndex("y","right"),x=this.getSelectIndex("z","left"),a=this.getSelectIndex("z","right"),d=this.getHisto();let f,h,g;if(t===e||i===n||x===a)return;let l=d.getBinContent(t+1,i+1,x+1);for(f=t;f<e;++f)for(h=i;h<n;++h)for(g=x;g<a;++g)l=Math.min(l,d.getBinContent(f+1,h+1,g+1));if(l>0)return;let m=e,M=t,D=n,E=i,u=a,c=x;for(f=t;f<e;++f)for(h=i;h<n;++h)for(g=x;g<a;++g)d.getBinContent(f+1,h+1,g+1)>l&&(f<m&&(m=f),f>=M&&(M=f+1),h<D&&(D=h),h>=E&&(E=h+1),g<u&&(u=g),g>=c&&(c=g+1));let b,p,C,I,H,j,w=!1;return m===M-1&&m>t+1&&M<e-1&&(m--,M++),D===E-1&&D>i+1&&E<n-1&&(D--,E++),u===c-1&&u>x+1&&c<a-1&&(u--,c++),(m>t||M<e)&&m<M-1&&(b=this.getAxis("x").GetBinLowEdge(m+1),p=this.getAxis("x").GetBinLowEdge(M+1),w=!0),(D>i||E<n)&&D<E-1&&(C=this.getAxis("y").GetBinLowEdge(D+1),I=this.getAxis("y").GetBinLowEdge(E+1),w=!0),(u>x||c<a)&&u<c-1&&(H=this.getAxis("z").GetBinLowEdge(u+1),j=this.getAxis("z").GetBinLowEdge(c+1),w=!0),w?this.getFramePainter().zoom(b,p,C,I,H,j):void 0}fillHistContextMenu(t){const e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,i=>{if(0===i.indexOf(V.kInspect))return this.showInspector(i);this.decodeOptions(i),this.interactiveRedraw(!0,"drawopt")})}static draw(t,e){return(0,pt.A)(function*(){const i=new it(t,e);return i.mode3d=!0,(0,bt.ensureRCanvas)(i,"3d").then(()=>{i.setAsMainPainter(),i.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:V.kNoZoom,maximum:V.kNoZoom,FrontBox:!1,BackBox:!1};const n=i.v7EvalAttr("kind",""),x=i.v7EvalAttr("sub",0),a=i.options;switch(n){case"box":a.Box=10+x;break;case"sphere":a.Sphere=10+x;break;case"col":a.Color=!0;break;case"scat":a.Scatter=!0;break;default:a.Box=10}return i.scanContent(),i.redraw()})})()}}function Ct(ft,t,e){return t?1===t.fAxes.length?zt.RH1Painter.draw(ft,t,e):2===t.fAxes.length?At.RH2Painter.draw(ft,t,e):3===t.fAxes.length?it.draw(ft,t,e):null:null}}}]);
//# sourceMappingURL=156.eb37652fc6f65eeb.js.map