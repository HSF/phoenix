"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[636],{4636:(Et,xt,G)=>{G.r(xt),G.d(xt,{RH3Painter:()=>q,drawHistDisplayItem:()=>Mt});var ft=G(5368),J=G(1773),O=G(1515),dt=G(5611),bt=G(6717),zt=G(757),Bt=G(8597),H=G(6772),At=G(2018),wt=G(7),Ct=G(3641);class q extends Bt.n{getDimension(){return 3}scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;let i=this.getHisto();if(i){if(this.extractAxesProperties(3),this.isDisplayItem())this.gminbin=i.fContMin,this.gminposbin=i.fContMinPos>0?i.fContMinPos:null,this.gmaxbin=i.fContMax;else{this.gminbin=this.gmaxbin=i.getBinContent(1,1,1);for(let e=0;e<this.nbinsx;++e)for(let n=0;n<this.nbinsy;++n)for(let o=0;o<this.nbinsz;++o){let h=i.getBinContent(e+1,n+1,o+1);h<this.gminbin?this.gminbin=h:h>this.gmaxbin&&(this.gmaxbin=h)}}this.draw_content=this.gmaxbin>0}}countStat(){let M,E,I,T,j,U,W,$,K,z,t=this.getHisto(),i=this.getAxis("x"),e=this.getAxis("y"),n=this.getAxis("z"),o=0,h=0,l=0,x=0,g=0,u=0,y=0,C=this.getSelectIndex("x","left"),P=this.getSelectIndex("x","right"),f=this.getSelectIndex("y","left"),d=this.getSelectIndex("y","right"),_=this.getSelectIndex("z","left"),p=this.getSelectIndex("z","right"),c=(this.getFramePainter(),{name:t.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0});for(M=1;M<=this.nbinsx;++M)for(T=i.GetBinCoord(M-.5),j=M<=C+1?0:M>P+1?2:1,E=1;E<=this.nbinsy;++E)for(U=e.GetBinCoord(E-.5),W=E<=f+1?0:E>d+1?2:1,I=1;I<=this.nbinsz;++I)$=n.GetBinCoord(I-.5),K=I<=_+1?0:I>p+1?2:1,z=t.getBinContent(M,E,I),c.entries+=z,1==j&&1==W&&1==K&&(o+=z,h+=T*z,l+=U*z,x+=$*z,g+=T**2*z,u+=U**2*z,y+=$**2*z);return Math.abs(o)>1e-300&&(c.meanx=h/o,c.meany=l/o,c.meanz=x/o,c.rmsx=Math.sqrt(Math.abs(g/o-c.meanx**2)),c.rmsy=Math.sqrt(Math.abs(u/o-c.meany**2)),c.rmsz=Math.sqrt(Math.abs(y/o-c.meanz**2))),c.integral=o,t.fEntries>1&&(c.entries=t.fEntries),c}fillStatistic(t,i){let e=this.countStat(),n=i%10,o=Math.floor(i/10)%10,h=Math.floor(i/100)%10,l=Math.floor(i/1e3)%10,x=Math.floor(i/1e6)%10;return t.clearStat(),n>0&&t.addText(e.name),o>0&&t.addText("Entries = "+t.format(e.entries,"entries")),h>0&&(t.addText("Mean x = "+t.format(e.meanx)),t.addText("Mean y = "+t.format(e.meany)),t.addText("Mean z = "+t.format(e.meanz))),l>0&&(t.addText("Std Dev x = "+t.format(e.rmsx)),t.addText("Std Dev y = "+t.format(e.rmsy)),t.addText("Std Dev z = "+t.format(e.rmsz))),x>0&&t.addText("Integral = "+t.format(e.integral,"entries")),!0}getBinTooltips(t,i,e){let n=[],o=this.getHisto(),h=1,l=1,x=1;this.isDisplayItem()&&(h=o.stepx||1,l=o.stepy||1,x=o.stepz||1),n.push(this.getObjectHint()),n.push(`x = ${this.getAxisBinTip("x",t,h)}  xbin=${t+1}`),n.push(`y = ${this.getAxisBinTip("y",i,l)}  ybin=${i+1}`),n.push(`z = ${this.getAxisBinTip("z",e,x)}  zbin=${e+1}`);let g=o.getBinContent(t+1,i+1,e+1),u="entries = "+(h>1||l>1||x>1?"~":"");return g===Math.round(g)?n.push(u+g):n.push(u+(0,dt.Ee)(g,J.gStyle.fStatFormat)),n}draw3DScatter(t){var i=this;return(0,ft.Z)(function*(){let f,d,_,p,e=i.getHisto(),n=i.getFramePainter(),o=t.i1,h=t.i2,l=t.stepi,x=t.j1,g=t.j2,u=t.stepj,y=t.k1,C=t.k2,P=t.stepk;if(h<=o||g<=x||C<=y)return!0;let F=i.gmaxbin>1e3?1e3/i.gmaxbin:1,c=0,M=0,E=Math.max(0,i.gminbin);for(f=o;f<h;f+=l)for(d=x;d<g;d+=u)for(_=y;_<C;_+=P)p=e.getBinContent(f+1,d+1,_+1),M+=p,!(p<=E)&&(c+=Math.round(p*F));if(c>(n.webgl?1e5:3e4))return!1;let I=new H.B_(c,n.webgl,n.size_x3d/200),T=new Int32Array(c),j=0,U=i.getAxis("x"),W=i.getAxis("y"),$=i.getAxis("z"),K=new dt.q9(M);for(f=o;f<h;f+=l)for(d=x;d<g;d+=u)for(_=y;_<C;_+=P){if(p=e.getBinContent(f+1,d+1,_+1),p<=E)continue;let z=Math.round(p*F);for(let b=0;b<z;++b){let S=U.GetBinCoord(f+K.random()),B=W.GetBinCoord(d+K.random()),v=$.GetBinCoord(_+K.random());T[j++]=e.getBin(f+1,d+1,_+1),I.addPoint(n.grx(S),n.gry(B),n.grz(v))}}return I.createPoints({color:i.v7EvalColor("fill_color","red")}).then(z=>(n.toplevel.add(z),z.bins=T,z.painter=i,z.tip_color=65280,z.tooltip=function(b){if(!Number.isInteger(b.index))return console.error(`intersect.index not provided, three.js version ${O.UZH}`),null;let S=Math.floor(b.index/this.nvertex);if(S<0||S>=this.bins.length)return null;let B=this.painter,v=B.getFramePainter(),m=B.get3DToolTip(this.bins[S]);return m.x1=v.grx(B.getAxis("x").GetBinLowEdge(m.ix)),m.x2=v.grx(B.getAxis("x").GetBinLowEdge(m.ix+l)),m.y1=v.gry(B.getAxis("y").GetBinLowEdge(m.iy)),m.y2=v.gry(B.getAxis("y").GetBinLowEdge(m.iy+u)),m.z1=v.grz(B.getAxis("z").GetBinLowEdge(m.iz)),m.z2=v.grz(B.getAxis("z").GetBinLowEdge(m.iz+P)),m.color=this.tip_color,m.opacity=.3,m},!0))})()}draw3DBins(t){let u,y,i=this.v7EvalColor("fill_color","red"),e=this.getFramePainter(),n=0,o=!1,h=!1,l=!1,x=1,g=!0,C=.5;if(this.options.Sphere){C=.4,o=!0,11===this.options.Sphere&&(l=!0);let a=e.webgl?new O.xo$(.5,16,12):new O.xo$(.5,8,6);a.applyMatrix4((new O.yGw).makeRotationX(Math.PI/2)),a.computeVertexNormals();let s=a.getIndex().array,k=a.getAttribute("position").array,w=a.getAttribute("normal").array;n=3*s.length,u=new Float32Array(n),y=new Float32Array(n);for(let r=0;r<s.length;++r){let A=3*s[r];u[3*r]=k[A],u[3*r+1]=k[A+1],u[3*r+2]=k[A+2],y[3*r]=w[A],y[3*r+1]=w[A+1],y[3*r+2]=w[A+2]}}else{let a=H.XZ.Indexes,s=H.XZ.Normals,k=H.XZ.Vertices;n=3*a.length,u=new Float32Array(n),y=new Float32Array(n);for(let w=0,r=-3;w<a.length;++w){let A=k[a[w]];u[3*w]=A.x-.5,u[3*w+1]=A.y-.5,u[3*w+2]=A.z-.5,w%6==0&&(r+=3),y[3*w]=s[r],y[3*w+1]=s[r+1],y[3*w+2]=s[r+2]}h=!0,11==this.options.Box?l=!0:12==this.options.Box?(l=!0,h=!1):this.options.Color&&(l=!0,x=.5,g=!1,h=!1,o=!0)}g&&(g=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);let P=this.getHisto(),f=t.i1,d=t.i2,_=t.stepi,p=t.j1,F=t.j2,c=t.stepj,M=t.k1,E=t.k2,I=t.stepk,T=null;if(l&&(T=e.getHistPalette(),this.createContour(e,T)),d<=f||F<=p||E<=M)return!0;let S,B,v,m,Z,j=this.getAxis("x"),U=this.getAxis("y"),W=this.getAxis("z"),$=(e.grx(j.GetBinCoord(d))-e.grx(j.GetBinCoord(f)))/(d-f)*_,K=(e.gry(U.GetBinCoord(F))-e.gry(U.GetBinCoord(p)))/(F-p)*c,z=(e.grz(W.GetBinCoord(E))-e.grz(W.GetBinCoord(M)))/(E-M)*I,b=0,X=[],N=0,Y=[];for(S=f;S<d;S+=_)for(B=p;B<F;B+=c)for(v=M;v<E;v+=I){if(Z=P.getBinContent(S+1,B+1,v+1),!this.options.Color&&(0===Z||Z<this.gminbin)||(m=g?Math.pow(Math.abs(Z*g),.3333):1,m<.001)||(b++,!l))continue;let a=T.getContourIndex(Z);a>=0?(void 0===X[a]&&(X[a]=0,Y[a]=N++),X[a]+=1):console.error(`not found color for value = ${Z}`)}l||(X.push(b),N=1,Y=[0]);let mt,at,ut,lt,_t,ht,it=new Array(N),tt=new Array(N),nt=new Array(N),rt=new Array(N),V=new Array(N),st=new Array(N),ot=new Array(N);for(let a=0;a<X.length;++a){if(!X[a])continue;b=X[a];let s=Y[a];it[s]=0,V[s]=0,h&&(V[s]=b*n/3>65520?2:1),tt[s]=new Float32Array(b*n),nt[s]=new Float32Array(b*n),rt[s]=new Int32Array(b),1===V[s]&&(st[s]=new Uint16Array(b*H.XZ.MeshSegments.length)),2===V[s]&&(ot[s]=new Float32Array(b*H.XZ.Segments.length*3))}for(j=this.getAxis("x"),U=this.getAxis("y"),W=this.getAxis("z"),S=f;S<d;S+=_)for(mt=j.GetBinCenter(S+1),at=e.grx(mt),B=p;B<F;B+=c)for(ut=U.GetBinCenter(B+1),lt=e.gry(ut),v=M;v<E;v+=I){if(Z=P.getBinContent(S+1,B+1,v+1),!this.options.Color&&(0===Z||Z<this.gminbin)||(m=g?Math.pow(Math.abs(Z*g),.3333):1,m<.001))continue;let a=0;if(l){let r=T.getContourIndex(Z);if(r<0)continue;a=Y[r]}b=it[a],_t=W.GetBinCenter(v+1),ht=e.grz(_t),rt[a][b]=P.getBin(S+1,B+1,v+1);let s=b*n,k=tt[a],w=nt[a];for(let r=0;r<n;r+=3,s+=3)k[s]=at+u[r]*$*m,k[s+1]=lt+u[r+1]*K*m,k[s+2]=ht+u[r+2]*z*m,w[s]=y[r],w[s+1]=y[r+1],w[s+2]=y[r+2];if(1===V[a]){let r=H.XZ.MeshSegments;s=b*r.length;let A=Math.round(b*n/3),R=st[a];for(let D=0;D<r.length;++D)R[s+D]=A+r[D]}if(2===V[a]){let r=H.XZ.Segments,A=ot[a];s=b*r.length*3;for(let R=0;R<r.length;++R,s+=3){let D=H.XZ.Vertices[r[R]];A[s]=at+(D.x-.5)*$*m,A[s+1]=lt+(D.y-.5)*K*m,A[s+2]=ht+(D.z-.5)*z*m}}it[a]=b+1}for(let a=0;a<X.length;++a){if(!X[a])continue;let s=Y[a],k=new O.u9r;k.setAttribute("position",new O.TlE(tt[s],3)),k.setAttribute("normal",new O.TlE(nt[s],3)),l&&(i=T.getColor(a));let w=o?new O.YBo({color:i,opacity:x,transparent:x<1,vertexColors:!1}):new O.vBJ({color:i,opacity:x,vertexColors:!1}),r=new O.Kj0(k,w);if(r.bins=rt[s],r.bins_faces=n/9,r.painter=this,r.scalex=C*$,r.scaley=C*K,r.scalez=C*z,r.tip_color=65280,r.use_scale=g,r.tooltip=function(A){if(!Number.isInteger(A.faceIndex))return console.error(`intersect.faceIndex not provided, three.js version ${O.UZH}`),null;let R=Math.floor(A.faceIndex/this.bins_faces);if(R<0||R>=this.bins.length)return null;let D=this.painter,gt=D.getFramePainter(),L=D.get3DToolTip(this.bins[R]),ct=gt.grx(D.getAxis("x").GetBinCoord(L.ix-.5)),pt=gt.gry(D.getAxis("y").GetBinCoord(L.iy-.5)),yt=gt.grz(D.getAxis("z").GetBinCoord(L.iz-.5)),Q=this.use_scale?Math.pow(Math.abs(L.value*this.use_scale),.3333):1;return L.x1=ct-this.scalex*Q,L.x2=ct+this.scalex*Q,L.y1=pt-this.scaley*Q,L.y2=pt+this.scaley*Q,L.z1=yt-this.scalez*Q,L.z2=yt+this.scalez*Q,L.color=this.tip_color,L},e.toplevel.add(r),V[s]>0){let A=this.v7EvalColor("line_color","lightblue"),R=new O.nls({color:A}),D=null;D=1===V[s]?(0,H.Qy)(tt[s],R,st[s]):(0,H.Qy)(ot[s],R),e.toplevel.add(D)}}l&&this.updatePaletteDraw()}draw3D(){if(!this.draw_content)return!1;let t=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});return(this.options.Scatter?this.draw3DScatter(t):Promise.resolve(!1)).then(e=>e||this.draw3DBins(t))}redraw(t){let i=this.getFramePainter();return"resize"==t?(i.resize3D()&&i.render3D(),this):((0,Ct.g_)(i),i.create3DScene(this.options.Render3D).then(()=>(i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),i.set3DOptions(this.options),i.drawXYZ(i.toplevel,zt.C,{zoom:J.settings.Zooming,ndim:3,draw:!0,v7:!0}),this.drawingBins(t))).then(()=>this.draw3D()).then(()=>(i.render3D(),i.addKeysHandler(),this)))}fillToolbar(){let t=this.getPadPainter();t&&(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,i,e){let n=this.getHisto();return n&&(n=n["f"+t.toUpperCase()+"axis"]),!n||n.FindBin(e,.5)-n.FindBin(i,0)>1}autoZoom(){let l,x,g,t=this.getSelectIndex("x","left"),i=this.getSelectIndex("x","right"),e=this.getSelectIndex("y","left"),n=this.getSelectIndex("y","right"),o=this.getSelectIndex("z","left"),h=this.getSelectIndex("z","right"),u=this.getHisto();if(t===i||e===n||o===h)return;let y=u.getBinContent(t+1,e+1,o+1);for(l=t;l<i;++l)for(x=e;x<n;++x)for(g=o;g<h;++g)y=Math.min(y,u.getBinContent(l+1,x+1,g+1));if(y>0)return;let C=i,P=t,f=n,d=e,_=h,p=o;for(l=t;l<i;++l)for(x=e;x<n;++x)for(g=o;g<h;++g)u.getBinContent(l+1,x+1,g+1)>y&&(l<C&&(C=l),l>=P&&(P=l+1),x<f&&(f=x),x>=d&&(d=x+1),g<_&&(_=g),g>=p&&(p=g+1));let F,c,M,E,I,T,j=!1;return C===P-1&&C>t+1&&P<i-1&&(C--,P++),f===d-1&&f>e+1&&d<n-1&&(f--,d++),_===p-1&&_>o+1&&p<h-1&&(_--,p++),(C>t||P<i)&&C<P-1&&(F=this.getAxis("x").GetBinLowEdge(C+1),c=this.getAxis("x").GetBinLowEdge(P+1),j=!0),(f>e||d<n)&&f<d-1&&(M=this.getAxis("y").GetBinLowEdge(f+1),E=this.getAxis("y").GetBinLowEdge(d+1),j=!0),(_>o||p<h)&&_<p-1&&(I=this.getAxis("z").GetBinLowEdge(_+1),T=this.getAxis("z").GetBinLowEdge(p+1),j=!0),j?this.getFramePainter().zoom(F,c,M,E,I,T):void 0}fillHistContextMenu(t){let i=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",i,e=>{if("inspect"===e)return this.showInspector();this.decodeOptions(e),this.interactiveRedraw(!0,"drawopt")})}static draw(t,i){return(0,ft.Z)(function*(){let e=new q(t,i);return e.mode3d=!0,(0,bt.ensureRCanvas)(e,"3d").then(()=>{e.setAsMainPainter(),e.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:J.kNoZoom,maximum:J.kNoZoom};let n=e.v7EvalAttr("kind",""),o=e.v7EvalAttr("sub",0),h=e.options;switch(n){case"box":h.Box=10+o;break;case"sphere":h.Sphere=10+o;break;case"col":h.Color=!0;break;case"scat":h.Scatter=!0;break;default:h.Box=10}return e.scanContent(),e.redraw()})})()}}function Mt(et,t,i){return t?1==t.fAxes.length?At.RH1Painter.draw(et,t,i):2==t.fAxes.length?wt.RH2Painter.draw(et,t,i):3==t.fAxes.length?q.draw(et,t,i):null:null}}}]);
//# sourceMappingURL=636.6ba473b6b4c07b12.js.map