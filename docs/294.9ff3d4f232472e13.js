"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[294],{7294:(yt,ot,T)=>{T.r(ot),T.d(ot,{RH1Painter:()=>it});var F=T(5774),z=T(4186),lt=T(3324),j=T(165),ct=T(5815),gt=T(7919);class et extends ct.G{constructor(t,e){super(t,e),this.wheel_zoomy=!1}scanContent(t){const e=this.getHisto();if(!e)return;!this.nbinsx&&t&&(t=!1),t||this.extractAxesProperties(1);let r=0,s=0,i=0,o=0;if(this.isDisplayItem())r=e.fContMin,s=e.fContMinPos,i=e.fContMax,o=i;else{const a=this.getSelectIndex("x","left"),y=this.getSelectIndex("x","right");if(t&&a===this.scan_xleft&&y===this.scan_xright)return;this.scan_xleft=a,this.scan_xright=y;let m,n,w=!0;for(let x=0;x<this.nbinsx;++x)m=e.getBinContent(x+1),o+=m,!(x<a||x>=y)&&(m>0&&(0===s||m<s)&&(s=m),w&&(r=i=m,w=!1),n=0,r=Math.min(r,m-n),i=Math.max(i,m+n))}if(this.stat_entries=o,this.hmin=r,this.hmax=i,this.ymin_nz=s,this.draw_content=!(0===this.nbinsx||Math.abs(r)<1e-300&&Math.abs(i)<1e-300),this.draw_content)if(r>=i)0===r?(this.ymin=0,this.ymax=1):r<0?(this.ymin=2*r,this.ymax=0):(this.ymin=0,this.ymax=2*r);else{const a=.05*(i-r);this.ymin=r-a,this.ymin<0&&r>=0&&(this.ymin=0),this.ymax=i+a}}countStat(t){const e=this.getHisto(),r=this.getAxis("x"),s=this.getSelectIndex("x","left"),i=this.getSelectIndex("x","right"),y={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};let x,w=0,m=0,n=0,d=0,g=0,l=null,u=null;for(x=s;x<i;++x)d=r.GetBinCoord(x+.5),(!t||t(d))&&(g=e.getBinContent(x+1),(null===l||g>u)&&(l=d,u=g),w+=g,m+=g*d,n+=g*d**2);return y.integral=w,Math.abs(w)>1e-300&&(y.meanx=m/w,y.meany=0/w,y.rmsx=Math.sqrt(Math.abs(n/w-y.meanx**2)),y.rmsy=Math.sqrt(Math.abs(0/w-y.meany**2))),null!==l&&(y.xmax=l,y.wmax=u),y}fillStatistic(t,e){const r=this.getHisto(),s=this.countStat(),i=e%10,o=Math.floor(e/10)%10,a=Math.floor(e/100)%10,y=Math.floor(e/1e3)%10,w=Math.floor(e/1e4)%10,m=Math.floor(e/1e5)%10,n=Math.floor(e/1e6)%10,x=Math.floor(e/1e7)%10,d=Math.floor(e/1e8)%10;return t.clearStat(),i>0&&t.addText(s.name),o>0&&t.addText("Entries = "+t.format(s.entries,"entries")),a>0&&t.addText("Mean = "+t.format(s.meanx)),y>0&&t.addText("Std Dev = "+t.format(s.rmsx)),w>0&&t.addText("Underflow = "+t.format(r.getBinContent(0),"entries")),m>0&&t.addText("Overflow = "+t.format(r.getBinContent(this.nbinsx+1),"entries")),n>0&&t.addText("Integral = "+t.format(s.integral,"entries")),x>0&&t.addText("Skew = <not avail>"),d>0&&t.addText("Kurt = <not avail>"),!0}drawBars(t,e,r,s){var i=this;return(0,F.A)(function*(){i.createG(!0);const o=t.i1,a=t.i2,y=t.stepi,w=i.getFramePainter(),m=i.getHisto(),n=i.getAxis("x");let x,d,g,l,u,C,h,c,v,$="",B="",b="";for(c=w.swap_xy?0:s,Number.isFinite(i.options.BaseLine)&&i.options.BaseLine>=e.scale_ymin&&(c=Math.round(e.gry(i.options.BaseLine))),x=o;x<a;x+=y)d=n.GetBinCoord(x),g=n.GetBinCoord(x+y),!(e.logx&&g<=0)&&(l=Math.round(e.grx(d)),u=Math.round(e.grx(g)),C=m.getBinContent(x+1),!(e.logy&&C<e.scale_ymin)&&(h=Math.round(e.gry(C)),v=u-l,l+=Math.round(i.options.BarOffset*v),v=Math.round(i.options.BarWidth*v),$+=w.swap_xy?`M${c},${l}h${h-c}v${v}h${c-h}z`:`M${l},${h}h${v}v${c-h}h${-v}z`,i.options.BarStyle>0&&(u=l+v,v=Math.round(v/10),w.swap_xy?(B+=`M${c},${l}h${h-c}v${v}h${c-h}z`,b+=`M${c},${u}h${h-c}v${-v}h${c-h}z`):(B+=`M${l},${h}h${v}v${c-h}h${-v}z`,b+=`M${u},${h}h${-v}v${c-h}h${v}z`))));return i.fillatt.empty()&&i.fillatt.setSolidColor("blue"),$&&i.draw_g.append("svg:path").attr("d",$).call(i.fillatt.func),B&&i.draw_g.append("svg:path").attr("d",B).call(i.fillatt.func).style("fill",(0,lt.Qh)(i.fillatt.color).brighter(.5).formatHex()),b&&i.draw_g.append("svg:path").attr("d",b).call(i.fillatt.func).style("fill",(0,lt.Qh)(i.fillatt.color).darker(.5).formatHex()),!0})()}drawFilledErrors(t,e){var r=this;return(0,F.A)(function*(){r.createG(!0);const s=t.i1,i=t.i2,o=t.stepi,a=r.getHisto(),y=r.getAxis("x"),w=[],m=[];let n,x,d,g,l,u;for(n=s;n<i;n+=o)x=y.GetBinCoord(n+.5),!(e.logx&&x<=0)&&(d=Math.round(e.grx(x)),g=a.getBinContent(n+1),l=a.getBinError(n+1),!(e.logy&&g-l<e.scale_ymin)&&(u=Math.round(e.gry(g+l)),w.push({grx:d,gry:u}),u=Math.round(e.gry(g-l)),m.unshift({grx:d,gry:u})));const C=(0,j.Mw)(w,{line:4!==r.options.ErrorKind}),h=(0,j.Mw)(m,{line:4!==r.options.ErrorKind,cmd:"L"});return r.fillatt.empty()&&r.fillatt.setSolidColor("blue"),r.draw_g.append("svg:path").attr("d",C+h+"Z").call(r.fillatt.func),!0})()}draw1DBins(){var t=this;return(0,F.A)(function*(){const e=t.getFramePainter(),r=e.getFrameRect();if(!t.draw_content||r.width<=0||r.height<=0)return t.removeG(),!1;t.createHistDrawAttributes();const s=t.prepareDraw({extra:1,only_indexes:!0}),i=e.getGrFuncs(t.options.second_x,t.options.second_y);return t.options.Bar?t.drawBars(s,i,r.width,r.height):3===t.options.ErrorKind||4===t.options.ErrorKind?t.drawFilledErrors(s,i,r.width,r.height):t.drawHistBins(s,i,r.width,r.height)})()}drawHistBins(t,e,r,s){var i=this;return(0,F.A)(function*(){i.createG(!0);const o=i.options,a=t.i1,y=t.i2,w=t.stepi,m=i.getHisto(),n=!i.isBatchMode()&&z.settings.Tooltip,x=i.getAxis("x"),d=!o.Zero,g=o.Error,l=o.Line,u=o.Text;let v,$,B,b,_,S,M,f,p,D,P,k,R,Z,E,L,Y,H,st,I,W,O,G,C=o.Mark,h="",c=!1,U=null,Q=null,J=null,X=null,V=null,rt="",nt="",q=0;if(g&&!C&&i.v7EvalAttr("marker_style",1)>1&&(C=!0),2===o.ErrorKind?i.fillatt.empty()?C=!0:U="":o.Error&&(Q="",V=n?"":null),l&&(X=""),C&&(i.createv7AttMarker(),i.markeratt.size>0?(J="",i.markeratt.resetPos()):C=!1),u){if(G=i.v7EvalFont("text",{size:20,color:"black",align:22}),!G.angle&&!o.TextKind){const A=r/(y-a+1);A<3*G.size&&(G.setAngle(270),G.setSize(Math.round(.7*A)))}i.startTextDrawing(G,"font")}let ft=y-a>3*r;if(1===o.ErrorKind){const A=i.lineatt.width+z.gStyle.fEndErrorSize;rt=`m0,${A}v${-2*A}m0,${A}`,nt=`m${A},0h${-2*A}m${A},0`,q=Math.floor((i.lineatt.width-1)/2)}const N=g||C;(N||u||l)&&(ft=!0);const tt=A=>{if(H=m.getBinContent(A+1),!d||0!==H){if(I=Math.round(e.grx(x.GetBinCoord(A))),W=Math.round(e.grx(x.GetBinCoord(A+w))),O=Math.round((I+W)/2),E=Math.round(e.gry(H)),L=Y=20,g&&(st=m.getBinError(A+1),L=Math.round(E-e.gry(H+st)),Y=Math.round(e.gry(H-st)-E)),u&&0!==H){const K=H===Math.round(H)?H.toString():(0,j.lg)(H,z.gStyle.fPaintTextFormat);i.drawText(G.angle?{align:12,x:O,y:Math.round(E-2-G.size/5),text:K,latex:0}:{x:Math.round(I+.1*(W-I)),y:Math.round(E-2-G.size),width:Math.round(.8*(W-I)),height:G.size,text:K,latex:0})}if(l&&null!==X&&(X+=(0===X.length?"M":"L")+O+","+E),N&&E>=-L&&E<=s+Y&&(null!==U&&(U+=`M${I},${E-L}h${W-I}v${L+Y+1}h${I-W}z`),null!==J&&(J+=i.markeratt.create(O,E)),null!==Q)){let K=5;if(i.options.errorX>0){K=Math.round((W-I)*i.options.errorX);const xt=O-K;Q+=`M${xt+q},${E}${rt}h${O+K-xt-2*q}${rt}`}Q+=`M${O},${E-L+q}${nt}v${L+Y-2*q}${nt}`,null!==V&&(V+=`M${O-K},${E-L}h${2*K}v${L+Y}h${-2*K}z`)}}};for(k=a;k<=y;k+=w)b=x.GetBinCoord(k),!(e.logx&&b<=0)&&(_=Math.round(e.grx(b)),c=k>y-w,c&&a<y?M=B:(S=m.getBinContent(k+1),M=Math.round(e.gry(S))),0===h.length?(R=Z=k,P=v=$=_,D=f=p=B=M,h="M"+$+","+B):ft?_!==$||c?((N||u||l)&&(R===Z?tt(R):R<Z?(tt(R),tt(Z)):(tt(Z),tt(R))),!N&&(f!==p||D!==f)&&(P!==$&&(h+="h"+($-P)),B===f?(p!==D&&(h+="v"+(p-D)),f!==p&&(h+="v"+(f-p))):(f!==D&&(h+="v"+(f-D)),p!==f&&(h+="v"+(p-f)),B!==p&&(h+="v"+(B-p))),P=$,D=B),c&&P!==_&&(h+="h"+(_-P)),R=Z=k,f=p=B=M,$=_):(M<f?Z=k:M>p&&(R=k),f=Math.min(f,M),p=Math.max(p,M),B=M):(M!==B||c)&&(_!==$&&(h+="h"+(_-$)),M!==B&&(h+="v"+(M-B)),B=M,$=_));const dt=!i.isBatchMode()&&i.fillatt.empty()&&o.Hist&&z.settings.Tooltip&&!N&&!l;let at=s+3;if(!dt){const A=Math.round(e.gry(0));A<=0?at=-3:A<s&&(at=A)}const ut=`L${$},${at}H${v}Z`;return N||l?(U&&i.draw_g.append("svg:path").attr("d",U).call(i.fillatt.func),Q&&i.draw_g.append("svg:path").attr("d",Q).call(i.lineatt.func),V&&i.draw_g.append("svg:path").attr("d",V).style("fill","none").style("pointer-events",i.isBatchMode()?null:"visibleFill"),X&&(!i.fillatt.empty()&&!o.Hist&&i.draw_g.append("svg:path").attr("d",X+ut).call(i.fillatt.func),i.draw_g.append("svg:path").attr("d",X).style("fill","none").call(i.lineatt.func)),J&&i.draw_g.append("svg:path").attr("d",J).call(i.markeratt.func)):h&&o.Hist&&i.draw_g.append("svg:path").attr("d",h+(!i.fillatt.empty()||dt?ut:"")).style("stroke-linejoin","miter").call(i.lineatt.func).call(i.fillatt.func),!u||i.finishTextDrawing()})()}getBinTooltips(t){const e=[],r=this.getObjectHint(),s=this.getFramePainter(),i=this.getHisto(),o=this.getAxis("x"),a=this.isDisplayItem()?i.stepx:1,y=o.GetBinCoord(t),w=o.GetBinCoord(t+a),m=this.getAxisBinTip("x",t,a);let n=i.getBinContent(t+1);if(r&&e.push(r),this.options.Error||this.options.Mark)e.push(`x = ${m}`,`y = ${s.axisAsText("y",n)}`),this.options.Error&&("["===m[0]&&e.push("error x = "+((w-y)/2).toPrecision(4)),e.push("error y = "+i.getBinError(t+1).toPrecision(4)));else{e.push(`bin = ${t+1}`,`x = ${m}`),i.$baseh&&(n-=i.$baseh.getBinContent(t+1));const x="entries = "+(a>1?"~":"");n===Math.round(n)?e.push(x+n):e.push(x+(0,j.lg)(n,z.gStyle.fStatFormat))}return e}processTooltipEvent(t){let e=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_content||this.options.Mode3D||!this.draw_g)return e?.remove(),null;const r=this.getFramePainter(),s=r.getGrFuncs(this.options.second_x,this.options.second_y),i=r.getFrameWidth(),o=r.getFrameHeight(),a=this.getHisto(),y=this.getAxis("x"),w=this.getSelectIndex("x","left",-1),m=this.getSelectIndex("x","right",2);let x,d,g,l,u,n=null,C=2,h=w,c=m;function v(f){const p=y.GetBinCoord(f);return s.logx&&p<=0?null:s.grx(p)}function $(f){const p=a.getBinContent(f+1);return s.logy&&p<s.scale_ymin?s.swap_xy?-1e3:10*o:Math.round(s.gry(p))}const B=s.swap_xy?t.y:t.x,b=s.swap_xy?t.x:t.y;for(;h<c-1;){const f=Math.round(.5*(h+c)),p=v(f);null===p||p<B-.5?s.swap_xy?c=f:h=f:p>B+.5?s.swap_xy?h=f:c=f:(h++,c--)}if(n=c=h,d=v(n),s.swap_xy){for(;h>w&&v(h-1)<d+2;)--h;for(;c<m&&v(c+1)>d-2;)++c}else{for(;h>w&&v(h-1)>d-2;)--h;for(;c<m&&v(c+1)<d+2;)++c}if(h<c){let f=o;for(let p=h;p<=c;p++){const D=Math.abs($(p)-b);D<f&&(f=D,n=p)}f>o/10&&(n=Math.round(h+(c-h)/o*b)),d=v(n)}if(d=Math.round(d),g=Math.round(v(n+1)),this.options.Bar){const f=g-d;d+=Math.round(this.options.BarOffset*f),g=d+Math.round(this.options.BarWidth*f)}if(d>g&&([d,g]=[g,d]),this.isDisplayItem()&&(n<=a.dx||n>=a.dx+a.nx))return e.remove(),null;const _=Math.round((d+g)/2),S=l=u=$(n);if(this.options.Bar)x=!0,C=0,l=Math.round(s.gry(!1!==this.options.BaseLine&&this.options.BaseLine>s.scale_ymin?this.options.BaseLine:s.scale_ymin)),l>u&&([l,u]=[u,l]),!t.touch&&1===t.nproc&&(b<l||b>u)&&(n=null);else if(this.options.Error||this.options.Mark){x=!0;let f=3;if(this.markeratt&&(f=Math.max(f,this.markeratt.getFullSize())),this.options.Error){const p=a.getBinContent(n+1),D=a.getBinError(n+1);l=Math.round(s.gry(p+D)),u=Math.round(s.gry(p-D));const P=(g-d)*this.options.errorX;d=Math.round(_-P),g=Math.round(_+P)}g-d<2*f&&(d=_-f,g=_+f),l=Math.min(l,S-f),u=Math.max(u,S+f),!t.touch&&1===t.nproc&&(b<l||b>u)&&(n=null)}else this.options.Line?x=!1:(x=1===t.nproc&&m-w<i,x&&(u=o,this.fillatt.empty()||(u=Math.min(o,Math.max(0,Math.round(s.gry(0)))),u<l&&([l,u]=[u,l])),(t.y<l||t.y>u)&&!t.touch&&(n=null)));if(null!==n&&(n===w&&d>B+C||n===m-1&&g<B-C||B<d-C||B>g+C||!this.options.Zero&&0===a.getBinContent(n+1))&&(n=null),null===n||u<=0||l>=o)return e.remove(),null;const M={name:"histo",title:a.fTitle,x:_,y:S,exact:!0,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(n)};if(t.disabled)e.remove(),M.changed=!0;else if(x)e.empty()&&(e=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(j.Ru)),M.changed=e.property("current_bin")!==n,M.changed&&e.attr("x",r.swap_xy?l:d).attr("width",r.swap_xy?u-l:g-d).attr("y",r.swap_xy?d:l).attr("height",r.swap_xy?g-d:u-l).style("opacity","0.3").property("current_bin",n),M.exact=Math.abs(S-b)<=5||b>=l&&b<=u,M.menu=M.exact,M.menu_dist=Math.sqrt((_-B)**2+(S-b)**2);else{const f=this.lineatt.width+3;e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",f).call(this.lineatt.func).call(this.fillatt.func)),M.exact=Math.abs(_-t.x)<=f&&Math.abs(S-t.y)<=f,M.menu=M.exact,M.menu_dist=Math.sqrt((_-t.x)**2+(S-t.y)**2),M.changed=e.property("current_bin")!==n,M.changed&&e.attr("cx",_).attr("cy",S).property("current_bin",n)}return M.changed&&(M.user_info={obj:a,name:"histo",bin:n,cont:a.getBinContent(n+1),grx:_,gry:S}),M}fillHistContextMenu(t){t.add("Auto zoom-in",()=>this.autoZoom());const e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,r=>{if(0===r.indexOf(z.kInspect))return this.showInspector(r);this.decodeOptions(r),this.options.need_fillcol&&this.fillatt?.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")})}autoZoom(){let t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1);const r=e-t,s=this.getHisto(),i=this.getAxis("x");if(0===r)return;let o=s.getBinContent(t+1);for(let a=t;a<e;++a)o=Math.min(o,s.getBinContent(a+1));if(!(o>0)){for(;t<e&&s.getBinContent(t+1)<=o;)++t;for(;t<e&&s.getBinContent(e)<=o;)--e;if(t===e-1&&t>2&&e<this.nbinsx-2&&(--t,++e),e-t<r&&t<e)return this.getFramePainter().zoom(i.GetBinCoord(t),i.GetBinCoord(e))}}canZoomInside(t,e,r){const s=this.getAxis("x");return"x"===t&&s.FindBin(r,.5)-s.FindBin(e,0)>1||"y"===t&&Math.abs(r-e)>1e-6*Math.abs(this.ymax-this.ymin)}callDrawFunc(t){var e=this;return(0,F.A)(function*(){const r=e.getFramePainter();return r&&r.mode3d!==e.options.Mode3D&&!e.isMainPainter()&&(e.options.Mode3D=r.mode3d),e.options.Mode3D?e.draw3D(t):e.draw2D(t)})()}draw2D(t){var e=this;return(0,F.A)(function*(){return e.clear3DScene(),e.drawFrameAxes().then(r=>!!r&&e.drawingBins(t)).then(r=>{if(r)return e.draw1DBins().then(()=>e.addInteractivity())}).then(()=>e)})()}draw3D(t){var e=this;return(0,F.A)(function*(){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),e.draw2D(t)})()}redraw(t){var e=this;return(0,F.A)(function*(){return e.callDrawFunc(t)})()}static _draw(t,e){return(0,F.A)(function*(){return(0,gt.ensureRCanvas)(t).then(()=>{t.setAsMainPainter(),t.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:z.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1,FrontBox:!1,BackBox:!1};const r=new j.nC(e);r.check("R3D_",!0)&&(t.options.Render3D=z.constants.Render3D.fromString(r.part.toLowerCase()));const s=t.v7EvalAttr("kind","hist"),i=t.v7EvalAttr("sub",0),o=!!t.getMainPainter(),a=t.options;switch(a.Text=t.v7EvalAttr("drawtext",!1),a.BarOffset=t.v7EvalAttr("baroffset",0),a.BarWidth=t.v7EvalAttr("barwidth",1),a.second_x=o&&t.v7EvalAttr("secondx",!1),a.second_y=o&&t.v7EvalAttr("secondy",!1),s){case"bar":a.Bar=!0,a.BarStyle=i;break;case"err":a.Error=!0,a.ErrorKind=i;break;case"p":a.Mark=!0;break;case"l":a.Line=!0;break;case"lego":a.Lego=i>0?10+i:12,a.Mode3D=!0;break;default:a.Hist=!0}return t.scanContent(),t.callDrawFunc()})})()}static draw(t,e,r){return(0,F.A)(function*(){return et._draw(new et(t,e),r)})()}}var mt=T(9798),ht=T(7387);class it extends et{draw3D(t){this.mode3d=!0;const e=this.getFramePainter(),r=this.isMainPainter(),s=1+2*z.gStyle.fHistTopMargin;let i=Promise.resolve(this);return"resize"===t?(r&&e.resize3D()&&e.render3D(),i):(this.deleteAttr(),this.scanContent(!0),r&&((0,ht.wx)(e),i=e.create3DScene(this.options.Render3D).then(()=>{e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,mt.R,{use_y_for_z:!0,zmult:s,zoom:z.settings.Zooming,ndim:1,draw:!0,v7:!0})})),e.mode3d?i.then(()=>this.drawingBins(t)).then(()=>{const o=this.getFramePainter();return(0,ht.CS)(this,!0),this.updatePaletteDraw(),o.render3D(),o.addKeysHandler(),this}):i)}static draw(t,e,r){return(0,F.A)(function*(){return it._draw(new it(t,e),r)})()}}}}]);
//# sourceMappingURL=294.9ff3d4f232472e13.js.map