"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[717],{6528:(et,J,T)=>{T.d(J,{p:()=>Z});var F=T(1773),f=T(6149),W=T(2454);class Z extends W.tK{constructor(m,b,h,c){super(m,b,h),this.csstype=c}v7EvalAttr(m,b){let h=this.getObject();if(!h)return b;this.cssprefix&&(m=this.cssprefix+m);const c=o=>{if(void 0===b)return o;let l=typeof b,d=typeof o;return l==d?o:"boolean"==l?"string"==d?""!=o&&"0"!=o&&"no"!=o&&"off"!=o:!!o:"number"==l&&"string"==d?parseFloat(o):o};if(h.fAttr&&h.fAttr.m){let o=h.fAttr.m[m];if(o)return c(o.v)}if(this.rstyle&&this.rstyle.fBlocks){let o=this.rstyle.fBlocks;for(let l=0;l<o.length;++l){let d=o[l];if((this.csstype&&d.selector==this.csstype||h.fId&&d.selector=="#"+h.fId||h.fCssClass&&d.selector=="."+h.fCssClass)&&d.map&&d.map.m){let v=d.map.m[m.toLowerCase()];if(v)return c(v.v)}}}return b}v7SetAttr(m,b){let h=this.getObject();this.cssprefix&&(m=this.cssprefix+m),h&&h.fAttr&&h.fAttr.m&&(h.fAttr.m[m]={v:b})}v7EvalLength(m,b,h){b<=0&&(b=1);let c=this.v7EvalAttr(m);if(void 0===c)return Math.round(h*b);if("number"==typeof c)return Math.round(c*b);if(null===c)return 0;let o=0,l=0,d=c,p=0,v=0;for(;d;){for(;v<d.length&&(" "==d[v]||"\t"==d[v]);)++v;if(v>=d.length)break;if("-"==d[v]||"+"==d[v]){if(p)return console.log("Fail to parse RPadLength "+c),h;p="-"==d[v]?-1:1,v++;continue}for(v>0&&(d=d.slice(v),v=0);v<d.length&&(d[v]>="0"&&d[v]<="9"||"."==d[v]);)v++;let w=parseFloat(d.slice(0,v));if(!Number.isFinite(w))return console.log("Fail to parse RPadLength "+c),Math.round(h*b);d=d.slice(v),v=0,p||(p=1),d&&"%"==d[0]?(d=d.slice(1),o+=p*w*.01):d.length>1&&"p"==d[0]&&"x"==d[1]?(d=d.slice(2),l+=p*w):o+=p*w,p=0}return Math.round(o*b+l)}v7EvalColor(m,b){let h=this.v7EvalAttr(m,"");if(!h||!(0,F.isStr)(h))return b;if("auto"==h){let c=this.getPadPainter();if(void 0!==c?._auto_color_cnt){let o=c.getHistPalette(),l=c._auto_color_cnt++,d=c._num_primitives-1;d<2&&(d=2),h=o?o.getColorOrdinal(l%d/d):"blue",this._auto_colors||(this._auto_colors={}),this._auto_colors[m]=h}else this._auto_colors&&this._auto_colors[m]?h=this._auto_colors[m]:(console.error(`Autocolor ${m} not defined yet - please check code`),h="")}else if("["==h[0]){let c=parseFloat(h.slice(1,h.length-1));if(h="black",Number.isFinite(c)){let l=this.getPadPainter()?.getHistPalette();l&&(h=l.getColorOrdinal(c))}}return h}v7EvalFont(m,b,h){b?"number"==typeof b&&(b={size:b}):b={};let c=this.getPadPainter(),o=c?._dfltRFont||{fFamily:"Arial",fStyle:"",fWeight:""},l=this.v7EvalAttr(m+"_size",b.size||12),d=this.v7EvalAttr(m+"_angle",0),p=this.v7EvalAttr(m+"_align",b.align||"none"),v=this.v7EvalColor(m+"_color",b.color||"none"),w=this.v7EvalAttr(m+"_font_family",o.fFamily||"Arial"),M=this.v7EvalAttr(m+"_font_style",o.fStyle||""),D=this.v7EvalAttr(m+"_font_weight",o.fWeight||"");(0,F.isStr)(l)&&(l=parseFloat(l)),(!Number.isFinite(l)||l<=0)&&(l=12),h||(h=c?.getPadHeight()||100);let z=new f.G(null,l,h,w,M,D);return d&&z.setAngle(360-d),"none"!==p&&z.setAlign(p),"none"!==v&&z.setColor(v),z}createv7AttFill(m){(!m||!(0,F.isStr)(m))&&(m="fill_");let b=this.v7EvalColor(m+"color",""),h=this.v7EvalAttr(m+"style",0);this.createAttFill({pattern:h,color:b,color_as_svg:!0})}createv7AttLine(m){(!m||!(0,F.isStr)(m))&&(m="line_");let b=this.v7EvalColor(m+"color","black"),h=this.v7EvalAttr(m+"width",1),c=this.v7EvalAttr(m+"style",1),o=this.v7EvalAttr(m+"pattern");this.createAttLine({color:b,width:h,style:c,pattern:o}),"border_"==m&&this.lineatt.setBorder(this.v7EvalAttr(m+"rx",0),this.v7EvalAttr(m+"ry",0))}createv7AttMarker(m){(!m||!(0,F.isStr)(m))&&(m="marker_");let b=this.v7EvalColor(m+"color","black"),h=this.v7EvalAttr(m+"size",.01),c=this.v7EvalAttr(m+"style",1),o=1;h<1&&(o=this.getPadPainter()?.getPadHeight()||100),this.createAttMarker({color:b,size:h,style:c,refsize:o})}v7AttrChange(m,b,h,c){if(!this.snapid)return!1;m._typename||(m._typename="ROOT::Experimental::RChangeAttrRequest",m.ids=[],m.names=[],m.values=[],m.update=!0),this.cssprefix&&(b=this.cssprefix+b),m.ids.push(this.snapid),m.names.push(b);let o=null;if(null==h&&(c||(c="none"),"none"!==c&&console.error(`Trying to set ${c} for none value`)),!c)switch(typeof h){case"number":c="double";break;case"boolean":c="boolean"}switch(o={_typename:"ROOT::Experimental::RAttrMap::"},c){case"none":o._typename+="NoValue_t";break;case"boolean":o._typename+="BoolValue_t",o.v=!!h;break;case"int":o._typename+="IntValue_t",o.v=parseInt(h);break;case"double":o._typename+="DoubleValue_t",o.v=parseFloat(h);break;default:o._typename+="StringValue_t",o.v=(0,F.isStr)(h)?h:JSON.stringify(h)}return m.values.push(o),!0}v7SendAttrChanges(m,b){let h=this.getCanvPainter();h&&m?._typename&&(void 0!==b&&(m.update=!!b),h.v7SubmitRequest("",m))}v7SubmitRequest(m,b,h){let c=this.getCanvPainter();return(0,F.isFunc)(c?.submitDrawableRequest)?this.snapid?c.submitDrawableRequest(m,b,this,h):(this._pending_request={kind:m,req:b,method:h},b):null}assignSnapId(m){if(this.snapid=m,this.snapid&&this._pending_request){let b=this._pending_request;this.v7SubmitRequest(b.kind,b.req,b.method),delete this._pending_request}}v7CommMode(){let m=this.getCanvPainter();return m&&m.submitDrawableRequest&&m._websocket?1:3}v7NormalMode(){return 1==this.v7CommMode()}v7OfflineMode(){return 3==this.v7CommMode()}}},757:(et,J,T)=>{T.d(J,{C:()=>m});var F=T(5368),f=T(1773),W=T(2912),B=T(6292),K=T(7428),Z=T(2989),V=T(6528);class m extends V.p{constructor(h,c,o,l){super(h,l?c.getObject():c,"",l?c.csstype:"axis"),Object.assign(this,B.KB),this.initAxisPainter(),this.axis=o,l?(this.embedded=!0,this.cssprefix=l,this.rstyle=c.rstyle):this.cssprefix="axis_"}cleanup(){delete this.axis,delete this.axis_g,this.cleanupAxisPainter(),super.cleanup()}getAxisType(){return"RAttrAxis"}configureZAxis(h,c){this.name=h,this.kind="normal",this.log=!1;let o=this.v7EvalAttr("log",0);o&&(this.log=!0,this.logbase=10,Math.abs(o-Math.exp(1))<.1?this.logbase=Math.exp(1):o>1.9&&(this.logbase=Math.round(o))),c.logz=this.log}configureAxis(h,c,o,l,d,p,v,w,M){M||(M={}),this.name=h,this.full_min=c,this.full_max=o,this.kind="normal",this.vertical=p,this.log=!1;let D=this.v7EvalAttr("log",0),z=this.v7EvalAttr("symlog",0);if(this.reverse=M.reverse||!1,this.v7EvalAttr("time")){this.kind="time",this.timeoffset=0;let P=this.v7EvalAttr("timeOffset");void 0!==P&&(P=parseFloat(P),Number.isFinite(P)&&(this.timeoffset=1e3*P))}else this.axis&&this.axis.fLabelsIndex?(this.kind="labels",delete this.own_labels):this.kind=M.labels?"labels":"normal";"time"==this.kind?this.func=(0,W.Xf)().domain([this.convertDate(l),this.convertDate(d)]):z&&z>0?(this.symlog=z,this.func=(0,W.eh)().constant(z).domain([l,d])):D?(d<=0&&(d=1),(l<=0||l>=d)&&(l=1e-4*d),this.log=!0,this.logbase=10,Math.abs(D-Math.exp(1))<.1?this.logbase=Math.exp(1):D>1.9&&(this.logbase=Math.round(D)),this.func=(0,W.p2)().base(this.logbase).domain([l,d])):this.func=(0,W.BY)().domain([l,d]),this.scale_min=l,this.scale_max=d,this.gr_range=w||1e3;let A=v||[0,this.gr_range];this.axis_shift=A[1]-this.gr_range,this.func.range(this.reverse?[A[1],A[0]]:A),this.gr="time"==this.kind?P=>this.func(this.convertDate(P)):this.log?P=>P<this.scale_min?this.vertical?this.func.range()[0]+5:-5:this.func(P):this.func,delete this.format;let O=this.v7EvalAttr("ndiv",508);this.nticks=O%100,this.nticks2=(O%1e4-this.nticks)/100,this.nticks3=Math.floor(O/1e4),this.nticks>20&&(this.nticks=20);let j=Math.abs(this.gr_range)||100;if("time"==this.kind){this.nticks>8&&(this.nticks=8);let P=this.scale_max-this.scale_min,I=this.v7EvalAttr("timeFormat",""),Y=(0,B.ai)(P/j,!1);(!I||P<.1*(this.full_max-this.full_min))&&(I=(0,B.ai)(P/this.nticks,!0)),this.tfunc1=this.tfunc2=(0,W.i$)(I),Y!==I&&(this.tfunc2=(0,W.i$)(Y)),this.format=this.formatTime}else if(this.log)this.nticks2>1&&(this.nticks*=this.nticks2,this.nticks2=1),this.noexp=this.v7EvalAttr("noexp",!1),this.scale_max<300&&this.scale_min>.3&&10==this.logbase&&(this.noexp=!0),this.moreloglabels=this.v7EvalAttr("moreloglbls",!1),this.format=this.formatLog;else if("labels"==this.kind){this.nticks=50;let P=this.scale_max-this.scale_min;this.nticks>P&&(this.nticks=Math.round(P)),this.nticks2=1,this.format=this.formatLabels}else this.order=0,this.ndig=0,this.format=this.formatNormal}getScaleMin(){return this.func?this.func.domain()[0]:0}getScaleMax(){return this.func?this.func.domain()[1]:0}formatLabels(h){let c=Math.round(h);if(this.axis&&this.axis.fLabelsIndex){if(c<0||c>=this.axis.fNBinsNoOver)return null;for(let o=0;o<this.axis.fLabelsIndex.length;++o){let l=this.axis.fLabelsIndex[o];if(l.second===c)return l.first}}else{let o=this.getObject().fLabels;if(o&&c>=0&&c<o.length)return o[c]}return null}createTicks(h,c,o,l){o&&this.nticks&&"normal"==this.kind&&(this.noticksopt=!0);let d={nminor:0,nmiddle:0,nmajor:0,func:this.func};if(d.minor=d.middle=d.major=this.produceTicks(this.nticks),h){let p=d.major,v=1e-5*(this.scale_max-this.scale_min);return p[0]>this.scale_min+v&&p.unshift(this.scale_min),p[p.length-1]<this.scale_max-v&&p.push(this.scale_max),p}if(this.nticks2>1&&(!this.log||10===this.logbase)){d.minor=d.middle=this.produceTicks(d.major.length,this.nticks2);let p=Math.abs(this.func.range()[1]-this.func.range()[0]);d.middle.length<=d.major.length||d.middle.length>p/3.5?d.minor=d.middle=d.major:this.nticks3>1&&!this.log&&(d.minor=this.produceTicks(d.middle.length,this.nticks3),(d.minor.length<=d.middle.length||d.minor.length>p/1.7)&&(d.minor=d.middle))}if(d.reset=function(){this.nminor=this.nmiddle=this.nmajor=0},d.next=function(p){return!(this.nminor>=this.minor.length||(this.tick=this.minor[this.nminor++],this.grpos=this.func(this.tick),p&&(this.grpos=Math.round(this.grpos)),this.kind=3,this.nmiddle<this.middle.length&&Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1&&(this.nmiddle++,this.kind=2),this.nmajor<this.major.length&&Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1&&(this.nmajor++,this.kind=1),0))},d.last_major=function(){return 1===this.kind&&this.nmajor==this.major.length},d.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])},this.order=0,this.ndig=0,"normal"==this.kind&&!this.log&&d.major.length>0){let p=0,v=0,w=!1;if(!c){let A=Math.max(Math.abs(d.major[0]),Math.abs(d.major[d.major.length-1])),O=Math.min(Math.abs(d.major[0]),Math.abs(d.major[d.major.length-1])),j=A>0?3*Math.round(Math.log10(A)/3):0,P=O>0?3*Math.round(Math.log10(O)/3):0;w=A<2e4,(A||O)&&(p=Math.max(j,P)+3,v=Math.min(j,P)-3)}let M=0,D=this.ndig,z=1e10;for(let A=v;A<=p;A+=3){if(w&&3===A)continue;this.order=A,this.ndig=0;let O=[],j=0,P=0;for(;j<d.major.length;){let I=this.format(d.major[j],!0);if(O.indexOf(I)<0)O.push(I),P+=I.length,j++;else{if(++this.ndig>11)break;O=[],j=0,P=0}}!A&&this.ndig<4&&(P-=2*d.major.length+3),P<z&&(z=P,M=this.order,D=this.ndig)}this.order=M,this.ndig=D,l&&(this.order&&console.warn(`Axis painter - integer labels are configured, but axis order ${this.order} is preferable`),this.ndig&&console.warn(`Axis painter - integer labels are configured, but ${this.ndig} decimal digits are required`),this.ndig=0,this.order=0)}return d}isCenteredLabels(){return"labels"===this.kind||"log"!==this.kind&&this.v7EvalAttr("labels_center",!1)}processLabelsMove(h,c){if(this.optionUnlab||!this.axis_g)return!1;let o=this.axis_g.select(".axis_labels");if(!o||1!=o.size())return!1;if("start"==h){let d=o.node().getBBox();return o.append("rect").classed("zoom",!0).attr("x",d.x).attr("y",d.y).attr("width",d.width).attr("height",d.height).style("cursor","move"),this.drag_pos0=this.vertical?c[0]:c[1],!0}let l=o.property("fix_offset");if(this.vertical?(l+=Math.round(c[0]-this.drag_pos0),o.attr("transform",`translate(${l})`)):(l+=Math.round(c[1]-this.drag_pos0),o.attr("transform",`translate(0,${l})`)),l||o.attr("transform",null),"stop"==h&&(o.select("rect.zoom").remove(),delete this.drag_pos0,l!=o.property("fix_offset"))){o.property("fix_offset",l);let d=o.property("side")||1;this.labelsOffset=l/(this.vertical?-d:d),this.changeAxisAttr(1,"labels_offset",this.labelsOffset/this.scalingSize)}return!0}addTitleDrag(h,c){if(!f.settings.MoveResize||(0,f.isBatchMode)())return;let l,d,p,v,w,M,o=null,D=(0,W.oh)().subject(Object);D.on("start",z=>{z.sourceEvent.preventDefault(),z.sourceEvent.stopPropagation();let A=h.node().getBBox(),O=this.vertical?A.height:A.width;p=l=h.property("shift_x"),v=d=h.property("shift_y"),M="center"==this.titlePos?1:"left"==this.titlePos?0:2,w=[0,this.gr_range/2,this.gr_range];let j=this.vertical?-O:O,P=this.isReverseAxis()?2:0;"middle"==this.title_align?(w[P]+=j/2,w[2-P]-=j/2):"begin"==this.title_align^this.isTitleRotated()?(w[1]-=j/2,w[2-P]-=j):(w[P]+=j,w[1]+=j/2),w[M]=this.vertical?d:l,o=h.append("rect").classed("zoom",!0).attr("x",A.x).attr("y",A.y).attr("width",A.width).attr("height",A.height).style("cursor","move")}).on("drag",z=>{if(!o)return;z.sourceEvent.preventDefault(),z.sourceEvent.stopPropagation(),l+=z.dx,d+=z.dy;let A,O,j=this.vertical?d:l,P=0;for(let I=1;I<3;++I)Math.abs(j-w[I])<Math.abs(j-w[P])&&(P=I);this.vertical?(A=l,O=w[P]):(A=w[P],O=d),p=A,v=O,M=P,h.attr("transform","translate("+Math.round(p)+","+Math.round(v)+")")}).on("end",z=>{if(!o)return;z.sourceEvent.preventDefault(),z.sourceEvent.stopPropagation();let A=h.property("basepos")||0;h.property("shift_x",p).property("shift_y",v),this.titleOffset=(this.vertical?A-p:v-A)*c,this.titlePos=1==M?"center":0==M?"left":"right",this.changeAxisAttr(0,"title_position",this.titlePos,"title_offset",this.titleOffset/this.scalingSize),o.remove(),o=null}),h.style("cursor","move").call(D)}isInsideGrRange(h,c,o){return c||(c=0),void 0===o&&(o=c),this.gr_range<0?h>=this.gr_range-o&&h<=c:h>=-c&&h<=this.gr_range+o}getGrRange(h){return h||(h=0),this.gr_range<0?this.gr_range-h:this.gr_range+h}isReverseAxis(){return!this.vertical!=this.getGrRange()>0}drawMainLine(h){let c="";if(this.endingSize&&this.endingStyle){let o=this.gr_range>0?-this.endingSize:this.endingSize,l=Math.round(.7*o);o=Math.round(o),c=this.vertical?`l${l},${o}M0,${this.gr_range}l${-l},${o}`:`l${o},${l}M${this.gr_range},0l${o},${-l}`}h.append("svg:path").attr("d","M0,0"+(this.vertical?"v":"h")+this.gr_range+c).call(this.lineatt.func).style("fill",c?"none":null)}drawTicks(h,c,o){o&&(this.ticks=[]),this.handle.reset();let l="",d=0;for("both"==this.ticksSide&&(c=1,d=1);this.handle.next(!0);){let w=Math.round(this.ticksSize/4),M=0;this.handle.kind<3&&(w=Math.round(this.ticksSize/2));let D=this.handle.grpos-this.axis_shift;(this.startingSize||this.endingSize)&&!this.isInsideGrRange(D,-Math.abs(this.startingSize),-Math.abs(this.endingSize))||(1==this.handle.kind&&(("labels"==this.kind||null!==this.format(this.handle.tick,!0))&&(w=this.ticksSize),o&&this.ticks.push(D)),d>0?M=-w:c<0?(M=-w,w=0):M=0,l+=this.vertical?`M${w},${D}H${M}`:`M${D},${-w}V${-M}`)}l&&h.append("svg:path").attr("d",l).style("stroke",this.ticksColor||this.lineatt.color).style("stroke-width",this.ticksWidth&&1!=this.ticksWidth?this.ticksWidth:null);let p=Math.round(.25*this.ticksSize),v=Math.round(1.25*this.ticksSize);return{"-1":c>0||d?v:p,1:c<0||d?v:p}}drawLabels(h,c,o){var l=this;return(0,F.Z)(function*(){let d=l.isCenteredLabels(),p=0!=l.labelsFont.angle,v=1,w=0,M=!1,D=h.append("svg:g").attr("class","axis_labels").property("side",c),z=l.handle.lbl_pos||l.handle.major,A=0,O=0;function j(N){A=Math.max(A,this.result_width),O=Math.max(O,this.result_height);let X=this.result_width;if(X&&(!N.vertical&&!p||N.vertical&&p)&&!N.log){let U=.45*this.gap_before+.45*this.gap_after;this.gap_before?this.gap_after||(U=.9*this.gap_before):U=.9*this.gap_after,v=Math.min(v,U/X)}v>1e-4&&v<.8&&!N.vertical&&!p&&w>5&&c>0&&(M=!0);let G=v*(M?3:1);G>1e-4&&G<1&&N.scaleTextDrawing(1/G,D)}let P=0,I=Math.round((l.vertical?-c:c)*l.labelsOffset),Y=Math.round((l.vertical?-c:c)*o[c]);I&&D.attr("transform",l.vertical?`translate(${I})`:`translate(0,${I})`),D.property("fix_offset",I),l.startTextDrawing(l.labelsFont,"font",D);for(let N=0;N<z.length;++N){let X=l.format(z[N],!0);if(null===X)continue;let G=Math.round(l.func(z[N])),U={text:X,latex:1,draw_g:D};if(U.gap_before=N>0?Math.abs(Math.round(G-l.func(z[N-1]))):0,U.gap_after=N<z.length-1?Math.abs(Math.round(l.func(z[N+1])-G)):0,d){let _=U.gap_after||U.gap_before;if(G=Math.round(G-(l.vertical?.5*_:-.5*_)),!l.isInsideGrRange(G,5))continue}if(w=Math.max(w,X.length),G-=l.axis_shift,!l.startingSize&&!l.endingSize||l.isInsideGrRange(G,-Math.abs(l.startingSize),-Math.abs(l.endingSize))){if(l.vertical?(U.x=Y,U.y=G,U.align=p?c<0?23:20:c<0?12:32):(U.x=G,U.y=Y,U.align=p?c<0?12:32:c<0?20:23),U.post_process=j,l.drawText(U),P&&G!=P&&(l.vertical&&!p||!l.vertical&&p)){let _=Math.abs(G-P);v=Math.min(v,.9*_/l.labelsFont.size)}P=G}}return l.order&&l.drawText({x:l.vertical?5*c:l.getGrRange(5),y:l.has_obstacle?Y:l.vertical?l.getGrRange(3):-3*c,align:l.vertical?c<0?30:10:l.has_obstacle^c<0?13:10,latex:1,text:"#times"+l.formatExp(10,l.order),draw_g:D}),l.finishTextDrawing(D).then(()=>{if(M&&D.selectAll("text").each(function(){let N=(0,W.Ys)(this),X=N.attr("transform");N.attr("transform",X+" rotate(25)").style("text-anchor","start")}),l.vertical)o[c]+=Math.round(p?1.2*O:A+.4*l.labelsFont.size)-c*I;else{let N=M?A*Math.sin(.1388888888888889*Math.PI)+O*(Math.cos(.1388888888888889*Math.PI)+.2):0;o[c]+=Math.round(Math.max(p?A+.4*l.labelsFont.size:1.2*O,1.2*l.labelsFont.size,N))+I}return o})})()}addZoomingRect(h,c,o){if(f.settings.Zooming&&!this.disable_zooming&&!(0,f.isBatchMode)()){let l=Math.max(o[c],10),d=this.vertical?`v${this.gr_range}h${-c*l}v${-this.gr_range}`:`h${this.gr_range}v${c*l}h${-this.gr_range}`;h.append("svg:path").attr("d",`M0,0${d}z`).attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair")}}isTitleRotated(){return this.titleFont&&this.titleFont.angle!=(this.vertical?270:0)}drawTitle(h,c,o){var l=this;return(0,F.Z)(function*(){if(!l.fTitle)return l;let d=h.append("svg:g").attr("class","axis_title"),p=0,v=0,w=0,M=l.isTitleRotated();return l.startTextDrawing(l.titleFont,"font",d),l.title_align=l.titleCenter?"middle":l.titleOpposite^(l.isReverseAxis()||M)?"begin":"end",l.vertical?(w=Math.round(-c*o[c]),p=w+Math.round(-c*l.titleOffset),v=Math.round(l.titleCenter?l.gr_range/2:l.titleOpposite?0:l.gr_range),l.drawText({align:[l.title_align,c<0^M?"top":"bottom"],text:l.fTitle,draw_g:d})):(p=Math.round(l.titleCenter?l.gr_range/2:l.titleOpposite?0:l.gr_range),w=Math.round(c*o[c]),v=w+Math.round(c*l.titleOffset),l.drawText({align:[l.title_align,c>0^M?"top":"bottom"],text:l.fTitle,draw_g:d})),d.attr("transform",`translate(${p},${v})`).property("basepos",w).property("shift_x",p).property("shift_y",v),l.addTitleDrag(d,c),l.finishTextDrawing(d)})()}extractDrawAttributes(h){let c=this.getPadPainter(),o=c?.getPadRect()||{width:10,height:10};this.scalingSize=h||(this.vertical?o.width:o.height),this.createv7AttLine("line_"),this.optionUnlab=this.v7EvalAttr("labels_hide",!1),this.endingStyle=this.v7EvalAttr("ending_style",""),this.endingSize=Math.round(this.v7EvalLength("ending_size",this.scalingSize,this.endingStyle?.02:0)),this.startingSize=Math.round(this.v7EvalLength("starting_size",this.scalingSize,0)),this.ticksSize=this.v7EvalLength("ticks_size",this.scalingSize,.02),this.ticksSide=this.v7EvalAttr("ticks_side","normal"),this.ticksColor=this.v7EvalColor("ticks_color",""),this.ticksWidth=this.v7EvalAttr("ticks_width",1),h&&this.ticksSize<0&&(this.ticksSize=-this.ticksSize),this.fTitle=this.v7EvalAttr("title_value",""),this.fTitle?(this.titleFont=this.v7EvalFont("title",{size:.03},h||c?.getPadHeight()||10),this.titleFont.roundAngle(180,this.vertical?270:0),this.titleOffset=this.v7EvalLength("title_offset",this.scalingSize,0),this.titlePos=this.v7EvalAttr("title_position","right"),this.titleCenter="center"==this.titlePos,this.titleOpposite="left"==this.titlePos):(delete this.titleFont,delete this.titleOffset,delete this.titlePos),this.labelsFont=this.v7EvalFont("labels",{size:h?.05:.03}),this.labelsFont.roundAngle(180),this.labelsFont.angle&&(this.labelsFont.angle=270),this.labelsOffset=this.v7EvalLength("labels_offset",this.scalingSize,0),h&&(this.ticksSize=.5*this.labelsFont.size),this.maxTickSize&&this.ticksSize>this.maxTickSize&&(this.ticksSize=this.maxTickSize)}drawAxis(h,c,o){var l=this;return(0,F.Z)(function*(){let d=h;void 0===o&&(o=1),l.standalone||(d=h.select("."+l.name+"_container"),d.empty()?d=h.append("svg:g").attr("class",l.name+"_container"):d.selectAll("*").remove()),d.attr("transform",c||null),l.extractDrawAttributes(),l.axis_g=d,l.side=o,"invert"==l.ticksSide&&(o=-o),l.standalone&&l.drawMainLine(d),l.handle=l.createTicks(!1,!1,!1,!1);let M=l.drawTicks(d,o,!0);return(l.optionUnlab?Promise.resolve(M):l.drawLabels(d,o,M)).then(z=>(l.addZoomingRect(d,l.standalone?o:l.side,z),l.drawTitle(d,o,z)))})()}setAfterDrawHandler(h){this._afterDrawAgain=h}drawAxisAgain(){if(!this.axis_g||!this.side)return;this.axis_g.selectAll("*").remove(),this.extractDrawAttributes();let h=this.side;"invert"==this.ticksSide&&(h=-h),this.standalone&&this.drawMainLine(this.axis_g);let c=this.drawTicks(this.axis_g,h,!1);return(this.optionUnlab?Promise.resolve(c):this.drawLabels(this.axis_g,h,c)).then(l=>(this.addZoomingRect(this.axis_g,this.standalone?h:this.side,l),this.drawTitle(this.axis_g,h,l))).then(()=>{(0,f.isFunc)(this._afterDrawAgain)&&this._afterDrawAgain()})}drawAxisOtherPlace(h,c,o,l){let d=h.select("."+this.name+"_container2");d.empty()?d=h.append("svg:g").attr("class",this.name+"_container2"):d.selectAll("*").remove(),d.attr("transform",c||null),"invert"==this.ticksSide&&(o=-o);let p=this.drawTicks(d,o,!1);return(this.optionUnlab||l?Promise.resolve(p):this.drawLabels(d,o,p)).then(w=>(this.addZoomingRect(d,o,w),!0))}zoomStandalone(h,c){this.changeAxisAttr(1,"zoomMin",h,"zoomMax",c)}redraw(){let h=this.getObject(),c=this.getPadPainter(),o=c.getCoordinate(h.fPos),l=c.getPadLength(h.fVertical,h.fLength),d=this.v7EvalAttr("reverse",!1),p=h.fLabels.length,v=p>0?0:this.v7EvalAttr("min",0),w=p>0?p:this.v7EvalAttr("max",100);h.fVertical&&(l-=c.getPadHeight());let M=this.v7EvalAttr("zoomMin"),D=this.v7EvalAttr("zoomMax");M===D&&(M=v,D=w),this.configureAxis("axis",v,w,M,D,h.fVertical,void 0,l,{reverse:d,labels:p>0}),this.createG(),this.standalone=!0;let z=this.drawAxis(this.draw_g,`translate(${o.x},${o.y})`);return(0,f.isBatchMode)()?z:z.then(()=>{f.settings.ContextMenu&&this.draw_g.on("contextmenu",A=>{A.stopPropagation(),A.preventDefault(),(0,K.Z)(A,this).then(O=>{O.add("header:RAxisDrawable"),O.add("Unzoom",()=>this.zoomStandalone()),this.fillAxisContextMenu(O,""),O.show()})}),(0,Z.uI)(this,{x:o.x,y:o.y,width:this.vertical?10:l,height:this.vertical?l:10,only_move:!0,redraw:A=>this.positionChanged(A)}),this.draw_g.on("dblclick",()=>this.zoomStandalone()),f.settings.ZoomWheel&&this.draw_g.on("wheel",A=>{A.stopPropagation(),A.preventDefault();let O=(0,W.cx)(A,this.draw_g.node()),P=this.analyzeWheelEvent(A,this.vertical?1-O[1]/l:O[0]/l);P.changed&&this.zoomStandalone(P.min,P.max)})})}positionChanged(h){let c=this.getObject(),o=this.getPadPainter().getPadRect(),l=h.x/o.width,d=1-h.y/o.height;c.fPos.fHoriz.fArr=[l],c.fPos.fVert.fArr=[d],this.submitCanvExec(`SetPos({${l.toFixed(4)},${d.toFixed(4)}})`)}changeAxisAttr(h){let c={},o=1;for(;o<arguments.length-1;)this.v7AttrChange(c,arguments[o],arguments[o+1]),this.v7SetAttr(arguments[o],arguments[o+1]),o+=2;this.v7SendAttrChanges(c,!1),1===h?this.standalone?this.redraw():this.drawAxisAgain():h&&this.redrawPad()}changeAxisLog(h){"labels"==this.kind||"time"==this.kind||("toggle"===h&&(h=this.log?0:10),h=parseFloat(h),Number.isFinite(h)&&this.changeAxisAttr(2,"log",h,"symlog",0))}fillAxisContextMenu(h,c){return c&&h.add("Unzoom",()=>this.getFramePainter().unzoom(c)),h.add("sub:Log scale",()=>this.changeAxisLog("toggle")),h.addchk(!this.log&&!this.symlog,"linear",0,o=>this.changeAxisLog(o)),h.addchk(this.log&&!this.symlog&&10==this.logbase,"log10",()=>this.changeAxisLog(10)),h.addchk(this.log&&!this.symlog&&2==this.logbase,"log2",()=>this.changeAxisLog(2)),h.addchk(this.log&&!this.symlog&&Math.abs(this.logbase-Math.exp(1))<.1,"ln",()=>this.changeAxisLog(Math.exp(1))),h.addchk(!this.log&&this.symlog,"symlog",0,()=>h.input("set symlog constant",this.symlog||10,"float").then(o=>this.changeAxisAttr(2,"symlog",o))),h.add("endsub:"),h.add("Divisions",()=>h.input("Set axis devisions",this.v7EvalAttr("ndiv",508),"int").then(o=>this.changeAxisAttr(2,"ndiv",o))),h.add("sub:Ticks"),h.addRColorMenu("color",this.ticksColor,o=>this.changeAxisAttr(1,"ticks_color",o)),h.addSizeMenu("size",0,.05,.01,this.ticksSize/this.scalingSize,o=>this.changeAxisAttr(1,"ticks_size",o)),h.addSelectMenu("side",["normal","invert","both"],this.ticksSide,o=>this.changeAxisAttr(1,"ticks_side",o)),h.add("endsub:"),!this.optionUnlab&&this.labelsFont&&(h.add("sub:Labels"),h.addSizeMenu("offset",-.05,.05,.01,this.labelsOffset/this.scalingSize,o=>this.changeAxisAttr(1,"labels_offset",o)),h.addRAttrTextItems(this.labelsFont,{noangle:1,noalign:1},o=>this.changeAxisAttr(1,"labels_"+o.name,o.value)),h.addchk(this.labelsFont.angle,"rotate",o=>this.changeAxisAttr(1,"labels_angle",o?180:0)),h.add("endsub:")),h.add("sub:Title",()=>h.input("Enter axis title",this.fTitle).then(o=>this.changeAxisAttr(1,"title_value",o))),this.fTitle&&(h.addSizeMenu("offset",-.05,.05,.01,this.titleOffset/this.scalingSize,o=>this.changeAxisAttr(1,"title_offset",o)),h.addSelectMenu("position",["left","center","right"],this.titlePos,o=>this.changeAxisAttr(1,"title_position",o)),h.addchk(this.isTitleRotated(),"rotate",o=>this.changeAxisAttr(1,"title_angle",o?180:0)),h.addRAttrTextItems(this.titleFont,{noangle:1,noalign:1},o=>this.changeAxisAttr(1,"title_"+o.name,o.value))),h.add("endsub:"),!0}}},6717:(et,J,T)=>{T.r(J),T.d(J,{RCanvasPainter:()=>j,RObjectPainter:()=>V.p,RPadPainter:()=>w,drawRAxis:()=>G,drawRFont:()=>X,drawRFrame:()=>U,drawRFrameTitle:()=>N,drawRPadSnapshot:()=>P,ensureRCanvas:()=>I});var F=T(5368),f=T(1773),W=T(2912),B=T(7222),K=T(1727),Z=T(2454),V=T(6528),m=T(757),b=T(1671),h=T(6292),c=T(2989);class o extends V.p{constructor(t,e){super(t,e,"","frame"),this.mode3d=!1,this.xmin=this.xmax=0,this.ymin=this.ymax=0,this.axes_drawn=!1,this.keys_handler=null,this.projection=0,this.v7_frame=!0}getFramePainter(){return this}is_root6(){return!1}setFrameActive(t){this.enabledKeys=!(!t||!f.settings.HandleKeys),this.control&&(this.control.enableKeys=this.enabledKeys)}setLastEventPos(t){this.fLastEventPnt=t}getLastEventPos(){return this.fLastEventPnt}updateAttributes(t){if(void 0===this.fX1NDC||t&&!this.modified_NDC){let e=this.getPadPainter().getPadRect();this.fX1NDC=this.v7EvalLength("margins_left",e.width,f.settings.FrameNDC.fX1NDC)/e.width,this.fY1NDC=this.v7EvalLength("margins_bottom",e.height,f.settings.FrameNDC.fY1NDC)/e.height,this.fX2NDC=1-this.v7EvalLength("margins_right",e.width,1-f.settings.FrameNDC.fX2NDC)/e.width,this.fY2NDC=1-this.v7EvalLength("margins_top",e.height,1-f.settings.FrameNDC.fY2NDC)/e.height}this.fillatt||this.createv7AttFill(),this.createv7AttLine("border_")}getProjectionFunc(){switch(this.projection){case 1:return(t,e)=>{const i=Math.PI/180,s=t/2*i,r=e*i,a=Math.sqrt(2),n=2*a/Math.PI,u=Math.cos(r),g=Math.sqrt(1+u*Math.cos(s));return{x:u*Math.sin(s)*2*a/g/n/i,y:Math.sin(r)*a/g/n/i}};case 2:return(t,e)=>({x:t,y:Math.log(Math.tan((Math.PI/2+e/180*Math.PI)/2))});case 3:return(t,e)=>({x:t*Math.cos(e/180*Math.PI),y:e});case 4:return(t,e)=>({x:t*(2*Math.cos(2*e/180*Math.PI/3)-1),y:180*Math.sin(e/180*Math.PI/3)})}}recalculateRange(t){this.projection=t||0,2==this.projection&&(this.scale_ymin<=-90||this.scale_ymax>=90)&&(console.warn(`Mercator Projection: latitude out of range ${this.scale_ymin} ${this.scale_ymax}`),this.projection=0);let e=this.getProjectionFunc();if(!e)return;let i=[e(this.scale_xmin,this.scale_ymin),e(this.scale_xmin,this.scale_ymax),e(this.scale_xmax,this.scale_ymax),e(this.scale_xmax,this.scale_ymin)];this.scale_xmin<0&&this.scale_xmax>0&&(i.push(e(0,this.scale_ymin)),i.push(e(0,this.scale_ymax))),this.scale_ymin<0&&this.scale_ymax>0&&(i.push(e(this.scale_xmin,0)),i.push(e(this.scale_xmax,0))),this.original_xmin=this.scale_xmin,this.original_xmax=this.scale_xmax,this.original_ymin=this.scale_ymin,this.original_ymax=this.scale_ymax,this.scale_xmin=this.scale_xmax=i[0].x,this.scale_ymin=this.scale_ymax=i[0].y;for(let s=1;s<i.length;++s)this.scale_xmin=Math.min(this.scale_xmin,i[s].x),this.scale_xmax=Math.max(this.scale_xmax,i[s].x),this.scale_ymin=Math.min(this.scale_ymin,i[s].y),this.scale_ymax=Math.max(this.scale_ymax,i[s].y)}drawGrids(){let t=this.getFrameSvg().select(".grid_layer");t.selectAll(".xgrid").remove(),t.selectAll(".ygrid").remove();let e=this.getFrameHeight(),i=this.getFrameWidth(),s=this.v7EvalAttr("gridX",!1),r=this.v7EvalAttr("gridY",!1),a=(0,b.p)(f.gStyle.fGridStyle),n=f.gStyle.fGridColor>0?this.getColor(f.gStyle.fGridColor):"black";if(this.x_handle&&(this.x_handle.draw_grid=s),this.x_handle&&this.x_handle.draw_grid){let u="";for(let g=0;g<this.x_handle.ticks.length;++g)u+=this.swap_xy?`M0,${e+this.x_handle.ticks[g]}h${i}`:`M${this.x_handle.ticks[g]},0v${e}`;u&&t.append("svg:path").attr("class","xgrid").attr("d",u).style("stroke",n).style("stroke-width",f.gStyle.fGridWidth).style("stroke-dasharray",a)}if(this.y_handle&&(this.y_handle.draw_grid=r),this.y_handle&&this.y_handle.draw_grid){let u="";for(let g=0;g<this.y_handle.ticks.length;++g)u+=this.swap_xy?`M${this.y_handle.ticks[g]},0v${e}`:`M0,${e+this.y_handle.ticks[g]}h${i}`;u&&t.append("svg:path").attr("class","ygrid").attr("d",u).style("stroke",n).style("stroke-width",f.gStyle.fGridWidth).style("stroke-dasharray",a)}}axisAsText(t,e){let i=this[t+"_handle"];return i?i.axisAsText(e,f.settings[t.toUpperCase()+"ValuesFormat"]):e.toPrecision(4)}_setAxisRange(t,e,i){let s=t+"min",r=t+"max";if(this[s]!=this[r])return;let a=this.v7EvalAttr(t+"_min"),n=this.v7EvalAttr(t+"_max");void 0!==a&&(e=a),void 0!==n&&(i=n),e<i&&(this[s]=e,this[r]=i);let u="zoom_"+t+"min",g="zoom_"+t+"max";this[u]==this[g]&&!this.zoomChangedInteractive(t)&&(a=this.v7EvalAttr(t+"_zoomMin"),n=this.v7EvalAttr(t+"_zoomMax"),(void 0!==a||void 0!==n)&&(this[u]=void 0===a?this[s]:a,this[g]=void 0===n?this[r]:n))}setAxesRanges(t,e,i,s,r,a,n,u,g){this.axes_drawn||(this.xaxis=t,this._setAxisRange("x",e,i),this.yaxis=s,this._setAxisRange("y",r,a),this.zaxis=n,this._setAxisRange("z",u,g))}setAxes2Ranges(t,e,i,s,r,a,n,u){t&&(this.x2axis=e,this._setAxisRange("x2",i,s)),r&&(this.y2axis=a,this._setAxisRange("y2",n,u))}createXY(t){if(this.self_drawaxes)return;this.cleanXY(),t||(t={}),this.v6axes=!0,this.swap_xy=t.swap_xy||!1,this.reverse_x=t.reverse_x||!1,this.reverse_y=t.reverse_y||!1,this.logx=this.v7EvalAttr("x_log",0),this.logy=this.v7EvalAttr("y_log",0);let e=this.getFrameWidth(),i=this.getFrameHeight();this.scale_xmin=this.xmin,this.scale_xmax=this.xmax,this.scale_ymin=this.ymin,this.scale_ymax=this.ymax,t.extra_y_space&&((this.swap_xy?this.logx:this.logy)&&this.scale_ymax>0?this.scale_ymax=Math.exp(1.1*Math.log(this.scale_ymax)):this.scale_ymax+=.1*(this.scale_ymax-this.scale_ymin)),this.zoom_ymin==this.zoom_ymax&&t.zoom_ymin!=t.zoom_ymax&&!this.zoomChangedInteractive("y")&&(this.zoom_ymin=t.zoom_ymin,this.zoom_ymax=t.zoom_ymax),this.zoom_xmin!=this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax),this.zoom_ymin!=this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);let s=this.xaxis,r=this.yaxis;s?._typename!=f.clTAxis&&(s=(0,f.create)(f.clTAxis)),r?._typename!=f.clTAxis&&(r=(0,f.create)(f.clTAxis)),this.x_handle=new h.z4(this.getDom(),s,!0),this.x_handle.setPadName(this.getPadName()),this.x_handle.optionUnlab=this.v7EvalAttr("x_labels_hide",!1),this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,this.swap_xy,this.swap_xy?[0,i]:[0,e],{reverse:this.reverse_x,log:this.swap_xy?this.logy:this.logx,symlog:this.swap_xy?t.symlog_y:t.symlog_x,logcheckmin:this.swap_xy,logminfactor:1e-4}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle=new h.z4(this.getDom(),r,!0),this.y_handle.setPadName(this.getPadName()),this.y_handle.optionUnlab=this.v7EvalAttr("y_labels_hide",!1),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!this.swap_xy,this.swap_xy?[0,e]:[0,i],{reverse:this.reverse_y,log:this.swap_xy?this.logx:this.logy,symlog:this.swap_xy?t.symlog_x:t.symlog_y,logcheckmin:t.ndim<2||this.swap_xy,log_min_nz:t.ymin_nz&&t.ymin_nz<.01*this.ymax?.3*t.ymin_nz:0,logminfactor:3e-4}),this.y_handle.assignFrameMembers(this,"y")}hasDrawnAxes(t,e){return!t&&!e&&this.axes_drawn}drawAxes(){var t=this;return(0,F.Z)(function*(){if(t.axes_drawn||t.xmin==t.xmax||t.ymin==t.ymax)return t.axes_drawn;let e=t.v7EvalAttr("ticksX",1),i=t.v7EvalAttr("ticksY",1),s=1,r=1;t.v7EvalAttr("swapX",!1)&&(s=-1),t.v7EvalAttr("swapY",!1)&&(r=-1);let a=t.getFrameWidth(),n=t.getFrameHeight();t.v6axes||(t.cleanupAxes(),t.swap_xy=!1,t.zoom_xmin!=t.zoom_xmax?(t.scale_xmin=t.zoom_xmin,t.scale_xmax=t.zoom_xmax):(t.scale_xmin=t.xmin,t.scale_xmax=t.xmax),t.zoom_ymin!=t.zoom_ymax?(t.scale_ymin=t.zoom_ymin,t.scale_ymax=t.zoom_ymax):(t.scale_ymin=t.ymin,t.scale_ymax=t.ymax),t.recalculateRange(0),t.x_handle=new m.C(t.getDom(),t,t.xaxis,"x_"),t.x_handle.setPadName(t.getPadName()),t.x_handle.snapid=t.snapid,t.x_handle.draw_swapside=s<0,t.x_handle.draw_ticks=e,t.y_handle=new m.C(t.getDom(),t,t.yaxis,"y_"),t.y_handle.setPadName(t.getPadName()),t.y_handle.snapid=t.snapid,t.y_handle.draw_swapside=r<0,t.y_handle.draw_ticks=i,t.z_handle=new m.C(t.getDom(),t,t.zaxis,"z_"),t.z_handle.setPadName(t.getPadName()),t.z_handle.snapid=t.snapid,t.x_handle.configureAxis("xaxis",t.xmin,t.xmax,t.scale_xmin,t.scale_xmax,!1,[0,a],a,{reverse:!1}),t.x_handle.assignFrameMembers(t,"x"),t.y_handle.configureAxis("yaxis",t.ymin,t.ymax,t.scale_ymin,t.scale_ymax,!0,[n,0],-n,{reverse:!1}),t.y_handle.assignFrameMembers(t,"y"),t.z_handle.configureZAxis("zaxis",t));let u=t.getFrameSvg().select(".axis_layer");t.x_handle.has_obstacle=!1;let k,g=t.swap_xy?t.y_handle:t.x_handle,x=t.swap_xy?t.x_handle:t.y_handle;if(t.getPadPainter()?._fast_drawing)k=Promise.resolve(!0);else if(t.v6axes){let S=!1,R=!1,E=!1;g.disable_ticks=e<=0,x.disable_ticks=i<=0;let C=g.drawAxis(u,a,n,g.invert_side?void 0:`translate(0,${n})`,e>1?-n:0,R,void 0,!1),q=x.drawAxis(u,a,n,x.invert_side?`translate(${a})`:void 0,i>1?a:0,E,x.invert_side?0:t._frame_x,S);k=Promise.all([C,q]).then(()=>t.drawGrids())}else{let S=[];e>0&&S.push(g.drawAxis(u,s>0?`translate(0,${n})`:"",s)),i>0&&S.push(x.drawAxis(u,r>0?`translate(0,${n})`:`translate(${a},${n})`,r)),k=Promise.all(S).then(()=>(S=[],e>1&&S.push(g.drawAxisOtherPlace(u,s<0?`translate(0,${n})`:"",-s,2==e)),i>1&&S.push(x.drawAxisOtherPlace(u,r<0?`translate(0,${n})`:`translate(${a},${n})`,-r,2==i)),Promise.all(S))).then(()=>t.drawGrids())}return k.then(()=>(t.axes_drawn=!0,!0))})()}drawAxes2(t,e){let a,n,i=this.getFrameWidth(),s=this.getFrameHeight(),r=this.getFrameSvg().select(".axis_layer");return t&&(this.zoom_x2min!=this.zoom_x2max?(this.scale_x2min=this.zoom_x2min,this.scale_x2max=this.zoom_x2max):(this.scale_x2min=this.x2min,this.scale_x2max=this.x2max),this.x2_handle=new m.C(this.getDom(),this,this.x2axis,"x2_"),this.x2_handle.setPadName(this.getPadName()),this.x2_handle.snapid=this.snapid,this.x2_handle.configureAxis("x2axis",this.x2min,this.x2max,this.scale_x2min,this.scale_x2max,!1,[0,i],i,{reverse:!1}),this.x2_handle.assignFrameMembers(this,"x2"),a=this.x2_handle.drawAxis(r,"",-1)),e&&(this.zoom_y2min!=this.zoom_y2max?(this.scale_y2min=this.zoom_y2min,this.scale_y2max=this.zoom_y2max):(this.scale_y2min=this.y2min,this.scale_y2max=this.y2max),this.y2_handle=new m.C(this.getDom(),this,this.y2axis,"y2_"),this.y2_handle.setPadName(this.getPadName()),this.y2_handle.snapid=this.snapid,this.y2_handle.configureAxis("y2axis",this.y2min,this.y2max,this.scale_y2min,this.scale_y2max,!0,[s,0],-s,{reverse:!1}),this.y2_handle.assignFrameMembers(this,"y2"),n=this.y2_handle.drawAxis(r,`translate(${i},${s})`,-1)),Promise.all([a,n])}getGrFuncs(t,e){let i=t&&this.grx2,s=e&&this.gry2;return i||s?{use_x2:i,grx:i?this.grx2:this.grx,x_handle:i?this.x2_handle:this.x_handle,logx:i?this.x2_handle.log:this.x_handle.log,scale_xmin:i?this.scale_x2min:this.scale_xmin,scale_xmax:i?this.scale_x2max:this.scale_xmax,use_y2:s,gry:s?this.gry2:this.gry,y_handle:s?this.y2_handle:this.y_handle,logy:s?this.y2_handle.log:this.y_handle.log,scale_ymin:s?this.scale_y2min:this.scale_ymin,scale_ymax:s?this.scale_y2max:this.scale_ymax,swap_xy:this.swap_xy,fp:this,revertAxis(r,a){return"x"==r&&this.use_x2&&(r="x2"),"y"==r&&this.use_y2&&(r="y2"),this.fp.revertAxis(r,a)},axisAsText(r,a){return"x"==r&&this.use_x2&&(r="x2"),"y"==r&&this.use_y2&&(r="y2"),this.fp.axisAsText(r,a)}}:this}sizeChanged(){let t={};this.v7AttrChange(t,"margins_left",this.fX1NDC),this.v7AttrChange(t,"margins_bottom",this.fY1NDC),this.v7AttrChange(t,"margins_right",1-this.fX2NDC),this.v7AttrChange(t,"margins_top",1-this.fY2NDC),this.v7SendAttrChanges(t,!1),this.redrawPad()}cleanXY(){let t=(e,i)=>{this[e]&&(this[e].cleanup(),delete this[e]),delete this[i]};t("x_handle","grx"),t("y_handle","gry"),t("z_handle","grz"),t("x2_handle","grx2"),t("y2_handle","gry2"),delete this.v6axes}cleanupAxes(){this.cleanXY(),this.draw_g&&(this.draw_g.select(".grid_layer").selectAll("*").remove(),this.draw_g.select(".axis_layer").selectAll("*").remove()),this.axes_drawn=!1}cleanFrameDrawings(){(0,f.isFunc)(this.create3DScene)&&this.create3DScene(-1),this.cleanupAxes();let t=e=>{this[e+"min"]=this[e+"max"]=0,this[`zoom_${e}min`]=this[`zoom_${e}max`]=0,this[`scale_${e}min`]=this[`scale_${e}max`]=0};t("x"),t("y"),t("z"),t("x2"),t("y2"),this.draw_g&&(this.draw_g.select(".main_layer").selectAll("*").remove(),this.draw_g.select(".upper_layer").selectAll("*").remove())}cleanup(){this.cleanFrameDrawings(),this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null)),this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null),delete this.enabledKeys,delete this.self_drawaxes,delete this.xaxis,delete this.yaxis,delete this.zaxis,delete this.x2axis,delete this.y2axis,delete this.draw_g,delete this._click_handler,delete this._dblclick_handler;let t=this.getPadPainter();t?.frame_painter_ref===this&&delete t.frame_painter_ref,super.cleanup()}redraw(){let t=this.getPadPainter();t&&(t.frame_painter_ref=this),this.updateAttributes();let g,x,y,e=t?.getPadRect()??{width:10,height:10},i=Math.round(e.width*this.fX1NDC),s=Math.round(e.width*(this.fX2NDC-this.fX1NDC)),r=Math.round(e.height*(1-this.fY2NDC)),a=Math.round(e.height*(this.fY2NDC-this.fY1NDC)),n=!1,u=!1;if(t?.options&&(t.options.RotateFrame&&(n=!0),t.options.FixFrame&&(u=!0)),n?(g=`rotate(-90,${i},${r}) translate(${i-a},${r})`,[s,a]=[a,s]):g=`translate(${i},${r})`,this._frame_x=i,this._frame_y=r,this._frame_width=s,this._frame_height=a,this._frame_rotate=n,this._frame_fixpos=u,this.mode3d)return this;this.draw_g=this.getFrameSvg(),this.draw_g.empty()?(this.draw_g=this.getLayerSvg("primitives_layer").append("svg:g").attr("class","root_frame"),(0,f.isBatchMode)()||this.draw_g.append("svg:title").text(""),x=this.draw_g.append("svg:rect"),this.draw_g.append("svg:g").attr("class","grid_layer"),y=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden"),this.draw_g.append("svg:g").attr("class","axis_layer"),this.draw_g.append("svg:g").attr("class","upper_layer")):(x=this.draw_g.select("rect"),y=this.draw_g.select(".main_layer")),this.axes_drawn=!1,this.draw_g.attr("transform",g),x.attr("x",0).attr("y",0).attr("width",s).attr("height",a).attr("rx",this.lineatt.rx||null).attr("ry",this.lineatt.ry||null).call(this.fillatt.func).call(this.lineatt.func),y.attr("width",s).attr("height",a).attr("viewBox",`0 0 ${s} ${a}`);let k=Promise.resolve(!0);return this.v7EvalAttr("drawAxes")&&(this.self_drawaxes=!0,this.setAxesRanges(),k=this.drawAxes().then(()=>this.addInteractivity())),k.then(()=>((0,f.isBatchMode)()||(x.style("pointer-events","visibleFill"),c.J9.assign(this),this.addBasicInteractivity()),this))}getFrameWidth(){return this._frame_width||0}getFrameHeight(){return this._frame_height||0}getFrameRect(){return{x:this._frame_x||0,y:this._frame_y||0,width:this.getFrameWidth(),height:this.getFrameHeight(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}}getHistPalette(){return this.getPadPainter().getHistPalette()}configureUserClickHandler(t){this._click_handler=(0,f.isFunc)(t)?t:null}configureUserDblclickHandler(t){this._dblclick_handler=(0,f.isFunc)(t)?t:null}zoom(t,e,i,s,r,a){var n=this;return(0,F.Z)(function*(){if(n.projection)return!1;"x"===t?(t=e,e=i,i=void 0):"y"===t?(s=i,i=e,t=e=void 0):"z"===t&&(r=e,a=i,t=e=i=void 0);let u=t!==e,g=i!==s,x=r!==a,y=!1,k=!1,S=!1;if(u){let $=0;t<=n.xmin&&(t=n.xmin,$++),e>=n.xmax&&(e=n.xmax,$++),2===$&&(u=!1,y=!0)}else y=t===e&&0===t;if(g){let $=0;i<=n.ymin&&(i=n.ymin,$++),s>=n.ymax&&(s=n.ymax,$++),2===$&&(g=!1,k=!0)}else k=i===s&&0===i;if(x){let $=0;r<=n.zmin&&(r=n.zmin,$++),a>=n.zmax&&(a=n.zmax,$++),2===$&&(x=!1,S=!0)}else S=r===a&&0===r;let R=!1,E="",C="",q="",H=!1,L={_typename:"ROOT::Experimental::RFrame::RUserRanges",values:[0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1]};const Q=($,tt)=>{!tt&&!(0,f.isFunc)($.canZoomInside)||(H=!0,u&&(tt||$.canZoomInside("x",t,e))&&(n.zoom_xmin=t,n.zoom_xmax=e,R=!0,E="0",u=!1,L.values[0]=t,L.values[1]=e,L.flags[0]=L.flags[1]=!0),g&&(tt||$.canZoomInside("y",i,s))&&(n.zoom_ymin=i,n.zoom_ymax=s,R=!0,C="1",g=!1,L.values[2]=i,L.values[3]=s,L.flags[2]=L.flags[3]=!0),x&&(tt||$.canZoomInside("z",r,a))&&(n.zoom_zmin=r,n.zoom_zmax=a,R=!0,q="2",x=!1,L.values[4]=r,L.values[5]=a,L.flags[4]=L.flags[5]=!0))};return(u||g||x)&&n.forEachPainter($=>Q($)),!H&&n.self_drawaxes&&Q(null,!0),(y||k||S)&&(y&&(n.zoom_xmin!==n.zoom_xmax&&(R=!0,E="0"),n.zoom_xmin=n.zoom_xmax=0,L.values[0]=L.values[1]=-1),k&&(n.zoom_ymin!==n.zoom_ymax&&(R=!0,C="1"),n.zoom_ymin=n.zoom_ymax=0,L.values[2]=L.values[3]=-1),S&&(n.zoom_zmin!==n.zoom_zmax&&(R=!0,q="2"),n.zoom_zmin=n.zoom_zmax=0,L.values[4]=L.values[5]=-1)),!!R&&(n.v7NormalMode()&&n.v7SubmitRequest("zoom",{_typename:"ROOT::Experimental::RFrame::RZoomRequest",ranges:L}),n.interactiveRedraw("pad","zoom"+E+C+q).then(()=>!0))})()}zoomSingle(t,e,i){var s=this;return(0,F.Z)(function*(){let a=["x","y","z","x2","y2"].indexOf(t);if(s.projection||!s[t+"_handle"]||a<0)return!1;let n=e!==i,u=!1;if(n){let S=0;e<=s[t+"min"]&&(e=s[t+"min"],S++),i>=s[t+"max"]&&(i=s[t+"max"],S++),2===S&&(n=!1,u=!0)}else u=e===i&&0===e;let g=!1,x=!1,y={_typename:"ROOT::Experimental::RFrame::RUserRanges",values:[0,0,0,0,0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]},k=(S,R)=>{!R&&!(0,f.isFunc)(S?.canZoomInside)||(x=!0,n&&(R||S.canZoomInside(t[0],e,i))&&(s["zoom_"+t+"min"]=e,s["zoom_"+t+"max"]=i,g=!0,n=!1,y.values[2*a]=e,y.values[2*a+1]=i,y.flags[2*a]=y.flags[2*a+1]=!0))};return n&&s.forEachPainter(S=>k(S)),!x&&s.self_drawaxes&&k(null,!0),u&&(s[`zoom_${t}min`]!==s[`zoom_${t}max`]&&(g=!0),s[`zoom_${t}min`]=s[`zoom_${t}max`]=0,y.values[2*a]=y.values[2*a+1]=-1),!!g&&(s.v7NormalMode()&&s.v7SubmitRequest("zoom",{_typename:"ROOT::Experimental::RFrame::RZoomRequest",ranges:y}),s.interactiveRedraw("pad","zoom"+a).then(()=>!0))})()}isAxisZoomed(t){return this["zoom_"+t+"min"]!==this["zoom_"+t+"max"]}unzoom(t,e,i){var s=this;return(0,F.Z)(function*(){return"all"==t?s.unzoom("x2").then(()=>s.unzoom("y2")).then(()=>s.unzoom("xyz")):"x2"==t||"y2"==t?s.zoomSingle(t,0,0).then(r=>(r&&s.zoomChangedInteractive(t,"unzoom"),r)):(typeof t>"u"?t=e=i=!0:(0,f.isStr)(t)&&(i=t.indexOf("z")>=0,e=t.indexOf("y")>=0,t=t.indexOf("x")>=0),s.zoom(t?0:void 0,t?0:void 0,e?0:void 0,e?0:void 0,i?0:void 0,i?0:void 0).then(r=>(r&&t&&s.zoomChangedInteractive("x","unzoom"),r&&e&&s.zoomChangedInteractive("y","unzoom"),r&&i&&s.zoomChangedInteractive("z","unzoom"),r)))})()}zoomChangedInteractive(t,e){if("reset"==t)return void(this.zoom_changed_x=this.zoom_changed_y=this.zoom_changed_z=void 0);if(!t||"any"==t)return this.zoom_changed_x||this.zoom_changed_y||this.zoom_changed_z;if("x"!==t&&"y"!==t&&"z"!==t)return;let i="zoom_changed_"+t;if(void 0===e)return this[i];"unzoom"!==e?e&&(this[i]=!0):this[i]=void 0===this[i]}fillObjectOfflineMenu(t,e){"x"!=e&&"y"!=e||t.add("Unzoom",()=>this.unzoom(e))}changeFrameAttr(t,e){let i={};this.v7AttrChange(i,t,e),this.v7SetAttr(t,e),this.v7SendAttrChanges(i,!1),this.redrawPad()}fillContextMenu(t,e){if("x"==e||"y"==e||"x2"==e||"y2"==e){let s=this[e+"_handle"];return!!s&&(t.add("header: "+e.toUpperCase()+" axis"),s.fillAxisContextMenu(t,e))}let i=0==t.size();return t.add(i?"header:Frame":"separator"),this.zoom_xmin!==this.zoom_xmax&&t.add("Unzoom X",()=>this.unzoom("x")),this.zoom_ymin!==this.zoom_ymax&&t.add("Unzoom Y",()=>this.unzoom("y")),this.zoom_zmin!==this.zoom_zmax&&t.add("Unzoom Z",()=>this.unzoom("z")),this.zoom_x2min!==this.zoom_x2max&&t.add("Unzoom X2",()=>this.unzoom("x2")),this.zoom_y2min!==this.zoom_y2max&&t.add("Unzoom Y2",()=>this.unzoom("y2")),t.add("Unzoom all",()=>this.unzoom("all")),t.add("separator"),t.addchk(this.isTooltipAllowed(),"Show tooltips",()=>this.setTooltipAllowed("toggle")),this.x_handle&&t.addchk(this.x_handle.draw_grid,"Grid x",s=>this.changeFrameAttr("gridX",s)),this.y_handle&&t.addchk(this.y_handle.draw_grid,"Grid y",s=>this.changeFrameAttr("gridY",s)),this.x_handle&&!this.x2_handle&&t.addchk(this.x_handle.draw_swapside,"Swap x",s=>this.changeFrameAttr("swapX",s)),this.y_handle&&!this.y2_handle&&t.addchk(this.y_handle.draw_swapside,"Swap y",s=>this.changeFrameAttr("swapY",s)),this.x_handle&&!this.x2_handle&&(t.add("sub:Ticks x"),t.addchk(0==this.x_handle.draw_ticks,"off",()=>this.changeFrameAttr("ticksX",0)),t.addchk(1==this.x_handle.draw_ticks,"normal",()=>this.changeFrameAttr("ticksX",1)),t.addchk(2==this.x_handle.draw_ticks,"ticks on both sides",()=>this.changeFrameAttr("ticksX",2)),t.addchk(3==this.x_handle.draw_ticks,"labels on both sides",()=>this.changeFrameAttr("ticksX",3)),t.add("endsub:")),this.y_handle&&!this.y2_handle&&(t.add("sub:Ticks y"),t.addchk(0==this.y_handle.draw_ticks,"off",()=>this.changeFrameAttr("ticksY",0)),t.addchk(1==this.y_handle.draw_ticks,"normal",()=>this.changeFrameAttr("ticksY",1)),t.addchk(2==this.y_handle.draw_ticks,"ticks on both sides",()=>this.changeFrameAttr("ticksY",2)),t.addchk(3==this.y_handle.draw_ticks,"labels on both sides",()=>this.changeFrameAttr("ticksY",3)),t.add("endsub:")),t.addAttributesMenu(this,i?"":"Frame "),t.add("separator"),t.add("Save as frame.png",()=>this.getPadPainter().saveAs("png","frame","frame.png")),t.add("Save as frame.svg",()=>this.getPadPainter().saveAs("svg","frame","frame.svg")),!0}revertAxis(t,e){let i=this[t+"_handle"];return i?i.revertPoint(e):0}showAxisStatus(t,e){let s=t,a=(0,W.cx)(e,this.getFrameSvg().node()),n="x"==t?0:1;this.swap_xy&&(n=1-n);let u=this.revertAxis(t,a[n]);this.showObjectStatus(s,"axis",t+" : "+this.axisAsText(t,u),Math.round(a[0])+","+Math.round(a[1]))}addKeysHandler(){(0,f.isBatchMode)()||(c.J9.assign(this),this.addFrameKeysHandler())}addInteractivity(t){return!(!(0,f.isBatchMode)()&&(f.settings.Zooming||f.settings.ContextMenu))||(c.J9.assign(this),this.addFrameInteractivity(t))}setRootPadRange(){}toggleAxisLog(t){let e=this[t+"_handle"];e&&e.changeAxisLog("toggle")}}var l=T(263),d=T(5611),p=T(7428),v=T(9822);class w extends V.p{constructor(t,e,i){super(t,e,"","pad"),this.pad=e,this.iscan=i,this.this_pad_name="",!this.iscan&&null!==e&&(this.this_pad_name=e.fObjectID?"pad"+e.fObjectID:"ppp"+f.internals.id_counter++),this.painters=[],this.has_canvas=!0,this.forEachPainter=this.forEachPainterInPad}isRoot6(){return!1}svg_this_pad(){return this.getPadSvg(this.this_pad_name)}getMainPainter(){return this.main_painter_ref||null}setMainPainter(t,e){(!this.main_painter_ref||e)&&(this.main_painter_ref=t)}cleanup(){this._doing_draw&&console.error("pad drawing is not completed when cleanup is called"),this.painters.forEach(e=>e.cleanup());let t=this.svg_this_pad();t.empty()||(t.property("pad_painter",null),this.iscan||t.remove()),delete this.main_painter_ref,delete this.frame_painter_ref,delete this.pads_cache,delete this._pad_x,delete this._pad_y,delete this._pad_width,delete this._pad_height,delete this._doing_draw,delete this._dfltRFont,this.painters=[],this.pad=null,this.draw_object=null,this.pad_frame=null,this.this_pad_name=void 0,this.has_canvas=!1,(0,Z.O5)({pp:this,active:!1}),super.cleanup()}getFramePainter(){return this.frame_painter_ref}getPadWidth(){return this._pad_width||0}getPadHeight(){return this._pad_height||0}getPadRect(){return{x:this._pad_x||0,y:this._pad_y||0,width:this.getPadWidth(),height:this.getPadHeight()}}getFrameRect(){let t=this.getFramePainter();if(t)return t.getFrameRect();let e=this.getPadWidth(),i=this.getPadHeight(),s={};return s.szx=Math.round(.5*e),s.szy=Math.round(.5*i),s.width=2*s.szx,s.height=2*s.szy,s.x=Math.round(e/2-s.szx),s.y=Math.round(i/2-s.szy),s.hint_delta_x=s.szx,s.hint_delta_y=s.szy,s.transform=`translate(${s.x},${s.y})`,s}getRootPad(t){return void 0!==t&&t?null:this.pad}cleanPrimitives(t){if((0,f.isFunc)(t))for(let e=this.painters.length-1;e>=0;--e)t(this.painters[e])&&(this.painters[e].cleanup(),this.painters.splice(e,1))}findPainterFor(t,e,i){return this.painters.find(s=>{let r=s.getObject();if(r){if(t&&r===t)return!0;if((e||i)&&(!e||r.fName===e)&&(!i||r._typename===i))return!0}})}getHistPalette(){let t=this.findPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable");return t?t.getHistPalette():(this.fDfltPalette||(this.fDfltPalette={_typename:"ROOT::Experimental::RPalette",fColors:[{fOrdinal:0,fColor:{fColor:"rgb(53, 42, 135)"}},{fOrdinal:.125,fColor:{fColor:"rgb(15, 92, 221)"}},{fOrdinal:.25,fColor:{fColor:"rgb(20, 129, 214)"}},{fOrdinal:.375,fColor:{fColor:"rgb(6, 164, 202)"}},{fOrdinal:.5,fColor:{fColor:"rgb(46, 183, 164)"}},{fOrdinal:.625,fColor:{fColor:"rgb(135, 191, 119)"}},{fOrdinal:.75,fColor:{fColor:"rgb(209, 187, 89)"}},{fOrdinal:.875,fColor:{fColor:"rgb(254, 200, 50)"}},{fOrdinal:1,fColor:{fColor:"rgb(249, 251, 14)"}}],fInterpolate:!0,fNormalized:!0},(0,f.addMethods)(this.fDfltPalette,"ROOT::Experimental::RPalette")),this.fDfltPalette)}getNumPainters(){return this.painters.length}forEachPainterInPad(t,e){e||(e="all"),"objects"!=e&&t(this);for(let i=0;i<this.painters.length;++i){let s=this.painters[i];(0,f.isFunc)(s.forEachPainterInPad)?"objects"!=e&&s.forEachPainterInPad(t,e):"pads"!=e&&t(s)}}registerForPadEvents(t){this.pad_events_receiver=t}producePadEvent(t,e,i,s,r){"select"==t&&(0,f.isFunc)(this.selectActivePad)&&this.selectActivePad(e,i,s),this.pad_events_receiver&&this.pad_events_receiver({what:t,padpainter:e,painter:i,position:s,place:r})}selectObjectPainter(t,e,i){let s=this.iscan||!this.has_canvas,r=s?this:this.getCanvPainter();void 0===t&&(t=this),e&&!s&&(e=(0,d.Yi)(this.svg_this_pad(),e)),(0,Z.O5)({pp:this,active:!0}),r.producePadEvent("select",this,t,e,i)}createCanvasSvg(t,e){let n,u,i=null,s=null,a=null;if(t>0){if(this._fixed_size)return t>1;if(s=this.getCanvSvg(),s.empty()||(i=s.property("height_factor"),a=this.testMainResize(t,null,i),!a.changed))return!1;(0,f.isBatchMode)()||(n=this.getLayerSvg("btns_layer",this.this_pad_name)),u=s.select(".canvas_fillrect")}else{let g=this.selectDom();"static"==g.style("position")&&g.style("position","relative"),s=g.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("current_pad","").property("redraw_by_resize",!1),this.setTopPainter(),!(0,f.isBatchMode)()&&!this.online_canvas&&s.append("svg:title").text("ROOT canvas"),u=s.append("svg:path").attr("class","canvas_fillrect"),(0,f.isBatchMode)()||u.style("pointer-events","visibleFill").on("dblclick",x=>this.enlargePad(x)).on("click",()=>this.selectObjectPainter(this,null)).on("mouseenter",()=>this.showObjectStatus()).on("contextmenu",f.settings.ContextMenu?x=>this.padContextMenu(x):null),s.append("svg:g").attr("class","primitives_layer"),s.append("svg:g").attr("class","info_layer"),(0,f.isBatchMode)()||(n=s.append("svg:g").attr("class","btns_layer").property("leftside","left"==f.settings.ToolBarSide).property("vertical",f.settings.ToolBarVert)),i=.66,this.pad&&this.pad.fWinSize[0]&&this.pad.fWinSize[1]&&(i=this.pad.fWinSize[1]/this.pad.fWinSize[0],(i<.1||i>10)&&(i=.66)),this._fixed_size?(g.style("overflow","auto"),a={width:this.pad.fWinSize[0],height:this.pad.fWinSize[1]},(!a.width||!a.height)&&(a=(0,d.Yo)(g))):a=this.testMainResize(2,e,i)}return this.createAttFill({pattern:1001,color:0}),a.width<=5||a.height<=5?(s.style("display","none"),console.warn(`Hide canvas while geometry too small w=${a.width} h=${a.height}`),a.width=200,a.height=100):s.style("display",null),this._fixed_size?s.attr("x",0).attr("y",0).attr("width",a.width).attr("height",a.height).style("position","absolute"):s.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("right",0).style("bottom",0),s.style("filter",f.settings.DarkMode?"invert(100%)":null),s.attr("viewBox",`0 0 ${a.width} ${a.height}`).attr("preserveAspectRatio","none").property("height_factor",i).property("draw_x",0).property("draw_y",0).property("draw_width",a.width).property("draw_height",a.height),this._pad_x=0,this._pad_y=0,this._pad_width=a.width,this._pad_height=a.height,u.attr("d",`M0,0H${a.width}V${a.height}H0Z`).call(this.fillatt.func),this._fast_drawing=f.settings.SmallPad&&(a.width<f.settings.SmallPad.width||a.height<f.settings.SmallPad.height),this.alignButtons&&n&&this.alignButtons(n,a.width,a.height),!0}enlargePad(t){t&&(t.preventDefault(),t.stopPropagation());let e=this.getCanvSvg(),i=e.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(i||this.hasObjectsToDraw()||this.painters))i?i===this.pad?(this.enlargeMain(!1),e.property("pad_enlarged",null)):console.error("missmatch with pad double click events"):(this.enlargeMain(!0,!0),e.property("pad_enlarged",this.pad));else{if(this._fixed_size||!this.enlargeMain("toggle"))return;"off"==this.enlargeMain("state")&&e.property("pad_enlarged",null)}let s=this._fast_drawing;this.checkResize(!0),this._fast_drawing!=s&&this.showPadButtons()}createPadSvg(t){if(!this.has_canvas)return this.createCanvasSvg(t?2:0),!0;let e=this.getPadSvg(this.pad_name),i=this.getCanvSvg(),s=e.property("draw_width"),r=e.property("draw_height"),a=i.property("pad_enlarged"),n=!0,u=s,g=r,x=0,y=0,k=null,S=null,R=null;return this.pad&&this.pad.fPos&&this.pad.fSize&&(x=Math.round(s*this.pad.fPos.fHoriz.fArr[0]),y=Math.round(r*this.pad.fPos.fVert.fArr[0]),u=Math.round(s*this.pad.fSize.fHoriz.fArr[0]),g=Math.round(r*this.pad.fSize.fVert.fArr[0])),a&&(n=!1,a===this.pad?n=!0:this.forEachPainterInPad(E=>{E.getObject()==a&&(n=!0)},"pads"),n&&(u=s,g=r,x=y=0)),t?(k=this.svg_this_pad(),S=k.select(".root_pad_border"),(0,f.isBatchMode)()||(R=this.getLayerSvg("btns_layer",this.this_pad_name))):(k=e.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this),(0,f.isBatchMode)()||k.append("svg:title").text("ROOT subpad"),S=k.append("svg:path").attr("class","root_pad_border"),k.append("svg:g").attr("class","primitives_layer"),(0,f.isBatchMode)()||(R=k.append("svg:g").attr("class","btns_layer").property("leftside","left"!=f.settings.ToolBarSide).property("vertical",f.settings.ToolBarVert)),f.settings.ContextMenu&&S.on("contextmenu",E=>this.padContextMenu(E)),(0,f.isBatchMode)()||S.style("pointer-events","visibleFill").on("dblclick",E=>this.enlargePad(E)).on("click",()=>this.selectObjectPainter(this,null)).on("mouseenter",()=>this.showObjectStatus())),this.createAttFill({attr:this.pad}),this.createAttLine({attr:this.pad,color0:0==this.pad.fBorderMode?"none":""}),k.style("display",n?null:"none").attr("viewBox",`0 0 ${u} ${g}`).attr("preserveAspectRatio","none").attr("x",x).attr("y",y).attr("width",u).attr("height",g).property("draw_x",x).property("draw_y",y).property("draw_width",u).property("draw_height",g),this._pad_x=x,this._pad_y=y,this._pad_width=u,this._pad_height=g,S.attr("d",`M0,0H${u}V${g}H0Z`).call(this.fillatt.func).call(this.lineatt.func),this._fast_drawing=f.settings.SmallPad&&(u<f.settings.SmallPad.width||g<f.settings.SmallPad.height),k.property("can3d")===f.constants.Embed3D.Overlay&&this.selectDom().select(".draw3d_"+this.this_pad_name).style("display",n?"":"none"),this.alignButtons&&R&&this.alignButtons(R,u,g),n}hasObjectsToDraw(){let t=this.pad?this.pad.fPrimitives:null;return!(!t||!t.find(e=>"ROOT::Experimental::RPadDisplayItem"!=e._typename))}syncDraw(t){let e={kind:t||"redraw"};return void 0===this._doing_draw?(this._doing_draw=[e],Promise.resolve(!0)):!(!0!==e.kind&&this._doing_draw.findIndex((i,s)=>s>0&&i.kind==e.kind)>0)&&(this._doing_draw.push(e),new Promise(i=>{e.func=i}))}confirmDraw(){if(void 0===this._doing_draw)return console.warn("failure, should not happen");if(this._doing_draw.shift(),0==this._doing_draw.length)delete this._doing_draw;else{let t=this._doing_draw[0];t.func&&(t.func(),delete t.func)}}drawObject(){return(0,F.Z)(function*(){return console.log("Not possible to draw object without loading of draw.mjs"),null})()}drawPrimitives(t){var e=this;return(0,F.Z)(function*(){if(void 0===t)return e.iscan&&(e._start_tm=(new Date).getTime()),e._num_primitives=e.pad&&e.pad.fPrimitives?e.pad.fPrimitives.length:0,e.syncDraw(!0).then(()=>e.drawPrimitives(0));if(e.pad&&!(t>=e._num_primitives))return e.drawObject(e.getDom(),e.pad.fPrimitives[t],"").then(i=>((0,f.isObject)(i)&&(i._primitive=!0),e.drawPrimitives(t+1)));if(e.confirmDraw(),e._start_tm){let i=(new Date).getTime()-e._start_tm;i>3e3&&console.log(`Canvas drawing took ${(.001*i).toFixed(2)}s`),delete e._start_tm}})()}processPadTooltipEvent(t){let e=[],i=[];return null!==this.painters&&this.painters.forEach(s=>{(0,f.isFunc)(s.processTooltipEvent)&&e.push(s)}),t&&(t.nproc=e.length),e.forEach(s=>{let r=s.processTooltipEvent(t);r||(r={user_info:null}),i.push(r),t&&t.painters&&(r.painter=s)}),i}changeDarkMode(t){this.getCanvSvg().style("filter",t??f.settings.DarkMode?"invert(100%)":null)}fillContextMenu(t){t.add(this.iscan?"header: RCanvas":"header: RPad"),t.addchk(this.isTooltipAllowed(),"Show tooltips",()=>this.setTooltipAllowed("toggle")),this._websocket||(t.addAttributesMenu(this),this.iscan&&t.addSettingsMenu(!1,!1,i=>{"dark"==i&&this.changeDarkMode()})),t.add("separator"),(0,f.isFunc)(this.hasMenuBar)&&(0,f.isFunc)(this.actiavteMenuBar)&&t.addchk(this.hasMenuBar(),"Menu bar",i=>this.actiavteMenuBar(i)),(0,f.isFunc)(this.hasEventStatus)&&(0,f.isFunc)(this.activateStatusBar)&&t.addchk(this.hasEventStatus(),"Event status",()=>this.activateStatusBar("toggle")),(this.enlargeMain()||this.has_canvas&&this.hasObjectsToDraw())&&t.addchk("on"==this.enlargeMain("state"),"Enlarge "+(this.iscan?"canvas":"pad"),()=>this.enlargePad());let e=this.this_pad_name||(this.iscan?"canvas":"pad");return t.add(`Save as ${e}.png`,e+".png",i=>this.saveAs("png",!1,i)),t.add(`Save as ${e}.svg`,e+".svg",i=>this.saveAs("svg",!1,i)),!0}padContextMenu(t){if(t.stopPropagation){let e=(0,W.cx)(t,this.svg_this_pad().node());if(2==e.length&&e[0]>=0&&e[0]<10&&e[1]>=0&&e[1]<10)return;t.stopPropagation(),t.preventDefault(),this.getFramePainter()?.setLastEventPos()}(0,p.Z)(t,this).then(e=>(this.fillContextMenu(e),this.fillObjectExecMenu(e))).then(e=>e.show())}redrawPad(t){var e=this;return(0,F.Z)(function*(){let i=e.syncDraw(t);if(!1===i)return console.log("Prevent RPad redrawing"),!1;let s=!0,r=a=>{for(;a<e.painters.length;){let n=e.painters[a++],u=0;if((s||n.this_pad_name)&&(u=n.redraw(t)),(0,f.isPromise)(u))return u.then(()=>r(a))}return!0};return i.then(()=>(e.iscan?e.createCanvasSvg(2):s=e.createPadSvg(!0),r(0))).then(()=>((0,Z.X8)()===e&&e.getCanvPainter()?.producePadEvent("padredraw",e),e.confirmDraw(),!0))})()}redraw(t){return this.redrawPad(t)}needRedrawByResize(){let t=this.svg_this_pad();if(!t.empty()&&t.property("can3d")===f.constants.Embed3D.Overlay)return!0;for(let e=0;e<this.painters.length;++e)if((0,f.isFunc)(this.painters[e].needRedrawByResize)&&this.painters[e].needRedrawByResize())return!0;return!1}checkCanvasResize(t,e){if(!this.iscan&&this.has_canvas)return!1;let i=this.syncDraw("canvas_resize");if(!1===i)return!1;(!0===t||!1===t)&&(e=t,t=null),(0,f.isObject)(t)&&t.force&&(e=!0),e||(e=this.needRedrawByResize());let s=!1,r=a=>!s||a>=this.painters.length?(this.confirmDraw(),s):(0,f.getPromise)(this.painters[a].redraw(e?"redraw":"resize")).then(()=>r(a+1));return i.then(()=>(s=this.createCanvasSvg(e?2:1,t),r(0)))}updateObject(t){return!!t&&(this.pad.fStyle=t.fStyle,this.pad.fAttr=t.fAttr,this.iscan?(this.pad.fTitle=t.fTitle,this.pad.fWinSize=t.fWinSize):(this.pad.fPos=t.fPos,this.pad.fSize=t.fSize),!0)}addObjectPainter(t,e,i){t&&e&&e[i]&&void 0===t.snapid&&(this.painters.indexOf(t)<0&&this.painters.push(t),t.assignSnapId(e[i].fObjectID),t.rstyle||(t.rstyle=e[i].fStyle||this.rstyle))}extractTObjectProp(t){if(t.fColIndex&&t.fColValue){let r=this.root_colors||(0,l._V)();for(let a=0;a<t.fColIndex.length;++a)r[t.fColIndex[a]]=t.fColValue[a]}let e=new V.p,i=t.fObject;e.assignObject(t),e.csstype=t.fCssType,e.rstyle=t.fStyle,t.fOption=e.v7EvalAttr("options","");const s=(r,a)=>{let n=e.v7EvalColor(a,"");n&&(i[r]=(0,l.hI)(n,this.root_colors))};void 0!==i.fLineColor&&void 0!==i.fLineWidth&&void 0!==i.fLineStyle&&(s("fLineColor","line_color"),i.fLineWidth=e.v7EvalAttr("line_width",i.fLineWidth),i.fLineStyle=e.v7EvalAttr("line_style",i.fLineStyle)),void 0!==i.fFillColor&&void 0!==i.fFillStyle&&(s("fFillColor","fill_color"),i.fFillStyle=e.v7EvalAttr("fill_style",i.fFillStyle)),void 0!==i.fMarkerColor&&void 0!==i.fMarkerStyle&&void 0!==i.fMarkerSize&&(s("fMarkerColor","marker_color"),i.fMarkerStyle=e.v7EvalAttr("marker_style",i.fMarkerStyle),i.fMarkerSize=e.v7EvalAttr("marker_size",i.fMarkerSize)),void 0!==i.fTextColor&&void 0!==i.fTextAlign&&void 0!==i.fTextAngle&&void 0!==i.fTextSize&&(s("fTextColor","text_color"),i.fTextAlign=e.v7EvalAttr("text_align",i.fTextAlign),i.fTextAngle=e.v7EvalAttr("text_angle",i.fTextAngle),i.fTextSize=e.v7EvalAttr("text_size",i.fTextSize))}drawNextSnap(t,e){var i=this;return(0,F.Z)(function*(){if(void 0===e&&(e=-1,i._snaps_map={},i._num_primitives=t?t.length:0,i._auto_color_cnt=0),delete i.next_rstyle,++e,!t||e>=t.length)return delete i._snaps_map,delete i._auto_color_cnt,i;let s=t[e],r=s.fObjectID,a=i._snaps_map[r],n=null;if(a?a++:a=1,i._snaps_map[r]=a,s.fDummy)return i.drawNextSnap(t,e);for(let u=0;u<i.painters.length;++u)if(i.painters[u].snapid===r&&0==--a){n=i.painters[u];break}if(n){if("ROOT::Experimental::RPadDisplayItem"==s._typename)return n.redrawPadSnap(s).then(g=>(i.addObjectPainter(g,t,e),i.drawNextSnap(t,e)));let u;return"ROOT::Experimental::TObjectDisplayItem"===s._typename&&i.extractTObjectProp(s),n.updateObject(s.fDrawable||s.fObject||s,s.fOption||"",!0)&&(u=n.redraw()),(0,f.getPromise)(u).then(()=>i.drawNextSnap(t,e))}if("ROOT::Experimental::RPadDisplayItem"==s._typename){let u=s,g=new w(i.getDom(),u,!1);g.decodeOptions(""),g.addToPadPrimitives(i.this_pad_name),g.assignSnapId(s.fObjectID),g.rstyle=s.fStyle,g.createPadSvg(),s.fPrimitives&&s.fPrimitives.length>0&&g.addPadButtons();let x=g.selectCurrentPad(g.this_pad_name);return g.drawNextSnap(s.fPrimitives).then(()=>(g.selectCurrentPad(x),i.drawNextSnap(t,e)))}if(i.next_rstyle=t[e].fStyle||i.rstyle,"ROOT::Experimental::TObjectDisplayItem"===s._typename){const u={kNone:0,kObject:1,kColors:4,kStyle:5,kPalette:6};if(s.fKind==u.kStyle)return Object.assign(f.gStyle,s.fObject),i.drawNextSnap(t,e);if(s.fKind==u.kColors){let g=[],x=s.fObject.arr;for(let y=0;y<x.length;++y){let k=x[y].fString,S=k.indexOf("=");S>0&&(g[parseInt(k.slice(0,S))]=k.slice(S+1))}return i.root_colors=g,i.drawNextSnap(t,e)}if(s.fKind==u.kPalette){let g=s.fObject.arr,x=[];for(let y=0;y<g.length;++y)x[y]=g[y].fString;return i.custom_palette=new l.VZ(x),i.drawNextSnap(t,e)}if(!i.getFramePainter())return i.drawObject(i.getDom(),{_typename:"TFrame",$dummy:!0},"").then(()=>i.drawNextSnap(t,e-1));i.extractTObjectProp(s)}return i.drawObject(i.getDom(),s.fDrawable||s.fObject||s,s.fOption||"").then(u=>(i.addObjectPainter(u,t,e),i.drawNextSnap(t,e)))})()}findSnap(t,e){function i(s){return!(!s||!(0,f.isStr)(s))&&(s==t||e&&s.length>t.length&&s.indexOf(t)==s.length-t.length)}if(i(this.snapid))return this;if(!this.painters)return null;for(let s=0;s<this.painters.length;++s){let r=this.painters[s];if(!e&&(0,f.isFunc)(r.findSnap)?r=r.findSnap(t):i(r.snapid)||(r=null),r)return r}return null}redrawPadSnap(t){var e=this;return(0,F.Z)(function*(){if(!t||!t.fPrimitives)return e;if(e.iscan&&e._websocket&&t.fTitle&&!e.embed_canvas&&typeof document<"u"&&(document.title=t.fTitle),void 0===e.snapid){e.assignSnapId(t.fObjectID),e.draw_object=t,e.pad=t,e.batch_mode&&e.iscan&&(e._fixed_size=!0);let a=e.selectDom().attr("id");return!e.batch_mode&&!e.use_openui&&!e.brlayout&&a&&(0,f.isStr)(a)&&(e.brlayout=new K.$B(a,null,e),e.brlayout.create(a,!0),e.setDom(e.brlayout.drawing_divid()),(0,B.MG)(e.brlayout)),e.createCanvasSvg(0),e.addPadButtons(!0),e.drawNextSnap(t.fPrimitives)}e.updateObject(t),e.iscan?e.createCanvasSvg(2):e.createPadSvg(!0);let i=!1,s=!1;for(let a=0;a<e.painters.length;++a){let n=e.painters[a];void 0!==n.snapid&&(t.fPrimitives.forEach(u=>{n&&u.fObjectID===n.snapid&&(n=null,i=!0)}),n&&(e.painters.splice(a--,1),n.cleanup(),s=!0,e.main_painter_ref===n&&delete e.main_painter_ref))}if(s&&delete e.pads_cache,!i){let a=e.getFramePainter();a?.is_root6()&&(a=null);for(let n=0;n<e.painters.length;++n)a!==e.painters[n]&&e.painters[n].cleanup();e.painters=[],delete e.main_painter_ref,a&&(e.painters.push(a),a.cleanFrameDrawings(),a.redraw()),e.removePadButtons&&e.removePadButtons(),e.addPadButtons(!0)}let r=e.selectCurrentPad(e.this_pad_name);return e.drawNextSnap(t.fPrimitives).then(()=>(e.selectCurrentPad(r),(0,Z.X8)()===e&&e.getCanvPainter()?.producePadEvent("padredraw",e),e))})()}createImage(t){var e=this;return(0,F.Z)(function*(){return"pdf"==t?(0,f.btoa_func)("dummy PDF file"):"png"==t||"jpeg"==t||"svg"==t?e.produceImage(!0,t).then(i=>{if(!i||"svg"==t)return i;let s=i.indexOf("base64,");return s>0?i.slice(s+7):""}):""})()}itemContextMenu(t){let e=this.svg_this_pad().node().getBoundingClientRect(),i={clientX:e.left+10,clientY:e.top+10};if("pad"==t)return setTimeout(()=>this.padContextMenu(i),50);let r,s=null;switch(t){case"xaxis":case"yaxis":case"zaxis":s=this.getMainPainter(),r=t[0];break;case"frame":s=this.getFramePainter();break;default:{let a=parseInt(t);Number.isInteger(a)&&(s=this.painters[a])}}(0,f.isFunc)(s?.fillContextMenu)&&(0,p.Z)(i,s).then(a=>{s.fillContextMenu(a,r)&&s.fillObjectExecMenu(a,r).then(()=>setTimeout(()=>a.show(),50))})}saveAs(t,e,i){i||(i=(this.this_pad_name||(this.iscan?"canvas":"pad"))+"."+t),this.produceImage(e,t).then(s=>{if(!s)return console.error(`Fail to produce image ${i}`);(0,B.yH)(i,"svg"!=t?s:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(s))})}findActivePad(){return null}produceImage(t,e){var i=this;return(0,F.Z)(function*(){let s="frame"===t,r=s?i.getFrameSvg(i.this_pad_name):t?i.getCanvSvg():i.svg_this_pad(),a=t&&!s?i.getCanvPainter():i,n=[];if(r.empty())return"";s||a.forEachPainterInPad(E=>{let C={prnt:E.svg_this_pad()};n.push(C);let q=E.getLayerSvg("btns_layer",i.this_pad_name);C.btns_node=q.node(),C.btns_node&&(C.btns_prnt=C.btns_node.parentNode,C.btns_next=C.btns_node.nextSibling,q.remove());let H=E.getFramePainter();if(!H||!(0,f.isFunc)(H.render3D)||!(0,f.isFunc)(H.access3dKind))return;let L=H.access3dKind();if(L!==f.constants.Embed3D.Overlay&&L!==f.constants.Embed3D.Embed)return;let Q=H.getSizeFor3d(f.constants.Embed3D.Embed),$=H.renderer.domElement;H.render3D(0);let tt=$.toDataURL("image/png");L===f.constants.Embed3D.Embed&&(C.foreign=C.prnt.select("."+Q.clname),C.foreign.remove());let it=H.getFrameSvg();C.frame_node=it.node(),C.frame_node&&(C.frame_next=C.frame_node.nextSibling,it.remove()),C.img=C.prnt.insert("image",".primitives_layer").attr("x",Q.x).attr("y",Q.y).attr("width",$.width).attr("height",$.height).attr("href",tt)},"pads");const g=()=>{for(let E=0;E<n.length;++E){let C=n[E];C.img&&C.img.remove();let q=C.prnt.select(".primitives_layer");C.foreign&&C.prnt.node().insertBefore(C.foreign.node(),q.node()),C.frame_node&&q.node().insertBefore(C.frame_node,C.frame_next),C.btns_node&&C.btns_prnt.insertBefore(C.btns_node,C.btns_next)}};let x=r.property("draw_width"),y=r.property("draw_height");if(s){let E=i.getFramePainter();x=E.getFrameWidth(),y=E.getFrameHeight()}let k=`<svg width="${x}" height="${y}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">${r.node().innerHTML}</svg>`;if(f.internals.processSvgWorkarounds&&(k=f.internals.processSvgWorkarounds(k)),k=(0,d.ln)(k),"svg"==e)return g(),k;let R=new Image;return new Promise(E=>{R.onload=function(){let C=document.createElement("canvas");C.width=R.width,C.height=R.height,C.getContext("2d").drawImage(R,0,0),g(),E(C.toDataURL("image/"+e))},R.onerror=function(C){console.log(`IMAGE ERROR ${C}`),g(),E(null)},R.src="data:image/svg+xml;base64,"+(0,f.btoa_func)((E=>(E=(E=encodeURIComponent(E)).replace(/%([0-9A-F]{2})/g,function(C,q){let H=String.fromCharCode("0x"+q);return"%"===H?"%25":H}),decodeURIComponent(E)))('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+k))})})()}clickPadButton(t,e){if("CanvasSnapShot"==t)return this.saveAs("png",!0);if("enlargePad"==t)return this.enlargePad();if("PadSnapShot"==t)return this.saveAs("png",!1);if("PadContextMenus"==t){if(e&&(e.preventDefault(),e.stopPropagation()),(0,p.W)())return;return void(0,p.Z)(e,this).then(s=>{s.add("header:Menus"),s.add(this.iscan?"Canvas":"Pad","pad",this.itemContextMenu),this.getFramePainter()&&s.add("Frame","frame",this.itemContextMenu);let r=this.getMainPainter();if(r&&(s.add("X axis","xaxis",this.itemContextMenu),s.add("Y axis","yaxis",this.itemContextMenu),(0,f.isFunc)(r.getDimension)&&r.getDimension()>1&&s.add("Z axis","zaxis",this.itemContextMenu)),this.painters?.length){s.add("separator");let a=[];for(let n=0;n<this.painters.length;++n){let u=this.painters[n]?.getObject();if(!u||a.indexOf(u)>=0)continue;let g=u._typename?u._typename+"::":"";u.fName&&(g+=u.fName),g||(g="item"+n),s.add(g,n,this.itemContextMenu)}}s.show()})}let i=!1;for(let s=0;s<this.painters.length;++s){let r=this.painters[s];(0,f.isFunc)(r.clickPadButton)&&r.clickPadButton(t),!i&&(0,f.isFunc)(r.clickButton)&&(i=r.clickButton(t))}}addPadButton(t,e,i,s){if(f.settings.ToolBar&&!(0,f.isBatchMode)()&&!this.batch_mode){this._buttons||(this._buttons=[]);for(let a=0;a<this._buttons.length;++a)if(this._buttons[a].funcname==i)return;if(this._buttons.push({btn:t,tooltip:e,funcname:i,keyname:s}),!this.iscan&&this.has_canvas&&0!=i.indexOf("Pad")&&"enlargePad"!==i){let a=this.getCanvPainter();a&&a!==this&&a.addPadButton(t,e,i)}}}addPadButtons(t){this.addPadButton("camera","Create PNG",this.iscan?"CanvasSnapShot":"PadSnapShot","Ctrl PrintScreen"),f.settings.ContextMenu&&this.addPadButton("question","Access context menus","PadContextMenus"),(!this.iscan&&this.has_canvas&&this.hasObjectsToDraw()||this.enlargeMain("verify"))&&this.addPadButton("circle","Enlarge canvas","enlargePad"),t&&this.brlayout&&(this.addPadButton("diamand","Toggle Ged","ToggleGed"),this.addPadButton("three_circles","Toggle Status","ToggleStatus"))}showPadButtons(){this._buttons&&(v.PadButtonsHandler.assign(this),this.showPadButtons())}getPadLength(t,e,i){let r,a,s=t?-1:1,n=(y,k)=>y<e.fArr.length?e.fArr[y]:k,u=()=>(r||(r=i?i.getFrameRect():this.getPadRect()),r);if(i){let y=n(2),k=t?"gry":"grx";void 0!==y&&i[k]&&(a=i[k](y))}void 0===a&&(a=t?u().height:0);let g=n(0,0);return a+=s*n(1,0),g&&(a+=s*(t?u().height:u().width)*g),Math.round(a)}getCoordinate(t,e){return{x:this.getPadLength(!1,t.fHoriz,e),y:this.getPadLength(!0,t.fVert,e)}}decodeOptions(t){let e=this.getObject();if(!e)return;let i=new d.pc(t);this.options||(this.options={}),Object.assign(this.options,{GlobalColors:!0,LocalColors:!1,IgnorePalette:!1,RotateFrame:!1,FixFrame:!1}),(i.check("NOCOLORS")||i.check("NOCOL"))&&(this.options.GlobalColors=this.options.LocalColors=!1),(i.check("LCOLORS")||i.check("LCOL"))&&(this.options.GlobalColors=!1,this.options.LocalColors=!0),(i.check("NOPALETTE")||i.check("NOPAL"))&&(this.options.IgnorePalette=!0),i.check("ROTATE")&&(this.options.RotateFrame=!0),i.check("FIXFRAME")&&(this.options.FixFrame=!0),i.check("WHITE")&&(e.fFillColor=0),i.check("LOGX")&&(e.fLogx=1),i.check("LOGY")&&(e.fLogy=1),i.check("LOGZ")&&(e.fLogz=1),i.check("LOG")&&(e.fLogx=e.fLogy=e.fLogz=1),i.check("GRIDX")&&(e.fGridx=1),i.check("GRIDY")&&(e.fGridy=1),i.check("GRID")&&(e.fGridx=e.fGridy=1),i.check("TICKX")&&(e.fTickx=1),i.check("TICKY")&&(e.fTicky=1),i.check("TICK")&&(e.fTickx=e.fTicky=1)}static draw(t,e,i){return(0,F.Z)(function*(){let s=new w(t,e,!1);s.decodeOptions(i),s.getCanvSvg().empty()?(s.has_canvas=!1,s.this_pad_name="",s.setTopPainter()):s.addToPadPrimitives(s.pad_name),s.createPadSvg(),s.matchObjectType(f.clTPad)&&(!s.has_canvas||s.hasObjectsToDraw())&&s.addPadButtons();let r=s.has_canvas?s.selectCurrentPad(s.this_pad_name):void 0;return(0,Z.O5)({pp:s,active:!1}),s.drawPrimitives().then(()=>(s.showPadButtons(),s.selectCurrentPad(r),s))})()}}class M{constructor(t,e,i){this.path=t,this.connid=null,this.req=null,this.raw=e,this.args=i,this.nextRequest("","connect")}nextRequest(t,e){let i=this.path,s="buf",r=null;if("connect"===e)i+=this.raw?"?raw_connect":"?txt_connect",this.args&&(i+="&"+this.args),console.log(`longpoll connect ${i} raw = ${this.raw}`),this.connid="connect";else if("close"===e){if(null===this.connid||"close"===this.connid)return;i+=`?connection=${this.connid}&close`,this.connid="close",s="text;sync"}else{if(null===this.connid||"number"!=typeof this.connid)return void(f.browser.qt5||console.error("No connection"));i+="?connection="+this.connid,"dummy"===e&&(i+="&dummy")}t&&(this.raw?i+="&post="+(0,f.btoa_func)(t):(s="postbuf",r=t)),(0,f.createHttpRequest)(i,s,function(a){if(this.handle.req===this&&(this.handle.req=null),null===a)return this.handle.processRequest(null);if(this.handle.raw){let n="",u=0,g=new Uint8Array(a),x=g.length;if(x<4)return f.browser.qt5||console.error(`longpoll got short message in raw mode ${x}`),this.handle.processRequest(null);for(;u<4;)n+=String.fromCharCode(g[u++]);if("txt:"!=n){for(n="";u<x&&":"!=String.fromCharCode(g[u]);)n+=String.fromCharCode(g[u++]);++u,x=u+parseInt(n.trim())}for(n="";u<x;)n+=String.fromCharCode(g[u++]);n&&this.handle.processRequest("<<nope>>"==n?-1111:n),x<g.length&&this.handle.processRequest(a,x)}else if("application/x-binary"==this.getResponseHeader("Content-Type")){let n=this.getResponseHeader("LongpollHeader");n&&this.handle.processRequest(n),this.handle.processRequest(a,0)}else{if(a&&!(0,f.isStr)(a)){let n="",u=new Uint8Array(a);for(let g=0;g<u.length;++g)n+=String.fromCharCode(u[g]);a=n}this.handle.processRequest("<<nope>>"==a?-1111:a)}},function(){this.handle.processRequest(null,"error")},!0).then(a=>{a.handle=this,this.req||(this.req=a),a.send(r)})}processRequest(t,e){if(null===t)return(0,f.isFunc)(this.onerror)&&this.onerror("receive data with connid "+(this.connid||"---")),"error"==e&&(0,f.isFunc)(this.onclose)&&this.onclose("force_close"),void(this.connid=null);-1111===t&&(t="");let i=5;if("connect"===this.connid){if(!t)return this.connid=null,void((0,f.isFunc)(this.onerror)&&this.onerror("connection rejected"));this.connid=parseInt(t),i=100,console.log(`Get new longpoll connection with id ${this.connid}`),(0,f.isFunc)(this.onopen)&&this.onopen()}else{if("close"===this.connid)return void((0,f.isFunc)(this.onclose)&&this.onclose());(0,f.isFunc)(this.onmessage)&&t&&this.onmessage({data:t,offset:e})}this.req||setTimeout(()=>{this.req||this.nextRequest("","dummy")},i)}send(t){this.nextRequest(t)}close(){this.nextRequest("","close")}}class D{constructor(t){this.receiver=t,this.protocol=[],this.cnt=0,(0,f.httpRequest)("protocol.json","text").then(e=>this.getProtocol(e))}getProtocol(t){t&&(this.protocol=JSON.parse(t),(0,f.isFunc)(this.onopen)&&this.onopen(),this.nextOperation())}send(){"send"==this.protocol[this.cnt]&&(this.cnt++,setTimeout(()=>this.nextOperation(),10))}close(){}nextOperation(){if(this.wait_for_file)return;let t=this.protocol[this.cnt];t&&"send"!=t&&(this.wait_for_file=!0,this.cnt++,(0,f.httpRequest)(t,t.indexOf(".bin")>0?"buf":"text").then(e=>{this.wait_for_file=!1,e&&(this.receiver.provideData&&this.receiver.provideData(1,e,0),setTimeout(()=>this.nextOperation(),10))}))}}class z{constructor(t,e){this.kind=t,this.state=0,this.credits=e||10,this.cansend=this.credits,this.ackn=this.credits}getUserArgs(t){return t&&(0,f.isStr)(t)?(0,f.isObject)(this.user_args)?this.user_args[t]:void 0:this.user_args}setUserArgs(t){this.user_args=t}setReceiver(t){this.receiver=t}cleanup(){delete this.receiver,this.close(!0)}invokeReceiver(t,e,i,s){if(this.receiver&&(0,f.isFunc)(this.receiver[e])&&this.receiver[e](this,i,s),t&&this.channels){let r=Object.keys(this.channels);for(let a=0;a<r.length;++a)this.channels[r[a]].invokeReceiver(!1,e,i,s)}}provideData(t,e,i){if(this.wait_first_recv)return delete this.wait_first_recv,this.invokeReceiver(!1,"onWebsocketOpened");if(t>1&&this.channels){const r=this.channels[t];if(r)return r.provideData(1,e,i)}const s=i&&i<0;if(!(s||this.msgqueue&&this.msgqueue.length))return this.invokeReceiver(!1,"onWebsocketMsg",e,i);this.msgqueue||(this.msgqueue=[]),s&&(i=void 0),this.msgqueue.push({ready:!0,msg:e,len:i})}reserveQueueItem(){this.msgqueue||(this.msgqueue=[]);let t={ready:!1,msg:null,len:0};return this.msgqueue.push(t),t}markQueueItemDone(t,e,i){t.ready=!0,t.msg=e,t.len=i,this.processQueue()}processQueue(){if(!this._loop_msgqueue&&this.msgqueue){for(this._loop_msgqueue=!0;this.msgqueue.length>0&&this.msgqueue[0].ready;){let t=this.msgqueue.shift();this.invokeReceiver(!1,"onWebsocketMsg",t.msg,t.len)}0==this.msgqueue.length&&delete this.msgqueue,delete this._loop_msgqueue}}close(t){if(this.master)return this.master.send("CLOSECH="+this.channelid,0),delete this.master.channels[this.channelid],void delete this.master;this.timerid&&(clearTimeout(this.timerid),delete this.timerid),this._websocket&&this.state>0&&(this.state=t?-1:0,this._websocket.onclose=null,this._websocket.close(),delete this._websocket)}canSend(t){return this.cansend>=(t||1)}getRelCanSend(){return this.credits?this.cansend/this.credits:1}send(t,e){if(this.master)return this.master.send(t,this.channelid);if(!this._websocket||this.state<=0)return!1;Number.isInteger(e)||(e=1),this.cansend<=0&&console.error(`should be queued before sending cansend: ${this.cansend}`);let i=`${this.ackn}:${this.cansend}:${e}:`;return this.ackn=0,this.cansend--,this._websocket.send(i+t),("websocket"===this.kind||"longpoll"===this.kind)&&(this.timerid&&clearTimeout(this.timerid),this.timerid=setTimeout(()=>this.keepAlive(),1e4)),!0}inject(t,e,i){if(!i)return setTimeout(this.inject.bind(this,t,e,!0),0);if(void 0===e&&(e=1),Array.isArray(t)){for(let s=0;s<t.length;++s)this.provideData(e,(0,f.isStr)(t[s])?t[s]:JSON.stringify(t[s]),-1);this.processQueue()}else t&&this.provideData(e,(0,f.isStr)(t)?t:JSON.stringify(t))}keepAlive(){delete this.timerid,this.send("KEEPALIVE",0)}createChannel(){if(this.master)return master.createChannel();let t=new z("channel",this.credits);return t.wait_first_recv=!0,this.channels||(this.channels={},this.freechannelid=2),t.master=this,t.channelid=this.freechannelid++,this.channels[t.channelid]=t,t}getChannelId(){return this.channelid&&this.master?this.channelid:1}setHRef(t){this.href=t}getHRef(t){if(!t||!this.kind||!this.href)return this.href;let e=this.href;if(0==t.indexOf("../")){let i=e.lastIndexOf("/",e.length-2);e=e.slice(0,i)+t.slice(2)}else e+=t;return e}connect(t){this.close(),!t&&this.href&&(t=this.href);let e=0,i=this.key?"key="+this.key:"";this.token&&(i&&(i+="&"),i+="token="+this.token);const s=r=>{if(0!=this.state)return;r||console.log(`try connect window again ${(new Date).toString()}`),this._websocket&&(this._websocket.close(),delete this._websocket),t||((t=window.location.href)&&t.indexOf("#")>0&&(t=t.slice(0,t.indexOf("#"))),t&&t.lastIndexOf("/")>0&&(t=t.slice(0,t.lastIndexOf("/")+1))),this.href=t,e++,r&&console.log(`Opening web socket at ${t}`),e>2&&(0,B.Ae)(`Trying to connect ${t}`);let a=t;"file"==this.kind?(a+="root.filedump",this._websocket=new D(this),console.log(`configure protocol log ${a}`)):"websocket"===this.kind&&r?(a=a.replace("http://","ws://").replace("https://","wss://")+"root.websocket",i&&(a+="?"+i),console.log(`configure websocket ${a}`),this._websocket=new WebSocket(a)):(a+="root.longpoll",console.log(`configure longpoll ${a}`),this._websocket=new M(a,"rawlongpoll"===this.kind,i)),this._websocket&&(this._websocket.onopen=()=>{e>2&&(0,B.Ae)(),this.state=1,this.send("READY="+(this.key||""),0),this.invokeReceiver(!1,"onWebsocketOpened")},this._websocket.onmessage=n=>{let u=n.data;if(this.next_binary){let R=this.next_binary;if(delete this.next_binary,u instanceof Blob){let E=new FileReader,C=this.reserveQueueItem();E.onload=q=>this.markQueueItemDone(C,q.target.result,0),E.readAsArrayBuffer(u,n.offset||0)}else this.provideData(R,u,n.offset||0);return}if(!(0,f.isStr)(u))return console.log("unsupported message kind: "+typeof u);let g=u.indexOf(":"),x=parseInt(u.slice(0,g)),y=u.indexOf(":",g+1),k=u.indexOf(":",y+1),S=parseInt(u.slice(y+1,k));if(this.ackn++,this.cansend+=x,u=u.slice(k+1),0==S){if(console.log(`GET chid=0 message ${u}`),"CLOSE"==u)this.close(!0),this.invokeReceiver(!0,"onWebsocketClosed");else if(0==u.indexOf("NEW_KEY=")){let R=u.slice(8);this.close(!0),typeof sessionStorage<"u"&&sessionStorage.setItem("RWebWindow_Key",R),location.reload(!0)}}else"$$binary$$"==u?this.next_binary=S:"$$nullbinary$$"==u?this.provideData(S,new ArrayBuffer(0),0):this.provideData(S,u);this.ackn>7&&this.send("READY",0)},this._websocket.onclose=n=>{delete this._websocket,(this.state>0||"force_close"===n)&&(console.log("websocket closed"),this.state=0,this.invokeReceiver(!0,"onWebsocketClosed"))},this._websocket.onerror=n=>{console.log(`websocket error ${n} state ${this.state}`),this.state>0&&(this.invokeReceiver(!0,"onWebsocketError",n),this.state=0)},(0,f.isBatchMode)()||setTimeout(s,3e3))};s(!0)}askReload(){this.send("GENERATE_KEY",0)}addReloadKeyHandler(){"file"!=this.kind&&window.addEventListener("keydown",t=>{("R"==t.key||"r"==t.key)&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),console.log("Prevent Ctrl-R propogation - ask reload RWebWindow!"),this.askReload())})}}class j extends w{constructor(t,e){super(t,e,!0),this._websocket=null,this.tooltip_allowed=f.settings.Tooltip,this.v7canvas=!0}cleanup(){delete this._websocket,delete this._submreq,this._changed_layout&&this.setLayoutKind("simple"),delete this._changed_layout,super.cleanup()}getLayoutKind(){let t=this.selectDom("origin");return(t.empty()?"":t.property("layout"))||"simple"}setLayoutKind(t,e){let i=this.selectDom("origin");i.empty()||(t||(t="simple"),i.property("layout",t),i.property("layout_selector","simple"!=t&&e?e:null),this._changed_layout="simple"!==t)}changeLayout(t,e){var i=this;return(0,F.Z)(function*(){if(i.getLayoutKind()==t)return!0;let r=i.selectDom("origin"),a=r.select(".side_panel"),n=i.selectDom(),u=[];for(;n.node().firstChild;)u.push(n.node().removeChild(n.node().firstChild));if(a.empty()||(0,Z.Eq)(a.node()),i.setLayoutKind("simple"),r.html(""),"simple"==t){n=r;for(let g=0;g<u.length;++g)n.node().appendChild(u[g]);i.setLayoutKind(t)}else{let g=new K.VU(r.node(),t);null==e&&(e=0==t.indexOf("vert")?0:1),n=(0,W.Ys)(g.getGridFrame(e)),a=(0,W.Ys)(g.getGridFrame(1-e)),n.classed("central_panel",!0).style("position","relative"),a.classed("side_panel",!0).style("position","relative");for(let x=0;x<u.length;++x)n.node().appendChild(u[x]);i.setLayoutKind(t,".central_panel"),r.property("mdi",null)}return(0,Z.SI)(n.node()),!0})()}toggleProjection(t){var e=this;return(0,F.Z)(function*(){if(delete e.proj_painter,t&&(e.proj_painter=1),(0,f.isFunc)(e.showUI5ProjectionArea))return e.showUI5ProjectionArea(t);let s,i="simple";switch(t){case"X":case"bottom":i="vert2_31",s=0;break;case"Y":case"left":i="horiz2_13",s=1;break;case"top":i="vert2_13",s=1;break;case"right":i="horiz2_31",s=0}return e.changeLayout(i,s)})()}drawProjection(){return(0,F.Z)(function*(){return!1})()}drawInSidePanel(t,e){var i=this;return(0,F.Z)(function*(){let s=i.selectDom("origin").select(".side_panel");return s.empty()?null:i.drawObject(s.node(),t,e)})()}testUI5(){return!!this.use_openui&&(console.warn("full ui5 should be used - not loaded yet? Please check!!"),!0)}showMessage(t){this.testUI5()||(0,B.Ae)(t,7e3)}saveCanvasAsFile(t){let e=t.indexOf(".");this.createImage(t.slice(e+1)).then(i=>{console.log("save",t,i.length),this.sendWebsocket("SAVE:"+t+":"+i)})}sendSaveCommand(t){this.sendWebsocket("PRODUCE:"+t)}sendWebsocket(t){return!!this._websocket?.canSend()&&(this._websocket.send(t),!0)}closeWebsocket(t){this._websocket&&(this._websocket.close(t),this._websocket.cleanup(),delete this._websocket)}useWebsocket(t){this.closeWebsocket(),this._websocket=t,this._websocket.setReceiver(this),this._websocket.connect()}onWebsocketOpened(){}onWebsocketClosed(){this.embed_canvas||(0,B.Hw)()}onWebsocketMsg(t,e){if(console.log("GET_MSG "+e.slice(0,30)),"CLOSE"==e)this.onWebsocketClosed(),this.closeWebsocket(!0);else if("SNAP:"==e.slice(0,5)){let i=(e=e.slice(5)).indexOf(":"),s=e.slice(0,i),r=(0,f.parse)(e.slice(i+1));this.syncDraw(!0).then(()=>this.redrawPadSnap(r)).then(()=>{t.send("SNAPDONE:"+s),this.confirmDraw()})}else if("JSON"==e.slice(0,4)){let i=(0,f.parse)(e.slice(4));this.redrawObject(i)}else if("REPL_REQ:"==e.slice(0,9))this.processDrawableReply(e.slice(9));else if("CMD:"==e.slice(0,4)){let i=(e=e.slice(4)).indexOf(":"),s=e.slice(0,i),r=e.slice(i+1),a="REPLY:"+s+":";if("SVG"==r||"PNG"==r||"JPEG"==r)this.createImage(r.toLowerCase()).then(n=>t.send(a+n));else if(0==r.indexOf("ADDPANEL:")){let n=r.slice(9);if((0,f.isFunc)(this.showUI5Panel)){let u=new z(t.kind);u.setReceiver({cpainter:this,onWebsocketOpened(){},onWebsocketMsg(x,y){let k=0==y.indexOf("SHOWPANEL:")?y.slice(10):"";this.cpainter.showUI5Panel(k,x).then(S=>t.send(a+(S?"true":"false")))},onWebsocketClosed(){t.send(a+"false")},onWebsocketError(){t.send(a+"false")}});let g=t.href;if(0==n.indexOf("../")){let x=g.lastIndexOf("/",g.length-2);g=g.slice(0,x)+n.slice(2)}else g+=n;u.connect(g)}else t.send(a+"false")}else console.log("Unrecognized command "+r),t.send(a)}else if("DXPROJ:"==e.slice(0,7)||"DYPROJ:"==e.slice(0,7)){let i=e[1],s=(0,f.parse)(e.slice(7));this.drawProjection(i,s)}else if("SHOW:"==e.slice(0,5)){let i=e.slice(5),s="1"==i[i.length-1];this.showSection(i.slice(0,i.length-2),s)}else console.log(`unrecognized msg len: ${e.length} msg: ${e.slice(0,30)}`)}submitDrawableRequest(t,e,i,s){if(!(this._websocket&&e&&e._typename&&i.snapid&&(0,f.isStr)(i.snapid)))return null;if(t&&s){i._requests||(i._requests={});let a=i._requests[t];if(a){let n=(new Date).getTime();if(!a._tm||n-a._tm<5e3)return a._nextreq=e,!1;delete i._requests[t]}i._requests[t]=e}e.id=i.snapid,s?(this._nextreqid||(this._nextreqid=1),e.reqid=this._nextreqid++):e.reqid=0;let r=JSON.stringify(e);return e.reqid&&(e._kind=t,e._painter=i,e._method=s,e._tm=(new Date).getTime(),this._submreq||(this._submreq={}),this._submreq[e.reqid]=e),this.sendWebsocket("REQ:"+r),e}submitMenuRequest(t,e,i){var s=this;return(0,F.Z)(function*(){return new Promise(r=>{s.submitDrawableRequest("",{_typename:"ROOT::Experimental::RDrawableMenuRequest",menukind:e||"",menureqid:i},t,r)})})()}submitExec(t,e,i){if(this._websocket){if(i&&(0,f.isStr)(i)){let s=i.length;if(s>2&&i.indexOf("#x")==s-2?i="x":s>2&&i.indexOf("#y")==s-2?i="y":s>2&&i.indexOf("#z")==s-2&&(i="z"),"x"!=i&&"y"!=i&&"z"!=i)return console.log(`not recoginzed subelem ${i} in SubmitExec`);e=i+"axis#"+e}this.submitDrawableRequest("",{_typename:"ROOT::Experimental::RDrawableExecRequest",exec:e},t)}}processDrawableReply(t){let e=(0,f.parse)(t);if(!e||!e.reqid||!this._submreq)return!1;let i=this._submreq[e.reqid];if(!i)return!1;delete this._submreq[e.reqid],i._kind&&i._painter?._requests&&i._painter._requests[i._kind]===i&&delete i._painter._requests[i._kind],i._method&&i._method(e,i),i._nextreq&&!i._painter._requests[i._kind]&&this.submitDrawableRequest(i._kind,i._nextreq,i._painter,i._method)}showSection(t,e){var i=this;return(0,F.Z)(function*(){switch(t){case"Menu":case"StatusBar":case"Editor":case"ToolBar":break;case"ToolTips":i.setTooltipAllowed(e)}return!0})()}processChanges(t,e,i){if(this._websocket&&this._websocket.canSend(2)&&(0,f.isStr)(t))switch(e||(e=this),t){case"sbits":console.log("Status bits in RCanvas are changed - that to do?");break;case"frame":case"zoom":console.log("Frame moved or zoom is changed - that to do?");break;case"pave_moved":console.log("TPave is moved inside RCanvas - that to do?");break;default:"exec:"==t.slice(0,5)&&e?.snapid?this.submitExec(e,t.slice(5),i):console.log("UNPROCESSED CHANGES",t)}}clickPadButton(t,e){return"ToggleGed"==t?this.activateGed(this,null,"toggle"):"ToggleStatus"==t?this.activateStatusBar("toggle"):void super.clickPadButton(t,e)}hasEventStatus(){if(this.testUI5())return!1;if(this.brlayout)return this.brlayout.hasStatus();let t=(0,K.nh)();return!!t&&t.hasStatusLine()}activateStatusBar(t){this.testUI5()||(this.brlayout?this.brlayout.createStatusLine(23,t):(0,K.nh)()?.createStatusLine(23,t),this.processChanges("sbits",this))}showCanvasStatus(...t){this.testUI5()||(this.brlayout||(0,K.nh)()?.brlayout)?.showStatus(...t)}hasGed(){return!this.testUI5()&&(this.brlayout?.hasContent()??!1)}removeGed(){this.testUI5()||(this.registerForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout?.deleteContent(!0),this.processChanges("sbits",this))}getUi5PanelData(){return{jsroot:{settings:f.settings,create:f.create,parse:f.parse,toJSON:f.toJSON,loadScript:f.loadScript,EAxisBits:Z.VO,getColorExec:B.Aq}}}activateGed(t,e,i){var s=this;return(0,F.Z)(function*(){if(s.testUI5()||!s.brlayout)return!1;if(s.brlayout.hasContent())return"toggle"===i||!1===i?s.removeGed():t?.getPadPainter()?.selectObjectPainter(t),!0;if(!1===i)return!1;let r=s.brlayout.createBrowserBtns();return B.KL.createSVG(r,B.KL.diamand,15,"toggle fix-pos mode").style("margin","3px").on("click",()=>s.brlayout.toggleKind("fix")),B.KL.createSVG(r,B.KL.circle,15,"toggle float mode").style("margin","3px").on("click",()=>s.brlayout.toggleKind("float")),B.KL.createSVG(r,B.KL.cross,15,"delete GED").style("margin","3px").on("click",()=>s.removeGed()),s.brlayout.setBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>"),s.brlayout.setBrowserTitle("GED"),s.brlayout.toggleBrowserKind(e||"float"),new Promise(a=>{B.OA.then(n=>{(0,W.Ys)("#ged_placeholder").text(""),n.ui.define(["sap/ui/model/json/JSONModel","sap/ui/core/mvc/XMLView"],(u,g)=>{let x=new u({handle:null});g.create({viewName:"rootui5.canv.view.Ged",viewData:s.getUi5PanelData("Ged")}).then(y=>{y.setModel(x),y.placeAt("ged_placeholder"),s.ged_view=y,s.registerForPadEvents(y.getController().padEventsReceiver.bind(y.getController())),t?.getPadPainter()?.selectObjectPainter(t),s.processChanges("sbits",s),a(!0)})})})})})()}produceJSON(){return console.error("RCanvasPainter.produceJSON not yet implemented"),""}static draw(t,e){return(0,F.Z)(function*(){let i=!e;i&&(e=(0,f.create)("ROOT::Experimental::RCanvas"));let s=new j(t,e);return s.normal_canvas=!i,s.createCanvasSvg(0),(0,Z.O5)({pp:s,active:!1}),s.drawPrimitives().then(()=>(s.addPadButtons(),s.showPadButtons(),s))})()}}function P(_,t){let e=new j(_,null);return e.normal_canvas=!1,e.batch_mode=(0,f.isBatchMode)(),e.syncDraw(!0).then(()=>e.redrawPadSnap(t)).then(()=>(e.confirmDraw(),e.showPadButtons(),e))}function I(_,t){return Y.apply(this,arguments)}function Y(){return(Y=(0,F.Z)(function*(_,t){return _?(_.getCanvSvg().empty()?j.draw(_.getDom(),null):Promise.resolve(!0)).then(()=>{if(!1!==t&&_.getFrameSvg().select(".main_layer").empty())return o.draw(_.getDom(),null,(0,f.isStr)(t)?t:"")}).then(()=>(_.addToPadPrimitives(),_)):Promise.reject(Error("Painter not provided in ensureRCanvas"))})).apply(this,arguments)}function N(_,t){let e=this.getFramePainter();if(!e)return console.log("no frame painter - no title");let i=e.getFrameRect(),s=i.x,r=i.y,a=i.width,n=this.getPadPainter().getPadHeight(),u=this.getObject(),g=this.v7EvalLength("margin",n,.02),x=a,y=this.v7EvalLength("height",n,.05),k=this.v7EvalFont("text",{size:.07,color:"black",align:22});if("drag"==_){y=t.height,g=r-t.y-t.height;let R={};this.v7AttrChange(R,"margin",g/n),this.v7AttrChange(R,"height",y/n),this.v7SendAttrChanges(R,!1)}this.createG(),this.draw_g.attr("transform",`translate(${s},${Math.round(r-g-y)})`);let S={x:x/2,y:y/2,text:u.fText,latex:1};return this.startTextDrawing(k,"font"),this.drawText(S),this.finishTextDrawing().then(()=>{(0,f.isBatchMode)()||(0,c.uI)(this,{x:s,y:Math.round(r-g-y),width:x,height:y,minwidth:20,minheight:20,no_change_x:!0,redraw:R=>this.redraw("drag",R)})})}function X(){let _=this.getObject(),t=this.getCanvSvg(),e=t.select(".canvas_defs"),i="custom_font_"+_.fFamily+_.fWeight+_.fStyle;e.empty()&&(e=t.insert("svg:defs",":first-child").attr("class","canvas_defs"));let s=e.select("."+i);return s.empty()&&(s=e.append("style").attr("type","text/css").attr("class",i)),s.text(`@font-face { font-family: "${_.fFamily}"; font-weight: ${_.fWeight?_.fWeight:"normal"}; font-style: ${_.fStyle?_.fStyle:"normal"}; src: ${_.fSrc}; }`),_.fDefault&&(this.getPadPainter()._dfltRFont=_),!0}function G(_,t,e){let i=new m.C(_,t,e);return i.disable_zooming=!0,I(i,!1).then(()=>i.redraw()).then(()=>i)}function U(_,t,e){let i=new o(_,t);return"3d"==e&&(i.mode3d=!0),I(i,!1).then(()=>i.redraw())}(0,f.registerMethods)("ROOT::Experimental::RPalette",{extractRColor:_=>_.fColor||"black",getColor(_){return this.palette[_]},getContourIndex(_){let s,t=this.fContour,e=0,i=t.length-1;if(_<t[0])return-1;if(_>=t[i])return i-1;if(this.fCustomContour){for(;e<i-1;)s=Math.round((e+i)/2),t[s]>_?i=s:e=s;return e}return Math.floor((_-t[0])/(t[i-1]-t[0])*(i-1))},getContourColor(_){let t=this.getContourIndex(_);return t<0?"":this.getColor(t)},getContour(){return this.fContour&&this.fContour.length>1?this.fContour:null},deleteContour(){delete this.fContour},calcColor(_,t,e){let i=e.fOrdinal-t.fOrdinal,s=e.fOrdinal-_,r=_-t.fOrdinal;if(!this.fInterpolate||i<=0)return s<r?e.fColor:t.fColor;let a=(0,W.B8)(this.extractRColor(t.fColor)),n=(0,W.B8)(this.extractRColor(e.fColor));return(0,W.B8)(Math.round((a.r*s+n.r*r)/i),Math.round((a.g*s+n.g*r)/i),Math.round((a.b*s+n.b*r)/i)).toString()},createPaletteColors(_){let t=[],e=0;for(;t.length<_;){let i=t.length/(_-1),s=this.fColors[e];if(Math.abs(s.fOrdinal-i)<1e-4||e==this.fColors.length-1){t.push(this.extractRColor(s.fColor));continue}let r=this.fColors[e+1];r.fOrdinal<=i?e++:t.push(this.calcColor(i,s,r))}return t},getColorOrdinal(_){if(!this.fColors)return"black";"number"!=typeof _||_<0?_=0:_>1&&(_=1);let t,e=this.fColors[0];for(let i=0;i<this.fColors.length-1;++i){if(t=e,Math.abs(t.fOrdinal-_)<1e-4)return this.extractRColor(t.fColor);if(e=this.fColors[i+1],e.fOrdinal>_)return this.calcColor(_,t,e)}return this.extractRColor(e.fColor)},setFullRange(_,t){this.full_min=_,this.full_max=t},createContour(_,t,e,i,s){if(this.fContour=[],delete this.fCustomContour,this.colzmin=e,this.colzmax=i,_){this.colzmax<=0&&(this.colzmax=1),this.colzmin<=0&&(this.colzmin=void 0===s||s<=0?1e-4*this.colzmax:s<3||s>100?.3*s:1),this.colzmin>=this.colzmax&&(this.colzmin=1e-4*this.colzmax);let r=Math.log(this.colzmin)/Math.log(10),n=(Math.log(this.colzmax)/Math.log(10)-r)/t;this.fContour.push(this.colzmin);for(let u=1;u<t;u++)this.fContour.push(Math.exp((r+n*u)*Math.log(10)));this.fContour.push(this.colzmax),this.fCustomContour=!0}else{this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin));let r=(this.colzmax-this.colzmin)/t;for(let a=0;a<=t;a++)this.fContour.push(this.colzmin+r*a)}(!this.palette||this.palette.length!=t)&&(this.palette=this.createPaletteColors(t))}})}}]);
//# sourceMappingURL=717.92b025f5f9cba505.js.map